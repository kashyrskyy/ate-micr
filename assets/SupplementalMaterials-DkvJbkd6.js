import{H as F,j as e,B as c,o as b,T as h,ay as N,Y as Q,ag as V,Z as Y,ah as Z,ai as _,ap as E,aw as te,ar as ne,af as R,d as r,a5 as ae,a4 as ie,a6 as re,a7 as oe,as as L,au as O,at as U,al as z,az as ce,aA as de,G as C,q as ue,A as he,Q as w,an as xe,R as pe,U as be,aq as me}from"./index-Cg8SDaoS.js";const je=()=>{const l=F(),n=()=>{l("/")};return e.jsxs(c,{children:[e.jsx(c,{className:"supplemental-header",children:e.jsx(b,{variant:"text",onClick:n,className:"supplemental-back-button",children:"← Home Page"})}),e.jsx(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:e.jsx(h,{className:"supplemental-title",children:"Course Materials"})})]})},ge=()=>{const l=F();return e.jsx(b,{className:"add-material-button",variant:"contained",color:"primary",onClick:()=>l("/add-material"),children:"+ Add Material"})},fe=({materialId:l,open:n,onClose:t,onDelete:a})=>{const u=N(),o=async()=>{const i=E(u,"materials",l);await te(i),a(),t()};return e.jsxs(Q,{open:n,onClose:t,children:[e.jsx(V,{children:"Delete Material"}),e.jsx(Y,{children:e.jsx(Z,{children:"Are you sure you want to delete this material? This action cannot be undone."})}),e.jsxs(_,{children:[e.jsx(b,{onClick:t,color:"primary",children:"Cancel"}),e.jsx(b,{onClick:o,color:"secondary",children:"Delete"})]})]})},Ce=({materialId:l,onClick:n})=>e.jsx(b,{variant:"contained",color:"error",onClick:()=>n(l),sx:{backgroundColor:"#FFCDD2",color:"#C62828",borderRadius:"15px",fontWeight:"bold",padding:"4px 8px",ml:1,textTransform:"none"},children:"Unpublish"}),ve=({materialId:l,open:n,onClose:t,onUnpublish:a})=>{const u=N(),o=async()=>{const i=E(u,"materials",l);await ne(i,{published:!1}),a(),t()};return e.jsxs(Q,{open:n,onClose:t,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(V,{id:"alert-dialog-title",children:"Unpublish Material"}),e.jsx(Y,{children:e.jsx(Z,{id:"alert-dialog-description",children:"Are you sure you want to unpublish this material? It will no longer be visible to users until it is published again."})}),e.jsxs(_,{children:[e.jsx(b,{onClick:t,color:"primary",children:"Cancel"}),e.jsx(b,{onClick:o,color:"error",autoFocus:!0,children:"Unpublish"})]})]})},ye=({selectedCourse:l,onCourseChange:n,onCoursesLoaded:t})=>{const{userDetails:a}=R(),[u,o]=r.useState([]);return r.useEffect(()=>{if(a!=null&&a.classes){const i=Object.entries(a.classes).map(([m,x])=>({id:m,number:x.number,title:x.title}));o(i),t&&i.length>0&&!l&&t(i[0].id)}else o([]),t&&t(null)},[a,t]),e.jsx(c,{sx:{width:"100%",mb:2},children:u.length>0?e.jsxs(ae,{sx:{width:"30%"},children:[e.jsx(ie,{id:"course-selector-label",children:"Select Course"}),e.jsx(re,{labelId:"course-selector-label",value:l,onChange:i=>n(i.target.value),children:u.map(i=>e.jsxs(oe,{value:i.id,children:[i.number," - ",i.title]},i.id))})]}):e.jsx(h,{variant:"body1",align:"center",children:"No Courses Available"})})},ke=()=>{const{userDetails:l}=R(),n=N(),[t,a]=r.useState([]),[u,o]=r.useState(!0),[i,m]=r.useState(!1),[x,T]=r.useState(!1),[v,J]=r.useState(!1),[d,B]=r.useState(null),[y,H]=r.useState(null),[j,P]=r.useState({open:!1,materialId:null}),[k,D]=r.useState(null),S=F(),K=async()=>{if(!d)return;const s=E(n,"courses",d),g=await me(s);if(g.exists()){const p=g.data(),f=(p==null?void 0:p.courseAdmin)||[];T(f.includes(l==null?void 0:l.uid))}else T(!1)};r.useEffect(()=>{K()},[d,l]),r.useEffect(()=>{if(!d){console.log("No course selected"),a([]),o(!1);return}if(!v){console.log("Initial load in progress, skipping fetch");return}console.log(`Fetching materials for course: ${d}`),o(!0);const s=l!=null&&l.isAdmin?L(z(n,"materials"),U("course","==",d),O("timestamp","desc")):L(z(n,"materials"),U("course","==",d),U("published","==",!0),O("timestamp","desc")),g=ce(s,p=>{const f=p.docs.map(G=>({id:G.id,...G.data()}));a(f),console.log(`Fetched ${f.length} materials for course: ${d}`),o(!1)},p=>{console.error(p),D("Failed to fetch materials"),o(!1)});return()=>g()},[n,d,l,v]);const I=s=>{H(s),m(!0)},X=()=>{m(!1),H(null)},ee=()=>{a(t.filter(s=>s.id!==y))},M=s=>{P({open:!0,materialId:s})},se=()=>{a(t.map(s=>s.id===j.materialId?{...s,published:!1}:s))},le=()=>{P({open:!1,materialId:null})};if(u)return e.jsx(de,{});const $=t.filter(s=>!s.published&&!s.scheduledTimestamp),W=t.filter(s=>s.scheduledTimestamp&&!s.published),q=t.filter(s=>s.published);return e.jsxs(c,{sx:{width:"100%"},children:[e.jsx(ye,{selectedCourse:d||"",onCourseChange:s=>{o(!0),B(s)},onCoursesLoaded:s=>{v||(console.log("Setting first course from onCoursesLoaded:",s),B(s),J(!0))}}),t.length===0&&d&&e.jsx(h,{variant:"body1",align:"center",sx:{width:"100%",mb:4},children:"No materials found for the selected course."}),x&&t.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{sx:{mb:4},children:[e.jsx(h,{variant:"h6",sx:{fontWeight:"bold",color:"#F57C00",mb:2},children:"Saved"}),e.jsx(C,{container:!0,spacing:3,children:$.length===0?e.jsx(h,{variant:"body1",align:"center",sx:{width:"100%"},children:"No saved (unpublished) materials found."}):$.map(s=>e.jsx(A,{material:s,isCourseAdmin:x,navigate:S,onDeleteClick:I,onUnpublishClick:M},s.id))})]}),e.jsxs(c,{sx:{mb:4},children:[e.jsx(h,{variant:"h6",sx:{fontWeight:"bold",color:"#0D47A1",mb:2},children:"Publish Scheduled"}),e.jsx(C,{container:!0,spacing:3,children:W.length===0?e.jsx(h,{variant:"body1",align:"center",sx:{width:"100%"},children:"No materials scheduled for publishing found."}):W.map(s=>e.jsx(A,{material:s,isCourseAdmin:x,navigate:S,onDeleteClick:I,onUnpublishClick:M},s.id))})]})]}),e.jsxs(c,{sx:{mb:4},children:[e.jsx(h,{variant:"h6",sx:{fontWeight:"bold",color:"#2E7D32",mb:2},children:"Published"}),e.jsx(C,{container:!0,spacing:3,children:q.length===0?e.jsx(h,{variant:"body1",align:"center",sx:{width:"100%"},children:"No published materials found."}):q.map(s=>e.jsx(A,{material:s,isCourseAdmin:x,navigate:S,onDeleteClick:I,onUnpublishClick:M},s.id))})]}),y&&e.jsx(fe,{materialId:y,open:i,onClose:X,onDelete:ee}),j.materialId&&e.jsx(ve,{materialId:j.materialId,open:j.open,onClose:le,onUnpublish:se}),k&&e.jsx(ue,{open:!0,autoHideDuration:6e3,onClose:()=>D(null),children:e.jsx(he,{onClose:()=>D(null),severity:"error",children:k})},k)]})},A=({material:l,isCourseAdmin:n,navigate:t,onDeleteClick:a,onUnpublishClick:u})=>e.jsx(C,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(c,{sx:{border:"1px solid #ddd",borderRadius:"8px",padding:2,position:"relative",backgroundColor:l.published?"#E8F5E9":"#FFF9C4"},children:[e.jsx(w,{onClick:()=>t(`/view-material/${l.id}`),"aria-label":"view",children:e.jsx(xe,{})}),e.jsx(h,{variant:"h6",children:l.title||"Untitled"}),e.jsx(c,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1},children:n&&e.jsxs(e.Fragment,{children:[e.jsx(w,{onClick:()=>t(`/edit-material/${l.id}`),"aria-label":"edit",children:e.jsx(pe,{})}),e.jsx(w,{onClick:()=>a(l.id),"aria-label":"delete",children:e.jsx(be,{})}),l.published&&e.jsx(Ce,{materialId:l.id,onClick:u})]})})]})}),Se=()=>{const{userDetails:l}=R();return e.jsxs(c,{className:"supplemental-container",children:[e.jsx(je,{}),e.jsxs(c,{className:"supplemental-content",children:[(l==null?void 0:l.isAdmin)&&e.jsx(ge,{}),e.jsx(ke,{})]})]})};export{Se as default};
