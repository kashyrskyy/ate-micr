import{I,j as e,B as o,p as c,T as u,ay as w,Z as O,ah as z,$ as L,ai as V,aj as Z,ap as N,aw as se,ar as te,ag as F,e as r,as as _,au as G,at as U,am as q,az as ne,aA as ae,G as g,t as le,A as ie,R as A,U as re,V as oe,aq as de}from"./index-sjg4052-.js";import{d as ce}from"./Visibility-CZuaYwy0.js";const ue=()=>{const t=I(),a=()=>{t("/")};return e.jsxs(o,{children:[e.jsx(o,{className:"supplemental-header",children:e.jsx(c,{variant:"text",onClick:a,className:"supplemental-back-button",children:"← Home Page"})}),e.jsx(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:e.jsx(u,{className:"supplemental-title",children:"Course Materials"})})]})},he=()=>{const t=I();return e.jsx(c,{className:"add-material-button",variant:"contained",color:"primary",onClick:()=>t("/add-material"),children:"+ Add Material"})},xe=({materialId:t,open:a,onClose:n,onDelete:i})=>{const d=w(),l=async()=>{const h=N(d,"materials",t);await se(h),i(),n()};return e.jsxs(O,{open:a,onClose:n,children:[e.jsx(z,{children:"Delete Material"}),e.jsx(L,{children:e.jsx(V,{children:"Are you sure you want to delete this material? This action cannot be undone."})}),e.jsxs(Z,{children:[e.jsx(c,{onClick:n,color:"primary",children:"Cancel"}),e.jsx(c,{onClick:l,color:"secondary",children:"Delete"})]})]})},pe=({materialId:t,onClick:a})=>e.jsx(c,{variant:"contained",color:"error",onClick:()=>a(t),sx:{backgroundColor:"#FFCDD2",color:"#C62828",borderRadius:"15px",fontWeight:"bold",padding:"4px 8px",ml:1,textTransform:"none"},children:"Unpublish"}),be=({materialId:t,open:a,onClose:n,onUnpublish:i})=>{const d=w(),l=async()=>{const h=N(d,"materials",t);await te(h,{published:!1}),i(),n()};return e.jsxs(O,{open:a,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(z,{id:"alert-dialog-title",children:"Unpublish Material"}),e.jsx(L,{children:e.jsx(V,{id:"alert-dialog-description",children:"Are you sure you want to unpublish this material? It will no longer be visible to users until it is published again."})}),e.jsxs(Z,{children:[e.jsx(c,{onClick:n,color:"primary",children:"Cancel"}),e.jsx(c,{onClick:l,color:"error",autoFocus:!0,children:"Unpublish"})]})]})},me=({selectedCourse:t,onCourseChange:a})=>{const{userDetails:n}=F(),[i,d]=r.useState([]);return r.useEffect(()=>{if(n!=null&&n.classes){const l=Object.entries(n.classes).map(([h,b])=>({id:h,number:b.number,title:b.title}));d(l)}else d([])},[n]),e.jsx(o,{sx:{display:"flex",gap:2,mb:2},children:i.length>0?i.map(l=>e.jsxs(c,{variant:t===l.id?"contained":"outlined",onClick:()=>a(l.id),children:[l.number," - ",l.title]},l.id)):e.jsx(c,{variant:"outlined",disabled:!0,children:"No Courses Available"})})},je=()=>{const{userDetails:t}=F(),a=w(),[n,i]=r.useState([]),[d,l]=r.useState(!0),[h,b]=r.useState(!1),[m,E]=r.useState(!1),[x,J]=r.useState(null),[C,R]=r.useState(null),[j,T]=r.useState({open:!1,materialId:null}),[B,v]=r.useState(null),y=I(),K=async()=>{if(!x)return;const s=N(a,"courses",x),f=await de(s);if(f.exists()){const p=f.data(),S=(p==null?void 0:p.courseAdmin)||[];E(S.includes(t==null?void 0:t.uid))}else E(!1)};r.useEffect(()=>{K()},[x,t]),r.useEffect(()=>{if(!t)return;l(!0);const s=t.isAdmin?_(q(a,"materials"),U("course","==",x),G("timestamp","desc")):_(q(a,"materials"),U("course","==",x),U("published","==",!0),G("timestamp","desc")),f=ne(s,p=>{const S=p.docs.map(W=>({id:W.id,...W.data()}));i(S),l(!1)},p=>{console.error(p),v("Failed to fetch materials"),l(!1)});return()=>f()},[a,t,x]);const k=s=>{R(s),b(!0)},Q=()=>{b(!1),R(null)},X=()=>{i(n.filter(s=>s.id!==C))},D=s=>{T({open:!0,materialId:s})},Y=()=>{i(n.map(s=>s.id===j.materialId?{...s,published:!1}:s))},ee=()=>{T({open:!1,materialId:null})};if(d)return e.jsx(ae,{});const P=n.filter(s=>!s.published&&!s.scheduledTimestamp),$=n.filter(s=>s.scheduledTimestamp&&!s.published),H=n.filter(s=>s.published);return e.jsxs(o,{sx:{width:"100%"},children:[e.jsx(me,{selectedCourse:x||"",onCourseChange:s=>{l(!0),J(s)}}),m&&e.jsxs(e.Fragment,{children:[e.jsxs(o,{sx:{mb:4},children:[e.jsx(u,{variant:"h6",sx:{fontWeight:"bold",color:"#F57C00",mb:2},children:"Saved"}),e.jsx(g,{container:!0,spacing:3,children:P.length===0?e.jsx(u,{variant:"body1",align:"center",sx:{width:"100%"},children:"No saved (unpublished) materials found."}):P.map(s=>e.jsx(M,{material:s,isCourseAdmin:m,navigate:y,onDeleteClick:k,onUnpublishClick:D},s.id))})]}),e.jsxs(o,{sx:{mb:4},children:[e.jsx(u,{variant:"h6",sx:{fontWeight:"bold",color:"#0D47A1",mb:2},children:"Publish Scheduled"}),e.jsx(g,{container:!0,spacing:3,children:$.length===0?e.jsx(u,{variant:"body1",align:"center",sx:{width:"100%"},children:"No materials scheduled for publishing found."}):$.map(s=>e.jsx(M,{material:s,isCourseAdmin:m,navigate:y,onDeleteClick:k,onUnpublishClick:D},s.id))})]})]}),e.jsxs(o,{sx:{mb:4},children:[e.jsx(u,{variant:"h6",sx:{fontWeight:"bold",color:"#2E7D32",mb:2},children:"Published"}),e.jsx(g,{container:!0,spacing:3,children:H.length===0?e.jsx(u,{variant:"body1",align:"center",sx:{width:"100%"},children:"No published materials found."}):H.map(s=>e.jsx(M,{material:s,isCourseAdmin:m,navigate:y,onDeleteClick:k,onUnpublishClick:D},s.id))})]}),C&&e.jsx(xe,{materialId:C,open:h,onClose:Q,onDelete:X}),j.materialId&&e.jsx(be,{materialId:j.materialId,open:j.open,onClose:ee,onUnpublish:Y}),B&&e.jsx(le,{open:!0,autoHideDuration:6e3,onClose:()=>v(null),children:e.jsx(ie,{onClose:()=>v(null),severity:"error",children:B})})]})},M=({material:t,isCourseAdmin:a,navigate:n,onDeleteClick:i,onUnpublishClick:d})=>e.jsx(g,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(o,{sx:{border:"1px solid #ddd",borderRadius:"8px",padding:2,position:"relative",backgroundColor:t.published?"#E8F5E9":"#FFF9C4"},children:[e.jsx(A,{onClick:()=>n(`/view-material/${t.id}`),"aria-label":"view",children:e.jsx(ce,{})}),e.jsx(u,{variant:"h6",children:t.title||"Untitled"}),e.jsx(o,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1},children:a&&e.jsxs(e.Fragment,{children:[e.jsx(A,{onClick:()=>n(`/edit-material/${t.id}`),"aria-label":"edit",children:e.jsx(re,{})}),e.jsx(A,{onClick:()=>i(t.id),"aria-label":"delete",children:e.jsx(oe,{})}),t.published&&e.jsx(pe,{materialId:t.id,onClick:d})]})})]})}),Ce=()=>{const{userDetails:t}=F();return e.jsxs(o,{className:"supplemental-container",children:[e.jsx(ue,{}),e.jsxs(o,{className:"supplemental-content",children:[(t==null?void 0:t.isAdmin)&&e.jsx(he,{}),e.jsx(je,{})]})]})};export{Ce as default};
