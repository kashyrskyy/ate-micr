import{s as Xr,_ as Pn,e as W,u as Zr,f as Kr,L as Jr,j as o,h as es,i as ts,E as ns,H as Ot,I as rs,B as Vt,p as Be,T as ss,J as ln,q as Qt,K as is,t as ht,A as mt,M as os,P as as,N as ls,O as cs,Q as En,R as Le,U as ds,V as Xe,W as yr,X as Xt,Y as Wn,Z as cn,$ as us,k as gt,l as pt,a0 as St,a1 as Ct,a2 as jt,a3 as It,a4 as Tr,a5 as Ar,a6 as fn,a7 as fs,a8 as nr,a9 as pn,aa as _t,ab as hs,ac as ms,ad as gs,ae as ps,af as bn,ag as bs,ah as Bn,ai as kt,aj as Kt,ak as Ut,al as Zt,am as $n,an as ke,ao as ae,ap as ut,aq as De,ar as xs,as as jn,at as ze,au as Ee,av as rt,aw as ft,ax as Dt,ay as vs}from"./index-DIIgBpbh.js";import{d as In}from"./Visibility-Ch9Rfn1_.js";const ys=["className"],Ts=h=>{const{alignItems:p,classes:R}=h;return ts({root:["root",p==="flex-start"&&"alignItemsFlexStart"]},ns,R)},As=Xr("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(h,p)=>{const{ownerState:R}=h;return[p.root,R.alignItems==="flex-start"&&p.alignItemsFlexStart]}})(({theme:h,ownerState:p})=>Pn({minWidth:56,color:(h.vars||h).palette.action.active,flexShrink:0,display:"inline-flex"},p.alignItems==="flex-start"&&{marginTop:8})),Ss=W.forwardRef(function(p,R){const c=Zr({props:p,name:"MuiListItemIcon"}),{className:e}=c,t=Kr(c,ys),d=W.useContext(Jr),i=Pn({},c,{alignItems:d.alignItems}),y=Ts(i);return o.jsx(As,Pn({className:es(y.root,e),ownerState:i,ref:R},t))}),Cs=W.memo(({setIsAdding:h})=>{const{userDetails:p,isSuperAdmin:R}=Ot();console.log("Header loaded");const c=rs(),[e,t]=W.useState(!1),[d,i]=W.useState(!1),y=()=>{p!=null&&p.uid?navigator.clipboard.writeText(p.uid).then(()=>{t(!0),i(!0)}).catch(s=>{console.error("Could not copy text: ",s)}):console.error("User details are null or undefined")},S=(s,r)=>{r!=="clickaway"&&t(!1)},n=()=>{c("/")};return o.jsxs(Vt,{sx:{mt:3,mb:2},children:[o.jsx(Vt,{sx:{display:"flex",alignItems:"center"},children:o.jsx(Be,{variant:"text",onClick:n,sx:{mr:2},children:"← Home Page"})}),o.jsx(ss,{variant:"h4",component:"h1",gutterBottom:!0,textAlign:"left",sx:{fontWeight:"bold"},children:"My Laboratory Notebook"}),p&&o.jsxs(Vt,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:[R&&o.jsx(ln,{label:"Super-Admin",variant:"outlined",sx:{borderRadius:"15px",fontWeight:"bold",background:"#ffcdd2",color:"#c62828",mr:1}}),(p==null?void 0:p.isAdmin)&&!R&&o.jsx(ln,{label:"Educator",variant:"outlined",sx:{borderRadius:"15px",fontWeight:"bold",background:"#ffcdd2",color:"#c62828",mr:1}}),!(p!=null&&p.isAdmin)&&o.jsx(ln,{label:"Student",variant:"outlined",sx:{borderRadius:"15px",fontWeight:"bold",background:"#bbdefb",color:"#1e88e5",mr:1}}),o.jsx(Qt,{title:d?"Copied!":"Click to Copy",enterDelay:300,leaveDelay:200,children:o.jsx(ln,{label:`User ID: ${p.uid}`,variant:"outlined",onClick:y,sx:{borderRadius:"15px",fontWeight:"bold",background:"#e0f2f1",color:"#00695c",mr:1,cursor:"pointer",transition:"background-color 0.3s"}})})]}),o.jsxs(Vt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx(Be,{variant:"contained",color:"primary",onClick:()=>h(!0),sx:{fontSize:"1.2rem",mt:2,textTransform:"none",minWidth:"150px",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"+ Create New"}),o.jsx(is,{})]}),o.jsx(ht,{open:e,autoHideDuration:6e3,onClose:S,children:o.jsx(mt,{onClose:S,severity:"success",sx:{width:"100%"},children:"User ID copied to clipboard!"})})]})}),Dn=({designs:h,handleEdit:p,handleDelete:R,isAdmin:c,userDetails:e,showUserIdColumn:t})=>{const d=i=>i?i instanceof Wn?i.toDate().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):i instanceof Date?i.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A":"N/A";return o.jsx(os,{component:as,children:o.jsxs(ls,{sx:{"& .MuiTableCell-root":{fontSize:"1rem"},"& .MuiTableCell-head":{fontSize:"1.2rem",backgroundColor:"#1A76D3",color:"white"}},children:[o.jsx(cs,{children:o.jsxs(En,{sx:{height:"60px"},children:[o.jsx(Le,{sx:{fontWeight:"bold",width:t?"30%":"40%"},children:"Title"}),o.jsx(Le,{sx:{fontWeight:"bold",width:"20%"},children:"Course"}),t&&o.jsx(Le,{sx:{fontWeight:"bold",width:"20%"},children:"User ID"}),o.jsx(Le,{sx:{fontWeight:"bold",width:"15%"},children:"Created"}),o.jsx(Le,{sx:{fontWeight:"bold",width:"15%"},children:"Last Edited"}),o.jsx(Le,{sx:{fontWeight:"bold",width:"10%"},children:"Edit"}),o.jsx(Le,{sx:{fontWeight:"bold",width:"10%"},children:"Delete"})]})}),o.jsx(ds,{children:h&&h.length>0?h.map(i=>{const y=i.userId===(e==null?void 0:e.uid);return o.jsxs(En,{sx:{height:"80px"},children:[o.jsx(Le,{children:o.jsx("button",{onClick:()=>p(i.id),className:"hyperlink-style",children:i.title})}),o.jsx(Le,{children:i.course||"N/A"})," ",t&&o.jsx(Le,{children:i.userId}),o.jsx(Le,{children:d(i.dateCreated)}),o.jsx(Le,{children:d(i.dateModified)}),o.jsx(Le,{children:o.jsx(Qt,{title:"Edit",children:o.jsx("span",{children:o.jsx(Xe,{onClick:()=>y&&p(i.id),color:"primary",disabled:!y,children:o.jsx(yr,{})})})})}),o.jsx(Le,{children:o.jsx(Qt,{title:"Delete",children:o.jsx("span",{children:o.jsx(Xe,{onClick:()=>y&&R(i.id),color:"error",disabled:!y,children:o.jsx(Xt,{})})})})})]},i.id)}):o.jsx(En,{children:o.jsx(Le,{colSpan:t?6:5,children:"No Designs Found"})})})]})})};function ws(h,p){return p.forEach(function(R){R&&typeof R!="string"&&!Array.isArray(R)&&Object.keys(R).forEach(function(c){if(c!=="default"&&!(c in h)){var e=Object.getOwnPropertyDescriptor(R,c);Object.defineProperty(h,c,e.get?e:{enumerable:!0,get:function(){return R[c]}})}})}),Object.freeze(h)}function Sr(h,p){return new Promise(function(R,c){let e;return _s(h).then(function(t){try{return e=t,R(new Blob([p.slice(0,2),e,p.slice(2)],{type:"image/jpeg"}))}catch(d){return c(d)}},c)})}const _s=h=>new Promise((p,R)=>{const c=new FileReader;c.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let d=0;if(t.getUint16(d)!==65496)return R("not a valid JPEG");for(d+=2;;){const i=t.getUint16(d);if(i===65498)break;const y=t.getUint16(d+2);if(i===65505&&t.getUint32(d+4)===1165519206){const S=d+10;let n;switch(t.getUint16(S)){case 18761:n=!0;break;case 19789:n=!1;break;default:return R("TIFF header contains invalid endian")}if(t.getUint16(S+2,n)!==42)return R("TIFF header contains invalid version");const s=t.getUint32(S+4,n),r=S+s+2+12*t.getUint16(S+s,n);for(let l=S+s+2;l<r;l+=12)if(t.getUint16(l,n)==274){if(t.getUint16(l+2,n)!==3)return R("Orientation data type is invalid");if(t.getUint32(l+4,n)!==1)return R("Orientation data count is invalid");t.setUint16(l+8,1,n);break}return p(e.slice(d,d+2+y))}d+=2+y}return p(new Blob)}),c.readAsArrayBuffer(h)});var xn={},Es={get exports(){return xn},set exports(h){xn=h}};(function(h){var p,R,c={};Es.exports=c,c.parse=function(e,t){for(var d=c.bin.readUshort,i=c.bin.readUint,y=0,S={},n=new Uint8Array(e),s=n.length-4;i(n,s)!=101010256;)s--;y=s,y+=4;var r=d(n,y+=4);d(n,y+=2);var l=i(n,y+=2),b=i(n,y+=4);y+=4,y=b;for(var I=0;I<r;I++){i(n,y),y+=4,y+=4,y+=4,i(n,y+=4),l=i(n,y+=4);var k=i(n,y+=4),w=d(n,y+=4),z=d(n,y+2),B=d(n,y+4);y+=6;var F=i(n,y+=8);y+=4,y+=w+z+B,c._readLocal(n,F,S,l,k,t)}return S},c._readLocal=function(e,t,d,i,y,S){var n=c.bin.readUshort,s=c.bin.readUint;s(e,t),n(e,t+=4),n(e,t+=2);var r=n(e,t+=2);s(e,t+=2),s(e,t+=4),t+=4;var l=n(e,t+=8),b=n(e,t+=2);t+=2;var I=c.bin.readUTF8(e,t,l);if(t+=l,t+=b,S)d[I]={size:y,csize:i};else{var k=new Uint8Array(e.buffer,t);if(r==0)d[I]=new Uint8Array(k.buffer.slice(t,t+i));else{if(r!=8)throw"unknown compression method: "+r;var w=new Uint8Array(y);c.inflateRaw(k,w),d[I]=w}}},c.inflateRaw=function(e,t){return c.F.inflate(e,t)},c.inflate=function(e,t){return e[0],e[1],c.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},c.deflate=function(e,t){t==null&&(t={level:6});var d=0,i=new Uint8Array(50+Math.floor(1.1*e.length));i[d]=120,i[d+1]=156,d+=2,d=c.F.deflateRaw(e,i,d,t.level);var y=c.adler(e,0,e.length);return i[d+0]=y>>>24&255,i[d+1]=y>>>16&255,i[d+2]=y>>>8&255,i[d+3]=y>>>0&255,new Uint8Array(i.buffer,0,d+4)},c.deflateRaw=function(e,t){t==null&&(t={level:6});var d=new Uint8Array(50+Math.floor(1.1*e.length)),i=c.F.deflateRaw(e,d,i,t.level);return new Uint8Array(d.buffer,0,i)},c.encode=function(e,t){t==null&&(t=!1);var d=0,i=c.bin.writeUint,y=c.bin.writeUshort,S={};for(var n in e){var s=!c._noNeed(n)&&!t,r=e[n],l=c.crc.crc(r,0,r.length);S[n]={cpr:s,usize:r.length,crc:l,file:s?c.deflateRaw(r):r}}for(var n in S)d+=S[n].file.length+30+46+2*c.bin.sizeUTF8(n);d+=22;var b=new Uint8Array(d),I=0,k=[];for(var n in S){var w=S[n];k.push(I),I=c._writeHeader(b,I,n,w,0)}var z=0,B=I;for(var n in S)w=S[n],k.push(I),I=c._writeHeader(b,I,n,w,1,k[z++]);var F=I-B;return i(b,I,101010256),I+=4,y(b,I+=4,z),y(b,I+=2,z),i(b,I+=2,F),i(b,I+=4,B),I+=4,I+=2,b.buffer},c._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},c._writeHeader=function(e,t,d,i,y,S){var n=c.bin.writeUint,s=c.bin.writeUshort,r=i.file;return n(e,t,y==0?67324752:33639248),t+=4,y==1&&(t+=2),s(e,t,20),s(e,t+=2,0),s(e,t+=2,i.cpr?8:0),n(e,t+=2,0),n(e,t+=4,i.crc),n(e,t+=4,r.length),n(e,t+=4,i.usize),s(e,t+=4,c.bin.sizeUTF8(d)),s(e,t+=2,0),t+=2,y==1&&(t+=2,t+=2,n(e,t+=6,S),t+=4),t+=c.bin.writeUTF8(e,t,d),y==0&&(e.set(r,t),t+=r.length),t},c.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var d=t,i=0;i<8;i++)1&d?d=3988292384^d>>>1:d>>>=1;e[t]=d}return e}(),update:function(e,t,d,i){for(var y=0;y<i;y++)e=c.crc.table[255&(e^t[d+y])]^e>>>8;return e},crc:function(e,t,d){return 4294967295^c.crc.update(4294967295,e,t,d)}},c.adler=function(e,t,d){for(var i=1,y=0,S=t,n=t+d;S<n;){for(var s=Math.min(S+5552,n);S<s;)y+=i+=e[S++];i%=65521,y%=65521}return y<<16|i},c.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255,e[t+2]=d>>16&255,e[t+3]=d>>24&255},readASCII:function(e,t,d){for(var i="",y=0;y<d;y++)i+=String.fromCharCode(e[t+y]);return i},writeASCII:function(e,t,d){for(var i=0;i<d.length;i++)e[t+i]=d.charCodeAt(i)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,d){for(var i,y="",S=0;S<d;S++)y+="%"+c.bin.pad(e[t+S].toString(16));try{i=decodeURIComponent(y)}catch{return c.bin.readASCII(e,t,d)}return i},writeUTF8:function(e,t,d){for(var i=d.length,y=0,S=0;S<i;S++){var n=d.charCodeAt(S);if(!(4294967168&n))e[t+y]=n,y++;else if(!(4294965248&n))e[t+y]=192|n>>6,e[t+y+1]=128|n>>0&63,y+=2;else if(!(4294901760&n))e[t+y]=224|n>>12,e[t+y+1]=128|n>>6&63,e[t+y+2]=128|n>>0&63,y+=3;else{if(4292870144&n)throw"e";e[t+y]=240|n>>18,e[t+y+1]=128|n>>12&63,e[t+y+2]=128|n>>6&63,e[t+y+3]=128|n>>0&63,y+=4}}return y},sizeUTF8:function(e){for(var t=e.length,d=0,i=0;i<t;i++){var y=e.charCodeAt(i);if(!(4294967168&y))d++;else if(!(4294965248&y))d+=2;else if(!(4294901760&y))d+=3;else{if(4292870144&y)throw"e";d+=4}}return d}},c.F={},c.F.deflateRaw=function(e,t,d,i){var y=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][i],S=c.F.U,n=c.F._goodIndex;c.F._hash;var s=c.F._putsE,r=0,l=d<<3,b=0,I=e.length;if(i==0){for(;r<I;)s(t,l,r+(A=Math.min(65535,I-r))==I?1:0),l=c.F._copyExact(e,r,A,t,l+8),r+=A;return l>>>3}var k=S.lits,w=S.strt,z=S.prev,B=0,F=0,H=0,x=0,M=0,f=0;for(I>2&&(w[f=c.F._hash(e,0)]=0),r=0;r<I;r++){if(M=f,r+1<I-2){f=c.F._hash(e,r+1);var u=r+1&32767;z[u]=w[f],w[f]=u}if(b<=r){(B>14e3||F>26697)&&I-r>100&&(b<r&&(k[B]=r-b,B+=2,b=r),l=c.F._writeBlock(r==I-1||b==I?1:0,k,B,x,e,H,r-H,t,l),B=F=x=0,H=r);var v=0;r<I-2&&(v=c.F._bestMatch(e,r,z,M,Math.min(y[2],I-r),y[3]));var A=v>>>16,C=65535&v;if(v!=0){C=65535&v;var E=n(A=v>>>16,S.of0);S.lhst[257+E]++;var T=n(C,S.df0);S.dhst[T]++,x+=S.exb[E]+S.dxb[T],k[B]=A<<23|r-b,k[B+1]=C<<16|E<<8|T,B+=2,b=r+A}else S.lhst[e[r]]++;F++}}for(H==r&&e.length!=0||(b<r&&(k[B]=r-b,B+=2,b=r),l=c.F._writeBlock(1,k,B,x,e,H,r-H,t,l),B=0,F=0,B=F=x=0,H=r);7&l;)l++;return l>>>3},c.F._bestMatch=function(e,t,d,i,y,S){var n=32767&t,s=d[n],r=n-s+32768&32767;if(s==n||i!=c.F._hash(e,t-r))return 0;for(var l=0,b=0,I=Math.min(32767,t);r<=I&&--S!=0&&s!=n;){if(l==0||e[t+l]==e[t+l-r]){var k=c.F._howLong(e,t,r);if(k>l){if(b=r,(l=k)>=y)break;r+2<k&&(k=r+2);for(var w=0,z=0;z<k-2;z++){var B=t-r+z+32768&32767,F=B-d[B]+32768&32767;F>w&&(w=F,s=B)}}}r+=(n=s)-(s=d[n])+32768&32767}return l<<16|b},c.F._howLong=function(e,t,d){if(e[t]!=e[t-d]||e[t+1]!=e[t+1-d]||e[t+2]!=e[t+2-d])return 0;var i=t,y=Math.min(e.length,t+258);for(t+=3;t<y&&e[t]==e[t-d];)t++;return t-i},c.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},c.saved=0,c.F._writeBlock=function(e,t,d,i,y,S,n,s,r){var l,b,I,k,w,z,B,F,H,x=c.F.U,M=c.F._putsF,f=c.F._putsE;x.lhst[256]++,b=(l=c.F.getTrees())[0],I=l[1],k=l[2],w=l[3],z=l[4],B=l[5],F=l[6],H=l[7];var u=32+(r+3&7?8-(r+3&7):0)+(n<<3),v=i+c.F.contSize(x.fltree,x.lhst)+c.F.contSize(x.fdtree,x.dhst),A=i+c.F.contSize(x.ltree,x.lhst)+c.F.contSize(x.dtree,x.dhst);A+=14+3*B+c.F.contSize(x.itree,x.ihst)+(2*x.ihst[16]+3*x.ihst[17]+7*x.ihst[18]);for(var C=0;C<286;C++)x.lhst[C]=0;for(C=0;C<30;C++)x.dhst[C]=0;for(C=0;C<19;C++)x.ihst[C]=0;var E=u<v&&u<A?0:v<A?1:2;if(M(s,r,e),M(s,r+1,E),r+=3,E==0){for(;7&r;)r++;r=c.F._copyExact(y,S,n,s,r)}else{var T,_;if(E==1&&(T=x.fltree,_=x.fdtree),E==2){c.F.makeCodes(x.ltree,b),c.F.revCodes(x.ltree,b),c.F.makeCodes(x.dtree,I),c.F.revCodes(x.dtree,I),c.F.makeCodes(x.itree,k),c.F.revCodes(x.itree,k),T=x.ltree,_=x.dtree,f(s,r,w-257),f(s,r+=5,z-1),f(s,r+=5,B-4),r+=4;for(var m=0;m<B;m++)f(s,r+3*m,x.itree[1+(x.ordr[m]<<1)]);r+=3*B,r=c.F._codeTiny(F,x.itree,s,r),r=c.F._codeTiny(H,x.itree,s,r)}for(var a=S,N=0;N<d;N+=2){for(var D=t[N],L=D>>>23,G=a+(8388607&D);a<G;)r=c.F._writeLit(y[a++],T,s,r);if(L!=0){var $=t[N+1],q=$>>16,V=$>>8&255,P=255&$;f(s,r=c.F._writeLit(257+V,T,s,r),L-x.of0[V]),r+=x.exb[V],M(s,r=c.F._writeLit(P,_,s,r),q-x.df0[P]),r+=x.dxb[P],a+=L}}r=c.F._writeLit(256,T,s,r)}return r},c.F._copyExact=function(e,t,d,i,y){var S=y>>>3;return i[S]=d,i[S+1]=d>>>8,i[S+2]=255-i[S],i[S+3]=255-i[S+1],S+=4,i.set(new Uint8Array(e.buffer,t,d),S),y+(d+4<<3)},c.F.getTrees=function(){for(var e=c.F.U,t=c.F._hufTree(e.lhst,e.ltree,15),d=c.F._hufTree(e.dhst,e.dtree,15),i=[],y=c.F._lenCodes(e.ltree,i),S=[],n=c.F._lenCodes(e.dtree,S),s=0;s<i.length;s+=2)e.ihst[i[s]]++;for(s=0;s<S.length;s+=2)e.ihst[S[s]]++;for(var r=c.F._hufTree(e.ihst,e.itree,7),l=19;l>4&&e.itree[1+(e.ordr[l-1]<<1)]==0;)l--;return[t,d,r,y,n,l,i,S]},c.F.getSecond=function(e){for(var t=[],d=0;d<e.length;d+=2)t.push(e[d+1]);return t},c.F.nonZero=function(e){for(var t="",d=0;d<e.length;d+=2)e[d+1]!=0&&(t+=(d>>1)+",");return t},c.F.contSize=function(e,t){for(var d=0,i=0;i<t.length;i++)d+=t[i]*e[1+(i<<1)];return d},c.F._codeTiny=function(e,t,d,i){for(var y=0;y<e.length;y+=2){var S=e[y],n=e[y+1];i=c.F._writeLit(S,t,d,i);var s=S==16?2:S==17?3:7;S>15&&(c.F._putsE(d,i,n,s),i+=s)}return i},c.F._lenCodes=function(e,t){for(var d=e.length;d!=2&&e[d-1]==0;)d-=2;for(var i=0;i<d;i+=2){var y=e[i+1],S=i+3<d?e[i+3]:-1,n=i+5<d?e[i+5]:-1,s=i==0?-1:e[i-1];if(y==0&&S==y&&n==y){for(var r=i+5;r+2<d&&e[r+2]==y;)r+=2;(l=Math.min(r+1-i>>>1,138))<11?t.push(17,l-3):t.push(18,l-11),i+=2*l-2}else if(y==s&&S==y&&n==y){for(r=i+5;r+2<d&&e[r+2]==y;)r+=2;var l=Math.min(r+1-i>>>1,6);t.push(16,l-3),i+=2*l-2}else t.push(y,0)}return d>>>1},c.F._hufTree=function(e,t,d){var i=[],y=e.length,S=t.length,n=0;for(n=0;n<S;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<y;n++)e[n]!=0&&i.push({lit:n,f:e[n]});var s=i.length,r=i.slice(0);if(s==0)return 0;if(s==1){var l=i[0].lit;return r=l==0?1:0,t[1+(l<<1)]=1,t[1+(r<<1)]=1,1}i.sort(function(F,H){return F.f-H.f});var b=i[0],I=i[1],k=0,w=1,z=2;for(i[0]={lit:-1,f:b.f+I.f,l:b,r:I,d:0};w!=s-1;)b=k!=w&&(z==s||i[k].f<i[z].f)?i[k++]:i[z++],I=k!=w&&(z==s||i[k].f<i[z].f)?i[k++]:i[z++],i[w++]={lit:-1,f:b.f+I.f,l:b,r:I};var B=c.F.setDepth(i[w-1],0);for(B>d&&(c.F.restrictDepth(r,d,B),B=d),n=0;n<s;n++)t[1+(r[n].lit<<1)]=r[n].d;return B},c.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(c.F.setDepth(e.l,t+1),c.F.setDepth(e.r,t+1))},c.F.restrictDepth=function(e,t,d){var i=0,y=1<<d-t,S=0;for(e.sort(function(s,r){return r.d==s.d?s.f-r.f:r.d-s.d}),i=0;i<e.length&&e[i].d>t;i++){var n=e[i].d;e[i].d=t,S+=y-(1<<d-n)}for(S>>>=d-t;S>0;)(n=e[i].d)<t?(e[i].d++,S-=1<<t-n-1):i++;for(;i>=0;i--)e[i].d==t&&S<0&&(e[i].d--,S++);S!=0&&console.log("debt left")},c.F._goodIndex=function(e,t){var d=0;return t[16|d]<=e&&(d|=16),t[8|d]<=e&&(d|=8),t[4|d]<=e&&(d|=4),t[2|d]<=e&&(d|=2),t[1|d]<=e&&(d|=1),d},c.F._writeLit=function(e,t,d,i){return c.F._putsF(d,i,t[e<<1]),i+t[1+(e<<1)]},c.F.inflate=function(e,t){var d=Uint8Array;if(e[0]==3&&e[1]==0)return t||new d(0);var i=c.F,y=i._bitsF,S=i._bitsE,n=i._decodeTiny,s=i.makeCodes,r=i.codes2map,l=i._get17,b=i.U,I=t==null;I&&(t=new d(e.length>>>2<<3));for(var k,w,z=0,B=0,F=0,H=0,x=0,M=0,f=0,u=0,v=0;z==0;)if(z=y(e,v,1),B=y(e,v+1,2),v+=3,B!=0){if(I&&(t=c.F._check(t,u+(1<<17))),B==1&&(k=b.flmap,w=b.fdmap,M=511,f=31),B==2){F=S(e,v,5)+257,H=S(e,v+5,5)+1,x=S(e,v+10,4)+4,v+=14;for(var A=0;A<38;A+=2)b.itree[A]=0,b.itree[A+1]=0;var C=1;for(A=0;A<x;A++){var E=S(e,v+3*A,3);b.itree[1+(b.ordr[A]<<1)]=E,E>C&&(C=E)}v+=3*x,s(b.itree,C),r(b.itree,C,b.imap),k=b.lmap,w=b.dmap,v=n(b.imap,(1<<C)-1,F+H,e,v,b.ttree);var T=i._copyOut(b.ttree,0,F,b.ltree);M=(1<<T)-1;var _=i._copyOut(b.ttree,F,H,b.dtree);f=(1<<_)-1,s(b.ltree,T),r(b.ltree,T,k),s(b.dtree,_),r(b.dtree,_,w)}for(;;){var m=k[l(e,v)&M];v+=15&m;var a=m>>>4;if(!(a>>>8))t[u++]=a;else{if(a==256)break;var N=u+a-254;if(a>264){var D=b.ldef[a-257];N=u+(D>>>3)+S(e,v,7&D),v+=7&D}var L=w[l(e,v)&f];v+=15&L;var G=L>>>4,$=b.ddef[G],q=($>>>4)+y(e,v,15&$);for(v+=15&$,I&&(t=c.F._check(t,u+(1<<17)));u<N;)t[u]=t[u++-q],t[u]=t[u++-q],t[u]=t[u++-q],t[u]=t[u++-q];u=N}}}else{7&v&&(v+=8-(7&v));var V=4+(v>>>3),P=e[V-4]|e[V-3]<<8;I&&(t=c.F._check(t,u+P)),t.set(new d(e.buffer,e.byteOffset+V,P),u),v=V+P<<3,u+=P}return t.length==u?t:t.slice(0,u)},c.F._check=function(e,t){var d=e.length;if(t<=d)return e;var i=new Uint8Array(Math.max(d<<1,t));return i.set(e,0),i},c.F._decodeTiny=function(e,t,d,i,y,S){for(var n=c.F._bitsE,s=c.F._get17,r=0;r<d;){var l=e[s(i,y)&t];y+=15&l;var b=l>>>4;if(b<=15)S[r]=b,r++;else{var I=0,k=0;b==16?(k=3+n(i,y,2),y+=2,I=S[r-1]):b==17?(k=3+n(i,y,3),y+=3):b==18&&(k=11+n(i,y,7),y+=7);for(var w=r+k;r<w;)S[r]=I,r++}}return y},c.F._copyOut=function(e,t,d,i){for(var y=0,S=0,n=i.length>>>1;S<d;){var s=e[S+t];i[S<<1]=0,i[1+(S<<1)]=s,s>y&&(y=s),S++}for(;S<n;)i[S<<1]=0,i[1+(S<<1)]=0,S++;return y},c.F.makeCodes=function(e,t){for(var d,i,y,S,n=c.F.U,s=e.length,r=n.bl_count,l=0;l<=t;l++)r[l]=0;for(l=1;l<s;l+=2)r[e[l]]++;var b=n.next_code;for(d=0,r[0]=0,i=1;i<=t;i++)d=d+r[i-1]<<1,b[i]=d;for(y=0;y<s;y+=2)(S=e[y+1])!=0&&(e[y]=b[S],b[S]++)},c.F.codes2map=function(e,t,d){for(var i=e.length,y=c.F.U.rev15,S=0;S<i;S+=2)if(e[S+1]!=0)for(var n=S>>1,s=e[S+1],r=n<<4|s,l=t-s,b=e[S]<<l,I=b+(1<<l);b!=I;)d[y[b]>>>15-t]=r,b++},c.F.revCodes=function(e,t){for(var d=c.F.U.rev15,i=15-t,y=0;y<e.length;y+=2){var S=e[y]<<t-e[y+1];e[y]=d[S]>>>i}},c.F._putsE=function(e,t,d){d<<=7&t;var i=t>>>3;e[i]|=d,e[i+1]|=d>>>8},c.F._putsF=function(e,t,d){d<<=7&t;var i=t>>>3;e[i]|=d,e[i+1]|=d>>>8,e[i+2]|=d>>>16},c.F._bitsE=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<d)-1},c.F._bitsF=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<d)-1},c.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},c.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},c.F.U=(p=Uint16Array,R=Uint32Array,{next_code:new p(16),bl_count:new p(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new p(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new R(32),flmap:new p(512),fltree:[],fdmap:new p(32),fdtree:[],lmap:new p(32768),ltree:[],ttree:[],dmap:new p(32768),dtree:[],imap:new p(512),itree:[],rev15:new p(32768),lhst:new R(286),dhst:new R(30),ihst:new R(19),lits:new R(15e3),strt:new p(65536),prev:new p(32768)}),function(){for(var e=c.F.U,t=0;t<32768;t++){var d=t;d=(4278255360&(d=(4042322160&(d=(3435973836&(d=(2863311530&d)>>>1|(1431655765&d)<<1))>>>2|(858993459&d)<<2))>>>4|(252645135&d)<<4))>>>8|(16711935&d)<<8,e.rev15[t]=(d>>>16|d<<16)>>>17}function i(y,S,n){for(;S--!=0;)y.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];i(e.fltree,144,8),i(e.fltree,112,9),i(e.fltree,24,7),i(e.fltree,8,8),c.F.makeCodes(e.fltree,9),c.F.codes2map(e.fltree,9,e.flmap),c.F.revCodes(e.fltree,9),i(e.fdtree,32,5),c.F.makeCodes(e.fdtree,5),c.F.codes2map(e.fdtree,5,e.fdmap),c.F.revCodes(e.fdtree,5),i(e.itree,19,0),i(e.ltree,286,0),i(e.dtree,30,0),i(e.ttree,320,0)}()})();var js=ws({__proto__:null,default:xn},[xn]);const et=function(){var h={nextZero(n,s){for(;n[s]!=0;)s++;return s},readUshort:(n,s)=>n[s]<<8|n[s+1],writeUshort(n,s,r){n[s]=r>>8&255,n[s+1]=255&r},readUint:(n,s)=>16777216*n[s]+(n[s+1]<<16|n[s+2]<<8|n[s+3]),writeUint(n,s,r){n[s]=r>>24&255,n[s+1]=r>>16&255,n[s+2]=r>>8&255,n[s+3]=255&r},readASCII(n,s,r){let l="";for(let b=0;b<r;b++)l+=String.fromCharCode(n[s+b]);return l},writeASCII(n,s,r){for(let l=0;l<r.length;l++)n[s+l]=r.charCodeAt(l)},readBytes(n,s,r){const l=[];for(let b=0;b<r;b++)l.push(n[s+b]);return l},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,s,r){let l,b="";for(let I=0;I<r;I++)b+=`%${h.pad(n[s+I].toString(16))}`;try{l=decodeURIComponent(b)}catch{return h.readASCII(n,s,r)}return l}};function p(n,s,r,l){const b=s*r,I=t(l),k=Math.ceil(s*I/8),w=new Uint8Array(4*b),z=new Uint32Array(w.buffer),{ctype:B}=l,{depth:F}=l,H=h.readUshort;if(B==6){const D=b<<2;if(F==8)for(var x=0;x<D;x+=4)w[x]=n[x],w[x+1]=n[x+1],w[x+2]=n[x+2],w[x+3]=n[x+3];if(F==16)for(x=0;x<D;x++)w[x]=n[x<<1]}else if(B==2){const D=l.tabs.tRNS;if(D==null){if(F==8)for(x=0;x<b;x++){var M=3*x;z[x]=255<<24|n[M+2]<<16|n[M+1]<<8|n[M]}if(F==16)for(x=0;x<b;x++)M=6*x,z[x]=255<<24|n[M+4]<<16|n[M+2]<<8|n[M]}else{var f=D[0];const L=D[1],G=D[2];if(F==8)for(x=0;x<b;x++){var u=x<<2;M=3*x,z[x]=255<<24|n[M+2]<<16|n[M+1]<<8|n[M],n[M]==f&&n[M+1]==L&&n[M+2]==G&&(w[u+3]=0)}if(F==16)for(x=0;x<b;x++)u=x<<2,M=6*x,z[x]=255<<24|n[M+4]<<16|n[M+2]<<8|n[M],H(n,M)==f&&H(n,M+2)==L&&H(n,M+4)==G&&(w[u+3]=0)}}else if(B==3){const D=l.tabs.PLTE,L=l.tabs.tRNS,G=L?L.length:0;if(F==1)for(var v=0;v<r;v++){var A=v*k,C=v*s;for(x=0;x<s;x++){u=C+x<<2;var E=3*(T=n[A+(x>>3)]>>7-((7&x)<<0)&1);w[u]=D[E],w[u+1]=D[E+1],w[u+2]=D[E+2],w[u+3]=T<G?L[T]:255}}if(F==2)for(v=0;v<r;v++)for(A=v*k,C=v*s,x=0;x<s;x++)u=C+x<<2,E=3*(T=n[A+(x>>2)]>>6-((3&x)<<1)&3),w[u]=D[E],w[u+1]=D[E+1],w[u+2]=D[E+2],w[u+3]=T<G?L[T]:255;if(F==4)for(v=0;v<r;v++)for(A=v*k,C=v*s,x=0;x<s;x++)u=C+x<<2,E=3*(T=n[A+(x>>1)]>>4-((1&x)<<2)&15),w[u]=D[E],w[u+1]=D[E+1],w[u+2]=D[E+2],w[u+3]=T<G?L[T]:255;if(F==8)for(x=0;x<b;x++){var T;u=x<<2,E=3*(T=n[x]),w[u]=D[E],w[u+1]=D[E+1],w[u+2]=D[E+2],w[u+3]=T<G?L[T]:255}}else if(B==4){if(F==8)for(x=0;x<b;x++){u=x<<2;var _=n[m=x<<1];w[u]=_,w[u+1]=_,w[u+2]=_,w[u+3]=n[m+1]}if(F==16)for(x=0;x<b;x++){var m;u=x<<2,_=n[m=x<<2],w[u]=_,w[u+1]=_,w[u+2]=_,w[u+3]=n[m+2]}}else if(B==0)for(f=l.tabs.tRNS?l.tabs.tRNS:-1,v=0;v<r;v++){const D=v*k,L=v*s;if(F==1)for(var a=0;a<s;a++){var N=(_=255*(n[D+(a>>>3)]>>>7-(7&a)&1))==255*f?0:255;z[L+a]=N<<24|_<<16|_<<8|_}else if(F==2)for(a=0;a<s;a++)N=(_=85*(n[D+(a>>>2)]>>>6-((3&a)<<1)&3))==85*f?0:255,z[L+a]=N<<24|_<<16|_<<8|_;else if(F==4)for(a=0;a<s;a++)N=(_=17*(n[D+(a>>>1)]>>>4-((1&a)<<2)&15))==17*f?0:255,z[L+a]=N<<24|_<<16|_<<8|_;else if(F==8)for(a=0;a<s;a++)N=(_=n[D+a])==f?0:255,z[L+a]=N<<24|_<<16|_<<8|_;else if(F==16)for(a=0;a<s;a++)_=n[D+(a<<1)],N=H(n,D+(a<<1))==f?0:255,z[L+a]=N<<24|_<<16|_<<8|_}return w}function R(n,s,r,l){const b=t(n),I=Math.ceil(r*b/8),k=new Uint8Array((I+1+n.interlace)*l);return s=n.tabs.CgBI?e(s,k):c(s,k),n.interlace==0?s=d(s,n,0,r,l):n.interlace==1&&(s=function(z,B){const F=B.width,H=B.height,x=t(B),M=x>>3,f=Math.ceil(F*x/8),u=new Uint8Array(H*f);let v=0;const A=[0,0,4,0,2,0,1],C=[0,4,0,2,0,1,0],E=[8,8,8,4,4,2,2],T=[8,8,4,4,2,2,1];let _=0;for(;_<7;){const a=E[_],N=T[_];let D=0,L=0,G=A[_];for(;G<H;)G+=a,L++;let $=C[_];for(;$<F;)$+=N,D++;const q=Math.ceil(D*x/8);d(z,B,v,D,L);let V=0,P=A[_];for(;P<H;){let J=C[_],ue=v+V*q<<3;for(;J<F;){var m;if(x==1&&(m=(m=z[ue>>3])>>7-(7&ue)&1,u[P*f+(J>>3)]|=m<<7-((7&J)<<0)),x==2&&(m=(m=z[ue>>3])>>6-(7&ue)&3,u[P*f+(J>>2)]|=m<<6-((3&J)<<1)),x==4&&(m=(m=z[ue>>3])>>4-(7&ue)&15,u[P*f+(J>>1)]|=m<<4-((1&J)<<2)),x>=8){const ie=P*f+J*M;for(let re=0;re<M;re++)u[ie+re]=z[(ue>>3)+re]}ue+=x,J+=N}V++,P+=a}D*L!=0&&(v+=L*(1+q)),_+=1}return u}(s,n)),s}function c(n,s){return e(new Uint8Array(n.buffer,2,n.length-6),s)}var e=function(){const n={H:{}};return n.H.N=function(s,r){const l=Uint8Array;let b,I,k=0,w=0,z=0,B=0,F=0,H=0,x=0,M=0,f=0;if(s[0]==3&&s[1]==0)return r||new l(0);const u=n.H,v=u.b,A=u.e,C=u.R,E=u.n,T=u.A,_=u.Z,m=u.m,a=r==null;for(a&&(r=new l(s.length>>>2<<5));k==0;)if(k=v(s,f,1),w=v(s,f+1,2),f+=3,w!=0){if(a&&(r=n.H.W(r,M+(1<<17))),w==1&&(b=m.J,I=m.h,H=511,x=31),w==2){z=A(s,f,5)+257,B=A(s,f+5,5)+1,F=A(s,f+10,4)+4,f+=14;let D=1;for(var N=0;N<38;N+=2)m.Q[N]=0,m.Q[N+1]=0;for(N=0;N<F;N++){const $=A(s,f+3*N,3);m.Q[1+(m.X[N]<<1)]=$,$>D&&(D=$)}f+=3*F,E(m.Q,D),T(m.Q,D,m.u),b=m.w,I=m.d,f=C(m.u,(1<<D)-1,z+B,s,f,m.v);const L=u.V(m.v,0,z,m.C);H=(1<<L)-1;const G=u.V(m.v,z,B,m.D);x=(1<<G)-1,E(m.C,L),T(m.C,L,b),E(m.D,G),T(m.D,G,I)}for(;;){const D=b[_(s,f)&H];f+=15&D;const L=D>>>4;if(!(L>>>8))r[M++]=L;else{if(L==256)break;{let G=M+L-254;if(L>264){const J=m.q[L-257];G=M+(J>>>3)+A(s,f,7&J),f+=7&J}const $=I[_(s,f)&x];f+=15&$;const q=$>>>4,V=m.c[q],P=(V>>>4)+v(s,f,15&V);for(f+=15&V;M<G;)r[M]=r[M++-P],r[M]=r[M++-P],r[M]=r[M++-P],r[M]=r[M++-P];M=G}}}}else{7&f&&(f+=8-(7&f));const D=4+(f>>>3),L=s[D-4]|s[D-3]<<8;a&&(r=n.H.W(r,M+L)),r.set(new l(s.buffer,s.byteOffset+D,L),M),f=D+L<<3,M+=L}return r.length==M?r:r.slice(0,M)},n.H.W=function(s,r){const l=s.length;if(r<=l)return s;const b=new Uint8Array(l<<1);return b.set(s,0),b},n.H.R=function(s,r,l,b,I,k){const w=n.H.e,z=n.H.Z;let B=0;for(;B<l;){const F=s[z(b,I)&r];I+=15&F;const H=F>>>4;if(H<=15)k[B]=H,B++;else{let x=0,M=0;H==16?(M=3+w(b,I,2),I+=2,x=k[B-1]):H==17?(M=3+w(b,I,3),I+=3):H==18&&(M=11+w(b,I,7),I+=7);const f=B+M;for(;B<f;)k[B]=x,B++}}return I},n.H.V=function(s,r,l,b){let I=0,k=0;const w=b.length>>>1;for(;k<l;){const z=s[k+r];b[k<<1]=0,b[1+(k<<1)]=z,z>I&&(I=z),k++}for(;k<w;)b[k<<1]=0,b[1+(k<<1)]=0,k++;return I},n.H.n=function(s,r){const l=n.H.m,b=s.length;let I,k,w,z;const B=l.j;for(var F=0;F<=r;F++)B[F]=0;for(F=1;F<b;F+=2)B[s[F]]++;const H=l.K;for(I=0,B[0]=0,k=1;k<=r;k++)I=I+B[k-1]<<1,H[k]=I;for(w=0;w<b;w+=2)z=s[w+1],z!=0&&(s[w]=H[z],H[z]++)},n.H.A=function(s,r,l){const b=s.length,I=n.H.m.r;for(let k=0;k<b;k+=2)if(s[k+1]!=0){const w=k>>1,z=s[k+1],B=w<<4|z,F=r-z;let H=s[k]<<F;const x=H+(1<<F);for(;H!=x;)l[I[H]>>>15-r]=B,H++}},n.H.l=function(s,r){const l=n.H.m.r,b=15-r;for(let I=0;I<s.length;I+=2){const k=s[I]<<r-s[I+1];s[I]=l[k]>>>b}},n.H.M=function(s,r,l){l<<=7&r;const b=r>>>3;s[b]|=l,s[b+1]|=l>>>8},n.H.I=function(s,r,l){l<<=7&r;const b=r>>>3;s[b]|=l,s[b+1]|=l>>>8,s[b+2]|=l>>>16},n.H.e=function(s,r,l){return(s[r>>>3]|s[1+(r>>>3)]<<8)>>>(7&r)&(1<<l)-1},n.H.b=function(s,r,l){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)&(1<<l)-1},n.H.Z=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)},n.H.i=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16|s[3+(r>>>3)]<<24)>>>(7&r)},n.H.m=function(){const s=Uint16Array,r=Uint32Array;return{K:new s(16),j:new s(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new s(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new r(32),J:new s(512),_:[],h:new s(32),$:[],w:new s(32768),C:[],v:[],d:new s(32768),D:[],u:new s(512),Q:[],r:new s(32768),s:new r(286),Y:new r(30),a:new r(19),t:new r(15e3),k:new s(65536),g:new s(32768)}}(),function(){const s=n.H.m;for(var r=0;r<32768;r++){let b=r;b=(2863311530&b)>>>1|(1431655765&b)<<1,b=(3435973836&b)>>>2|(858993459&b)<<2,b=(4042322160&b)>>>4|(252645135&b)<<4,b=(4278255360&b)>>>8|(16711935&b)<<8,s.r[r]=(b>>>16|b<<16)>>>17}function l(b,I,k){for(;I--!=0;)b.push(0,k)}for(r=0;r<32;r++)s.q[r]=s.S[r]<<3|s.T[r],s.c[r]=s.p[r]<<4|s.z[r];l(s._,144,8),l(s._,112,9),l(s._,24,7),l(s._,8,8),n.H.n(s._,9),n.H.A(s._,9,s.J),n.H.l(s._,9),l(s.$,32,5),n.H.n(s.$,5),n.H.A(s.$,5,s.h),n.H.l(s.$,5),l(s.Q,19,0),l(s.C,286,0),l(s.D,30,0),l(s.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function d(n,s,r,l,b){let I=t(s);const k=Math.ceil(l*I/8);let w,z;I=Math.ceil(I/8);let B=n[r],F=0;if(B>1&&(n[r]=[0,0,1][B-2]),B==3)for(F=I;F<k;F++)n[F+1]=n[F+1]+(n[F+1-I]>>>1)&255;for(let H=0;H<b;H++)if(w=r+H*k,z=w+H+1,B=n[z-1],F=0,B==0)for(;F<k;F++)n[w+F]=n[z+F];else if(B==1){for(;F<I;F++)n[w+F]=n[z+F];for(;F<k;F++)n[w+F]=n[z+F]+n[w+F-I]}else if(B==2)for(;F<k;F++)n[w+F]=n[z+F]+n[w+F-k];else if(B==3){for(;F<I;F++)n[w+F]=n[z+F]+(n[w+F-k]>>>1);for(;F<k;F++)n[w+F]=n[z+F]+(n[w+F-k]+n[w+F-I]>>>1)}else{for(;F<I;F++)n[w+F]=n[z+F]+i(0,n[w+F-k],0);for(;F<k;F++)n[w+F]=n[z+F]+i(n[w+F-I],n[w+F-k],n[w+F-I-k])}return n}function i(n,s,r){const l=n+s-r,b=l-n,I=l-s,k=l-r;return b*b<=I*I&&b*b<=k*k?n:I*I<=k*k?s:r}function y(n,s,r){r.width=h.readUint(n,s),s+=4,r.height=h.readUint(n,s),s+=4,r.depth=n[s],s++,r.ctype=n[s],s++,r.compress=n[s],s++,r.filter=n[s],s++,r.interlace=n[s],s++}function S(n,s,r,l,b,I,k,w,z){const B=Math.min(s,b),F=Math.min(r,I);let H=0,x=0;for(let _=0;_<F;_++)for(let m=0;m<B;m++)if(k>=0&&w>=0?(H=_*s+m<<2,x=(w+_)*b+k+m<<2):(H=(-w+_)*s-k+m<<2,x=_*b+m<<2),z==0)l[x]=n[H],l[x+1]=n[H+1],l[x+2]=n[H+2],l[x+3]=n[H+3];else if(z==1){var M=n[H+3]*.00392156862745098,f=n[H]*M,u=n[H+1]*M,v=n[H+2]*M,A=l[x+3]*(1/255),C=l[x]*A,E=l[x+1]*A,T=l[x+2]*A;const a=1-M,N=M+A*a,D=N==0?0:1/N;l[x+3]=255*N,l[x+0]=(f+C*a)*D,l[x+1]=(u+E*a)*D,l[x+2]=(v+T*a)*D}else if(z==2)M=n[H+3],f=n[H],u=n[H+1],v=n[H+2],A=l[x+3],C=l[x],E=l[x+1],T=l[x+2],M==A&&f==C&&u==E&&v==T?(l[x]=0,l[x+1]=0,l[x+2]=0,l[x+3]=0):(l[x]=f,l[x+1]=u,l[x+2]=v,l[x+3]=M);else if(z==3){if(M=n[H+3],f=n[H],u=n[H+1],v=n[H+2],A=l[x+3],C=l[x],E=l[x+1],T=l[x+2],M==A&&f==C&&u==E&&v==T)continue;if(M<220&&A>20)return!1}return!0}return{decode:function(s){const r=new Uint8Array(s);let l=8;const b=h,I=b.readUshort,k=b.readUint,w={tabs:{},frames:[]},z=new Uint8Array(r.length);let B,F=0,H=0;const x=[137,80,78,71,13,10,26,10];for(var M=0;M<8;M++)if(r[M]!=x[M])throw"The input is not a PNG file!";for(;l<r.length;){const _=b.readUint(r,l);l+=4;const m=b.readASCII(r,l,4);if(l+=4,m=="IHDR")y(r,l,w);else if(m=="iCCP"){for(var f=l;r[f]!=0;)f++;b.readASCII(r,l,f-l),r[f+1];const a=r.slice(f+2,l+_);let N=null;try{N=c(a)}catch{N=e(a)}w.tabs[m]=N}else if(m=="CgBI")w.tabs[m]=r.slice(l,l+4);else if(m=="IDAT"){for(M=0;M<_;M++)z[F+M]=r[l+M];F+=_}else if(m=="acTL")w.tabs[m]={num_frames:k(r,l),num_plays:k(r,l+4)},B=new Uint8Array(r.length);else if(m=="fcTL"){H!=0&&((T=w.frames[w.frames.length-1]).data=R(w,B.slice(0,H),T.rect.width,T.rect.height),H=0);const a={x:k(r,l+12),y:k(r,l+16),width:k(r,l+4),height:k(r,l+8)};let N=I(r,l+22);N=I(r,l+20)/(N==0?100:N);const D={rect:a,delay:Math.round(1e3*N),dispose:r[l+24],blend:r[l+25]};w.frames.push(D)}else if(m=="fdAT"){for(M=0;M<_-4;M++)B[H+M]=r[l+M+4];H+=_-4}else if(m=="pHYs")w.tabs[m]=[b.readUint(r,l),b.readUint(r,l+4),r[l+8]];else if(m=="cHRM")for(w.tabs[m]=[],M=0;M<8;M++)w.tabs[m].push(b.readUint(r,l+4*M));else if(m=="tEXt"||m=="zTXt"){w.tabs[m]==null&&(w.tabs[m]={});var u=b.nextZero(r,l),v=b.readASCII(r,l,u-l),A=l+_-u-1;if(m=="tEXt")E=b.readASCII(r,u+1,A);else{var C=c(r.slice(u+2,u+2+A));E=b.readUTF8(C,0,C.length)}w.tabs[m][v]=E}else if(m=="iTXt"){w.tabs[m]==null&&(w.tabs[m]={}),u=0,f=l,u=b.nextZero(r,f),v=b.readASCII(r,f,u-f);const a=r[f=u+1];var E;r[f+1],f+=2,u=b.nextZero(r,f),b.readASCII(r,f,u-f),f=u+1,u=b.nextZero(r,f),b.readUTF8(r,f,u-f),A=_-((f=u+1)-l),a==0?E=b.readUTF8(r,f,A):(C=c(r.slice(f,f+A)),E=b.readUTF8(C,0,C.length)),w.tabs[m][v]=E}else if(m=="PLTE")w.tabs[m]=b.readBytes(r,l,_);else if(m=="hIST"){const a=w.tabs.PLTE.length/3;for(w.tabs[m]=[],M=0;M<a;M++)w.tabs[m].push(I(r,l+2*M))}else if(m=="tRNS")w.ctype==3?w.tabs[m]=b.readBytes(r,l,_):w.ctype==0?w.tabs[m]=I(r,l):w.ctype==2&&(w.tabs[m]=[I(r,l),I(r,l+2),I(r,l+4)]);else if(m=="gAMA")w.tabs[m]=b.readUint(r,l)/1e5;else if(m=="sRGB")w.tabs[m]=r[l];else if(m=="bKGD")w.ctype==0||w.ctype==4?w.tabs[m]=[I(r,l)]:w.ctype==2||w.ctype==6?w.tabs[m]=[I(r,l),I(r,l+2),I(r,l+4)]:w.ctype==3&&(w.tabs[m]=r[l]);else if(m=="IEND")break;l+=_,b.readUint(r,l),l+=4}var T;return H!=0&&((T=w.frames[w.frames.length-1]).data=R(w,B.slice(0,H),T.rect.width,T.rect.height)),w.data=R(w,z,w.width,w.height),delete w.compress,delete w.interlace,delete w.filter,w},toRGBA8:function(s){const r=s.width,l=s.height;if(s.tabs.acTL==null)return[p(s.data,r,l,s).buffer];const b=[];s.frames[0].data==null&&(s.frames[0].data=s.data);const I=r*l*4,k=new Uint8Array(I),w=new Uint8Array(I),z=new Uint8Array(I);for(let F=0;F<s.frames.length;F++){const H=s.frames[F],x=H.rect.x,M=H.rect.y,f=H.rect.width,u=H.rect.height,v=p(H.data,f,u,s);if(F!=0)for(var B=0;B<I;B++)z[B]=k[B];if(H.blend==0?S(v,f,u,k,r,l,x,M,0):H.blend==1&&S(v,f,u,k,r,l,x,M,1),b.push(k.buffer.slice(0)),H.dispose!=0){if(H.dispose==1)S(w,f,u,k,r,l,x,M,0);else if(H.dispose==2)for(B=0;B<I;B++)k[B]=z[B]}}return b},_paeth:i,_copyTile:S,_bin:h}}();(function(){const{_copyTile:h}=et,{_bin:p}=et,R=et._paeth;var c={table:function(){const f=new Uint32Array(256);for(let u=0;u<256;u++){let v=u;for(let A=0;A<8;A++)1&v?v=3988292384^v>>>1:v>>>=1;f[u]=v}return f}(),update(f,u,v,A){for(let C=0;C<A;C++)f=c.table[255&(f^u[v+C])]^f>>>8;return f},crc:(f,u,v)=>4294967295^c.update(4294967295,f,u,v)};function e(f,u,v,A){u[v]+=f[0]*A>>4,u[v+1]+=f[1]*A>>4,u[v+2]+=f[2]*A>>4,u[v+3]+=f[3]*A>>4}function t(f){return Math.max(0,Math.min(255,f))}function d(f,u){const v=f[0]-u[0],A=f[1]-u[1],C=f[2]-u[2],E=f[3]-u[3];return v*v+A*A+C*C+E*E}function i(f,u,v,A,C,E,T){T==null&&(T=1);const _=A.length,m=[];for(var a=0;a<_;a++){const P=A[a];m.push([P>>>0&255,P>>>8&255,P>>>16&255,P>>>24&255])}for(a=0;a<_;a++){let P=4294967295;for(var N=0,D=0;D<_;D++){var L=d(m[a],m[D]);D!=a&&L<P&&(P=L,N=D)}}const G=new Uint32Array(C.buffer),$=new Int16Array(u*v*4),q=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(a=0;a<q.length;a++)q[a]=255*((q[a]+.5)/16-.5);for(let P=0;P<v;P++)for(let J=0;J<u;J++){var V;a=4*(P*u+J),T!=2?V=[t(f[a]+$[a]),t(f[a+1]+$[a+1]),t(f[a+2]+$[a+2]),t(f[a+3]+$[a+3])]:(L=q[4*(3&P)+(3&J)],V=[t(f[a]+L),t(f[a+1]+L),t(f[a+2]+L),t(f[a+3]+L)]),N=0;let ue=16777215;for(D=0;D<_;D++){const le=d(V,m[D]);le<ue&&(ue=le,N=D)}const ie=m[N],re=[V[0]-ie[0],V[1]-ie[1],V[2]-ie[2],V[3]-ie[3]];T==1&&(J!=u-1&&e(re,$,a+4,7),P!=v-1&&(J!=0&&e(re,$,a+4*u-4,3),e(re,$,a+4*u,5),J!=u-1&&e(re,$,a+4*u+4,1))),E[a>>2]=N,G[a>>2]=A[N]}}function y(f,u,v,A,C){C==null&&(C={});const{crc:E}=c,T=p.writeUint,_=p.writeUshort,m=p.writeASCII;let a=8;const N=f.frames.length>1;let D,L=!1,G=33+(N?20:0);if(C.sRGB!=null&&(G+=13),C.pHYs!=null&&(G+=21),C.iCCP!=null&&(D=pako.deflate(C.iCCP),G+=21+D.length+4),f.ctype==3){for(var $=f.plte.length,q=0;q<$;q++)f.plte[q]>>>24!=255&&(L=!0);G+=8+3*$+4+(L?8+1*$+4:0)}for(var V=0;V<f.frames.length;V++)N&&(G+=38),G+=(ie=f.frames[V]).cimg.length+12,V!=0&&(G+=4);G+=12;const P=new Uint8Array(G),J=[137,80,78,71,13,10,26,10];for(q=0;q<8;q++)P[q]=J[q];if(T(P,a,13),a+=4,m(P,a,"IHDR"),a+=4,T(P,a,u),a+=4,T(P,a,v),a+=4,P[a]=f.depth,a++,P[a]=f.ctype,a++,P[a]=0,a++,P[a]=0,a++,P[a]=0,a++,T(P,a,E(P,a-17,17)),a+=4,C.sRGB!=null&&(T(P,a,1),a+=4,m(P,a,"sRGB"),a+=4,P[a]=C.sRGB,a++,T(P,a,E(P,a-5,5)),a+=4),C.iCCP!=null){const re=13+D.length;T(P,a,re),a+=4,m(P,a,"iCCP"),a+=4,m(P,a,"ICC profile"),a+=11,a+=2,P.set(D,a),a+=D.length,T(P,a,E(P,a-(re+4),re+4)),a+=4}if(C.pHYs!=null&&(T(P,a,9),a+=4,m(P,a,"pHYs"),a+=4,T(P,a,C.pHYs[0]),a+=4,T(P,a,C.pHYs[1]),a+=4,P[a]=C.pHYs[2],a++,T(P,a,E(P,a-13,13)),a+=4),N&&(T(P,a,8),a+=4,m(P,a,"acTL"),a+=4,T(P,a,f.frames.length),a+=4,T(P,a,C.loop!=null?C.loop:0),a+=4,T(P,a,E(P,a-12,12)),a+=4),f.ctype==3){for(T(P,a,3*($=f.plte.length)),a+=4,m(P,a,"PLTE"),a+=4,q=0;q<$;q++){const re=3*q,le=f.plte[q],ce=255&le,fe=le>>>8&255,Ue=le>>>16&255;P[a+re+0]=ce,P[a+re+1]=fe,P[a+re+2]=Ue}if(a+=3*$,T(P,a,E(P,a-3*$-4,3*$+4)),a+=4,L){for(T(P,a,$),a+=4,m(P,a,"tRNS"),a+=4,q=0;q<$;q++)P[a+q]=f.plte[q]>>>24&255;a+=$,T(P,a,E(P,a-$-4,$+4)),a+=4}}let ue=0;for(V=0;V<f.frames.length;V++){var ie=f.frames[V];N&&(T(P,a,26),a+=4,m(P,a,"fcTL"),a+=4,T(P,a,ue++),a+=4,T(P,a,ie.rect.width),a+=4,T(P,a,ie.rect.height),a+=4,T(P,a,ie.rect.x),a+=4,T(P,a,ie.rect.y),a+=4,_(P,a,A[V]),a+=2,_(P,a,1e3),a+=2,P[a]=ie.dispose,a++,P[a]=ie.blend,a++,T(P,a,E(P,a-30,30)),a+=4);const re=ie.cimg;T(P,a,($=re.length)+(V==0?0:4)),a+=4;const le=a;m(P,a,V==0?"IDAT":"fdAT"),a+=4,V!=0&&(T(P,a,ue++),a+=4),P.set(re,a),a+=$,T(P,a,E(P,le,a-le)),a+=4}return T(P,a,0),a+=4,m(P,a,"IEND"),a+=4,T(P,a,E(P,a-4,4)),a+=4,P.buffer}function S(f,u,v){for(let A=0;A<f.frames.length;A++){const C=f.frames[A];C.rect.width;const E=C.rect.height,T=new Uint8Array(E*C.bpl+E);C.cimg=l(C.img,E,C.bpp,C.bpl,T,u,v)}}function n(f,u,v,A,C){const E=C[0],T=C[1],_=C[2],m=C[3],a=C[4],N=C[5];let D=6,L=8,G=255;for(var $=0;$<f.length;$++){const ye=new Uint8Array(f[$]);for(var q=ye.length,V=0;V<q;V+=4)G&=ye[V+3]}const P=G!=255,J=function(de,he,pe,Se,be,je){const xe=[];for(var ne=0;ne<de.length;ne++){const te=new Uint8Array(de[ne]),Oe=new Uint32Array(te.buffer);var Ce;let se=0,Me=0,ee=he,_e=pe,Ie=Se?1:0;if(ne!=0){const bt=je||Se||ne==1||xe[ne-2].dispose!=0?1:2;let xt=0,nt=1e9;for(let at=0;at<bt;at++){var we=new Uint8Array(de[ne-1-at]);const Mt=new Uint32Array(de[ne-1-at]);let ge=he,Re=pe,Ke=-1,$e=-1;for(let qe=0;qe<pe;qe++)for(let Ve=0;Ve<he;Ve++)Oe[Ae=qe*he+Ve]!=Mt[Ae]&&(Ve<ge&&(ge=Ve),Ve>Ke&&(Ke=Ve),qe<Re&&(Re=qe),qe>$e&&($e=qe));Ke==-1&&(ge=Re=Ke=$e=0),be&&((1&ge)==1&&ge--,(1&Re)==1&&Re--);const ct=(Ke-ge+1)*($e-Re+1);ct<nt&&(nt=ct,xt=at,se=ge,Me=Re,ee=Ke-ge+1,_e=$e-Re+1)}we=new Uint8Array(de[ne-1-xt]),xt==1&&(xe[ne-1].dispose=2),Ce=new Uint8Array(ee*_e*4),h(we,he,pe,Ce,ee,_e,-se,-Me,0),Ie=h(te,he,pe,Ce,ee,_e,-se,-Me,3)?1:0,Ie==1?r(te,he,pe,Ce,{x:se,y:Me,width:ee,height:_e}):h(te,he,pe,Ce,ee,_e,-se,-Me,0)}else Ce=te.slice(0);xe.push({rect:{x:se,y:Me,width:ee,height:_e},img:Ce,blend:Ie,dispose:0})}if(Se)for(ne=0;ne<xe.length;ne++){if((Ye=xe[ne]).blend==1)continue;const te=Ye.rect,Oe=xe[ne-1].rect,se=Math.min(te.x,Oe.x),Me=Math.min(te.y,Oe.y),ee={x:se,y:Me,width:Math.max(te.x+te.width,Oe.x+Oe.width)-se,height:Math.max(te.y+te.height,Oe.y+Oe.height)-Me};xe[ne-1].dispose=1,ne-1!=0&&s(de,he,pe,xe,ne-1,ee,be),s(de,he,pe,xe,ne,ee,be)}let ot=0;if(de.length!=1)for(var Ae=0;Ae<xe.length;Ae++){var Ye;ot+=(Ye=xe[Ae]).rect.width*Ye.rect.height}return xe}(f,u,v,E,T,_),ue={},ie=[],re=[];if(A!=0){const ye=[];for(V=0;V<J.length;V++)ye.push(J[V].img.buffer);const de=function(be){let je=0;for(var xe=0;xe<be.length;xe++)je+=be[xe].byteLength;const ne=new Uint8Array(je);let Ce=0;for(xe=0;xe<be.length;xe++){const we=new Uint8Array(be[xe]),ot=we.length;for(let Ae=0;Ae<ot;Ae+=4){let Ye=we[Ae],te=we[Ae+1],Oe=we[Ae+2];const se=we[Ae+3];se==0&&(Ye=te=Oe=0),ne[Ce+Ae]=Ye,ne[Ce+Ae+1]=te,ne[Ce+Ae+2]=Oe,ne[Ce+Ae+3]=se}Ce+=ot}return ne.buffer}(ye),he=I(de,A);for(V=0;V<he.plte.length;V++)ie.push(he.plte[V].est.rgba);let pe=0;for(V=0;V<J.length;V++){const Se=(ce=J[V]).img.length;var le=new Uint8Array(he.inds.buffer,pe>>2,Se>>2);re.push(le);const be=new Uint8Array(he.abuf,pe,Se);N&&i(ce.img,ce.rect.width,ce.rect.height,ie,be,le),ce.img.set(be),pe+=Se}}else for($=0;$<J.length;$++){var ce=J[$];const ye=new Uint32Array(ce.img.buffer);var fe=ce.rect.width;for(q=ye.length,le=new Uint8Array(q),re.push(le),V=0;V<q;V++){const de=ye[V];if(V!=0&&de==ye[V-1])le[V]=le[V-1];else if(V>fe&&de==ye[V-fe])le[V]=le[V-fe];else{let he=ue[de];if(he==null&&(ue[de]=he=ie.length,ie.push(de),ie.length>=300))break;le[V]=he}}}const Ue=ie.length;for(Ue<=256&&a==0&&(L=Ue<=2?1:Ue<=4?2:Ue<=16?4:8,L=Math.max(L,m)),$=0;$<J.length;$++){(ce=J[$]).rect.x,ce.rect.y,fe=ce.rect.width;const ye=ce.rect.height;let de=ce.img;new Uint32Array(de.buffer);let he=4*fe,pe=4;if(Ue<=256&&a==0){he=Math.ceil(L*fe/8);var Te=new Uint8Array(he*ye);const Se=re[$];for(let be=0;be<ye;be++){V=be*he;const je=be*fe;if(L==8)for(var me=0;me<fe;me++)Te[V+me]=Se[je+me];else if(L==4)for(me=0;me<fe;me++)Te[V+(me>>1)]|=Se[je+me]<<4-4*(1&me);else if(L==2)for(me=0;me<fe;me++)Te[V+(me>>2)]|=Se[je+me]<<6-2*(3&me);else if(L==1)for(me=0;me<fe;me++)Te[V+(me>>3)]|=Se[je+me]<<7-1*(7&me)}de=Te,D=3,pe=1}else if(P==0&&J.length==1){Te=new Uint8Array(fe*ye*3);const Se=fe*ye;for(V=0;V<Se;V++){const be=3*V,je=4*V;Te[be]=de[je],Te[be+1]=de[je+1],Te[be+2]=de[je+2]}de=Te,D=2,pe=3,he=3*fe}ce.img=de,ce.bpl=he,ce.bpp=pe}return{ctype:D,depth:L,plte:ie,frames:J}}function s(f,u,v,A,C,E,T){const _=Uint8Array,m=Uint32Array,a=new _(f[C-1]),N=new m(f[C-1]),D=C+1<f.length?new _(f[C+1]):null,L=new _(f[C]),G=new m(L.buffer);let $=u,q=v,V=-1,P=-1;for(let ue=0;ue<E.height;ue++)for(let ie=0;ie<E.width;ie++){const re=E.x+ie,le=E.y+ue,ce=le*u+re,fe=G[ce];fe==0||A[C-1].dispose==0&&N[ce]==fe&&(D==null||D[4*ce+3]!=0)||(re<$&&($=re),re>V&&(V=re),le<q&&(q=le),le>P&&(P=le))}V==-1&&($=q=V=P=0),T&&((1&$)==1&&$--,(1&q)==1&&q--),E={x:$,y:q,width:V-$+1,height:P-q+1};const J=A[C];J.rect=E,J.blend=1,J.img=new Uint8Array(E.width*E.height*4),A[C-1].dispose==0?(h(a,u,v,J.img,E.width,E.height,-E.x,-E.y,0),r(L,u,v,J.img,E)):h(L,u,v,J.img,E.width,E.height,-E.x,-E.y,0)}function r(f,u,v,A,C){h(f,u,v,A,C.width,C.height,-C.x,-C.y,2)}function l(f,u,v,A,C,E,T){const _=[];let m,a=[0,1,2,3,4];E!=-1?a=[E]:(u*A>5e5||v==1)&&(a=[0]),T&&(m={level:0});const N=js;for(var D=0;D<a.length;D++){for(let $=0;$<u;$++)b(C,f,$,A,v,a[D]);_.push(N.deflate(C,m))}let L,G=1e9;for(D=0;D<_.length;D++)_[D].length<G&&(L=D,G=_[D].length);return _[L]}function b(f,u,v,A,C,E){const T=v*A;let _=T+v;if(f[_]=E,_++,E==0)if(A<500)for(var m=0;m<A;m++)f[_+m]=u[T+m];else f.set(new Uint8Array(u.buffer,T,A),_);else if(E==1){for(m=0;m<C;m++)f[_+m]=u[T+m];for(m=C;m<A;m++)f[_+m]=u[T+m]-u[T+m-C]+256&255}else if(v==0){for(m=0;m<C;m++)f[_+m]=u[T+m];if(E==2)for(m=C;m<A;m++)f[_+m]=u[T+m];if(E==3)for(m=C;m<A;m++)f[_+m]=u[T+m]-(u[T+m-C]>>1)+256&255;if(E==4)for(m=C;m<A;m++)f[_+m]=u[T+m]-R(u[T+m-C],0,0)+256&255}else{if(E==2)for(m=0;m<A;m++)f[_+m]=u[T+m]+256-u[T+m-A]&255;if(E==3){for(m=0;m<C;m++)f[_+m]=u[T+m]+256-(u[T+m-A]>>1)&255;for(m=C;m<A;m++)f[_+m]=u[T+m]+256-(u[T+m-A]+u[T+m-C]>>1)&255}if(E==4){for(m=0;m<C;m++)f[_+m]=u[T+m]+256-R(0,u[T+m-A],0)&255;for(m=C;m<A;m++)f[_+m]=u[T+m]+256-R(u[T+m-C],u[T+m-A],u[T+m-C-A])&255}}}function I(f,u){const v=new Uint8Array(f),A=v.slice(0),C=new Uint32Array(A.buffer),E=k(A,u),T=E[0],_=E[1],m=v.length,a=new Uint8Array(m>>2);let N;if(v.length<2e7)for(var D=0;D<m;D+=4)N=w(T,L=v[D]*(1/255),G=v[D+1]*(1/255),$=v[D+2]*(1/255),q=v[D+3]*(1/255)),a[D>>2]=N.ind,C[D>>2]=N.est.rgba;else for(D=0;D<m;D+=4){var L=v[D]*.00392156862745098,G=v[D+1]*(1/255),$=v[D+2]*(1/255),q=v[D+3]*(1/255);for(N=T;N.left;)N=z(N.est,L,G,$,q)<=0?N.left:N.right;a[D>>2]=N.ind,C[D>>2]=N.est.rgba}return{abuf:A.buffer,inds:a,plte:_}}function k(f,u,v){v==null&&(v=1e-4);const A=new Uint32Array(f.buffer),C={i0:0,i1:f.length,bst:null,est:null,tdst:0,left:null,right:null};C.bst=H(f,C.i0,C.i1),C.est=x(C.bst);const E=[C];for(;E.length<u;){let _=0,m=0;for(var T=0;T<E.length;T++)E[T].est.L>_&&(_=E[T].est.L,m=T);if(_<v)break;const a=E[m],N=B(f,A,a.i0,a.i1,a.est.e,a.est.eMq255);if(a.i0>=N||a.i1<=N){a.est.L=0;continue}const D={i0:a.i0,i1:N,bst:null,est:null,tdst:0,left:null,right:null};D.bst=H(f,D.i0,D.i1),D.est=x(D.bst);const L={i0:N,i1:a.i1,bst:null,est:null,tdst:0,left:null,right:null};for(L.bst={R:[],m:[],N:a.bst.N-D.bst.N},T=0;T<16;T++)L.bst.R[T]=a.bst.R[T]-D.bst.R[T];for(T=0;T<4;T++)L.bst.m[T]=a.bst.m[T]-D.bst.m[T];L.est=x(L.bst),a.left=D,a.right=L,E[m]=D,E.push(L)}for(E.sort((_,m)=>m.bst.N-_.bst.N),T=0;T<E.length;T++)E[T].ind=T;return[C,E]}function w(f,u,v,A,C){if(f.left==null)return f.tdst=function(D,L,G,$,q){const V=L-D[0],P=G-D[1],J=$-D[2],ue=q-D[3];return V*V+P*P+J*J+ue*ue}(f.est.q,u,v,A,C),f;const E=z(f.est,u,v,A,C);let T=f.left,_=f.right;E>0&&(T=f.right,_=f.left);const m=w(T,u,v,A,C);if(m.tdst<=E*E)return m;const a=w(_,u,v,A,C);return a.tdst<m.tdst?a:m}function z(f,u,v,A,C){const{e:E}=f;return E[0]*u+E[1]*v+E[2]*A+E[3]*C-f.eMq}function B(f,u,v,A,C,E){for(A-=4;v<A;){for(;F(f,v,C)<=E;)v+=4;for(;F(f,A,C)>E;)A-=4;if(v>=A)break;const T=u[v>>2];u[v>>2]=u[A>>2],u[A>>2]=T,v+=4,A-=4}for(;F(f,v,C)>E;)v-=4;return v+4}function F(f,u,v){return f[u]*v[0]+f[u+1]*v[1]+f[u+2]*v[2]+f[u+3]*v[3]}function H(f,u,v){const A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=[0,0,0,0],E=v-u>>2;for(let T=u;T<v;T+=4){const _=f[T]*.00392156862745098,m=f[T+1]*(1/255),a=f[T+2]*(1/255),N=f[T+3]*(1/255);C[0]+=_,C[1]+=m,C[2]+=a,C[3]+=N,A[0]+=_*_,A[1]+=_*m,A[2]+=_*a,A[3]+=_*N,A[5]+=m*m,A[6]+=m*a,A[7]+=m*N,A[10]+=a*a,A[11]+=a*N,A[15]+=N*N}return A[4]=A[1],A[8]=A[2],A[9]=A[6],A[12]=A[3],A[13]=A[7],A[14]=A[11],{R:A,m:C,N:E}}function x(f){const{R:u}=f,{m:v}=f,{N:A}=f,C=v[0],E=v[1],T=v[2],_=v[3],m=A==0?0:1/A,a=[u[0]-C*C*m,u[1]-C*E*m,u[2]-C*T*m,u[3]-C*_*m,u[4]-E*C*m,u[5]-E*E*m,u[6]-E*T*m,u[7]-E*_*m,u[8]-T*C*m,u[9]-T*E*m,u[10]-T*T*m,u[11]-T*_*m,u[12]-_*C*m,u[13]-_*E*m,u[14]-_*T*m,u[15]-_*_*m],N=a,D=M;let L=[Math.random(),Math.random(),Math.random(),Math.random()],G=0,$=0;if(A!=0)for(let V=0;V<16&&(L=D.multVec(N,L),$=Math.sqrt(D.dot(L,L)),L=D.sml(1/$,L),!(V!=0&&Math.abs($-G)<1e-9));V++)G=$;const q=[C*m,E*m,T*m,_*m];return{Cov:a,q,e:L,L:G,eMq255:D.dot(D.sml(255,q),L),eMq:D.dot(L,q),rgba:(Math.round(255*q[3])<<24|Math.round(255*q[2])<<16|Math.round(255*q[1])<<8|Math.round(255*q[0])<<0)>>>0}}var M={multVec:(f,u)=>[f[0]*u[0]+f[1]*u[1]+f[2]*u[2]+f[3]*u[3],f[4]*u[0]+f[5]*u[1]+f[6]*u[2]+f[7]*u[3],f[8]*u[0]+f[9]*u[1]+f[10]*u[2]+f[11]*u[3],f[12]*u[0]+f[13]*u[1]+f[14]*u[2]+f[15]*u[3]],dot:(f,u)=>f[0]*u[0]+f[1]*u[1]+f[2]*u[2]+f[3]*u[3],sml:(f,u)=>[f*u[0],f*u[1],f*u[2],f*u[3]]};et.encode=function(u,v,A,C,E,T,_){C==null&&(C=0),_==null&&(_=!1);const m=n(u,v,A,C,[!1,!1,!1,0,_,!1]);return S(m,-1),y(m,v,A,E,T)},et.encodeLL=function(u,v,A,C,E,T,_,m){const a={ctype:0+(C==1?0:2)+(E==0?0:4),depth:T,frames:[]},N=(C+E)*T,D=N*v;for(let L=0;L<u.length;L++)a.frames.push({rect:{x:0,y:0,width:v,height:A},img:new Uint8Array(u[L]),blend:0,dispose:1,bpp:Math.ceil(N/8),bpl:Math.ceil(D/8)});return S(a,0,!0),y(a,v,A,_,m)},et.encode.compress=n,et.encode.dither=i,et.quantize=I,et.quantize.getKDtree=k,et.quantize.getNearest=w})();const Cr={toArrayBuffer(h,p){const R=h.width,c=h.height,e=R<<2,t=h.getContext("2d").getImageData(0,0,R,c),d=new Uint32Array(t.data.buffer),i=(32*R+31)/32<<2,y=i*c,S=122+y,n=new ArrayBuffer(S),s=new DataView(n),r=1<<20;let l,b,I,k,w=r,z=0,B=0,F=0;function H(f){s.setUint16(B,f,!0),B+=2}function x(f){s.setUint32(B,f,!0),B+=4}function M(f){B+=f}H(19778),x(S),M(4),x(122),x(108),x(R),x(-c>>>0),H(1),H(32),x(3),x(y),x(2835),x(2835),M(8),x(16711680),x(65280),x(255),x(4278190080),x(1466527264),function f(){for(;z<c&&w>0;){for(k=122+z*i,l=0;l<e;)w--,b=d[F++],I=b>>>24,s.setUint32(k+l,b<<8|I),l+=4;z++}F<d.length?(w=r,setTimeout(f,Cr._dly)):p(n)}()},toBlob(h,p){this.toArrayBuffer(h,R=>{p(new Blob([R],{type:"image/bmp"}))})},_dly:9};var We={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Is={[We.CHROME]:16384,[We.FIREFOX]:11180,[We.DESKTOP_SAFARI]:16384,[We.IE]:8192,[We.IOS]:4096,[We.ETC]:8192};const Gn=typeof window<"u",wr=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,vn=Gn&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Ds=(Gn||wr)&&(vn&&vn.getOriginalSymbol(window,"File")||typeof File<"u"&&File),_r=(Gn||wr)&&(vn&&vn.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function Yn(h,p,R=Date.now()){return new Promise(c=>{const e=h.split(","),t=e[0].match(/:(.*?);/)[1],d=globalThis.atob(e[1]);let i=d.length;const y=new Uint8Array(i);for(;i--;)y[i]=d.charCodeAt(i);const S=new Blob([y],{type:t});S.name=p,S.lastModified=R,c(S)})}function Er(h){return new Promise((p,R)=>{const c=new _r;c.onload=()=>p(c.result),c.onerror=e=>R(e),c.readAsDataURL(h)})}function jr(h){return new Promise((p,R)=>{const c=new Image;c.onload=()=>p(c),c.onerror=e=>R(e),c.src=h})}function At(){if(At.cachedResult!==void 0)return At.cachedResult;let h=We.ETC;const{userAgent:p}=navigator;return/Chrom(e|ium)/i.test(p)?h=We.CHROME:/iP(ad|od|hone)/i.test(p)&&/WebKit/i.test(p)?h=We.IOS:/Safari/i.test(p)?h=We.DESKTOP_SAFARI:/Firefox/i.test(p)?h=We.FIREFOX:(/MSIE/i.test(p)||document.documentMode)&&(h=We.IE),At.cachedResult=h,At.cachedResult}function Ir(h,p){const R=At(),c=Is[R];let e=h,t=p,d=e*t;const i=e>t?t/e:e/t;for(;d>c*c;){const y=(c+e)/2,S=(c+t)/2;y<S?(t=S,e=S*i):(t=y*i,e=y),d=e*t}return{width:e,height:t}}function An(h,p){let R,c;try{if(R=new OffscreenCanvas(h,p),c=R.getContext("2d"),c===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{R=document.createElement("canvas"),c=R.getContext("2d")}return R.width=h,R.height=p,[R,c]}function Dr(h,p){const{width:R,height:c}=Ir(h.width,h.height),[e,t]=An(R,c);return p&&/jpe?g/.test(p)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(h,0,0,e.width,e.height),e}function hn(){return hn.cachedResult!==void 0||(hn.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),hn.cachedResult}function yn(h,p={}){return new Promise(function(R,c){let e,t;var d=function(){try{return t=Dr(e,p.fileType||h.type),R([e,t])}catch(y){return c(y)}},i=function(y){try{var S=function(n){try{throw n}catch(s){return c(s)}};try{let n;return Er(h).then(function(s){try{return n=s,jr(n).then(function(r){try{return e=r,function(){try{return d()}catch(l){return c(l)}}()}catch(l){return S(l)}},S)}catch(r){return S(r)}},S)}catch(n){S(n)}}catch(n){return c(n)}};try{if(hn()||[We.DESKTOP_SAFARI,We.MOBILE_SAFARI].includes(At()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(h).then(function(y){try{return e=y,d()}catch{return i()}},i)}catch{i()}})}function Tn(h,p,R,c,e=1){return new Promise(function(t,d){let i;if(p==="image/png"){let S,n,s;return S=h.getContext("2d"),{data:n}=S.getImageData(0,0,h.width,h.height),s=et.encode([n.buffer],h.width,h.height,4096*e),i=new Blob([s],{type:p}),i.name=R,i.lastModified=c,y.call(this)}{let S=function(){return y.call(this)};if(p==="image/bmp")return new Promise(n=>Cr.toBlob(h,n)).then((function(n){try{return i=n,i.name=R,i.lastModified=c,S.call(this)}catch(s){return d(s)}}).bind(this),d);{let n=function(){return S.call(this)};if(typeof OffscreenCanvas=="function"&&h instanceof OffscreenCanvas)return h.convertToBlob({type:p,quality:e}).then((function(s){try{return i=s,i.name=R,i.lastModified=c,n.call(this)}catch(r){return d(r)}}).bind(this),d);{let s;return s=h.toDataURL(p,e),Yn(s,R,c).then((function(r){try{return i=r,n.call(this)}catch(l){return d(l)}}).bind(this),d)}}}function y(){return t(i)}})}function st(h){h.width=0,h.height=0}function Et(){return new Promise(function(h,p){let R,c,e,t;return Et.cachedResult!==void 0?h(Et.cachedResult):Yn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(d){try{return R=d,yn(R).then(function(i){try{return c=i[1],Tn(c,R.type,R.name,R.lastModified).then(function(y){try{return e=y,st(c),yn(e).then(function(S){try{return t=S[0],Et.cachedResult=t.width===1&&t.height===2,h(Et.cachedResult)}catch(n){return p(n)}},p)}catch(S){return p(S)}},p)}catch(y){return p(y)}},p)}catch(i){return p(i)}},p)})}function Rr(h){return new Promise((p,R)=>{const c=new _r;c.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return p(-2);const d=t.byteLength;let i=2;for(;i<d;){if(t.getUint16(i+2,!1)<=8)return p(-1);const y=t.getUint16(i,!1);if(i+=2,y==65505){if(t.getUint32(i+=2,!1)!=1165519206)return p(-1);const S=t.getUint16(i+=6,!1)==18761;i+=t.getUint32(i+4,S);const n=t.getUint16(i,S);i+=2;for(let s=0;s<n;s++)if(t.getUint16(i+12*s,S)==274)return p(t.getUint16(i+12*s+8,S))}else{if((65280&y)!=65280)break;i+=t.getUint16(i,!1)}}return p(-1)},c.onerror=e=>R(e),c.readAsArrayBuffer(h)})}function Fr(h,p){const{width:R}=h,{height:c}=h,{maxWidthOrHeight:e}=p;let t,d=h;return isFinite(e)&&(R>e||c>e)&&([d,t]=An(R,c),R>c?(d.width=e,d.height=c/R*e):(d.width=R/c*e,d.height=e),t.drawImage(h,0,0,d.width,d.height),st(h)),d}function kr(h,p){const{width:R}=h,{height:c}=h,[e,t]=An(R,c);switch(p>4&&p<9?(e.width=c,e.height=R):(e.width=R,e.height=c),p){case 2:t.transform(-1,0,0,1,R,0);break;case 3:t.transform(-1,0,0,-1,R,c);break;case 4:t.transform(1,0,0,-1,0,c);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,c,0);break;case 7:t.transform(0,-1,-1,0,c,R);break;case 8:t.transform(0,-1,1,0,0,R)}return t.drawImage(h,0,0,R,c),st(h),e}function rr(h,p,R=0){return new Promise(function(c,e){let t,d,i,y,S,n,s,r,l,b,I,k,w,z,B,F,H,x,M,f;function u(A=5){if(p.signal&&p.signal.aborted)throw p.signal.reason;t+=A,p.onProgress(Math.min(t,100))}function v(A){if(p.signal&&p.signal.aborted)throw p.signal.reason;t=Math.min(Math.max(A,t),100),p.onProgress(t)}return t=R,d=p.maxIteration||10,i=1024*p.maxSizeMB*1024,u(),yn(h,p).then((function(A){try{return[,y]=A,u(),S=Fr(y,p),u(),new Promise(function(C,E){var T;if(!(T=p.exifOrientation))return Rr(h).then((function(m){try{return T=m,_.call(this)}catch(a){return E(a)}}).bind(this),E);function _(){return C(T)}return _.call(this)}).then((function(C){try{return n=C,u(),Et().then((function(E){try{return s=E?S:kr(S,n),u(),r=p.initialQuality||1,l=p.fileType||h.type,Tn(s,l,h.name,h.lastModified,r).then((function(T){try{{let m=function(){if(d--&&(B>i||B>w)){let N,D;return N=f?.95*M.width:M.width,D=f?.95*M.height:M.height,[H,x]=An(N,D),x.drawImage(M,0,0,N,D),r*=l==="image/png"?.85:.95,Tn(H,l,h.name,h.lastModified,r).then(function(L){try{return F=L,st(M),M=H,B=F.size,v(Math.min(99,Math.floor((z-B)/(z-i)*100))),m}catch(G){return e(G)}},e)}return[1]},a=function(){return st(M),st(H),st(S),st(s),st(y),v(100),c(F)};if(b=T,u(),I=b.size>i,k=b.size>h.size,!I&&!k)return v(100),c(b);var _;return w=h.size,z=b.size,B=z,M=s,f=!p.alwaysKeepResolution&&I,(_=(function(N){for(;N;){if(N.then)return void N.then(_,e);try{if(N.pop){if(N.length)return N.pop()?a.call(this):N;N=m}else N=N.call(this)}catch(D){return e(D)}}}).bind(this))(m)}}catch(m){return e(m)}}).bind(this),e)}catch(T){return e(T)}}).bind(this),e)}catch(E){return e(E)}}).bind(this),e)}catch(C){return e(C)}}).bind(this),e)})}const Rs=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Rn;function Fs(h,p){return new Promise((R,c)=>{Rn||(Rn=function(d){const i=[];return i.push(d),URL.createObjectURL(new Blob(i))}(Rs));const e=new Worker(Rn);e.addEventListener("message",function(d){if(p.signal&&p.signal.aborted)e.terminate();else if(d.data.progress===void 0){if(d.data.error)return c(new Error(d.data.error)),void e.terminate();R(d.data.file),e.terminate()}else p.onProgress(d.data.progress)}),e.addEventListener("error",c),p.signal&&p.signal.addEventListener("abort",()=>{c(p.signal.reason),e.terminate()}),e.postMessage({file:h,imageCompressionLibUrl:p.libURL,options:{...p,onProgress:void 0,signal:void 0}})})}function Ne(h,p){return new Promise(function(R,c){let e,t,d,i,y,S;if(e={...p},d=0,{onProgress:i}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,y=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=l=>{d=l,typeof i=="function"&&i(d)},!(h instanceof Blob||h instanceof Ds))return c(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(h.type))return c(new Error("The file given is not an image"));if(S=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!y||typeof Worker!="function"||S)return rr(h,e).then((function(l){try{return t=l,r.call(this)}catch(b){return c(b)}}).bind(this),c);var n=(function(){try{return r.call(this)}catch(l){return c(l)}}).bind(this),s=function(l){try{return rr(h,e).then(function(b){try{return t=b,n()}catch(I){return c(I)}},c)}catch(b){return c(b)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Fs(h,e).then(function(l){try{return t=l,n()}catch{return s()}},s)}catch{s()}function r(){try{t.name=h.name,t.lastModified=h.lastModified}catch{}try{e.preserveExif&&h.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===h.type)&&(t=Sr(h,t))}catch{}return R(t)}})}Ne.getDataUrlFromFile=Er,Ne.getFilefromDataUrl=Yn,Ne.loadImage=jr,Ne.drawImageInCanvas=Dr,Ne.drawFileInCanvas=yn,Ne.canvasToFile=Tn,Ne.getExifOrientation=Rr,Ne.handleMaxWidthOrHeight=Fr,Ne.followExifOrientation=kr,Ne.cleanupCanvasMemory=st,Ne.isAutoOrientationInBrowser=Et,Ne.approximateBelowMaximumCanvasSizeOfBrowser=Ir,Ne.copyExifWithoutOrientation=Sr,Ne.getBrowserName=At,Ne.version="2.0.2";function ks(h){var p=typeof h;return h!=null&&(p=="object"||p=="function")}var Ur=ks,Us=typeof cn=="object"&&cn&&cn.Object===Object&&cn,Os=Us,Ms=Os,Ns=typeof self=="object"&&self&&self.Object===Object&&self,Ls=Ms||Ns||Function("return this")(),Or=Ls,Ps=Or,Bs=function(){return Ps.Date.now()},Hs=Bs,zs=/\s/;function Ws(h){for(var p=h.length;p--&&zs.test(h.charAt(p)););return p}var $s=Ws,Gs=$s,Ys=/^\s+/;function qs(h){return h&&h.slice(0,Gs(h)+1).replace(Ys,"")}var Vs=qs,Qs=Or,Xs=Qs.Symbol,Mr=Xs,sr=Mr,Nr=Object.prototype,Zs=Nr.hasOwnProperty,Ks=Nr.toString,Ht=sr?sr.toStringTag:void 0;function Js(h){var p=Zs.call(h,Ht),R=h[Ht];try{h[Ht]=void 0;var c=!0}catch{}var e=Ks.call(h);return c&&(p?h[Ht]=R:delete h[Ht]),e}var ei=Js,ti=Object.prototype,ni=ti.toString;function ri(h){return ni.call(h)}var si=ri,ir=Mr,ii=ei,oi=si,ai="[object Null]",li="[object Undefined]",or=ir?ir.toStringTag:void 0;function ci(h){return h==null?h===void 0?li:ai:or&&or in Object(h)?ii(h):oi(h)}var di=ci;function ui(h){return h!=null&&typeof h=="object"}var fi=ui,hi=di,mi=fi,gi="[object Symbol]";function pi(h){return typeof h=="symbol"||mi(h)&&hi(h)==gi}var bi=pi,xi=Vs,ar=Ur,vi=bi,lr=NaN,yi=/^[-+]0x[0-9a-f]+$/i,Ti=/^0b[01]+$/i,Ai=/^0o[0-7]+$/i,Si=parseInt;function Ci(h){if(typeof h=="number")return h;if(vi(h))return lr;if(ar(h)){var p=typeof h.valueOf=="function"?h.valueOf():h;h=ar(p)?p+"":p}if(typeof h!="string")return h===0?h:+h;h=xi(h);var R=Ti.test(h);return R||Ai.test(h)?Si(h.slice(2),R?2:8):yi.test(h)?lr:+h}var wi=Ci,_i=Ur,Fn=Hs,cr=wi,Ei="Expected a function",ji=Math.max,Ii=Math.min;function Di(h,p,R){var c,e,t,d,i,y,S=0,n=!1,s=!1,r=!0;if(typeof h!="function")throw new TypeError(Ei);p=cr(p)||0,_i(R)&&(n=!!R.leading,s="maxWait"in R,t=s?ji(cr(R.maxWait)||0,p):t,r="trailing"in R?!!R.trailing:r);function l(x){var M=c,f=e;return c=e=void 0,S=x,d=h.apply(f,M),d}function b(x){return S=x,i=setTimeout(w,p),n?l(x):d}function I(x){var M=x-y,f=x-S,u=p-M;return s?Ii(u,t-f):u}function k(x){var M=x-y,f=x-S;return y===void 0||M>=p||M<0||s&&f>=t}function w(){var x=Fn();if(k(x))return z(x);i=setTimeout(w,I(x))}function z(x){return i=void 0,r&&c?l(x):(c=e=void 0,d)}function B(){i!==void 0&&clearTimeout(i),S=0,c=y=e=i=void 0}function F(){return i===void 0?d:z(Fn())}function H(){var x=Fn(),M=k(x);if(c=arguments,e=this,y=x,M){if(i===void 0)return b(y);if(s)return clearTimeout(i),i=setTimeout(w,p),l(y)}return i===void 0&&(i=setTimeout(w,p)),d}return H.cancel=B,H.flush=F,H}var Ri=Di;const Fi=us(Ri);var qn={},ki=pt;Object.defineProperty(qn,"__esModule",{value:!0});var Lr=qn.default=void 0,Ui=ki(gt()),dr=o;Lr=qn.default=(0,Ui.default)([(0,dr.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,dr.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn");var Vn={},Oi=pt;Object.defineProperty(Vn,"__esModule",{value:!0});var Pr=Vn.default=void 0,Mi=Oi(gt()),Ni=o;Pr=Vn.default=(0,Mi.default)((0,Ni.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut");var Qn={},Li=pt;Object.defineProperty(Qn,"__esModule",{value:!0});var Br=Qn.default=void 0,Pi=Li(gt()),Bi=o;Br=Qn.default=(0,Pi.default)((0,Bi.jsx)("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen");var Xn={},Hi=pt;Object.defineProperty(Xn,"__esModule",{value:!0});var Hr=Xn.default=void 0,zi=Hi(gt()),Wi=o;Hr=Xn.default=(0,zi.default)((0,Wi.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var Zn={},$i=pt;Object.defineProperty(Zn,"__esModule",{value:!0});var zr=Zn.default=void 0,Gi=$i(gt()),ur=o;zr=Zn.default=(0,Gi.default)([(0,ur.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,ur.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera");const Rt=W.forwardRef(({path:h,initialImages:p=[],onImagesUpdated:R,onDelete:c,isOwnDesign:e},t)=>{const[d,i]=W.useState(p.map(a=>({...a,deleted:!1}))),[y,S]=W.useState(!1),[n,s]=W.useState(0),[r,l]=W.useState(!1),[b,I]=W.useState(null),[k,w]=W.useState(1),[z,B]=W.useState(!1),[F,H]=W.useState(!1),[x,M]=W.useState(""),[f,u]=W.useState("info"),v=W.useRef(null);W.useEffect(()=>{console.log("Initial images received:",p),i(p.map(a=>({...a,deleted:!!a.deleted})))},[p]);const A=async a=>{const N=Array.from(a.target.files||[]);S(!0);const D={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},L=N.map(async(G,$)=>{let q=G;G.size>1024*1024&&(q=await Ne(G,D),M("Your image was compressed before uploading due to file size larger than 1 MB."),u("info"),H(!0));const P=`${new Date().getTime()}-${q.name}`,J=jt(),ue=It(J,`${h}/${P}`),ie=Tr(ue,q);return new Promise((re,le)=>{ie.on("state_changed",ce=>{const fe=ce.bytesTransferred/ce.totalBytes*100;s(fe)},ce=>{console.error("Upload failed:",ce),le(ce)},()=>{Ar(ie.snapshot.ref).then(ce=>{re({url:ce,path:ue.fullPath,title:""})})})})});Promise.all(L).then(G=>{const $=[...d,...G];i($),R&&R($),M("Images uploaded successfully."),u("success"),H(!0),S(!1),s(0),v.current&&(v.current.value="")}).catch(G=>{console.error("Error uploading images: ",G),M("Failed to upload images."),u("error"),H(!0),S(!1),s(0)})},C=a=>{i(N=>{const D=N.map((L,G)=>G===a?{...L,deleted:!0}:L);return R(D),D}),M("Image marked for deletion. Update to permanently delete."),u("info"),H(!0)},E=async()=>{const a=d.filter(N=>N.deleted);if(console.log("Attempting to delete images:",a),a.length>0){const N=a.map(D=>{const L=jt(),G=It(L,D.path);return fn(G)});try{await Promise.all(N),c(a),i(D=>D.filter(L=>!L.deleted)),M("Deleted images have been permanently removed."),u("success")}catch(D){console.error("Error committing deletions:",D),M("Failed to commit deletions."),u("error")}H(!0)}else console.log("No images marked for deletion.")},T=a=>{B(!z),I(a)};W.useEffect(()=>{const a=()=>{const N=!!document.fullscreenElement;B(N)};return document.addEventListener("fullscreenchange",a),()=>document.removeEventListener("fullscreenchange",a)},[]);const _=(a,N)=>{N!=="clickaway"&&H(!1)},m=W.useCallback(Fi((a,N)=>{setTimeout(()=>{i(D=>{const L=D.map((G,$)=>$===a?{...G,title:N}:G);return R&&R(L),L})},0)},30),[R]);return W.useImperativeHandle(t,()=>({commitDeletions:E})),o.jsxs("div",{children:[e&&o.jsx(Qt,{title:"Upload Images",children:o.jsxs(Be,{variant:"outlined",component:"label",startIcon:o.jsx(zr,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",o.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:A,disabled:y,ref:v,accept:"image/*"})]})}),y&&o.jsxs(o.Fragment,{children:[o.jsxs("p",{children:["Uploading... ",Math.round(n),"%"]}),o.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:o.jsx("div",{style:{height:"20px",width:`${n}%`,backgroundColor:"green"}})})]}),d.filter(a=>!a.deleted).map((a,N)=>o.jsxs("div",{children:[o.jsx("img",{src:a.url,alt:`Uploaded design ${N}`,onClick:()=>{l(!0),I(N)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&o.jsx(Xe,{onClick:()=>C(N),children:o.jsx(Xt,{})}),o.jsx("textarea",{value:a.title,onChange:D=>m(N,D.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},N)),o.jsx(St,{open:r,onClose:()=>l(!1),fullScreen:z,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:z?"none":void 0,maxHeight:z?"none":void 0,height:z?"100%":void 0,width:z?"100%":void 0,overflowY:"auto"}},children:b!==null&&o.jsxs(Ct,{children:[o.jsx("div",{style:{textAlign:"center"},children:o.jsx("img",{src:d[b].url,alt:`Zoomed Design ${b}`,style:{maxWidth:"100%",maxHeight:z?"100vh":void 0,transform:`scale(${k})`,transition:"transform 0.2s ease-out"}})}),o.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[o.jsx(Xe,{onClick:()=>w(k*1.2),children:o.jsx(Lr,{})}),o.jsx(Xe,{onClick:()=>w(k/1.2),style:{marginLeft:"10px"},children:o.jsx(Pr,{})}),o.jsx(Xe,{onClick:()=>T(b),style:{marginLeft:"10px"},children:o.jsx(Br,{})}),z&&o.jsx(Xe,{onClick:()=>T(b),style:{position:"absolute",top:20,right:20},children:o.jsx(Hr,{})})]})]})}),o.jsx(ht,{open:F,autoHideDuration:6e3,onClose:_,children:o.jsx(mt,{onClose:_,severity:f,sx:{width:"100%"},children:x})})]})});/*! @license DOMPurify 3.1.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.1.6/LICENSE */const{entries:Wr,setPrototypeOf:fr,isFrozen:Yi,getPrototypeOf:qi,getOwnPropertyDescriptor:Vi}=Object;let{freeze:He,seal:Ze,create:$r}=Object,{apply:Hn,construct:zn}=typeof Reflect<"u"&&Reflect;He||(He=function(p){return p});Ze||(Ze=function(p){return p});Hn||(Hn=function(p,R,c){return p.apply(R,c)});zn||(zn=function(p,R){return new p(...R)});const dn=Ge(Array.prototype.forEach),hr=Ge(Array.prototype.pop),zt=Ge(Array.prototype.push),mn=Ge(String.prototype.toLowerCase),kn=Ge(String.prototype.toString),mr=Ge(String.prototype.match),Wt=Ge(String.prototype.replace),Qi=Ge(String.prototype.indexOf),Xi=Ge(String.prototype.trim),tt=Ge(Object.prototype.hasOwnProperty),Pe=Ge(RegExp.prototype.test),$t=Zi(TypeError);function Ge(h){return function(p){for(var R=arguments.length,c=new Array(R>1?R-1:0),e=1;e<R;e++)c[e-1]=arguments[e];return Hn(h,p,c)}}function Zi(h){return function(){for(var p=arguments.length,R=new Array(p),c=0;c<p;c++)R[c]=arguments[c];return zn(h,R)}}function oe(h,p){let R=arguments.length>2&&arguments[2]!==void 0?arguments[2]:mn;fr&&fr(h,null);let c=p.length;for(;c--;){let e=p[c];if(typeof e=="string"){const t=R(e);t!==e&&(Yi(p)||(p[c]=t),e=t)}h[e]=!0}return h}function Ki(h){for(let p=0;p<h.length;p++)tt(h,p)||(h[p]=null);return h}function Tt(h){const p=$r(null);for(const[R,c]of Wr(h))tt(h,R)&&(Array.isArray(c)?p[R]=Ki(c):c&&typeof c=="object"&&c.constructor===Object?p[R]=Tt(c):p[R]=c);return p}function Gt(h,p){for(;h!==null;){const c=Vi(h,p);if(c){if(c.get)return Ge(c.get);if(typeof c.value=="function")return Ge(c.value)}h=qi(h)}function R(){return null}return R}const gr=He(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Un=He(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),On=He(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Ji=He(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Mn=He(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),eo=He(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),pr=He(["#text"]),br=He(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Nn=He(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),xr=He(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),un=He(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),to=Ze(/\{\{[\w\W]*|[\w\W]*\}\}/gm),no=Ze(/<%[\w\W]*|[\w\W]*%>/gm),ro=Ze(/\${[\w\W]*}/gm),so=Ze(/^data-[\-\w.\u00B7-\uFFFF]/),io=Ze(/^aria-[\-\w]+$/),Gr=Ze(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),oo=Ze(/^(?:\w+script|data):/i),ao=Ze(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Yr=Ze(/^html$/i),lo=Ze(/^[a-z][.\w]*(-[.\w]+)+$/i);var vr=Object.freeze({__proto__:null,MUSTACHE_EXPR:to,ERB_EXPR:no,TMPLIT_EXPR:ro,DATA_ATTR:so,ARIA_ATTR:io,IS_ALLOWED_URI:Gr,IS_SCRIPT_OR_DATA:oo,ATTR_WHITESPACE:ao,DOCTYPE_NAME:Yr,CUSTOM_ELEMENT:lo});const Yt={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},co=function(){return typeof window>"u"?null:window},uo=function(p,R){if(typeof p!="object"||typeof p.createPolicy!="function")return null;let c=null;const e="data-tt-policy-suffix";R&&R.hasAttribute(e)&&(c=R.getAttribute(e));const t="dompurify"+(c?"#"+c:"");try{return p.createPolicy(t,{createHTML(d){return d},createScriptURL(d){return d}})}catch{return console.warn("TrustedTypes policy "+t+" could not be created."),null}};function qr(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:co();const p=K=>qr(K);if(p.version="3.1.6",p.removed=[],!h||!h.document||h.document.nodeType!==Yt.document)return p.isSupported=!1,p;let{document:R}=h;const c=R,e=c.currentScript,{DocumentFragment:t,HTMLTemplateElement:d,Node:i,Element:y,NodeFilter:S,NamedNodeMap:n=h.NamedNodeMap||h.MozNamedAttrMap,HTMLFormElement:s,DOMParser:r,trustedTypes:l}=h,b=y.prototype,I=Gt(b,"cloneNode"),k=Gt(b,"remove"),w=Gt(b,"nextSibling"),z=Gt(b,"childNodes"),B=Gt(b,"parentNode");if(typeof d=="function"){const K=R.createElement("template");K.content&&K.content.ownerDocument&&(R=K.content.ownerDocument)}let F,H="";const{implementation:x,createNodeIterator:M,createDocumentFragment:f,getElementsByTagName:u}=R,{importNode:v}=c;let A={};p.isSupported=typeof Wr=="function"&&typeof B=="function"&&x&&x.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:C,ERB_EXPR:E,TMPLIT_EXPR:T,DATA_ATTR:_,ARIA_ATTR:m,IS_SCRIPT_OR_DATA:a,ATTR_WHITESPACE:N,CUSTOM_ELEMENT:D}=vr;let{IS_ALLOWED_URI:L}=vr,G=null;const $=oe({},[...gr,...Un,...On,...Mn,...pr]);let q=null;const V=oe({},[...br,...Nn,...xr,...un]);let P=Object.seal($r(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),J=null,ue=null,ie=!0,re=!0,le=!1,ce=!0,fe=!1,Ue=!0,Te=!1,me=!1,ye=!1,de=!1,he=!1,pe=!1,Se=!0,be=!1;const je="user-content-";let xe=!0,ne=!1,Ce={},we=null;const ot=oe({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ae=null;const Ye=oe({},["audio","video","img","source","image","track"]);let te=null;const Oe=oe({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),se="http://www.w3.org/1998/Math/MathML",Me="http://www.w3.org/2000/svg",ee="http://www.w3.org/1999/xhtml";let _e=ee,Ie=!1,bt=null;const xt=oe({},[se,Me,ee],kn);let nt=null;const at=["application/xhtml+xml","text/html"],Mt="text/html";let ge=null,Re=null;const Ke=R.createElement("form"),$e=function(j){return j instanceof RegExp||j instanceof Function},ct=function(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Re&&Re===j)){if((!j||typeof j!="object")&&(j={}),j=Tt(j),nt=at.indexOf(j.PARSER_MEDIA_TYPE)===-1?Mt:j.PARSER_MEDIA_TYPE,ge=nt==="application/xhtml+xml"?kn:mn,G=tt(j,"ALLOWED_TAGS")?oe({},j.ALLOWED_TAGS,ge):$,q=tt(j,"ALLOWED_ATTR")?oe({},j.ALLOWED_ATTR,ge):V,bt=tt(j,"ALLOWED_NAMESPACES")?oe({},j.ALLOWED_NAMESPACES,kn):xt,te=tt(j,"ADD_URI_SAFE_ATTR")?oe(Tt(Oe),j.ADD_URI_SAFE_ATTR,ge):Oe,Ae=tt(j,"ADD_DATA_URI_TAGS")?oe(Tt(Ye),j.ADD_DATA_URI_TAGS,ge):Ye,we=tt(j,"FORBID_CONTENTS")?oe({},j.FORBID_CONTENTS,ge):ot,J=tt(j,"FORBID_TAGS")?oe({},j.FORBID_TAGS,ge):{},ue=tt(j,"FORBID_ATTR")?oe({},j.FORBID_ATTR,ge):{},Ce=tt(j,"USE_PROFILES")?j.USE_PROFILES:!1,ie=j.ALLOW_ARIA_ATTR!==!1,re=j.ALLOW_DATA_ATTR!==!1,le=j.ALLOW_UNKNOWN_PROTOCOLS||!1,ce=j.ALLOW_SELF_CLOSE_IN_ATTR!==!1,fe=j.SAFE_FOR_TEMPLATES||!1,Ue=j.SAFE_FOR_XML!==!1,Te=j.WHOLE_DOCUMENT||!1,de=j.RETURN_DOM||!1,he=j.RETURN_DOM_FRAGMENT||!1,pe=j.RETURN_TRUSTED_TYPE||!1,ye=j.FORCE_BODY||!1,Se=j.SANITIZE_DOM!==!1,be=j.SANITIZE_NAMED_PROPS||!1,xe=j.KEEP_CONTENT!==!1,ne=j.IN_PLACE||!1,L=j.ALLOWED_URI_REGEXP||Gr,_e=j.NAMESPACE||ee,P=j.CUSTOM_ELEMENT_HANDLING||{},j.CUSTOM_ELEMENT_HANDLING&&$e(j.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(P.tagNameCheck=j.CUSTOM_ELEMENT_HANDLING.tagNameCheck),j.CUSTOM_ELEMENT_HANDLING&&$e(j.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(P.attributeNameCheck=j.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),j.CUSTOM_ELEMENT_HANDLING&&typeof j.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(P.allowCustomizedBuiltInElements=j.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),fe&&(re=!1),he&&(de=!0),Ce&&(G=oe({},pr),q=[],Ce.html===!0&&(oe(G,gr),oe(q,br)),Ce.svg===!0&&(oe(G,Un),oe(q,Nn),oe(q,un)),Ce.svgFilters===!0&&(oe(G,On),oe(q,Nn),oe(q,un)),Ce.mathMl===!0&&(oe(G,Mn),oe(q,xr),oe(q,un))),j.ADD_TAGS&&(G===$&&(G=Tt(G)),oe(G,j.ADD_TAGS,ge)),j.ADD_ATTR&&(q===V&&(q=Tt(q)),oe(q,j.ADD_ATTR,ge)),j.ADD_URI_SAFE_ATTR&&oe(te,j.ADD_URI_SAFE_ATTR,ge),j.FORBID_CONTENTS&&(we===ot&&(we=Tt(we)),oe(we,j.FORBID_CONTENTS,ge)),xe&&(G["#text"]=!0),Te&&oe(G,["html","head","body"]),G.table&&(oe(G,["tbody"]),delete J.tbody),j.TRUSTED_TYPES_POLICY){if(typeof j.TRUSTED_TYPES_POLICY.createHTML!="function")throw $t('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof j.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw $t('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');F=j.TRUSTED_TYPES_POLICY,H=F.createHTML("")}else F===void 0&&(F=uo(l,e)),F!==null&&typeof H=="string"&&(H=F.createHTML(""));He&&He(j),Re=j}},qe=oe({},["mi","mo","mn","ms","mtext"]),Ve=oe({},["foreignobject","annotation-xml"]),Jt=oe({},["title","style","font","a","script"]),Nt=oe({},[...Un,...On,...Ji]),en=oe({},[...Mn,...eo]),Sn=function(j){let g=B(j);(!g||!g.tagName)&&(g={namespaceURI:_e,tagName:"template"});const U=mn(j.tagName),O=mn(g.tagName);return bt[j.namespaceURI]?j.namespaceURI===Me?g.namespaceURI===ee?U==="svg":g.namespaceURI===se?U==="svg"&&(O==="annotation-xml"||qe[O]):!!Nt[U]:j.namespaceURI===se?g.namespaceURI===ee?U==="math":g.namespaceURI===Me?U==="math"&&Ve[O]:!!en[U]:j.namespaceURI===ee?g.namespaceURI===Me&&!Ve[O]||g.namespaceURI===se&&!qe[O]?!1:!en[U]&&(Jt[U]||!Nt[U]):!!(nt==="application/xhtml+xml"&&bt[j.namespaceURI]):!1},Qe=function(j){zt(p.removed,{element:j});try{B(j).removeChild(j)}catch{k(j)}},vt=function(j,g){try{zt(p.removed,{attribute:g.getAttributeNode(j),from:g})}catch{zt(p.removed,{attribute:null,from:g})}if(g.removeAttribute(j),j==="is"&&!q[j])if(de||he)try{Qe(g)}catch{}else try{g.setAttribute(j,"")}catch{}},tn=function(j){let g=null,U=null;if(ye)j="<remove></remove>"+j;else{const Y=mr(j,/^[\r\n\t ]+/);U=Y&&Y[0]}nt==="application/xhtml+xml"&&_e===ee&&(j='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+j+"</body></html>");const O=F?F.createHTML(j):j;if(_e===ee)try{g=new r().parseFromString(O,nt)}catch{}if(!g||!g.documentElement){g=x.createDocument(_e,"template",null);try{g.documentElement.innerHTML=Ie?H:O}catch{}}const Q=g.body||g.documentElement;return j&&U&&Q.insertBefore(R.createTextNode(U),Q.childNodes[0]||null),_e===ee?u.call(g,Te?"html":"body")[0]:Te?g.documentElement:Q},nn=function(j){return M.call(j.ownerDocument||j,j,S.SHOW_ELEMENT|S.SHOW_COMMENT|S.SHOW_TEXT|S.SHOW_PROCESSING_INSTRUCTION|S.SHOW_CDATA_SECTION,null)},rn=function(j){return j instanceof s&&(typeof j.nodeName!="string"||typeof j.textContent!="string"||typeof j.removeChild!="function"||!(j.attributes instanceof n)||typeof j.removeAttribute!="function"||typeof j.setAttribute!="function"||typeof j.namespaceURI!="string"||typeof j.insertBefore!="function"||typeof j.hasChildNodes!="function")},yt=function(j){return typeof i=="function"&&j instanceof i},Je=function(j,g,U){A[j]&&dn(A[j],O=>{O.call(p,g,U,Re)})},Lt=function(j){let g=null;if(Je("beforeSanitizeElements",j,null),rn(j))return Qe(j),!0;const U=ge(j.nodeName);if(Je("uponSanitizeElement",j,{tagName:U,allowedTags:G}),j.hasChildNodes()&&!yt(j.firstElementChild)&&Pe(/<[/\w]/g,j.innerHTML)&&Pe(/<[/\w]/g,j.textContent)||j.nodeType===Yt.progressingInstruction||Ue&&j.nodeType===Yt.comment&&Pe(/<[/\w]/g,j.data))return Qe(j),!0;if(!G[U]||J[U]){if(!J[U]&&sn(U)&&(P.tagNameCheck instanceof RegExp&&Pe(P.tagNameCheck,U)||P.tagNameCheck instanceof Function&&P.tagNameCheck(U)))return!1;if(xe&&!we[U]){const O=B(j)||j.parentNode,Q=z(j)||j.childNodes;if(Q&&O){const Y=Q.length;for(let Z=Y-1;Z>=0;--Z){const X=I(Q[Z],!0);X.__removalCount=(j.__removalCount||0)+1,O.insertBefore(X,w(j))}}}return Qe(j),!0}return j instanceof y&&!Sn(j)||(U==="noscript"||U==="noembed"||U==="noframes")&&Pe(/<\/no(script|embed|frames)/i,j.innerHTML)?(Qe(j),!0):(fe&&j.nodeType===Yt.text&&(g=j.textContent,dn([C,E,T],O=>{g=Wt(g,O," ")}),j.textContent!==g&&(zt(p.removed,{element:j.cloneNode()}),j.textContent=g)),Je("afterSanitizeElements",j,null),!1)},Pt=function(j,g,U){if(Se&&(g==="id"||g==="name")&&(U in R||U in Ke))return!1;if(!(re&&!ue[g]&&Pe(_,g))){if(!(ie&&Pe(m,g))){if(!q[g]||ue[g]){if(!(sn(j)&&(P.tagNameCheck instanceof RegExp&&Pe(P.tagNameCheck,j)||P.tagNameCheck instanceof Function&&P.tagNameCheck(j))&&(P.attributeNameCheck instanceof RegExp&&Pe(P.attributeNameCheck,g)||P.attributeNameCheck instanceof Function&&P.attributeNameCheck(g))||g==="is"&&P.allowCustomizedBuiltInElements&&(P.tagNameCheck instanceof RegExp&&Pe(P.tagNameCheck,U)||P.tagNameCheck instanceof Function&&P.tagNameCheck(U))))return!1}else if(!te[g]){if(!Pe(L,Wt(U,N,""))){if(!((g==="src"||g==="xlink:href"||g==="href")&&j!=="script"&&Qi(U,"data:")===0&&Ae[j])){if(!(le&&!Pe(a,Wt(U,N,"")))){if(U)return!1}}}}}}return!0},sn=function(j){return j!=="annotation-xml"&&mr(j,D)},on=function(j){Je("beforeSanitizeAttributes",j,null);const{attributes:g}=j;if(!g)return;const U={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:q};let O=g.length;for(;O--;){const Q=g[O],{name:Y,namespaceURI:Z,value:X}=Q,Fe=ge(Y);let ve=Y==="value"?X:Xi(X);if(U.attrName=Fe,U.attrValue=ve,U.keepAttr=!0,U.forceKeepAttr=void 0,Je("uponSanitizeAttribute",j,U),ve=U.attrValue,Ue&&Pe(/((--!?|])>)|<\/(style|title)/i,ve)){vt(Y,j);continue}if(U.forceKeepAttr||(vt(Y,j),!U.keepAttr))continue;if(!ce&&Pe(/\/>/i,ve)){vt(Y,j);continue}fe&&dn([C,E,T],an=>{ve=Wt(ve,an," ")});const wt=ge(j.nodeName);if(Pt(wt,Fe,ve)){if(be&&(Fe==="id"||Fe==="name")&&(vt(Y,j),ve=je+ve),F&&typeof l=="object"&&typeof l.getAttributeType=="function"&&!Z)switch(l.getAttributeType(wt,Fe)){case"TrustedHTML":{ve=F.createHTML(ve);break}case"TrustedScriptURL":{ve=F.createScriptURL(ve);break}}try{Z?j.setAttributeNS(Z,Y,ve):j.setAttribute(Y,ve),rn(j)?Qe(j):hr(p.removed)}catch{}}}Je("afterSanitizeAttributes",j,null)},Cn=function K(j){let g=null;const U=nn(j);for(Je("beforeSanitizeShadowDOM",j,null);g=U.nextNode();)Je("uponSanitizeShadowNode",g,null),!Lt(g)&&(g.content instanceof t&&K(g.content),on(g));Je("afterSanitizeShadowDOM",j,null)};return p.sanitize=function(K){let j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=null,U=null,O=null,Q=null;if(Ie=!K,Ie&&(K="<!-->"),typeof K!="string"&&!yt(K))if(typeof K.toString=="function"){if(K=K.toString(),typeof K!="string")throw $t("dirty is not a string, aborting")}else throw $t("toString is not a function");if(!p.isSupported)return K;if(me||ct(j),p.removed=[],typeof K=="string"&&(ne=!1),ne){if(K.nodeName){const X=ge(K.nodeName);if(!G[X]||J[X])throw $t("root node is forbidden and cannot be sanitized in-place")}}else if(K instanceof i)g=tn("<!---->"),U=g.ownerDocument.importNode(K,!0),U.nodeType===Yt.element&&U.nodeName==="BODY"||U.nodeName==="HTML"?g=U:g.appendChild(U);else{if(!de&&!fe&&!Te&&K.indexOf("<")===-1)return F&&pe?F.createHTML(K):K;if(g=tn(K),!g)return de?null:pe?H:""}g&&ye&&Qe(g.firstChild);const Y=nn(ne?K:g);for(;O=Y.nextNode();)Lt(O)||(O.content instanceof t&&Cn(O.content),on(O));if(ne)return K;if(de){if(he)for(Q=f.call(g.ownerDocument);g.firstChild;)Q.appendChild(g.firstChild);else Q=g;return(q.shadowroot||q.shadowrootmode)&&(Q=v.call(c,Q,!0)),Q}let Z=Te?g.outerHTML:g.innerHTML;return Te&&G["!doctype"]&&g.ownerDocument&&g.ownerDocument.doctype&&g.ownerDocument.doctype.name&&Pe(Yr,g.ownerDocument.doctype.name)&&(Z="<!DOCTYPE "+g.ownerDocument.doctype.name+`>
`+Z),fe&&dn([C,E,T],X=>{Z=Wt(Z,X," ")}),F&&pe?F.createHTML(Z):Z},p.setConfig=function(){let K=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ct(K),me=!0},p.clearConfig=function(){Re=null,me=!1},p.isValidAttribute=function(K,j,g){Re||ct({});const U=ge(K),O=ge(j);return Pt(U,O,g)},p.addHook=function(K,j){typeof j=="function"&&(A[K]=A[K]||[],zt(A[K],j))},p.removeHook=function(K){if(A[K])return hr(A[K])},p.removeHooks=function(K){A[K]&&(A[K]=[])},p.removeAllHooks=function(){A={}},p}var Ln=qr();const it=({onChange:h,initialValue:p})=>{const[R,c]=W.useState(Ln.sanitize(p||"")),e=W.useRef(!1),t=W.useRef(null),[d,i]=W.useState("");W.useEffect(()=>{e.current?c(Ln.sanitize(p||"")):e.current=!0},[p]);const y=(l,b)=>{const I=b.getData(),k=Ln.sanitize(I);c(k),h(k)},S=l=>{if(!t.current){console.warn("Editor not initialized");return}const b=t.current;b.model.change(I=>{const k=b.model.document.selection.getFirstPosition();I.insertText(l,k)}),i("")},n=l=>{S(l.target.value)},s=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],r=["°","+","-","=","~","≥","≤","≠",">","<","*","/","%"];return o.jsxs("div",{children:[o.jsxs(Vt,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%"},children:[o.jsx(fs,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),o.jsx(nr,{variant:"standard",sx:{m:1,minWidth:40},children:o.jsxs(pn,{labelId:"math-operators-label",id:"math-operators",value:d,onChange:n,displayEmpty:!0,children:[o.jsx(_t,{value:"",disabled:!0,children:"Math"}),r.map(l=>o.jsx(_t,{value:l,children:l},l))]})}),o.jsx(nr,{variant:"standard",sx:{m:1,minWidth:40},children:o.jsxs(pn,{labelId:"greek-letters-label",id:"greek-letters",value:d,onChange:n,displayEmpty:!0,children:[o.jsx(_t,{value:"",disabled:!0,children:"Greek"}),s.map(l=>o.jsx(_t,{value:l,children:l},l))]})})]}),o.jsx(hs.CKEditor,{editor:ms,data:R,onReady:l=>{t.current=l},config:{toolbar:["undo","redo","|","heading","bold","italic","|","bulletedList","numberedList","blockQuote","indent","outdent","|","link","insertTable","|"],table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]}},onChange:y})]})};var Kn={},fo=pt;Object.defineProperty(Kn,"__esModule",{value:!0});var Vr=Kn.default=void 0,ho=fo(gt()),mo=o;Vr=Kn.default=(0,ho.default)((0,mo.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile");var Jn={},go=pt;Object.defineProperty(Jn,"__esModule",{value:!0});var Qr=Jn.default=void 0,po=go(gt()),bo=o;Qr=Jn.default=(0,po.default)((0,bo.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload");const Ft=({path:h,initialFiles:p,onFilesChange:R,isOwnDesign:c})=>{const[e,t]=W.useState(p.map(v=>({...v,deleted:!!v.deleted}))),[d,i]=W.useState(!1),[y,S]=W.useState(0),[n,s]=W.useState({}),[r,l]=W.useState(!1),[b,I]=W.useState(""),[k,w]=W.useState("info"),z=W.useRef(null);W.useEffect(()=>{console.log("Initial files received:",p),t(p.map(v=>({...v,deleted:!!v.deleted})))},[p]),W.useEffect(()=>()=>{s({})},[]);const B=v=>{console.log("Updating files with",v),R(v),t(v)},F=async v=>{if(!v.target.files)return;const C=Array.from(v.target.files).filter(T=>T.size>5242880?(I("File size should not exceed 5 MB"),w("error"),l(!0),!1):!0);i(!0);const E=C.map(T=>{const _=new Date().getTime(),m=`${_}-${T.name}`,a=jt(),N=It(a,`${h}/${m}`),D=Tr(N,T);return new Promise((L,G)=>{D.on("state_changed",$=>{const q=$.bytesTransferred/$.totalBytes*100;S(q)},$=>{console.error("Upload failed:",$),G($)},()=>{Ar(D.snapshot.ref).then($=>{L({id:_.toString(),url:$,name:T.name,path:N.fullPath})})})})});Promise.all(E).then(T=>{const _=[...e.filter(m=>!m.deleted),...T];B(_),I("Files uploaded successfully."),w("success"),l(!0),i(!1),S(0),z.current&&(z.current.value="")}).catch(T=>{console.error("Error uploading files: ",T),I("Failed to upload files."),w("error"),l(!0),i(!1),S(0)})},H=v=>{const A=e.map(C=>C.id===v?{...C,deleted:!0}:C);B(A),I("File marked for deletion. Update to permanently delete."),w("info"),l(!0)},x=v=>{s(A=>{var C;return{...A,[v]:((C=e.find(E=>E.id===v))==null?void 0:C.name)||""}}),console.log("editStates after handleEditClick:",n)},M=v=>{t(A=>{const C=A.map(E=>E.id===v&&n[v]!==void 0?{...E,name:n[v]}:E);return R(C),C}),s(A=>{const C={...A};return delete C[v],C}),I("File name updated successfully."),w("info"),l(!0)},f=(v,A)=>{s(C=>({...C,[v]:A}))},u=(v,A)=>{A!=="clickaway"&&l(!1)};return o.jsxs("div",{children:[c&&o.jsx(Qt,{title:"Upload Files",children:o.jsxs(Be,{variant:"outlined",component:"label",startIcon:o.jsx(Qr,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",o.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:F,disabled:d,ref:z})]})}),d&&o.jsx("div",{children:o.jsxs("p",{children:["Uploading... ",Math.round(y),"%"]})}),o.jsx(gs,{children:e.map(v=>o.jsxs(ps,{component:"div",disabled:v.deleted,children:[o.jsx(Ss,{children:o.jsx(Vr,{})}),typeof n[v.id]=="string"?o.jsx(bn,{variant:"outlined",size:"small",value:n[v.id],onChange:A=>f(v.id,A.target.value),onKeyPress:A=>A.key==="Enter"&&M(v.id),fullWidth:!0}):o.jsx(bs,{primary:v.name,secondary:o.jsx("a",{href:v.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),c&&(typeof n[v.id]=="string"?o.jsx(Xe,{onClick:()=>M(v.id),edge:"end","aria-label":"save",children:o.jsx(Bn,{})}):o.jsxs(o.Fragment,{children:[o.jsx(Xe,{onClick:()=>x(v.id),edge:"end","aria-label":"edit",children:o.jsx(yr,{})}),o.jsx(Xe,{onClick:()=>H(v.id),edge:"end","aria-label":"delete",children:o.jsx(Xt,{})})]}))]},v.id))}),o.jsx(ht,{open:r,autoHideDuration:6e3,onClose:u,children:o.jsx(mt,{onClose:u,severity:k,sx:{width:"100%"},children:b})})]})},xo=({designs:h,setDesigns:p,setIsAdding:R,getDesigns:c,onReturnToDashboard:e})=>{const{userDetails:t}=Ot();console.log("Add Design loaded");const[d,i]=W.useState(""),[y,S]=W.useState(""),[n,s]=W.useState(""),[r,l]=W.useState([]),[b,I]=W.useState([]),k=W.useMemo(()=>r,[r]),[w,z]=W.useState(!1),[B,F]=W.useState(""),[H,x]=W.useState("info"),[M,f]=W.useState(!1),[u,v]=W.useState("");console.log("Adding New Design from user:",t);const A=W.useRef(null),C=()=>{f(!1)},E=(_,m)=>{m!=="clickaway"&&z(!1)};W.useEffect(()=>{if(t!=null&&t.class){const _=t.class.filter(m=>m!=="Public-Source");S(_[0]||"")}},[t==null?void 0:t.class]);const T=async _=>{var D;if(_.preventDefault(),console.log("Files to be saved:",b),!t||!t.uid){console.error("User object is undefined or missing UID."),v("You must be signed in to add a design."),f(!0);return}if(!d){v("All fields are required."),f(!0);return}await((D=A.current)==null?void 0:D.commitDeletions());const m=r.filter(L=>!L.deleted),a=b.filter(L=>!L.deleted).map(L=>({id:L.id,url:L.url,name:L.name,path:L.path})),N={title:n,description:d,course:y,dateCreated:Zt(),dateModified:Zt(),images:m,files:a,userId:t.uid};try{const L=await $n(ke(ae,"designs"),N),G={...N,id:L.id};p([...h,G]),setTimeout(()=>{R(!1),c()},1e3),F(`${n} has been Added.`),x("success"),z(!0),s(""),i(""),l([]),I([])}catch(L){console.log(L),v("There was an issue adding your design."),f(!0)}};return o.jsxs("div",{className:"small-container",children:[o.jsx("button",{onClick:e,className:"muted-button margin-top-20",children:"← All Designs"}),o.jsx("div",{className:"design-record",children:o.jsxs("form",{onSubmit:T,children:[o.jsx("h1",{className:"designHeader",children:"New Design"}),o.jsx("div",{style:{display:"flex",alignItems:"center"},children:o.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[o.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),o.jsx("input",{id:"title",type:"text",name:"title",value:n,onChange:_=>s(_.target.value),style:{width:"100%"}})]})}),o.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),o.jsx(pn,{id:"course",value:y,onChange:_=>S(_.target.value),fullWidth:!0,children:((t==null?void 0:t.class)||[]).filter(_=>_!=="Public-Source").map(_=>o.jsx(_t,{value:_,children:_},_))}),o.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),o.jsxs("ul",{children:[o.jsx("li",{children:"Objective: What is the goal for this design?"}),o.jsx("li",{children:"Rationale: Why is this new design being done?"}),o.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),o.jsx("li",{children:"Functional Modification: What is being done to this target?"}),o.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),o.jsx(it,{onChange:i,initialValue:d}),o.jsx(Rt,{ref:A,path:"designs/images",initialImages:k,onImagesUpdated:l,onDelete:_=>l(r.filter(m=>!_.includes(m)))}),o.jsx(Ft,{path:"designs/files",initialFiles:b,onFilesChange:I}),o.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[o.jsx(Be,{type:"submit",variant:"contained",sx:{fontSize:"1rem",mt:2,textTransform:"none",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"Add"}),o.jsx(Be,{onClick:()=>R(!1),style:{marginLeft:"12px"},variant:"outlined",sx:{fontSize:"1rem",mt:2,textTransform:"none",color:"currentColor",borderColor:"rgba(255, 0, 0, 0.5)",boxShadow:"none","&:hover":{borderColor:"rgba(255, 0, 0, 0.7)",backgroundColor:"rgba(255, 0, 0, 0.1)",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",color:"currentColor",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out, background-color 0.3s ease-in-out"},children:"Cancel"})]})]})}),o.jsxs(St,{open:M,onClose:C,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[o.jsx(kt,{id:"alert-dialog-title",children:"Notification"}),o.jsx(Ct,{children:o.jsx(Kt,{id:"alert-dialog-description",children:u})}),o.jsx(Ut,{children:o.jsx(Be,{onClick:C,autoFocus:!0,children:"Ok"})})]}),o.jsx(ht,{open:w,autoHideDuration:1e3,onClose:E,children:o.jsx(mt,{onClose:E,severity:H,sx:{width:"100%"},children:B})})]})},vo=({designId:h,setIsAddingBuild:p,refreshBuilds:R})=>{const[c,e]=W.useState(""),[t,d]=W.useState(""),[i,y]=W.useState([]),[S,n]=W.useState([]),{userDetails:s}=Ot(),r=A=>{y(A)},l=A=>{n(A)};console.log("AddBuild loaded");const[b,I]=W.useState(!1),[k,w]=W.useState(""),[z,B]=W.useState(!1),[F,H]=W.useState(""),[x,M]=W.useState("info");console.log("Adding New Build by user:",s);const f=()=>{I(!1)},u=(A,C)=>{C!=="clickaway"&&B(!1)},v=async A=>{if(A.preventDefault(),!s||!s.uid){console.error("UserDetails object is undefined or missing UID."),w("You must be signed in to add a build."),I(!0);return}if(!t){w("Build description is required."),I(!0);return}const C=i.filter(T=>!T.deleted),E=S.filter(T=>!T.deleted).map(T=>({id:T.id,url:T.url,name:T.name,path:T.path}));try{const T=await $n(ke(ae,"builds"),{title:c,description:t,design_ID:h,dateCreated:Zt(),userId:s.uid,images:C,files:E});console.log("Build added with ID: ",T.id),console.log("Added New Build by user:",s),H("Your build has been successfully added."),M("success"),B(!0),setTimeout(()=>{e(""),d(""),y([]),n([]),p(!1),R()},1e3)}catch(T){if(console.error("Error adding build: ",T),T instanceof Error){let _=`Failed to add the build. ${T.message}`;T.message==="permission-denied"&&(_="You do not have permission to perform this operation."),H(_),M("error"),B(!0)}else H("Failed to add the build. Please try again later."),M("error"),B(!0)}};return o.jsxs("div",{className:"small-container",children:[o.jsxs("form",{onSubmit:v,children:[o.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),o.jsx("input",{id:"buildTitle",type:"text",value:c,onChange:A=>e(A.target.value),style:{width:"100%",marginBottom:"20px"}}),o.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),o.jsx(it,{onChange:d,initialValue:t})," ",o.jsx(Rt,{path:`builds/${h}/images`,initialImages:i,onImagesUpdated:r}),o.jsx(Ft,{path:`builds/${h}/files`,initialFiles:S,onFilesChange:l}),o.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[o.jsx("input",{type:"submit",value:"Save"}),o.jsx("button",{style:{marginLeft:"12px"},onClick:()=>p(!1),className:"button muted-button",children:"Cancel"})]})]}),o.jsxs(St,{open:b,onClose:f,children:[o.jsx(kt,{children:"Notification"}),o.jsx(Ct,{children:o.jsx(Kt,{children:k})}),o.jsx(Ut,{children:o.jsx(Be,{onClick:f,children:"OK"})})]}),o.jsx(ht,{open:z,autoHideDuration:6e3,onClose:u,children:o.jsx(mt,{onClose:u,severity:x,sx:{width:"100%"},children:F})})]})},yo=({designId:h,buildId:p,refreshTests:R,setAddingTestIdForBuild:c})=>{const[e,t]=W.useState(""),[d,i]=W.useState(""),[y,S]=W.useState(""),[n,s]=W.useState(""),[r,l]=W.useState([]),[b,I]=W.useState([]),{userDetails:k}=Ot();console.log("AddTest loaded");const[w,z]=W.useState(!1),[B,F]=W.useState(""),[H,x]=W.useState(!1),[M,f]=W.useState(""),[u,v]=W.useState("info"),A=E=>{I(E)},C=async()=>{if(!d){F("Test description cannot be empty!"),z(!0);return}const E=r.filter(_=>!_.deleted),T=b.filter(_=>!_.deleted).map(_=>({id:_.id,url:_.url,name:_.name,path:_.path}));try{await $n(ke(ae,"tests"),{title:e,build_ID:p,design_ID:h,dateCreated:Zt(),description:d,results:y,conclusions:n,userId:k==null?void 0:k.uid,images:E,files:T}),setTimeout(()=>{R(p),t(""),i(""),S(""),s(""),l([]),I([]),c(!1)},1e3),f("Test added successfully"),v("success"),x(!0)}catch(_){console.error("Error adding test: ",_),f("Failed to add the test"),v("error"),x(!0)}};return o.jsxs("div",{children:[o.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),o.jsx("input",{id:"testTitle",type:"text",value:e,onChange:E=>t(E.target.value),style:{width:"100%",marginBottom:"20px"}}),o.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),o.jsx(it,{onChange:i,initialValue:d}),o.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),o.jsx(it,{onChange:S,initialValue:y}),o.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),o.jsx(it,{onChange:s,initialValue:n}),o.jsx(Rt,{path:`tests/${p}/images`,initialImages:r,onImagesUpdated:E=>{l(E)}}),o.jsx(Ft,{path:`tests/${p}/files`,initialFiles:b,onFilesChange:A}),o.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[o.jsx("button",{onClick:C,children:"Save"}),o.jsx("button",{style:{marginLeft:"12px"},onClick:()=>c(!1),className:"button muted-button",children:"Cancel"})]}),o.jsxs(St,{open:w,onClose:()=>z(!1),children:[o.jsx(kt,{children:"Notification"}),o.jsx(Ct,{children:o.jsx(Kt,{children:B})}),o.jsx(Ut,{children:o.jsx(Be,{onClick:()=>z(!1),children:"OK"})})]}),o.jsx(ht,{open:H,autoHideDuration:6e3,onClose:()=>x(!1),children:o.jsx(mt,{onClose:()=>x(!1),severity:u,sx:{width:"100%"},children:M})})]})};var er={},To=pt;Object.defineProperty(er,"__esModule",{value:!0});var gn=er.default=void 0,Ao=To(gt()),So=o;gn=er.default=(0,Ao.default)((0,So.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff");const qt=h=>h&&h instanceof Wn?h.toDate().toLocaleString():"",Co=({selectedDesign:h,setIsEditing:p,getDesigns:R,onReturnToDashboard:c})=>{const{userDetails:e,loading:t}=Ot(),d=h.id,i=h.userId===(e==null?void 0:e.uid);console.log("Edit page loaded"),console.log("Design ID:",d),console.log("Editing Design by user:",e);const[y,S]=W.useState(""),[n,s]=W.useState(h.description),[r,l]=W.useState(h.course||""),[b,I]=W.useState(qt(h.dateCreated)),[k,w]=W.useState(qt(h.dateModified)),[z,B]=W.useState([]),[F,H]=W.useState([]),x=W.useRef(null),[M,f]=W.useState(!1),[u,v]=W.useState([]),[A,C]=W.useState({}),[E,T]=W.useState({}),[_,m]=W.useState({}),a=W.useRef(null),[N,D]=W.useState({}),[L,G]=W.useState({}),[$,q]=W.useState({}),[V,P]=W.useState(!1),[J,ue]=W.useState({}),[ie,re]=W.useState({}),[le,ce]=W.useState({}),[fe,Ue]=W.useState({}),[Te,me]=W.useState({}),ye=W.useRef(null),[de,he]=W.useState({}),[pe,Se]=W.useState({}),[be,je]=W.useState({}),[xe,ne]=W.useState(!1),[Ce,we]=W.useState(""),[ot,Ae]=W.useState(()=>{}),[Ye,te]=W.useState(!1),[Oe,se]=W.useState(""),[Me,ee]=W.useState("info"),[_e,Ie]=W.useState({design:!1,builds:!1,tests:!1}),bt=async g=>{if(g.preventDefault(),!n){we("All fields are required."),ne(!0);return}console.log("About to check image deletions",x.current),console.log(x.current),console.log(z.some(Y=>Y.deleted)),x.current&&z.some(Y=>Y.deleted)&&(console.log("Committing deletions"),await x.current.commitDeletions());const U=z.filter(Y=>!Y.deleted);F.some(Y=>Y.deleted)&&await at();const O=F.filter(Y=>!Y.deleted);let Q={title:y,description:n,course:r,dateModified:Zt(),images:U.map(Y=>({url:Y.url,title:Y.title,path:Y.path})),files:O.map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path})),userId:e.uid};try{await ut(De(ae,"designs",d),Q,{merge:!0}),se("Your design has been updated."),ee("success"),te(!0);const Y=Wn.now();w(qt(Y))}catch(Y){console.error("Error updating design:",Y),se("There was an issue updating your design."),ee("error"),te(!0)}Ie(Y=>({...Y,design:!1}))};W.useEffect(()=>{h&&(s(h.description||""),S(h.title||""),l(h.course||""),(async()=>{const U=De(ae,"designs",d),O=await xs(U);if(O.exists()){const Q=O.data();console.log("Fetched images:",Q.images),console.log("Fetched files:",Q.files),B(Q.images||[]),H(Q.files||[]),I(qt(Q.dateCreated)),w(qt(Q.dateModified))}})())},[h,d]);const xt=g=>{const U=z.filter(Q=>!g.some(Y=>Y.path===Q.path));console.log("Remaining images after deletion:",U),B(U);const O=U.map(Q=>({url:Q.url,title:Q.title,path:Q.path}));ut(De(ae,"designs",d),{images:O},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(Q=>console.error("Failed to update Firestore:",Q))},nt=g=>{JSON.stringify(z)!==JSON.stringify(g)&&(B(g),console.log("Updated images received:",g))},at=async()=>{const g=F.filter(U=>U.deleted);if(console.log("Files to delete:",g),g.length>0){const U=jt(),O=g.map(Q=>{const Y=It(U,Q.path);return fn(Y)});try{await Promise.all(O),console.log("Files deleted successfully");const Q=F.filter(Y=>!Y.deleted);H(Q),await jn(De(ae,"designs",h.id),{files:Q.map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path}))}),se("Deleted files have been permanently removed."),ee("success"),te(!0)}catch(Q){console.error("Failed to delete files: ",Q),se("Failed to delete files."),ee("error"),te(!0)}}},Mt=async g=>{var Y,Z;try{await en(g)}catch(X){console.error("Error deleting files:",X),se("Failed to delete build files."),ee("error"),te(!0)}const U=((Y=E[g])==null?void 0:Y.filter(X=>!X.deleted).map(({url:X,path:Fe,title:ve})=>({url:X,path:Fe,title:ve})))||[],O=((Z=_[g])==null?void 0:Z.filter(X=>!X.deleted).map(X=>({id:X.id,url:X.url,name:X.name,path:X.path})))||[],Q={};U.length>0&&(Q.images=U),O.length>0&&(Q.files=O),A[g]!==void 0&&(Q.description=A[g]);try{const X=De(ae,"builds",g);await ut(X,Q,{merge:!0}),se("Your build has been updated."),ee("success"),te(!0),$e(),Ie(Fe=>({...Fe,builds:!1}))}catch(X){console.error("Error updating build:",X),se("Failed to update build."),ee("error"),te(!0)}},ge=(g,U)=>{G(O=>({...O,[g]:U}))},Re=(g,U)=>{C(O=>({...O,[g]:U})),Ie(O=>({...O,builds:!0}))},Ke=async g=>{const U=L[g];try{const O=De(ae,"builds",g);await ut(O,{title:U},{merge:!0}),G(Q=>{const Y={...Q};return delete Y[g],Y}),$e()}catch(O){console.error("Failed to save build title:",O)}},$e=async()=>{if(!e){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",e==null?void 0:e.uid),console.log("Selected design ID for query:",h==null?void 0:h.id);let g;e.isAdmin?g=ze(ke(ae,"builds"),Ee("design_ID","==",d),rt("dateCreated")):g=ze(ke(ae,"builds"),Ee("design_ID","==",d),Ee("userId","==",e.uid),rt("dateCreated")),console.log("Builds query details:",JSON.stringify(g,null,2));const U=await ft(g);console.log("Builds snapshot details:",JSON.stringify(U.docs.map(Q=>Q.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",U.docs.length);const O=U.docs.map(Q=>(console.log("Build doc path: ",Q.ref.path),{id:Q.id,...Q.data()}));v(O),console.log("New builds state after refresh:",O)}catch(g){console.error("Error refreshing builds:",g),g.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",g):console.error("An unexpected error occurred when trying to refresh builds:",g)}},ct=(g,U)=>{const O=De(ae,"builds",g),Q=E[g].filter(Z=>!U.some(X=>X.path===Z.path));T(Z=>({...Z,[g]:Q}));const Y=Q.map(Z=>({url:Z.url,title:Z.title,path:Z.path}));ut(O,{images:Y},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),se("Build Image deletions updated."),ee("success")}).catch(Z=>{console.error("Failed to update build images in Firestore:",Z),se("Failed to update build image deletions."),ee("error")}),te(!0)},qe=async g=>{const U=ze(ke(ae,"tests"),Ee("build_ID","==",g),Ee("userId","==",e.uid)),O=await ft(U);for(const Q of O.docs)await Dt(De(ae,"tests",Q.id));await Dt(De(ae,"builds",g)),await $e(),se("Build and its tests (if any) deleted successfully."),ee("success"),te(!0)},Ve=g=>{we("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),Ae(()=>()=>qe(g)),ne(!0)},Jt=(g,U)=>{T(O=>({...O,[g]:U}))},Nt=(g,U)=>{m(O=>({...O,[g]:U}))},en=async g=>{var O;const U=((O=_[g])==null?void 0:O.filter(Q=>Q.deleted))||[];if(console.log("Build files to delete:",U),U.length>0){const Q=jt(),Y=U.map(Z=>{const X=It(Q,Z.path);return fn(X)});try{await Promise.all(Y),console.log("Build files deleted successfully");const Z=_[g].filter(X=>!X.deleted);m(X=>({...X,[g]:Z})),await jn(De(ae,"builds",g),{files:Z.map(X=>({id:X.id,url:X.url,name:X.name,path:X.path}))}),console.log("Firestore successfully updated to remove deleted files"),se("Deleted build files have been permanently removed."),ee("success"),te(!0)}catch(Z){console.error("Failed to delete build files: ",Z),se("Failed to delete build files."),ee("error"),te(!0)}}},Sn=async(g,U)=>{var Z;try{await sn(g)}catch(X){console.error("Error deleting files:",X),se("Failed to delete build files."),ee("error"),te(!0)}const O={},Q=fe[g].filter(X=>!X.deleted).map(({url:X,path:Fe,title:ve})=>({url:X,path:Fe,title:ve})),Y=((Z=Te[g])==null?void 0:Z.filter(X=>!X.deleted).map(X=>({id:X.id,url:X.url,name:X.name,path:X.path})))||[];J[g]!==void 0&&(O.description=J[g]),ie[g]!==void 0&&(O.results=ie[g]),le[g]!==void 0&&(O.conclusions=le[g]),O.images=Q,O.files=Y;try{const X=De(ae,"tests",g);await ut(X,O,{merge:!0}),se("Your test has been updated."),ee("success"),te(!0),yt(U)}catch(X){console.error(`Error updating test ID: ${g}:`,X),se("There was an issue updating your test."),ee("error"),te(!0)}},Qe=(g,U)=>{Se(O=>({...O,[g]:U}))},vt=async(g,U)=>{const O=pe[g],Q=De(ae,"tests",g);await ut(Q,{title:O},{merge:!0}),Se(Y=>{const Z={...Y};return delete Z[g],Z}),yt(U)},tn=(g,U)=>{console.log(`Updating description for test ID ${g}:`,U),ue(O=>({...O,[g]:U})),Ie(O=>({...O,tests:!0}))},nn=(g,U)=>{console.log(`Updating results for test ID ${g}:`,U),re(O=>({...O,[g]:U})),Ie(O=>({...O,tests:!0}))},rn=(g,U)=>{ce(O=>({...O,[g]:U})),Ie(O=>({...O,tests:!0}))};W.useEffect(()=>{!t&&e&&(async()=>{if(!e)return;let U;e.isAdmin?U=ze(ke(ae,"builds"),Ee("design_ID","==",d),rt("dateCreated")):U=ze(ke(ae,"builds"),Ee("design_ID","==",d),Ee("userId","==",e.uid),rt("dateCreated"));const O=await ft(U);let Q=[],Y={},Z={};for(const X of O.docs){const Fe=X.data(),ve=X.id;Q.push({id:ve,...Fe,images:Fe.images||[],files:Fe.files||[]}),Z[ve]=!0;let wt;e.isAdmin?wt=ze(ke(ae,"tests"),Ee("build_ID","==",ve),rt("dateCreated")):wt=ze(ke(ae,"tests"),Ee("build_ID","==",ve),Ee("userId","==",e.uid),rt("dateCreated"));const an=await ft(wt);let tr=[],wn={},_n={};for(const dt of an.docs){const lt=dt.data();tr.push({id:dt.id,...lt}),wn[dt.id]=lt.images||[],_n[dt.id]=lt.files||[]}Y[ve]=tr,Ue(dt=>{let lt={...dt};for(const Bt in wn)lt[Bt]=wn[Bt];return lt}),me(dt=>{let lt={...dt};for(const Bt in _n)lt[Bt]=_n[Bt];return lt})}v(Q),q(Y),je(Z)})()},[t,e,h.id,d]);const yt=async g=>{if(!e){console.log("User details not loaded yet");return}try{let U;e.isAdmin?U=ze(ke(ae,"tests"),Ee("build_ID","==",g),rt("dateCreated")):U=ze(ke(ae,"tests"),Ee("build_ID","==",g),Ee("userId","==",e.uid),rt("dateCreated"));const Q=(await ft(U)).docs.map(X=>({id:X.id,...X.data(),images:X.data().images||[],files:X.data().files||[]}));q(X=>({...X,[g]:Q}));let Y={},Z={};Q.forEach(X=>{Y[X.id]=X.images,Z[X.id]=X.files}),Ue(Y),me(Z)}catch(U){console.error("Error fetching tests:",U)}},Je=(g,U)=>{const O=De(ae,"tests",g),Q=fe[g].filter(Z=>!U.includes(Z));Ue(Z=>({...Z,[g]:Q}));const Y=Q.map(({url:Z,path:X,title:Fe})=>({url:Z,path:X,title:Fe}));ut(O,{images:Y},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),se("Test Image deletions updated."),ee("success")}).catch(Z=>{console.error("Failed to update test images in Firestore:",Z),se("Failed to update test image deletions."),ee("error")}),te(!0)},Lt=(g,U)=>{Ue(O=>({...O,[g]:U}))},Pt=(g,U)=>{me(O=>({...O,[g]:U}))},sn=async g=>{var O;const U=((O=Te[g])==null?void 0:O.filter(Q=>Q.deleted))||[];if(U.length>0){const Q=jt(),Y=U.map(Z=>{const X=It(Q,Z.path);return fn(X)});try{await Promise.all(Y);const Z=Te[g].filter(X=>!X.deleted);me(X=>({...X,[g]:Z})),await jn(De(ae,"tests",g),{files:Z.map(X=>({id:X.id,url:X.url,name:X.name,path:X.path}))}),se("Deleted test files have been permanently removed."),ee("success"),te(!0)}catch(Z){console.error("Failed to delete test files: ",Z),se("Failed to delete test files."),ee("error"),te(!0)}}},on=async(g,U)=>{await Dt(De(ae,"tests",g)),await yt(U),se("Test deleted successfully."),ee("success"),te(!0)},Cn=(g,U)=>{we("Are you sure you want to delete this test? This action cannot be undone."),Ae(()=>()=>on(g,U)),ne(!0)},K=g=>{je(U=>({...U,[g]:!U[g]}))},j=()=>{const g=Object.entries(_e).filter(([O,Q])=>Q).map(([O])=>O).join(", ");if(!g.length){c();return}const U=`You have unsaved changes in the following sections: ${g}. Are you sure you want to leave?`;we(U),Ae(()=>()=>{Ie({design:!1,builds:!1,tests:!1}),c()}),ne(!0)};return W.useEffect(()=>{const g=U=>{Object.values(_e).some(Q=>Q)&&(U.preventDefault(),U.returnValue="")};return window.addEventListener("beforeunload",g),()=>window.removeEventListener("beforeunload",g)},[_e]),o.jsxs("div",{className:"small-container",children:[o.jsx("button",{onClick:()=>{Object.values(_e).some(U=>U)?j():c()},className:"muted-button margin-top-20",children:"← All Designs"}),o.jsx("div",{className:"design-record",children:o.jsxs("form",{onSubmit:bt,children:[o.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),o.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[o.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[o.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),o.jsx("input",{id:"title",type:"text",name:"title",value:y,onChange:g=>{S(g.target.value),Ie(U=>({...U,design:!0}))},style:{width:"100%"}})]}),o.jsxs("div",{style:{flexGrow:2},children:[o.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),o.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:b||"",readOnly:!0,style:{width:"100%"}})]}),o.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[o.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),o.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:k||"",readOnly:!0,style:{width:"100%"}})]})]}),o.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),o.jsx(pn,{id:"course",value:r,onChange:g=>{l(g.target.value),Ie(U=>({...U,design:!0}))},fullWidth:!0,children:o.jsx(_t,{value:r,children:r})}),o.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),o.jsxs("ul",{children:[o.jsx("li",{children:"Objective: What is the goal for this design?"}),o.jsx("li",{children:"Rationale: Why is this new design being done?"}),o.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),o.jsx("li",{children:"Functional Modification: What is being done to this target?"}),o.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),o.jsx(it,{initialValue:n,onChange:g=>{s(g),Ie(U=>({...U,design:!0}))}}),o.jsx(Rt,{ref:x,path:`designs/${h.id}/images`,initialImages:z,onImagesUpdated:nt,onDelete:xt,isOwnDesign:i}),o.jsx(Ft,{path:`designs/${h.id}/files`,initialFiles:F,onFilesChange:H,isOwnDesign:i}),i&&o.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[o.jsx("input",{type:"submit",value:"Update"}),o.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>p(!1),children:"Cancel"})]})]})}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex-space-between",children:[o.jsx("h2",{className:"buildsHeader",children:"Builds"}),i&&o.jsxs("button",{className:"button muted-button",onClick:()=>{f(!0),setTimeout(()=>{a.current&&a.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[o.jsx("span",{role:"img","aria-label":"Add Build",children:"➕"})," Build"]})]}),u.map((g,U)=>o.jsxs("div",{className:"build-record",children:[o.jsxs("div",{className:"flex-space-between align-items-center",children:[o.jsx("div",{children:L[g.id]!==void 0?o.jsx(bn,{variant:"outlined",size:"small",fullWidth:!0,value:L[g.id],onChange:O=>ge(g.id,O.target.value),onBlur:()=>Ke(g.id),autoFocus:!0,InputProps:{endAdornment:o.jsx(Xe,{onClick:()=>Ke(g.id),size:"small",children:o.jsx(Bn,{})})}}):o.jsx("div",{className:"buildTitle",onClick:()=>G(O=>({...O,[g.id]:g.title||`Build ${U+1}`})),style:{cursor:"pointer"},children:g.title||`Build ${U+1}`})}),o.jsxs("div",{children:[o.jsx("button",{onClick:()=>D(O=>({...O,[g.id]:!O[g.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:N[g.id]?o.jsx(gn,{}):o.jsx(In,{})}),i&&o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Ve(g.id),children:o.jsx(Xt,{})}),o.jsxs("button",{className:"button muted-button",onClick:()=>{P(g.id),setTimeout(()=>{ye.current&&ye.current.scrollIntoView({behavior:"smooth"})},100)},children:[o.jsx("span",{role:"img","aria-label":"Add Test",children:"➕"})," Test"]})]})]})]}),N[g.id]&&o.jsxs(o.Fragment,{children:[o.jsx(it,{initialValue:A[g.id]||g.description,onChange:O=>{Re(g.id,O)}}),o.jsx(Rt,{path:`builds/${g.id}/images`,initialImages:g.images,onImagesUpdated:O=>Jt(g.id,O),onDelete:O=>ct(g.id,O),isOwnDesign:i}),o.jsx(Ft,{path:`builds/${g.id}/files`,initialFiles:g.files,onFilesChange:O=>Nt(g.id,O),isOwnDesign:i}),i&&o.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:o.jsx("button",{onClick:()=>Mt(g.id),children:"Update"})}),o.jsx("div",{children:$[g.id]&&$[g.id].length>0&&o.jsx("button",{onClick:()=>K(g.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:be[g.id]?o.jsxs(o.Fragment,{children:[o.jsx(In,{style:{marginRight:"8px"}}),"Tests"]}):o.jsxs(o.Fragment,{children:[o.jsx(gn,{style:{marginRight:"8px"}}),"Tests"]})})}),!be[g.id]&&$[g.id]&&$[g.id].map((O,Q)=>o.jsxs("div",{className:"test-record",children:[o.jsxs("div",{className:"flex-space-between align-items-center",children:[o.jsx("div",{children:pe[O.id]!==void 0?o.jsx(bn,{variant:"outlined",size:"small",fullWidth:!0,value:pe[O.id],onChange:Y=>Qe(O.id,Y.target.value),onBlur:()=>vt(O.id,g.id),autoFocus:!0,InputProps:{endAdornment:o.jsx(Xe,{onClick:()=>vt(O.id,g.id),size:"small",children:o.jsx(Bn,{})})}}):o.jsx("div",{className:"testTitle",onClick:()=>Se(Y=>({...Y,[O.id]:O.title||`Test ${Q+1}`})),style:{cursor:"pointer"},children:O.title||`Test ${Q+1}`})}),o.jsxs("div",{children:[o.jsx("button",{onClick:()=>he(Y=>({...Y,[O.id]:!Y[O.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:de[O.id]?o.jsx(gn,{}):o.jsx(In,{})}),i&&o.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Cn(O.id,g.id),children:o.jsx(Xt,{})})]})]}),de[O.id]&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:[o.jsx("label",{className:"testTitles",children:"Description"}),o.jsx(it,{initialValue:J[O.id]||O.description,onChange:Y=>{tn(O.id,Y)}})]}),o.jsxs("div",{children:[o.jsx("label",{className:"testTitles",children:"Results"}),o.jsx(it,{initialValue:ie[O.id]||O.results,onChange:Y=>{nn(O.id,Y)}})]}),o.jsxs("div",{children:[o.jsx("label",{className:"testTitles",children:"Conclusions"}),o.jsx(it,{initialValue:le[O.id]||O.conclusions,onChange:Y=>{rn(O.id,Y)}})]}),o.jsxs("div",{children:[o.jsx(Rt,{path:`tests/${O.id}/images`,initialImages:fe[O.id]||[],onImagesUpdated:Y=>Lt(O.id,Y),onDelete:Y=>Je(O.id,Y),isOwnDesign:i}),o.jsx(Ft,{path:`tests/${O.id}/files`,initialFiles:Te[O.id]||[],onFilesChange:Y=>Pt(O.id,Y),isOwnDesign:i})]}),i&&o.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:o.jsx("button",{onClick:()=>Sn(O.id,g.id),children:"Update"})})]})]},O.id))]}),V===g.id&&o.jsxs("div",{className:"new-test-record",ref:ye,children:[o.jsx("h3",{className:"newTestHeader",children:"New Test"}),o.jsx(yo,{designId:h.id,buildId:g.id,refreshTests:()=>yt(g.id),setAddingTestIdForBuild:P,onImagesUpdated:O=>Lt(g.id,O),onFilesChange:O=>Pt(g.id,O)})]})]},g.id)),o.jsx("div",{children:M&&o.jsxs("div",{className:"new-build-record",ref:a,children:[o.jsx("h3",{className:"newBuildHeader",children:"New Build"}),o.jsx(vo,{designId:h.id,setIsAddingBuild:f,refreshBuilds:$e,onImagesUpdated:g=>Jt(build.id,g),onFilesChange:g=>Nt(build.id,g)})]})})]}),o.jsxs(St,{open:xe,onClose:()=>ne(!1),children:[o.jsx(kt,{children:"Confirmation Required"}),o.jsx(Ct,{children:o.jsx(Kt,{children:Ce})}),o.jsxs(Ut,{children:[o.jsx(Be,{onClick:()=>ne(!1),children:"Cancel"}),o.jsx(Be,{onClick:()=>{ot(),ne(!1)},autoFocus:!0,children:"Confirm"})]})]}),o.jsx(ht,{open:Ye,autoHideDuration:6e3,onClose:()=>te(!1),children:o.jsx(mt,{onClose:()=>te(!1),severity:Me,sx:{width:"100%"},children:Oe})})]})},wo=()=>{const{userDetails:h,loading:p}=Ot();console.log("Dashboard loaded");const[R,c]=W.useState([]),[e,t]=W.useState([]),[d,i]=W.useState(null),[y,S]=W.useState(!1),[n,s]=W.useState(!1),[r,l]=W.useState(!1),[b,I]=W.useState(""),[k,w]=W.useState(""),[z,B]=W.useState(!1),[F,H]=W.useState(null),[x,M]=W.useState(!1),[f,u]=W.useState(""),[v,A]=W.useState("info"),C=()=>{s(!1),S(!1),i(null),E()},E=W.useCallback(async()=>{let a;h&&h.isAdmin?a=ze(ke(ae,"designs"),rt("dateCreated","desc")):h&&(a=ze(ke(ae,"designs"),Ee("userId","==",h.uid),rt("dateCreated","desc")));const N=await ft(a||ze(ke(ae,"designs"))),D=[],L=[];N.forEach(G=>{const $=G.data(),q={id:G.id,title:$.title,description:$.description,course:$.course,dateCreated:$.dateCreated,dateModified:$.dateModified,userId:$.userId,images:$.images||[],files:$.files||[]};$.userId===(h==null?void 0:h.uid)?D.push(q):L.push(q)}),c(D),t(L)},[h]);W.useEffect(()=>{!p&&h&&E()},[h,p,E]);const T=a=>{const N=[...R,...e].find(D=>D.id===a);i(N||null),s(!0)},_=a=>{H(a),I("Are you sure you want to delete this design? This action cannot be undone."),l(!0)},m=async()=>{if(F)if(k!==(h==null?void 0:h.uid))u("User ID confirmation failed. Enter the correct User ID."),A("error"),M(!0);else try{const a=ze(ke(ae,"builds"),Ee("design_ID","==",F),Ee("userId","==",h.uid)),N=await ft(a);for(const D of N.docs){const L=D.id,G=ze(ke(ae,"tests"),Ee("build_ID","==",L),Ee("userId","==",h.uid)),$=await ft(G);for(const q of $.docs)await Dt(De(ae,"tests",q.id));await Dt(De(ae,"builds",L))}await Dt(De(ae,"designs",F)),c(D=>D.filter(L=>L.id!==F)),t(D=>D.filter(L=>L.id!==F)),u("Your design and its associated builds and tests have been deleted."),A("success"),M(!0)}catch(a){console.error("Error deleting design, builds, and tests: ",a),u("There was an issue deleting your design and its associated builds and tests."),A("error"),M(!0)}finally{w(""),B(!1),H(null)}};return o.jsxs("div",{className:"container",children:[!y&&!n&&o.jsxs(o.Fragment,{children:[o.jsx(Cs,{setIsAdding:S}),(h==null?void 0:h.isAdmin)&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Admin Designs"}),o.jsx(Dn,{designs:R,handleEdit:T,handleDelete:_,isAdmin:!0,userDetails:h,showUserIdColumn:!0}),o.jsx("h2",{children:"Users' Designs"}),o.jsx(Dn,{designs:e,handleEdit:T,handleDelete:_,isAdmin:!1,userDetails:h,showUserIdColumn:!0})]}),!(h!=null&&h.isAdmin)&&o.jsx(Dn,{designs:R,handleEdit:T,handleDelete:_,isAdmin:!1,userDetails:h,showUserIdColumn:!1})]}),y&&o.jsx(xo,{designs:R,setDesigns:c,setIsAdding:S,getDesigns:E,onReturnToDashboard:C}),n&&o.jsx(Co,{designs:R,selectedDesign:d,setDesigns:c,setIsEditing:s,getDesigns:E,onReturnToDashboard:C}),o.jsxs(St,{open:r,onClose:()=>l(!1),PaperProps:{style:{minWidth:500}},children:[o.jsx(kt,{children:"Confirm Deletion"}),o.jsx(Ct,{children:o.jsx(Kt,{children:b})}),o.jsxs(Ut,{children:[o.jsx(Be,{onClick:()=>l(!1),children:"No, cancel"}),o.jsx(Be,{onClick:()=>{B(!0),l(!1)},color:"primary",children:"Yes, delete it"})]})]}),o.jsxs(St,{open:z,onClose:()=>B(!1),PaperProps:{style:{minWidth:500}},children:[o.jsx(kt,{children:"Confirm Your User ID"}),o.jsx(Ct,{children:o.jsx(bn,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:k,onChange:a=>w(a.target.value)})}),o.jsxs(Ut,{children:[o.jsx(Be,{onClick:()=>B(!1),children:"No, cancel"}),o.jsx(Be,{onClick:m,color:"primary",children:"Confirm"})]})]}),o.jsx(ht,{open:x,autoHideDuration:6e3,onClose:()=>M(!1),children:o.jsx(mt,{onClose:()=>M(!1),severity:v,sx:{width:"100%"},children:f})})]})},jo=vs.memo(wo);export{jo as default};
