import{H as A,j as e,B as d,o as p,T as h,ay as F,Y as Q,ag as V,Z as Y,ah as Z,ai as _,ap as N,aw as ae,ar as le,af as E,d as c,a5 as ne,a4 as ie,a6 as re,a7 as oe,as as L,au as O,at as M,al as z,az as ce,aA as de,G as v,q as ue,A as he,Q as U,an as xe,R as pe,U as be,aq as me,aB as je}from"./index-BqL-r4yV.js";const ge=()=>{const t=A(),l=()=>{t("/")};return e.jsxs(d,{children:[e.jsx(d,{className:"supplemental-header",children:e.jsx(p,{variant:"text",onClick:l,className:"supplemental-back-button",children:"â† Home Page"})}),e.jsx(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:e.jsx(h,{className:"supplemental-title",children:"Course Materials"})})]})},fe=()=>{const t=A();return e.jsx(p,{className:"add-material-button",variant:"contained",color:"primary",onClick:()=>t("/add-material"),children:"+ Add Material"})},Ce=({materialId:t,open:l,onClose:a,onDelete:n})=>{const r=F(),i=async()=>{const u=N(r,"materials",t);await ae(u),n(),a()};return e.jsxs(Q,{open:l,onClose:a,children:[e.jsx(V,{children:"Delete Material"}),e.jsx(Y,{children:e.jsx(Z,{children:"Are you sure you want to delete this material? This action cannot be undone."})}),e.jsxs(_,{children:[e.jsx(p,{onClick:a,color:"primary",children:"Cancel"}),e.jsx(p,{onClick:i,color:"secondary",children:"Delete"})]})]})},ve=({materialId:t,onClick:l})=>e.jsx(p,{variant:"contained",color:"error",onClick:()=>l(t),sx:{backgroundColor:"#FFCDD2",color:"#C62828",borderRadius:"15px",fontWeight:"bold",padding:"4px 8px",ml:1,textTransform:"none"},children:"Unpublish"}),ye=({materialId:t,open:l,onClose:a,onUnpublish:n})=>{const r=F(),i=async()=>{const u=N(r,"materials",t);await le(u,{published:!1}),n(),a()};return e.jsxs(Q,{open:l,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(V,{id:"alert-dialog-title",children:"Unpublish Material"}),e.jsx(Y,{children:e.jsx(Z,{id:"alert-dialog-description",children:"Are you sure you want to unpublish this material? It will no longer be visible to users until it is published again."})}),e.jsxs(_,{children:[e.jsx(p,{onClick:a,color:"primary",children:"Cancel"}),e.jsx(p,{onClick:i,color:"error",autoFocus:!0,children:"Unpublish"})]})]})},ke=({selectedCourse:t,onCourseChange:l})=>{const{userDetails:a}=E(),[n,r]=c.useState([]);return c.useEffect(()=>{if(a!=null&&a.classes){const i=Object.entries(a.classes).map(([u,b])=>({id:u,number:b.number,title:b.title}));r(i)}else r([])},[a]),e.jsx(d,{sx:{width:"100%",mb:2},children:n.length>0?e.jsxs(ne,{sx:{width:"30%"},children:[e.jsx(ie,{id:"course-selector-label",children:"Select Course"}),e.jsx(re,{labelId:"course-selector-label",value:t,onChange:i=>l(i.target.value),children:n.map(i=>e.jsxs(oe,{value:i.id,children:[i.number," - ",i.title]},i.id))})]}):e.jsx(h,{variant:"body1",align:"center",children:"No Courses Available"})})},De=({initialCourse:t})=>{const{userDetails:l}=E(),a=F(),[n,r]=c.useState([]),[i,u]=c.useState(!0),[b,R]=c.useState(!1),[m,T]=c.useState(!1),[o,B]=c.useState(t??null),[y,P]=c.useState(null),[j,$]=c.useState({open:!1,materialId:null}),[k,D]=c.useState(null),g=A(),J=async()=>{if(!o)return;const s=N(a,"courses",o),f=await me(s);if(f.exists()){const x=f.data(),C=(x==null?void 0:x.courseAdmin)||[];T(C.includes(l==null?void 0:l.uid))}else T(!1)};c.useEffect(()=>{J()},[o,l]),c.useEffect(()=>{t&&o!==t&&B(t)},[t,o]),c.useEffect(()=>{if(!o){console.log("No course selected"),r([]),u(!1);return}console.log(`Fetching materials for course: ${o}`),u(!0);const s=l!=null&&l.isAdmin?L(z(a,"materials"),M("course","==",o),O("timestamp","desc")):L(z(a,"materials"),M("course","==",o),M("published","==",!0),O("timestamp","desc")),f=ce(s,x=>{const C=x.docs.map(G=>({id:G.id,...G.data()}));r(C),console.log(`Fetched ${C.length} materials for course: ${o}`),u(!1)},x=>{console.error(x),D("Failed to fetch materials"),u(!1)});return()=>f()},[a,o,l]);const S=s=>{P(s),R(!0)},K=()=>{R(!1),P(null)},X=()=>{r(n.filter(s=>s.id!==y))},I=s=>{$({open:!0,materialId:s})},ee=()=>{r(n.map(s=>s.id===j.materialId?{...s,published:!1}:s))},se=()=>{$({open:!1,materialId:null})},te=s=>{B(s),g(`/supplemental-materials?course=${s}`)};if(i)return e.jsx(de,{});const H=n.filter(s=>!s.published&&!s.scheduledTimestamp),W=n.filter(s=>s.scheduledTimestamp&&!s.published),q=n.filter(s=>s.published);return e.jsxs(d,{sx:{width:"100%"},children:[e.jsx(ke,{selectedCourse:o||"",onCourseChange:te}),n.length===0&&o&&e.jsx(h,{variant:"body1",align:"center",sx:{width:"100%",mb:4},children:"No materials found for the selected course."}),m&&n.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{sx:{mb:4},children:[e.jsx(h,{variant:"h6",sx:{fontWeight:"bold",color:"#F57C00",mb:2},children:"Saved"}),e.jsx(v,{container:!0,spacing:3,children:H.length===0?e.jsx(h,{variant:"body1",align:"center",sx:{width:"100%"},children:"No saved (unpublished) materials found."}):H.map(s=>e.jsx(w,{material:s,isCourseAdmin:m,navigate:g,onDeleteClick:S,onUnpublishClick:I},s.id))})]}),e.jsxs(d,{sx:{mb:4},children:[e.jsx(h,{variant:"h6",sx:{fontWeight:"bold",color:"#0D47A1",mb:2},children:"Publish Scheduled"}),e.jsx(v,{container:!0,spacing:3,children:W.length===0?e.jsx(h,{variant:"body1",align:"center",sx:{width:"100%"},children:"No materials scheduled for publishing found."}):W.map(s=>e.jsx(w,{material:s,isCourseAdmin:m,navigate:g,onDeleteClick:S,onUnpublishClick:I},s.id))})]})]}),e.jsxs(d,{sx:{mb:4},children:[e.jsx(h,{variant:"h6",sx:{fontWeight:"bold",color:"#2E7D32",mb:2},children:"Published"}),e.jsx(v,{container:!0,spacing:3,children:q.length===0?e.jsx(h,{variant:"body1",align:"center",sx:{width:"100%"},children:"No published materials found."}):q.map(s=>e.jsx(w,{material:s,isCourseAdmin:m,navigate:g,onDeleteClick:S,onUnpublishClick:I},s.id))})]}),y&&e.jsx(Ce,{materialId:y,open:b,onClose:K,onDelete:X}),j.materialId&&e.jsx(ye,{materialId:j.materialId,open:j.open,onClose:se,onUnpublish:ee}),k&&e.jsx(ue,{open:!0,autoHideDuration:6e3,onClose:()=>D(null),children:e.jsx(he,{onClose:()=>D(null),severity:"error",children:k})},k)]})},w=({material:t,isCourseAdmin:l,navigate:a,onDeleteClick:n,onUnpublishClick:r})=>e.jsx(v,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(d,{sx:{border:"1px solid #ddd",borderRadius:"8px",padding:2,position:"relative",backgroundColor:t.published?"#E8F5E9":"#FFF9C4"},children:[e.jsx(U,{onClick:()=>a(`/view-material/${t.id}`),"aria-label":"view",children:e.jsx(xe,{})}),e.jsx(h,{variant:"h6",children:t.title||"Untitled"}),e.jsx(d,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1},children:l&&e.jsxs(e.Fragment,{children:[e.jsx(U,{onClick:()=>a(`/edit-material/${t.id}`),"aria-label":"edit",children:e.jsx(pe,{})}),e.jsx(U,{onClick:()=>n(t.id),"aria-label":"delete",children:e.jsx(be,{})}),t.published&&e.jsx(ve,{materialId:t.id,onClick:r})]})})]})}),Ie=()=>{const{userDetails:t}=E(),[l]=je(),a=l.get("course");return e.jsxs(d,{className:"supplemental-container",children:[e.jsx(ge,{}),e.jsxs(d,{className:"supplemental-content",children:[(t==null?void 0:t.isAdmin)&&e.jsx(fe,{}),e.jsx(De,{initialCourse:a})," "]})]})};export{Ie as default};
