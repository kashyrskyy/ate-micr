import{s as Qs,_ as Ln,e as z,u as Xs,f as Zs,L as Ks,j as a,h as Js,i as er,E as tr,H as nr,B as dn,p as Be,T as sr,I as rr,P as ir,J as ar,K as or,M as En,N as Le,O as lr,q as gn,Q as Xe,R as vs,U as Vt,V as $n,W as on,X as cr,k as ht,l as mt,Y as Tt,Z as At,t as St,A as Ct,$ as It,a0 as Dt,a1 as ys,a2 as Ts,a3 as un,a4 as dr,a5 as ts,a6 as pn,a7 as Et,a8 as ur,a9 as fr,aa as hr,ab as mr,ac as bn,ad as gr,ae as Pn,af as Xt,ag as Ot,ah as Zt,ai as kt,aj as Qt,ak as zn,al as Ue,am as oe,an as ut,ao as De,ap as pr,aq as jn,ar as $e,as as _e,at as nt,au as ft,av as Rt,aw as br}from"./index-DkE_V6Ox.js";import{d as In}from"./Visibility-O29BT72A.js";const xr=["className"],vr=u=>{const{alignItems:v,classes:R}=u;return er({root:["root",v==="flex-start"&&"alignItemsFlexStart"]},tr,R)},yr=Qs("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(u,v)=>{const{ownerState:R}=u;return[v.root,R.alignItems==="flex-start"&&v.alignItemsFlexStart]}})(({theme:u,ownerState:v})=>Ln({minWidth:56,color:(u.vars||u).palette.action.active,flexShrink:0,display:"inline-flex"},v.alignItems==="flex-start"&&{marginTop:8})),Tr=z.forwardRef(function(v,R){const c=Xs({props:v,name:"MuiListItemIcon"}),{className:e}=c,t=Zs(c,xr),d=z.useContext(Ks),i=Ln({},c,{alignItems:d.alignItems}),y=vr(i);return a.jsx(yr,Ln({className:Js(y.root,e),ownerState:i,ref:R},t))}),Ar=z.memo(({setIsAdding:u})=>{console.log("Header loaded");const v=nr(),R=()=>{v("/")};return a.jsxs(dn,{className:"lab-notebook-container",children:[a.jsx(dn,{sx:{display:"flex",alignItems:"center"},children:a.jsx(Be,{variant:"text",onClick:R,className:"back-home-button",children:"← Home Page"})}),a.jsx(sr,{className:"webpage_title",children:"My Laboratory Notebook"}),a.jsx(dn,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:a.jsx(Be,{className:"create-new-button",variant:"contained",color:"primary",onClick:()=>u(!0),children:"+ Create New"})})]})}),_t=({designs:u,handleEdit:v,handleDelete:R,isAdmin:c,userDetails:e,showUserIdColumn:t})=>{const d=i=>i?i instanceof $n?i.toDate().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):i instanceof Date?i.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A":"N/A";return a.jsx(rr,{component:ir,children:a.jsxs(ar,{sx:{"& .MuiTableCell-root":{fontSize:"1rem"},"& .MuiTableCell-head":{fontSize:"1.2rem",backgroundColor:"#1A76D3",color:"white"}},children:[a.jsx(or,{children:a.jsxs(En,{sx:{height:"60px"},children:[a.jsx(Le,{sx:{fontWeight:"bold",width:t?"30%":"40%"},children:"Title"}),a.jsx(Le,{sx:{fontWeight:"bold",width:"20%"},children:"Course"}),t&&a.jsx(Le,{sx:{fontWeight:"bold",width:"20%"},children:"User ID"}),a.jsx(Le,{sx:{fontWeight:"bold",width:"15%"},children:"Created"}),a.jsx(Le,{sx:{fontWeight:"bold",width:"15%"},children:"Last Edited"}),a.jsx(Le,{sx:{fontWeight:"bold",width:"10%"},children:"Edit"}),a.jsx(Le,{sx:{fontWeight:"bold",width:"10%"},children:"Delete"})]})}),a.jsx(lr,{children:u&&u.length>0?u.map(i=>{const y=i.userId===(e==null?void 0:e.uid);return a.jsxs(En,{sx:{height:"80px"},children:[a.jsx(Le,{children:a.jsx("button",{onClick:()=>v(i.id),className:"hyperlink-style",children:i.title})}),a.jsx(Le,{children:i.course&&(e!=null&&e.classes)&&e.classes[i.course]?`${e.classes[i.course].number} - ${e.classes[i.course].title}`:"N/A"}),t&&a.jsx(Le,{children:i.userId}),a.jsx(Le,{children:d(i.dateCreated)}),a.jsx(Le,{children:d(i.dateModified)}),a.jsx(Le,{children:a.jsx(gn,{title:"Edit",children:a.jsx("span",{children:a.jsx(Xe,{onClick:()=>y&&v(i.id),color:"primary",disabled:!y,children:a.jsx(vs,{})})})})}),a.jsx(Le,{children:a.jsx(gn,{title:"Delete",children:a.jsx("span",{children:a.jsx(Xe,{onClick:()=>y&&R(i.id),color:"error",disabled:!y,children:a.jsx(Vt,{})})})})})]},i.id)}):a.jsx(En,{children:a.jsx(Le,{colSpan:t?6:5,children:"No Designs Found"})})})]})})};function Sr(u,v){return v.forEach(function(R){R&&typeof R!="string"&&!Array.isArray(R)&&Object.keys(R).forEach(function(c){if(c!=="default"&&!(c in u)){var e=Object.getOwnPropertyDescriptor(R,c);Object.defineProperty(u,c,e.get?e:{enumerable:!0,get:function(){return R[c]}})}})}),Object.freeze(u)}function As(u,v){return new Promise(function(R,c){let e;return Cr(u).then(function(t){try{return e=t,R(new Blob([v.slice(0,2),e,v.slice(2)],{type:"image/jpeg"}))}catch(d){return c(d)}},c)})}const Cr=u=>new Promise((v,R)=>{const c=new FileReader;c.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let d=0;if(t.getUint16(d)!==65496)return R("not a valid JPEG");for(d+=2;;){const i=t.getUint16(d);if(i===65498)break;const y=t.getUint16(d+2);if(i===65505&&t.getUint32(d+4)===1165519206){const C=d+10;let s;switch(t.getUint16(C)){case 18761:s=!0;break;case 19789:s=!1;break;default:return R("TIFF header contains invalid endian")}if(t.getUint16(C+2,s)!==42)return R("TIFF header contains invalid version");const r=t.getUint32(C+4,s),n=C+r+2+12*t.getUint16(C+r,s);for(let l=C+r+2;l<n;l+=12)if(t.getUint16(l,s)==274){if(t.getUint16(l+2,s)!==3)return R("Orientation data type is invalid");if(t.getUint32(l+4,s)!==1)return R("Orientation data count is invalid");t.setUint16(l+8,1,s);break}return v(e.slice(d,d+2+y))}d+=2+y}return v(new Blob)}),c.readAsArrayBuffer(u)});var xn={},wr={get exports(){return xn},set exports(u){xn=u}};(function(u){var v,R,c={};wr.exports=c,c.parse=function(e,t){for(var d=c.bin.readUshort,i=c.bin.readUint,y=0,C={},s=new Uint8Array(e),r=s.length-4;i(s,r)!=101010256;)r--;y=r,y+=4;var n=d(s,y+=4);d(s,y+=2);var l=i(s,y+=2),b=i(s,y+=4);y+=4,y=b;for(var I=0;I<n;I++){i(s,y),y+=4,y+=4,y+=4,i(s,y+=4),l=i(s,y+=4);var O=i(s,y+=4),w=d(s,y+=4),$=d(s,y+2),B=d(s,y+4);y+=6;var F=i(s,y+=8);y+=4,y+=w+$+B,c._readLocal(s,F,C,l,O,t)}return C},c._readLocal=function(e,t,d,i,y,C){var s=c.bin.readUshort,r=c.bin.readUint;r(e,t),s(e,t+=4),s(e,t+=2);var n=s(e,t+=2);r(e,t+=2),r(e,t+=4),t+=4;var l=s(e,t+=8),b=s(e,t+=2);t+=2;var I=c.bin.readUTF8(e,t,l);if(t+=l,t+=b,C)d[I]={size:y,csize:i};else{var O=new Uint8Array(e.buffer,t);if(n==0)d[I]=new Uint8Array(O.buffer.slice(t,t+i));else{if(n!=8)throw"unknown compression method: "+n;var w=new Uint8Array(y);c.inflateRaw(O,w),d[I]=w}}},c.inflateRaw=function(e,t){return c.F.inflate(e,t)},c.inflate=function(e,t){return e[0],e[1],c.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},c.deflate=function(e,t){t==null&&(t={level:6});var d=0,i=new Uint8Array(50+Math.floor(1.1*e.length));i[d]=120,i[d+1]=156,d+=2,d=c.F.deflateRaw(e,i,d,t.level);var y=c.adler(e,0,e.length);return i[d+0]=y>>>24&255,i[d+1]=y>>>16&255,i[d+2]=y>>>8&255,i[d+3]=y>>>0&255,new Uint8Array(i.buffer,0,d+4)},c.deflateRaw=function(e,t){t==null&&(t={level:6});var d=new Uint8Array(50+Math.floor(1.1*e.length)),i=c.F.deflateRaw(e,d,i,t.level);return new Uint8Array(d.buffer,0,i)},c.encode=function(e,t){t==null&&(t=!1);var d=0,i=c.bin.writeUint,y=c.bin.writeUshort,C={};for(var s in e){var r=!c._noNeed(s)&&!t,n=e[s],l=c.crc.crc(n,0,n.length);C[s]={cpr:r,usize:n.length,crc:l,file:r?c.deflateRaw(n):n}}for(var s in C)d+=C[s].file.length+30+46+2*c.bin.sizeUTF8(s);d+=22;var b=new Uint8Array(d),I=0,O=[];for(var s in C){var w=C[s];O.push(I),I=c._writeHeader(b,I,s,w,0)}var $=0,B=I;for(var s in C)w=C[s],O.push(I),I=c._writeHeader(b,I,s,w,1,O[$++]);var F=I-B;return i(b,I,101010256),I+=4,y(b,I+=4,$),y(b,I+=2,$),i(b,I+=2,F),i(b,I+=4,B),I+=4,I+=2,b.buffer},c._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},c._writeHeader=function(e,t,d,i,y,C){var s=c.bin.writeUint,r=c.bin.writeUshort,n=i.file;return s(e,t,y==0?67324752:33639248),t+=4,y==1&&(t+=2),r(e,t,20),r(e,t+=2,0),r(e,t+=2,i.cpr?8:0),s(e,t+=2,0),s(e,t+=4,i.crc),s(e,t+=4,n.length),s(e,t+=4,i.usize),r(e,t+=4,c.bin.sizeUTF8(d)),r(e,t+=2,0),t+=2,y==1&&(t+=2,t+=2,s(e,t+=6,C),t+=4),t+=c.bin.writeUTF8(e,t,d),y==0&&(e.set(n,t),t+=n.length),t},c.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var d=t,i=0;i<8;i++)1&d?d=3988292384^d>>>1:d>>>=1;e[t]=d}return e}(),update:function(e,t,d,i){for(var y=0;y<i;y++)e=c.crc.table[255&(e^t[d+y])]^e>>>8;return e},crc:function(e,t,d){return 4294967295^c.crc.update(4294967295,e,t,d)}},c.adler=function(e,t,d){for(var i=1,y=0,C=t,s=t+d;C<s;){for(var r=Math.min(C+5552,s);C<r;)y+=i+=e[C++];i%=65521,y%=65521}return y<<16|i},c.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255,e[t+2]=d>>16&255,e[t+3]=d>>24&255},readASCII:function(e,t,d){for(var i="",y=0;y<d;y++)i+=String.fromCharCode(e[t+y]);return i},writeASCII:function(e,t,d){for(var i=0;i<d.length;i++)e[t+i]=d.charCodeAt(i)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,d){for(var i,y="",C=0;C<d;C++)y+="%"+c.bin.pad(e[t+C].toString(16));try{i=decodeURIComponent(y)}catch{return c.bin.readASCII(e,t,d)}return i},writeUTF8:function(e,t,d){for(var i=d.length,y=0,C=0;C<i;C++){var s=d.charCodeAt(C);if(!(4294967168&s))e[t+y]=s,y++;else if(!(4294965248&s))e[t+y]=192|s>>6,e[t+y+1]=128|s>>0&63,y+=2;else if(!(4294901760&s))e[t+y]=224|s>>12,e[t+y+1]=128|s>>6&63,e[t+y+2]=128|s>>0&63,y+=3;else{if(4292870144&s)throw"e";e[t+y]=240|s>>18,e[t+y+1]=128|s>>12&63,e[t+y+2]=128|s>>6&63,e[t+y+3]=128|s>>0&63,y+=4}}return y},sizeUTF8:function(e){for(var t=e.length,d=0,i=0;i<t;i++){var y=e.charCodeAt(i);if(!(4294967168&y))d++;else if(!(4294965248&y))d+=2;else if(!(4294901760&y))d+=3;else{if(4292870144&y)throw"e";d+=4}}return d}},c.F={},c.F.deflateRaw=function(e,t,d,i){var y=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][i],C=c.F.U,s=c.F._goodIndex;c.F._hash;var r=c.F._putsE,n=0,l=d<<3,b=0,I=e.length;if(i==0){for(;n<I;)r(t,l,n+(A=Math.min(65535,I-n))==I?1:0),l=c.F._copyExact(e,n,A,t,l+8),n+=A;return l>>>3}var O=C.lits,w=C.strt,$=C.prev,B=0,F=0,H=0,p=0,N=0,h=0;for(I>2&&(w[h=c.F._hash(e,0)]=0),n=0;n<I;n++){if(N=h,n+1<I-2){h=c.F._hash(e,n+1);var f=n+1&32767;$[f]=w[h],w[h]=f}if(b<=n){(B>14e3||F>26697)&&I-n>100&&(b<n&&(O[B]=n-b,B+=2,b=n),l=c.F._writeBlock(n==I-1||b==I?1:0,O,B,p,e,H,n-H,t,l),B=F=p=0,H=n);var x=0;n<I-2&&(x=c.F._bestMatch(e,n,$,N,Math.min(y[2],I-n),y[3]));var A=x>>>16,S=65535&x;if(x!=0){S=65535&x;var j=s(A=x>>>16,C.of0);C.lhst[257+j]++;var T=s(S,C.df0);C.dhst[T]++,p+=C.exb[j]+C.dxb[T],O[B]=A<<23|n-b,O[B+1]=S<<16|j<<8|T,B+=2,b=n+A}else C.lhst[e[n]]++;F++}}for(H==n&&e.length!=0||(b<n&&(O[B]=n-b,B+=2,b=n),l=c.F._writeBlock(1,O,B,p,e,H,n-H,t,l),B=0,F=0,B=F=p=0,H=n);7&l;)l++;return l>>>3},c.F._bestMatch=function(e,t,d,i,y,C){var s=32767&t,r=d[s],n=s-r+32768&32767;if(r==s||i!=c.F._hash(e,t-n))return 0;for(var l=0,b=0,I=Math.min(32767,t);n<=I&&--C!=0&&r!=s;){if(l==0||e[t+l]==e[t+l-n]){var O=c.F._howLong(e,t,n);if(O>l){if(b=n,(l=O)>=y)break;n+2<O&&(O=n+2);for(var w=0,$=0;$<O-2;$++){var B=t-n+$+32768&32767,F=B-d[B]+32768&32767;F>w&&(w=F,r=B)}}}n+=(s=r)-(r=d[s])+32768&32767}return l<<16|b},c.F._howLong=function(e,t,d){if(e[t]!=e[t-d]||e[t+1]!=e[t+1-d]||e[t+2]!=e[t+2-d])return 0;var i=t,y=Math.min(e.length,t+258);for(t+=3;t<y&&e[t]==e[t-d];)t++;return t-i},c.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},c.saved=0,c.F._writeBlock=function(e,t,d,i,y,C,s,r,n){var l,b,I,O,w,$,B,F,H,p=c.F.U,N=c.F._putsF,h=c.F._putsE;p.lhst[256]++,b=(l=c.F.getTrees())[0],I=l[1],O=l[2],w=l[3],$=l[4],B=l[5],F=l[6],H=l[7];var f=32+(n+3&7?8-(n+3&7):0)+(s<<3),x=i+c.F.contSize(p.fltree,p.lhst)+c.F.contSize(p.fdtree,p.dhst),A=i+c.F.contSize(p.ltree,p.lhst)+c.F.contSize(p.dtree,p.dhst);A+=14+3*B+c.F.contSize(p.itree,p.ihst)+(2*p.ihst[16]+3*p.ihst[17]+7*p.ihst[18]);for(var S=0;S<286;S++)p.lhst[S]=0;for(S=0;S<30;S++)p.dhst[S]=0;for(S=0;S<19;S++)p.ihst[S]=0;var j=f<x&&f<A?0:x<A?1:2;if(N(r,n,e),N(r,n+1,j),n+=3,j==0){for(;7&n;)n++;n=c.F._copyExact(y,C,s,r,n)}else{var T,_;if(j==1&&(T=p.fltree,_=p.fdtree),j==2){c.F.makeCodes(p.ltree,b),c.F.revCodes(p.ltree,b),c.F.makeCodes(p.dtree,I),c.F.revCodes(p.dtree,I),c.F.makeCodes(p.itree,O),c.F.revCodes(p.itree,O),T=p.ltree,_=p.dtree,h(r,n,w-257),h(r,n+=5,$-1),h(r,n+=5,B-4),n+=4;for(var m=0;m<B;m++)h(r,n+3*m,p.itree[1+(p.ordr[m]<<1)]);n+=3*B,n=c.F._codeTiny(F,p.itree,r,n),n=c.F._codeTiny(H,p.itree,r,n)}for(var o=C,P=0;P<d;P+=2){for(var D=t[P],L=D>>>23,G=o+(8388607&D);o<G;)n=c.F._writeLit(y[o++],T,r,n);if(L!=0){var W=t[P+1],V=W>>16,Y=W>>8&255,U=255&W;h(r,n=c.F._writeLit(257+Y,T,r,n),L-p.of0[Y]),n+=p.exb[Y],N(r,n=c.F._writeLit(U,_,r,n),V-p.df0[U]),n+=p.dxb[U],o+=L}}n=c.F._writeLit(256,T,r,n)}return n},c.F._copyExact=function(e,t,d,i,y){var C=y>>>3;return i[C]=d,i[C+1]=d>>>8,i[C+2]=255-i[C],i[C+3]=255-i[C+1],C+=4,i.set(new Uint8Array(e.buffer,t,d),C),y+(d+4<<3)},c.F.getTrees=function(){for(var e=c.F.U,t=c.F._hufTree(e.lhst,e.ltree,15),d=c.F._hufTree(e.dhst,e.dtree,15),i=[],y=c.F._lenCodes(e.ltree,i),C=[],s=c.F._lenCodes(e.dtree,C),r=0;r<i.length;r+=2)e.ihst[i[r]]++;for(r=0;r<C.length;r+=2)e.ihst[C[r]]++;for(var n=c.F._hufTree(e.ihst,e.itree,7),l=19;l>4&&e.itree[1+(e.ordr[l-1]<<1)]==0;)l--;return[t,d,n,y,s,l,i,C]},c.F.getSecond=function(e){for(var t=[],d=0;d<e.length;d+=2)t.push(e[d+1]);return t},c.F.nonZero=function(e){for(var t="",d=0;d<e.length;d+=2)e[d+1]!=0&&(t+=(d>>1)+",");return t},c.F.contSize=function(e,t){for(var d=0,i=0;i<t.length;i++)d+=t[i]*e[1+(i<<1)];return d},c.F._codeTiny=function(e,t,d,i){for(var y=0;y<e.length;y+=2){var C=e[y],s=e[y+1];i=c.F._writeLit(C,t,d,i);var r=C==16?2:C==17?3:7;C>15&&(c.F._putsE(d,i,s,r),i+=r)}return i},c.F._lenCodes=function(e,t){for(var d=e.length;d!=2&&e[d-1]==0;)d-=2;for(var i=0;i<d;i+=2){var y=e[i+1],C=i+3<d?e[i+3]:-1,s=i+5<d?e[i+5]:-1,r=i==0?-1:e[i-1];if(y==0&&C==y&&s==y){for(var n=i+5;n+2<d&&e[n+2]==y;)n+=2;(l=Math.min(n+1-i>>>1,138))<11?t.push(17,l-3):t.push(18,l-11),i+=2*l-2}else if(y==r&&C==y&&s==y){for(n=i+5;n+2<d&&e[n+2]==y;)n+=2;var l=Math.min(n+1-i>>>1,6);t.push(16,l-3),i+=2*l-2}else t.push(y,0)}return d>>>1},c.F._hufTree=function(e,t,d){var i=[],y=e.length,C=t.length,s=0;for(s=0;s<C;s+=2)t[s]=0,t[s+1]=0;for(s=0;s<y;s++)e[s]!=0&&i.push({lit:s,f:e[s]});var r=i.length,n=i.slice(0);if(r==0)return 0;if(r==1){var l=i[0].lit;return n=l==0?1:0,t[1+(l<<1)]=1,t[1+(n<<1)]=1,1}i.sort(function(F,H){return F.f-H.f});var b=i[0],I=i[1],O=0,w=1,$=2;for(i[0]={lit:-1,f:b.f+I.f,l:b,r:I,d:0};w!=r-1;)b=O!=w&&($==r||i[O].f<i[$].f)?i[O++]:i[$++],I=O!=w&&($==r||i[O].f<i[$].f)?i[O++]:i[$++],i[w++]={lit:-1,f:b.f+I.f,l:b,r:I};var B=c.F.setDepth(i[w-1],0);for(B>d&&(c.F.restrictDepth(n,d,B),B=d),s=0;s<r;s++)t[1+(n[s].lit<<1)]=n[s].d;return B},c.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(c.F.setDepth(e.l,t+1),c.F.setDepth(e.r,t+1))},c.F.restrictDepth=function(e,t,d){var i=0,y=1<<d-t,C=0;for(e.sort(function(r,n){return n.d==r.d?r.f-n.f:n.d-r.d}),i=0;i<e.length&&e[i].d>t;i++){var s=e[i].d;e[i].d=t,C+=y-(1<<d-s)}for(C>>>=d-t;C>0;)(s=e[i].d)<t?(e[i].d++,C-=1<<t-s-1):i++;for(;i>=0;i--)e[i].d==t&&C<0&&(e[i].d--,C++);C!=0&&console.log("debt left")},c.F._goodIndex=function(e,t){var d=0;return t[16|d]<=e&&(d|=16),t[8|d]<=e&&(d|=8),t[4|d]<=e&&(d|=4),t[2|d]<=e&&(d|=2),t[1|d]<=e&&(d|=1),d},c.F._writeLit=function(e,t,d,i){return c.F._putsF(d,i,t[e<<1]),i+t[1+(e<<1)]},c.F.inflate=function(e,t){var d=Uint8Array;if(e[0]==3&&e[1]==0)return t||new d(0);var i=c.F,y=i._bitsF,C=i._bitsE,s=i._decodeTiny,r=i.makeCodes,n=i.codes2map,l=i._get17,b=i.U,I=t==null;I&&(t=new d(e.length>>>2<<3));for(var O,w,$=0,B=0,F=0,H=0,p=0,N=0,h=0,f=0,x=0;$==0;)if($=y(e,x,1),B=y(e,x+1,2),x+=3,B!=0){if(I&&(t=c.F._check(t,f+(1<<17))),B==1&&(O=b.flmap,w=b.fdmap,N=511,h=31),B==2){F=C(e,x,5)+257,H=C(e,x+5,5)+1,p=C(e,x+10,4)+4,x+=14;for(var A=0;A<38;A+=2)b.itree[A]=0,b.itree[A+1]=0;var S=1;for(A=0;A<p;A++){var j=C(e,x+3*A,3);b.itree[1+(b.ordr[A]<<1)]=j,j>S&&(S=j)}x+=3*p,r(b.itree,S),n(b.itree,S,b.imap),O=b.lmap,w=b.dmap,x=s(b.imap,(1<<S)-1,F+H,e,x,b.ttree);var T=i._copyOut(b.ttree,0,F,b.ltree);N=(1<<T)-1;var _=i._copyOut(b.ttree,F,H,b.dtree);h=(1<<_)-1,r(b.ltree,T),n(b.ltree,T,O),r(b.dtree,_),n(b.dtree,_,w)}for(;;){var m=O[l(e,x)&N];x+=15&m;var o=m>>>4;if(!(o>>>8))t[f++]=o;else{if(o==256)break;var P=f+o-254;if(o>264){var D=b.ldef[o-257];P=f+(D>>>3)+C(e,x,7&D),x+=7&D}var L=w[l(e,x)&h];x+=15&L;var G=L>>>4,W=b.ddef[G],V=(W>>>4)+y(e,x,15&W);for(x+=15&W,I&&(t=c.F._check(t,f+(1<<17)));f<P;)t[f]=t[f++-V],t[f]=t[f++-V],t[f]=t[f++-V],t[f]=t[f++-V];f=P}}}else{7&x&&(x+=8-(7&x));var Y=4+(x>>>3),U=e[Y-4]|e[Y-3]<<8;I&&(t=c.F._check(t,f+U)),t.set(new d(e.buffer,e.byteOffset+Y,U),f),x=Y+U<<3,f+=U}return t.length==f?t:t.slice(0,f)},c.F._check=function(e,t){var d=e.length;if(t<=d)return e;var i=new Uint8Array(Math.max(d<<1,t));return i.set(e,0),i},c.F._decodeTiny=function(e,t,d,i,y,C){for(var s=c.F._bitsE,r=c.F._get17,n=0;n<d;){var l=e[r(i,y)&t];y+=15&l;var b=l>>>4;if(b<=15)C[n]=b,n++;else{var I=0,O=0;b==16?(O=3+s(i,y,2),y+=2,I=C[n-1]):b==17?(O=3+s(i,y,3),y+=3):b==18&&(O=11+s(i,y,7),y+=7);for(var w=n+O;n<w;)C[n]=I,n++}}return y},c.F._copyOut=function(e,t,d,i){for(var y=0,C=0,s=i.length>>>1;C<d;){var r=e[C+t];i[C<<1]=0,i[1+(C<<1)]=r,r>y&&(y=r),C++}for(;C<s;)i[C<<1]=0,i[1+(C<<1)]=0,C++;return y},c.F.makeCodes=function(e,t){for(var d,i,y,C,s=c.F.U,r=e.length,n=s.bl_count,l=0;l<=t;l++)n[l]=0;for(l=1;l<r;l+=2)n[e[l]]++;var b=s.next_code;for(d=0,n[0]=0,i=1;i<=t;i++)d=d+n[i-1]<<1,b[i]=d;for(y=0;y<r;y+=2)(C=e[y+1])!=0&&(e[y]=b[C],b[C]++)},c.F.codes2map=function(e,t,d){for(var i=e.length,y=c.F.U.rev15,C=0;C<i;C+=2)if(e[C+1]!=0)for(var s=C>>1,r=e[C+1],n=s<<4|r,l=t-r,b=e[C]<<l,I=b+(1<<l);b!=I;)d[y[b]>>>15-t]=n,b++},c.F.revCodes=function(e,t){for(var d=c.F.U.rev15,i=15-t,y=0;y<e.length;y+=2){var C=e[y]<<t-e[y+1];e[y]=d[C]>>>i}},c.F._putsE=function(e,t,d){d<<=7&t;var i=t>>>3;e[i]|=d,e[i+1]|=d>>>8},c.F._putsF=function(e,t,d){d<<=7&t;var i=t>>>3;e[i]|=d,e[i+1]|=d>>>8,e[i+2]|=d>>>16},c.F._bitsE=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<d)-1},c.F._bitsF=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<d)-1},c.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},c.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},c.F.U=(v=Uint16Array,R=Uint32Array,{next_code:new v(16),bl_count:new v(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new v(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new R(32),flmap:new v(512),fltree:[],fdmap:new v(32),fdtree:[],lmap:new v(32768),ltree:[],ttree:[],dmap:new v(32768),dtree:[],imap:new v(512),itree:[],rev15:new v(32768),lhst:new R(286),dhst:new R(30),ihst:new R(19),lits:new R(15e3),strt:new v(65536),prev:new v(32768)}),function(){for(var e=c.F.U,t=0;t<32768;t++){var d=t;d=(4278255360&(d=(4042322160&(d=(3435973836&(d=(2863311530&d)>>>1|(1431655765&d)<<1))>>>2|(858993459&d)<<2))>>>4|(252645135&d)<<4))>>>8|(16711935&d)<<8,e.rev15[t]=(d>>>16|d<<16)>>>17}function i(y,C,s){for(;C--!=0;)y.push(0,s)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];i(e.fltree,144,8),i(e.fltree,112,9),i(e.fltree,24,7),i(e.fltree,8,8),c.F.makeCodes(e.fltree,9),c.F.codes2map(e.fltree,9,e.flmap),c.F.revCodes(e.fltree,9),i(e.fdtree,32,5),c.F.makeCodes(e.fdtree,5),c.F.codes2map(e.fdtree,5,e.fdmap),c.F.revCodes(e.fdtree,5),i(e.itree,19,0),i(e.ltree,286,0),i(e.dtree,30,0),i(e.ttree,320,0)}()})();var _r=Sr({__proto__:null,default:xn},[xn]);const et=function(){var u={nextZero(s,r){for(;s[r]!=0;)r++;return r},readUshort:(s,r)=>s[r]<<8|s[r+1],writeUshort(s,r,n){s[r]=n>>8&255,s[r+1]=255&n},readUint:(s,r)=>16777216*s[r]+(s[r+1]<<16|s[r+2]<<8|s[r+3]),writeUint(s,r,n){s[r]=n>>24&255,s[r+1]=n>>16&255,s[r+2]=n>>8&255,s[r+3]=255&n},readASCII(s,r,n){let l="";for(let b=0;b<n;b++)l+=String.fromCharCode(s[r+b]);return l},writeASCII(s,r,n){for(let l=0;l<n.length;l++)s[r+l]=n.charCodeAt(l)},readBytes(s,r,n){const l=[];for(let b=0;b<n;b++)l.push(s[r+b]);return l},pad:s=>s.length<2?`0${s}`:s,readUTF8(s,r,n){let l,b="";for(let I=0;I<n;I++)b+=`%${u.pad(s[r+I].toString(16))}`;try{l=decodeURIComponent(b)}catch{return u.readASCII(s,r,n)}return l}};function v(s,r,n,l){const b=r*n,I=t(l),O=Math.ceil(r*I/8),w=new Uint8Array(4*b),$=new Uint32Array(w.buffer),{ctype:B}=l,{depth:F}=l,H=u.readUshort;if(B==6){const D=b<<2;if(F==8)for(var p=0;p<D;p+=4)w[p]=s[p],w[p+1]=s[p+1],w[p+2]=s[p+2],w[p+3]=s[p+3];if(F==16)for(p=0;p<D;p++)w[p]=s[p<<1]}else if(B==2){const D=l.tabs.tRNS;if(D==null){if(F==8)for(p=0;p<b;p++){var N=3*p;$[p]=255<<24|s[N+2]<<16|s[N+1]<<8|s[N]}if(F==16)for(p=0;p<b;p++)N=6*p,$[p]=255<<24|s[N+4]<<16|s[N+2]<<8|s[N]}else{var h=D[0];const L=D[1],G=D[2];if(F==8)for(p=0;p<b;p++){var f=p<<2;N=3*p,$[p]=255<<24|s[N+2]<<16|s[N+1]<<8|s[N],s[N]==h&&s[N+1]==L&&s[N+2]==G&&(w[f+3]=0)}if(F==16)for(p=0;p<b;p++)f=p<<2,N=6*p,$[p]=255<<24|s[N+4]<<16|s[N+2]<<8|s[N],H(s,N)==h&&H(s,N+2)==L&&H(s,N+4)==G&&(w[f+3]=0)}}else if(B==3){const D=l.tabs.PLTE,L=l.tabs.tRNS,G=L?L.length:0;if(F==1)for(var x=0;x<n;x++){var A=x*O,S=x*r;for(p=0;p<r;p++){f=S+p<<2;var j=3*(T=s[A+(p>>3)]>>7-((7&p)<<0)&1);w[f]=D[j],w[f+1]=D[j+1],w[f+2]=D[j+2],w[f+3]=T<G?L[T]:255}}if(F==2)for(x=0;x<n;x++)for(A=x*O,S=x*r,p=0;p<r;p++)f=S+p<<2,j=3*(T=s[A+(p>>2)]>>6-((3&p)<<1)&3),w[f]=D[j],w[f+1]=D[j+1],w[f+2]=D[j+2],w[f+3]=T<G?L[T]:255;if(F==4)for(x=0;x<n;x++)for(A=x*O,S=x*r,p=0;p<r;p++)f=S+p<<2,j=3*(T=s[A+(p>>1)]>>4-((1&p)<<2)&15),w[f]=D[j],w[f+1]=D[j+1],w[f+2]=D[j+2],w[f+3]=T<G?L[T]:255;if(F==8)for(p=0;p<b;p++){var T;f=p<<2,j=3*(T=s[p]),w[f]=D[j],w[f+1]=D[j+1],w[f+2]=D[j+2],w[f+3]=T<G?L[T]:255}}else if(B==4){if(F==8)for(p=0;p<b;p++){f=p<<2;var _=s[m=p<<1];w[f]=_,w[f+1]=_,w[f+2]=_,w[f+3]=s[m+1]}if(F==16)for(p=0;p<b;p++){var m;f=p<<2,_=s[m=p<<2],w[f]=_,w[f+1]=_,w[f+2]=_,w[f+3]=s[m+2]}}else if(B==0)for(h=l.tabs.tRNS?l.tabs.tRNS:-1,x=0;x<n;x++){const D=x*O,L=x*r;if(F==1)for(var o=0;o<r;o++){var P=(_=255*(s[D+(o>>>3)]>>>7-(7&o)&1))==255*h?0:255;$[L+o]=P<<24|_<<16|_<<8|_}else if(F==2)for(o=0;o<r;o++)P=(_=85*(s[D+(o>>>2)]>>>6-((3&o)<<1)&3))==85*h?0:255,$[L+o]=P<<24|_<<16|_<<8|_;else if(F==4)for(o=0;o<r;o++)P=(_=17*(s[D+(o>>>1)]>>>4-((1&o)<<2)&15))==17*h?0:255,$[L+o]=P<<24|_<<16|_<<8|_;else if(F==8)for(o=0;o<r;o++)P=(_=s[D+o])==h?0:255,$[L+o]=P<<24|_<<16|_<<8|_;else if(F==16)for(o=0;o<r;o++)_=s[D+(o<<1)],P=H(s,D+(o<<1))==h?0:255,$[L+o]=P<<24|_<<16|_<<8|_}return w}function R(s,r,n,l){const b=t(s),I=Math.ceil(n*b/8),O=new Uint8Array((I+1+s.interlace)*l);return r=s.tabs.CgBI?e(r,O):c(r,O),s.interlace==0?r=d(r,s,0,n,l):s.interlace==1&&(r=function($,B){const F=B.width,H=B.height,p=t(B),N=p>>3,h=Math.ceil(F*p/8),f=new Uint8Array(H*h);let x=0;const A=[0,0,4,0,2,0,1],S=[0,4,0,2,0,1,0],j=[8,8,8,4,4,2,2],T=[8,8,4,4,2,2,1];let _=0;for(;_<7;){const o=j[_],P=T[_];let D=0,L=0,G=A[_];for(;G<H;)G+=o,L++;let W=S[_];for(;W<F;)W+=P,D++;const V=Math.ceil(D*p/8);d($,B,x,D,L);let Y=0,U=A[_];for(;U<H;){let Z=S[_],ue=x+Y*V<<3;for(;Z<F;){var m;if(p==1&&(m=(m=$[ue>>3])>>7-(7&ue)&1,f[U*h+(Z>>3)]|=m<<7-((7&Z)<<0)),p==2&&(m=(m=$[ue>>3])>>6-(7&ue)&3,f[U*h+(Z>>2)]|=m<<6-((3&Z)<<1)),p==4&&(m=(m=$[ue>>3])>>4-(7&ue)&15,f[U*h+(Z>>1)]|=m<<4-((1&Z)<<2)),p>=8){const ie=U*h+Z*N;for(let se=0;se<N;se++)f[ie+se]=$[(ue>>3)+se]}ue+=p,Z+=P}Y++,U+=o}D*L!=0&&(x+=L*(1+V)),_+=1}return f}(r,s)),r}function c(s,r){return e(new Uint8Array(s.buffer,2,s.length-6),r)}var e=function(){const s={H:{}};return s.H.N=function(r,n){const l=Uint8Array;let b,I,O=0,w=0,$=0,B=0,F=0,H=0,p=0,N=0,h=0;if(r[0]==3&&r[1]==0)return n||new l(0);const f=s.H,x=f.b,A=f.e,S=f.R,j=f.n,T=f.A,_=f.Z,m=f.m,o=n==null;for(o&&(n=new l(r.length>>>2<<5));O==0;)if(O=x(r,h,1),w=x(r,h+1,2),h+=3,w!=0){if(o&&(n=s.H.W(n,N+(1<<17))),w==1&&(b=m.J,I=m.h,H=511,p=31),w==2){$=A(r,h,5)+257,B=A(r,h+5,5)+1,F=A(r,h+10,4)+4,h+=14;let D=1;for(var P=0;P<38;P+=2)m.Q[P]=0,m.Q[P+1]=0;for(P=0;P<F;P++){const W=A(r,h+3*P,3);m.Q[1+(m.X[P]<<1)]=W,W>D&&(D=W)}h+=3*F,j(m.Q,D),T(m.Q,D,m.u),b=m.w,I=m.d,h=S(m.u,(1<<D)-1,$+B,r,h,m.v);const L=f.V(m.v,0,$,m.C);H=(1<<L)-1;const G=f.V(m.v,$,B,m.D);p=(1<<G)-1,j(m.C,L),T(m.C,L,b),j(m.D,G),T(m.D,G,I)}for(;;){const D=b[_(r,h)&H];h+=15&D;const L=D>>>4;if(!(L>>>8))n[N++]=L;else{if(L==256)break;{let G=N+L-254;if(L>264){const Z=m.q[L-257];G=N+(Z>>>3)+A(r,h,7&Z),h+=7&Z}const W=I[_(r,h)&p];h+=15&W;const V=W>>>4,Y=m.c[V],U=(Y>>>4)+x(r,h,15&Y);for(h+=15&Y;N<G;)n[N]=n[N++-U],n[N]=n[N++-U],n[N]=n[N++-U],n[N]=n[N++-U];N=G}}}}else{7&h&&(h+=8-(7&h));const D=4+(h>>>3),L=r[D-4]|r[D-3]<<8;o&&(n=s.H.W(n,N+L)),n.set(new l(r.buffer,r.byteOffset+D,L),N),h=D+L<<3,N+=L}return n.length==N?n:n.slice(0,N)},s.H.W=function(r,n){const l=r.length;if(n<=l)return r;const b=new Uint8Array(l<<1);return b.set(r,0),b},s.H.R=function(r,n,l,b,I,O){const w=s.H.e,$=s.H.Z;let B=0;for(;B<l;){const F=r[$(b,I)&n];I+=15&F;const H=F>>>4;if(H<=15)O[B]=H,B++;else{let p=0,N=0;H==16?(N=3+w(b,I,2),I+=2,p=O[B-1]):H==17?(N=3+w(b,I,3),I+=3):H==18&&(N=11+w(b,I,7),I+=7);const h=B+N;for(;B<h;)O[B]=p,B++}}return I},s.H.V=function(r,n,l,b){let I=0,O=0;const w=b.length>>>1;for(;O<l;){const $=r[O+n];b[O<<1]=0,b[1+(O<<1)]=$,$>I&&(I=$),O++}for(;O<w;)b[O<<1]=0,b[1+(O<<1)]=0,O++;return I},s.H.n=function(r,n){const l=s.H.m,b=r.length;let I,O,w,$;const B=l.j;for(var F=0;F<=n;F++)B[F]=0;for(F=1;F<b;F+=2)B[r[F]]++;const H=l.K;for(I=0,B[0]=0,O=1;O<=n;O++)I=I+B[O-1]<<1,H[O]=I;for(w=0;w<b;w+=2)$=r[w+1],$!=0&&(r[w]=H[$],H[$]++)},s.H.A=function(r,n,l){const b=r.length,I=s.H.m.r;for(let O=0;O<b;O+=2)if(r[O+1]!=0){const w=O>>1,$=r[O+1],B=w<<4|$,F=n-$;let H=r[O]<<F;const p=H+(1<<F);for(;H!=p;)l[I[H]>>>15-n]=B,H++}},s.H.l=function(r,n){const l=s.H.m.r,b=15-n;for(let I=0;I<r.length;I+=2){const O=r[I]<<n-r[I+1];r[I]=l[O]>>>b}},s.H.M=function(r,n,l){l<<=7&n;const b=n>>>3;r[b]|=l,r[b+1]|=l>>>8},s.H.I=function(r,n,l){l<<=7&n;const b=n>>>3;r[b]|=l,r[b+1]|=l>>>8,r[b+2]|=l>>>16},s.H.e=function(r,n,l){return(r[n>>>3]|r[1+(n>>>3)]<<8)>>>(7&n)&(1<<l)-1},s.H.b=function(r,n,l){return(r[n>>>3]|r[1+(n>>>3)]<<8|r[2+(n>>>3)]<<16)>>>(7&n)&(1<<l)-1},s.H.Z=function(r,n){return(r[n>>>3]|r[1+(n>>>3)]<<8|r[2+(n>>>3)]<<16)>>>(7&n)},s.H.i=function(r,n){return(r[n>>>3]|r[1+(n>>>3)]<<8|r[2+(n>>>3)]<<16|r[3+(n>>>3)]<<24)>>>(7&n)},s.H.m=function(){const r=Uint16Array,n=Uint32Array;return{K:new r(16),j:new r(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new r(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new n(32),J:new r(512),_:[],h:new r(32),$:[],w:new r(32768),C:[],v:[],d:new r(32768),D:[],u:new r(512),Q:[],r:new r(32768),s:new n(286),Y:new n(30),a:new n(19),t:new n(15e3),k:new r(65536),g:new r(32768)}}(),function(){const r=s.H.m;for(var n=0;n<32768;n++){let b=n;b=(2863311530&b)>>>1|(1431655765&b)<<1,b=(3435973836&b)>>>2|(858993459&b)<<2,b=(4042322160&b)>>>4|(252645135&b)<<4,b=(4278255360&b)>>>8|(16711935&b)<<8,r.r[n]=(b>>>16|b<<16)>>>17}function l(b,I,O){for(;I--!=0;)b.push(0,O)}for(n=0;n<32;n++)r.q[n]=r.S[n]<<3|r.T[n],r.c[n]=r.p[n]<<4|r.z[n];l(r._,144,8),l(r._,112,9),l(r._,24,7),l(r._,8,8),s.H.n(r._,9),s.H.A(r._,9,r.J),s.H.l(r._,9),l(r.$,32,5),s.H.n(r.$,5),s.H.A(r.$,5,r.h),s.H.l(r.$,5),l(r.Q,19,0),l(r.C,286,0),l(r.D,30,0),l(r.v,320,0)}(),s.H.N}();function t(s){return[1,null,3,1,2,null,4][s.ctype]*s.depth}function d(s,r,n,l,b){let I=t(r);const O=Math.ceil(l*I/8);let w,$;I=Math.ceil(I/8);let B=s[n],F=0;if(B>1&&(s[n]=[0,0,1][B-2]),B==3)for(F=I;F<O;F++)s[F+1]=s[F+1]+(s[F+1-I]>>>1)&255;for(let H=0;H<b;H++)if(w=n+H*O,$=w+H+1,B=s[$-1],F=0,B==0)for(;F<O;F++)s[w+F]=s[$+F];else if(B==1){for(;F<I;F++)s[w+F]=s[$+F];for(;F<O;F++)s[w+F]=s[$+F]+s[w+F-I]}else if(B==2)for(;F<O;F++)s[w+F]=s[$+F]+s[w+F-O];else if(B==3){for(;F<I;F++)s[w+F]=s[$+F]+(s[w+F-O]>>>1);for(;F<O;F++)s[w+F]=s[$+F]+(s[w+F-O]+s[w+F-I]>>>1)}else{for(;F<I;F++)s[w+F]=s[$+F]+i(0,s[w+F-O],0);for(;F<O;F++)s[w+F]=s[$+F]+i(s[w+F-I],s[w+F-O],s[w+F-I-O])}return s}function i(s,r,n){const l=s+r-n,b=l-s,I=l-r,O=l-n;return b*b<=I*I&&b*b<=O*O?s:I*I<=O*O?r:n}function y(s,r,n){n.width=u.readUint(s,r),r+=4,n.height=u.readUint(s,r),r+=4,n.depth=s[r],r++,n.ctype=s[r],r++,n.compress=s[r],r++,n.filter=s[r],r++,n.interlace=s[r],r++}function C(s,r,n,l,b,I,O,w,$){const B=Math.min(r,b),F=Math.min(n,I);let H=0,p=0;for(let _=0;_<F;_++)for(let m=0;m<B;m++)if(O>=0&&w>=0?(H=_*r+m<<2,p=(w+_)*b+O+m<<2):(H=(-w+_)*r-O+m<<2,p=_*b+m<<2),$==0)l[p]=s[H],l[p+1]=s[H+1],l[p+2]=s[H+2],l[p+3]=s[H+3];else if($==1){var N=s[H+3]*.00392156862745098,h=s[H]*N,f=s[H+1]*N,x=s[H+2]*N,A=l[p+3]*(1/255),S=l[p]*A,j=l[p+1]*A,T=l[p+2]*A;const o=1-N,P=N+A*o,D=P==0?0:1/P;l[p+3]=255*P,l[p+0]=(h+S*o)*D,l[p+1]=(f+j*o)*D,l[p+2]=(x+T*o)*D}else if($==2)N=s[H+3],h=s[H],f=s[H+1],x=s[H+2],A=l[p+3],S=l[p],j=l[p+1],T=l[p+2],N==A&&h==S&&f==j&&x==T?(l[p]=0,l[p+1]=0,l[p+2]=0,l[p+3]=0):(l[p]=h,l[p+1]=f,l[p+2]=x,l[p+3]=N);else if($==3){if(N=s[H+3],h=s[H],f=s[H+1],x=s[H+2],A=l[p+3],S=l[p],j=l[p+1],T=l[p+2],N==A&&h==S&&f==j&&x==T)continue;if(N<220&&A>20)return!1}return!0}return{decode:function(r){const n=new Uint8Array(r);let l=8;const b=u,I=b.readUshort,O=b.readUint,w={tabs:{},frames:[]},$=new Uint8Array(n.length);let B,F=0,H=0;const p=[137,80,78,71,13,10,26,10];for(var N=0;N<8;N++)if(n[N]!=p[N])throw"The input is not a PNG file!";for(;l<n.length;){const _=b.readUint(n,l);l+=4;const m=b.readASCII(n,l,4);if(l+=4,m=="IHDR")y(n,l,w);else if(m=="iCCP"){for(var h=l;n[h]!=0;)h++;b.readASCII(n,l,h-l),n[h+1];const o=n.slice(h+2,l+_);let P=null;try{P=c(o)}catch{P=e(o)}w.tabs[m]=P}else if(m=="CgBI")w.tabs[m]=n.slice(l,l+4);else if(m=="IDAT"){for(N=0;N<_;N++)$[F+N]=n[l+N];F+=_}else if(m=="acTL")w.tabs[m]={num_frames:O(n,l),num_plays:O(n,l+4)},B=new Uint8Array(n.length);else if(m=="fcTL"){H!=0&&((T=w.frames[w.frames.length-1]).data=R(w,B.slice(0,H),T.rect.width,T.rect.height),H=0);const o={x:O(n,l+12),y:O(n,l+16),width:O(n,l+4),height:O(n,l+8)};let P=I(n,l+22);P=I(n,l+20)/(P==0?100:P);const D={rect:o,delay:Math.round(1e3*P),dispose:n[l+24],blend:n[l+25]};w.frames.push(D)}else if(m=="fdAT"){for(N=0;N<_-4;N++)B[H+N]=n[l+N+4];H+=_-4}else if(m=="pHYs")w.tabs[m]=[b.readUint(n,l),b.readUint(n,l+4),n[l+8]];else if(m=="cHRM")for(w.tabs[m]=[],N=0;N<8;N++)w.tabs[m].push(b.readUint(n,l+4*N));else if(m=="tEXt"||m=="zTXt"){w.tabs[m]==null&&(w.tabs[m]={});var f=b.nextZero(n,l),x=b.readASCII(n,l,f-l),A=l+_-f-1;if(m=="tEXt")j=b.readASCII(n,f+1,A);else{var S=c(n.slice(f+2,f+2+A));j=b.readUTF8(S,0,S.length)}w.tabs[m][x]=j}else if(m=="iTXt"){w.tabs[m]==null&&(w.tabs[m]={}),f=0,h=l,f=b.nextZero(n,h),x=b.readASCII(n,h,f-h);const o=n[h=f+1];var j;n[h+1],h+=2,f=b.nextZero(n,h),b.readASCII(n,h,f-h),h=f+1,f=b.nextZero(n,h),b.readUTF8(n,h,f-h),A=_-((h=f+1)-l),o==0?j=b.readUTF8(n,h,A):(S=c(n.slice(h,h+A)),j=b.readUTF8(S,0,S.length)),w.tabs[m][x]=j}else if(m=="PLTE")w.tabs[m]=b.readBytes(n,l,_);else if(m=="hIST"){const o=w.tabs.PLTE.length/3;for(w.tabs[m]=[],N=0;N<o;N++)w.tabs[m].push(I(n,l+2*N))}else if(m=="tRNS")w.ctype==3?w.tabs[m]=b.readBytes(n,l,_):w.ctype==0?w.tabs[m]=I(n,l):w.ctype==2&&(w.tabs[m]=[I(n,l),I(n,l+2),I(n,l+4)]);else if(m=="gAMA")w.tabs[m]=b.readUint(n,l)/1e5;else if(m=="sRGB")w.tabs[m]=n[l];else if(m=="bKGD")w.ctype==0||w.ctype==4?w.tabs[m]=[I(n,l)]:w.ctype==2||w.ctype==6?w.tabs[m]=[I(n,l),I(n,l+2),I(n,l+4)]:w.ctype==3&&(w.tabs[m]=n[l]);else if(m=="IEND")break;l+=_,b.readUint(n,l),l+=4}var T;return H!=0&&((T=w.frames[w.frames.length-1]).data=R(w,B.slice(0,H),T.rect.width,T.rect.height)),w.data=R(w,$,w.width,w.height),delete w.compress,delete w.interlace,delete w.filter,w},toRGBA8:function(r){const n=r.width,l=r.height;if(r.tabs.acTL==null)return[v(r.data,n,l,r).buffer];const b=[];r.frames[0].data==null&&(r.frames[0].data=r.data);const I=n*l*4,O=new Uint8Array(I),w=new Uint8Array(I),$=new Uint8Array(I);for(let F=0;F<r.frames.length;F++){const H=r.frames[F],p=H.rect.x,N=H.rect.y,h=H.rect.width,f=H.rect.height,x=v(H.data,h,f,r);if(F!=0)for(var B=0;B<I;B++)$[B]=O[B];if(H.blend==0?C(x,h,f,O,n,l,p,N,0):H.blend==1&&C(x,h,f,O,n,l,p,N,1),b.push(O.buffer.slice(0)),H.dispose!=0){if(H.dispose==1)C(w,h,f,O,n,l,p,N,0);else if(H.dispose==2)for(B=0;B<I;B++)O[B]=$[B]}}return b},_paeth:i,_copyTile:C,_bin:u}}();(function(){const{_copyTile:u}=et,{_bin:v}=et,R=et._paeth;var c={table:function(){const h=new Uint32Array(256);for(let f=0;f<256;f++){let x=f;for(let A=0;A<8;A++)1&x?x=3988292384^x>>>1:x>>>=1;h[f]=x}return h}(),update(h,f,x,A){for(let S=0;S<A;S++)h=c.table[255&(h^f[x+S])]^h>>>8;return h},crc:(h,f,x)=>4294967295^c.update(4294967295,h,f,x)};function e(h,f,x,A){f[x]+=h[0]*A>>4,f[x+1]+=h[1]*A>>4,f[x+2]+=h[2]*A>>4,f[x+3]+=h[3]*A>>4}function t(h){return Math.max(0,Math.min(255,h))}function d(h,f){const x=h[0]-f[0],A=h[1]-f[1],S=h[2]-f[2],j=h[3]-f[3];return x*x+A*A+S*S+j*j}function i(h,f,x,A,S,j,T){T==null&&(T=1);const _=A.length,m=[];for(var o=0;o<_;o++){const U=A[o];m.push([U>>>0&255,U>>>8&255,U>>>16&255,U>>>24&255])}for(o=0;o<_;o++){let U=4294967295;for(var P=0,D=0;D<_;D++){var L=d(m[o],m[D]);D!=o&&L<U&&(U=L,P=D)}}const G=new Uint32Array(S.buffer),W=new Int16Array(f*x*4),V=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(o=0;o<V.length;o++)V[o]=255*((V[o]+.5)/16-.5);for(let U=0;U<x;U++)for(let Z=0;Z<f;Z++){var Y;o=4*(U*f+Z),T!=2?Y=[t(h[o]+W[o]),t(h[o+1]+W[o+1]),t(h[o+2]+W[o+2]),t(h[o+3]+W[o+3])]:(L=V[4*(3&U)+(3&Z)],Y=[t(h[o]+L),t(h[o+1]+L),t(h[o+2]+L),t(h[o+3]+L)]),P=0;let ue=16777215;for(D=0;D<_;D++){const le=d(Y,m[D]);le<ue&&(ue=le,P=D)}const ie=m[P],se=[Y[0]-ie[0],Y[1]-ie[1],Y[2]-ie[2],Y[3]-ie[3]];T==1&&(Z!=f-1&&e(se,W,o+4,7),U!=x-1&&(Z!=0&&e(se,W,o+4*f-4,3),e(se,W,o+4*f,5),Z!=f-1&&e(se,W,o+4*f+4,1))),j[o>>2]=P,G[o>>2]=A[P]}}function y(h,f,x,A,S){S==null&&(S={});const{crc:j}=c,T=v.writeUint,_=v.writeUshort,m=v.writeASCII;let o=8;const P=h.frames.length>1;let D,L=!1,G=33+(P?20:0);if(S.sRGB!=null&&(G+=13),S.pHYs!=null&&(G+=21),S.iCCP!=null&&(D=pako.deflate(S.iCCP),G+=21+D.length+4),h.ctype==3){for(var W=h.plte.length,V=0;V<W;V++)h.plte[V]>>>24!=255&&(L=!0);G+=8+3*W+4+(L?8+1*W+4:0)}for(var Y=0;Y<h.frames.length;Y++)P&&(G+=38),G+=(ie=h.frames[Y]).cimg.length+12,Y!=0&&(G+=4);G+=12;const U=new Uint8Array(G),Z=[137,80,78,71,13,10,26,10];for(V=0;V<8;V++)U[V]=Z[V];if(T(U,o,13),o+=4,m(U,o,"IHDR"),o+=4,T(U,o,f),o+=4,T(U,o,x),o+=4,U[o]=h.depth,o++,U[o]=h.ctype,o++,U[o]=0,o++,U[o]=0,o++,U[o]=0,o++,T(U,o,j(U,o-17,17)),o+=4,S.sRGB!=null&&(T(U,o,1),o+=4,m(U,o,"sRGB"),o+=4,U[o]=S.sRGB,o++,T(U,o,j(U,o-5,5)),o+=4),S.iCCP!=null){const se=13+D.length;T(U,o,se),o+=4,m(U,o,"iCCP"),o+=4,m(U,o,"ICC profile"),o+=11,o+=2,U.set(D,o),o+=D.length,T(U,o,j(U,o-(se+4),se+4)),o+=4}if(S.pHYs!=null&&(T(U,o,9),o+=4,m(U,o,"pHYs"),o+=4,T(U,o,S.pHYs[0]),o+=4,T(U,o,S.pHYs[1]),o+=4,U[o]=S.pHYs[2],o++,T(U,o,j(U,o-13,13)),o+=4),P&&(T(U,o,8),o+=4,m(U,o,"acTL"),o+=4,T(U,o,h.frames.length),o+=4,T(U,o,S.loop!=null?S.loop:0),o+=4,T(U,o,j(U,o-12,12)),o+=4),h.ctype==3){for(T(U,o,3*(W=h.plte.length)),o+=4,m(U,o,"PLTE"),o+=4,V=0;V<W;V++){const se=3*V,le=h.plte[V],ce=255&le,fe=le>>>8&255,Oe=le>>>16&255;U[o+se+0]=ce,U[o+se+1]=fe,U[o+se+2]=Oe}if(o+=3*W,T(U,o,j(U,o-3*W-4,3*W+4)),o+=4,L){for(T(U,o,W),o+=4,m(U,o,"tRNS"),o+=4,V=0;V<W;V++)U[o+V]=h.plte[V]>>>24&255;o+=W,T(U,o,j(U,o-W-4,W+4)),o+=4}}let ue=0;for(Y=0;Y<h.frames.length;Y++){var ie=h.frames[Y];P&&(T(U,o,26),o+=4,m(U,o,"fcTL"),o+=4,T(U,o,ue++),o+=4,T(U,o,ie.rect.width),o+=4,T(U,o,ie.rect.height),o+=4,T(U,o,ie.rect.x),o+=4,T(U,o,ie.rect.y),o+=4,_(U,o,A[Y]),o+=2,_(U,o,1e3),o+=2,U[o]=ie.dispose,o++,U[o]=ie.blend,o++,T(U,o,j(U,o-30,30)),o+=4);const se=ie.cimg;T(U,o,(W=se.length)+(Y==0?0:4)),o+=4;const le=o;m(U,o,Y==0?"IDAT":"fdAT"),o+=4,Y!=0&&(T(U,o,ue++),o+=4),U.set(se,o),o+=W,T(U,o,j(U,le,o-le)),o+=4}return T(U,o,0),o+=4,m(U,o,"IEND"),o+=4,T(U,o,j(U,o-4,4)),o+=4,U.buffer}function C(h,f,x){for(let A=0;A<h.frames.length;A++){const S=h.frames[A];S.rect.width;const j=S.rect.height,T=new Uint8Array(j*S.bpl+j);S.cimg=l(S.img,j,S.bpp,S.bpl,T,f,x)}}function s(h,f,x,A,S){const j=S[0],T=S[1],_=S[2],m=S[3],o=S[4],P=S[5];let D=6,L=8,G=255;for(var W=0;W<h.length;W++){const ye=new Uint8Array(h[W]);for(var V=ye.length,Y=0;Y<V;Y+=4)G&=ye[Y+3]}const U=G!=255,Z=function(de,he,pe,Se,be,je){const xe=[];for(var ne=0;ne<de.length;ne++){const te=new Uint8Array(de[ne]),ke=new Uint32Array(te.buffer);var Ce;let re=0,Me=0,ee=he,Ee=pe,Ie=Se?1:0;if(ne!=0){const gt=je||Se||ne==1||xe[ne-2].dispose!=0?1:2;let pt=0,st=1e9;for(let ot=0;ot<gt;ot++){var we=new Uint8Array(de[ne-1-ot]);const Mt=new Uint32Array(de[ne-1-ot]);let ge=he,Re=pe,Ke=-1,We=-1;for(let qe=0;qe<pe;qe++)for(let Ve=0;Ve<he;Ve++)ke[Ae=qe*he+Ve]!=Mt[Ae]&&(Ve<ge&&(ge=Ve),Ve>Ke&&(Ke=Ve),qe<Re&&(Re=qe),qe>We&&(We=qe));Ke==-1&&(ge=Re=Ke=We=0),be&&((1&ge)==1&&ge--,(1&Re)==1&&Re--);const ct=(Ke-ge+1)*(We-Re+1);ct<st&&(st=ct,pt=ot,re=ge,Me=Re,ee=Ke-ge+1,Ee=We-Re+1)}we=new Uint8Array(de[ne-1-pt]),pt==1&&(xe[ne-1].dispose=2),Ce=new Uint8Array(ee*Ee*4),u(we,he,pe,Ce,ee,Ee,-re,-Me,0),Ie=u(te,he,pe,Ce,ee,Ee,-re,-Me,3)?1:0,Ie==1?n(te,he,pe,Ce,{x:re,y:Me,width:ee,height:Ee}):u(te,he,pe,Ce,ee,Ee,-re,-Me,0)}else Ce=te.slice(0);xe.push({rect:{x:re,y:Me,width:ee,height:Ee},img:Ce,blend:Ie,dispose:0})}if(Se)for(ne=0;ne<xe.length;ne++){if((Ye=xe[ne]).blend==1)continue;const te=Ye.rect,ke=xe[ne-1].rect,re=Math.min(te.x,ke.x),Me=Math.min(te.y,ke.y),ee={x:re,y:Me,width:Math.max(te.x+te.width,ke.x+ke.width)-re,height:Math.max(te.y+te.height,ke.y+ke.height)-Me};xe[ne-1].dispose=1,ne-1!=0&&r(de,he,pe,xe,ne-1,ee,be),r(de,he,pe,xe,ne,ee,be)}let at=0;if(de.length!=1)for(var Ae=0;Ae<xe.length;Ae++){var Ye;at+=(Ye=xe[Ae]).rect.width*Ye.rect.height}return xe}(h,f,x,j,T,_),ue={},ie=[],se=[];if(A!=0){const ye=[];for(Y=0;Y<Z.length;Y++)ye.push(Z[Y].img.buffer);const de=function(be){let je=0;for(var xe=0;xe<be.length;xe++)je+=be[xe].byteLength;const ne=new Uint8Array(je);let Ce=0;for(xe=0;xe<be.length;xe++){const we=new Uint8Array(be[xe]),at=we.length;for(let Ae=0;Ae<at;Ae+=4){let Ye=we[Ae],te=we[Ae+1],ke=we[Ae+2];const re=we[Ae+3];re==0&&(Ye=te=ke=0),ne[Ce+Ae]=Ye,ne[Ce+Ae+1]=te,ne[Ce+Ae+2]=ke,ne[Ce+Ae+3]=re}Ce+=at}return ne.buffer}(ye),he=I(de,A);for(Y=0;Y<he.plte.length;Y++)ie.push(he.plte[Y].est.rgba);let pe=0;for(Y=0;Y<Z.length;Y++){const Se=(ce=Z[Y]).img.length;var le=new Uint8Array(he.inds.buffer,pe>>2,Se>>2);se.push(le);const be=new Uint8Array(he.abuf,pe,Se);P&&i(ce.img,ce.rect.width,ce.rect.height,ie,be,le),ce.img.set(be),pe+=Se}}else for(W=0;W<Z.length;W++){var ce=Z[W];const ye=new Uint32Array(ce.img.buffer);var fe=ce.rect.width;for(V=ye.length,le=new Uint8Array(V),se.push(le),Y=0;Y<V;Y++){const de=ye[Y];if(Y!=0&&de==ye[Y-1])le[Y]=le[Y-1];else if(Y>fe&&de==ye[Y-fe])le[Y]=le[Y-fe];else{let he=ue[de];if(he==null&&(ue[de]=he=ie.length,ie.push(de),ie.length>=300))break;le[Y]=he}}}const Oe=ie.length;for(Oe<=256&&o==0&&(L=Oe<=2?1:Oe<=4?2:Oe<=16?4:8,L=Math.max(L,m)),W=0;W<Z.length;W++){(ce=Z[W]).rect.x,ce.rect.y,fe=ce.rect.width;const ye=ce.rect.height;let de=ce.img;new Uint32Array(de.buffer);let he=4*fe,pe=4;if(Oe<=256&&o==0){he=Math.ceil(L*fe/8);var Te=new Uint8Array(he*ye);const Se=se[W];for(let be=0;be<ye;be++){Y=be*he;const je=be*fe;if(L==8)for(var me=0;me<fe;me++)Te[Y+me]=Se[je+me];else if(L==4)for(me=0;me<fe;me++)Te[Y+(me>>1)]|=Se[je+me]<<4-4*(1&me);else if(L==2)for(me=0;me<fe;me++)Te[Y+(me>>2)]|=Se[je+me]<<6-2*(3&me);else if(L==1)for(me=0;me<fe;me++)Te[Y+(me>>3)]|=Se[je+me]<<7-1*(7&me)}de=Te,D=3,pe=1}else if(U==0&&Z.length==1){Te=new Uint8Array(fe*ye*3);const Se=fe*ye;for(Y=0;Y<Se;Y++){const be=3*Y,je=4*Y;Te[be]=de[je],Te[be+1]=de[je+1],Te[be+2]=de[je+2]}de=Te,D=2,pe=3,he=3*fe}ce.img=de,ce.bpl=he,ce.bpp=pe}return{ctype:D,depth:L,plte:ie,frames:Z}}function r(h,f,x,A,S,j,T){const _=Uint8Array,m=Uint32Array,o=new _(h[S-1]),P=new m(h[S-1]),D=S+1<h.length?new _(h[S+1]):null,L=new _(h[S]),G=new m(L.buffer);let W=f,V=x,Y=-1,U=-1;for(let ue=0;ue<j.height;ue++)for(let ie=0;ie<j.width;ie++){const se=j.x+ie,le=j.y+ue,ce=le*f+se,fe=G[ce];fe==0||A[S-1].dispose==0&&P[ce]==fe&&(D==null||D[4*ce+3]!=0)||(se<W&&(W=se),se>Y&&(Y=se),le<V&&(V=le),le>U&&(U=le))}Y==-1&&(W=V=Y=U=0),T&&((1&W)==1&&W--,(1&V)==1&&V--),j={x:W,y:V,width:Y-W+1,height:U-V+1};const Z=A[S];Z.rect=j,Z.blend=1,Z.img=new Uint8Array(j.width*j.height*4),A[S-1].dispose==0?(u(o,f,x,Z.img,j.width,j.height,-j.x,-j.y,0),n(L,f,x,Z.img,j)):u(L,f,x,Z.img,j.width,j.height,-j.x,-j.y,0)}function n(h,f,x,A,S){u(h,f,x,A,S.width,S.height,-S.x,-S.y,2)}function l(h,f,x,A,S,j,T){const _=[];let m,o=[0,1,2,3,4];j!=-1?o=[j]:(f*A>5e5||x==1)&&(o=[0]),T&&(m={level:0});const P=_r;for(var D=0;D<o.length;D++){for(let W=0;W<f;W++)b(S,h,W,A,x,o[D]);_.push(P.deflate(S,m))}let L,G=1e9;for(D=0;D<_.length;D++)_[D].length<G&&(L=D,G=_[D].length);return _[L]}function b(h,f,x,A,S,j){const T=x*A;let _=T+x;if(h[_]=j,_++,j==0)if(A<500)for(var m=0;m<A;m++)h[_+m]=f[T+m];else h.set(new Uint8Array(f.buffer,T,A),_);else if(j==1){for(m=0;m<S;m++)h[_+m]=f[T+m];for(m=S;m<A;m++)h[_+m]=f[T+m]-f[T+m-S]+256&255}else if(x==0){for(m=0;m<S;m++)h[_+m]=f[T+m];if(j==2)for(m=S;m<A;m++)h[_+m]=f[T+m];if(j==3)for(m=S;m<A;m++)h[_+m]=f[T+m]-(f[T+m-S]>>1)+256&255;if(j==4)for(m=S;m<A;m++)h[_+m]=f[T+m]-R(f[T+m-S],0,0)+256&255}else{if(j==2)for(m=0;m<A;m++)h[_+m]=f[T+m]+256-f[T+m-A]&255;if(j==3){for(m=0;m<S;m++)h[_+m]=f[T+m]+256-(f[T+m-A]>>1)&255;for(m=S;m<A;m++)h[_+m]=f[T+m]+256-(f[T+m-A]+f[T+m-S]>>1)&255}if(j==4){for(m=0;m<S;m++)h[_+m]=f[T+m]+256-R(0,f[T+m-A],0)&255;for(m=S;m<A;m++)h[_+m]=f[T+m]+256-R(f[T+m-S],f[T+m-A],f[T+m-S-A])&255}}}function I(h,f){const x=new Uint8Array(h),A=x.slice(0),S=new Uint32Array(A.buffer),j=O(A,f),T=j[0],_=j[1],m=x.length,o=new Uint8Array(m>>2);let P;if(x.length<2e7)for(var D=0;D<m;D+=4)P=w(T,L=x[D]*(1/255),G=x[D+1]*(1/255),W=x[D+2]*(1/255),V=x[D+3]*(1/255)),o[D>>2]=P.ind,S[D>>2]=P.est.rgba;else for(D=0;D<m;D+=4){var L=x[D]*.00392156862745098,G=x[D+1]*(1/255),W=x[D+2]*(1/255),V=x[D+3]*(1/255);for(P=T;P.left;)P=$(P.est,L,G,W,V)<=0?P.left:P.right;o[D>>2]=P.ind,S[D>>2]=P.est.rgba}return{abuf:A.buffer,inds:o,plte:_}}function O(h,f,x){x==null&&(x=1e-4);const A=new Uint32Array(h.buffer),S={i0:0,i1:h.length,bst:null,est:null,tdst:0,left:null,right:null};S.bst=H(h,S.i0,S.i1),S.est=p(S.bst);const j=[S];for(;j.length<f;){let _=0,m=0;for(var T=0;T<j.length;T++)j[T].est.L>_&&(_=j[T].est.L,m=T);if(_<x)break;const o=j[m],P=B(h,A,o.i0,o.i1,o.est.e,o.est.eMq255);if(o.i0>=P||o.i1<=P){o.est.L=0;continue}const D={i0:o.i0,i1:P,bst:null,est:null,tdst:0,left:null,right:null};D.bst=H(h,D.i0,D.i1),D.est=p(D.bst);const L={i0:P,i1:o.i1,bst:null,est:null,tdst:0,left:null,right:null};for(L.bst={R:[],m:[],N:o.bst.N-D.bst.N},T=0;T<16;T++)L.bst.R[T]=o.bst.R[T]-D.bst.R[T];for(T=0;T<4;T++)L.bst.m[T]=o.bst.m[T]-D.bst.m[T];L.est=p(L.bst),o.left=D,o.right=L,j[m]=D,j.push(L)}for(j.sort((_,m)=>m.bst.N-_.bst.N),T=0;T<j.length;T++)j[T].ind=T;return[S,j]}function w(h,f,x,A,S){if(h.left==null)return h.tdst=function(D,L,G,W,V){const Y=L-D[0],U=G-D[1],Z=W-D[2],ue=V-D[3];return Y*Y+U*U+Z*Z+ue*ue}(h.est.q,f,x,A,S),h;const j=$(h.est,f,x,A,S);let T=h.left,_=h.right;j>0&&(T=h.right,_=h.left);const m=w(T,f,x,A,S);if(m.tdst<=j*j)return m;const o=w(_,f,x,A,S);return o.tdst<m.tdst?o:m}function $(h,f,x,A,S){const{e:j}=h;return j[0]*f+j[1]*x+j[2]*A+j[3]*S-h.eMq}function B(h,f,x,A,S,j){for(A-=4;x<A;){for(;F(h,x,S)<=j;)x+=4;for(;F(h,A,S)>j;)A-=4;if(x>=A)break;const T=f[x>>2];f[x>>2]=f[A>>2],f[A>>2]=T,x+=4,A-=4}for(;F(h,x,S)>j;)x-=4;return x+4}function F(h,f,x){return h[f]*x[0]+h[f+1]*x[1]+h[f+2]*x[2]+h[f+3]*x[3]}function H(h,f,x){const A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S=[0,0,0,0],j=x-f>>2;for(let T=f;T<x;T+=4){const _=h[T]*.00392156862745098,m=h[T+1]*(1/255),o=h[T+2]*(1/255),P=h[T+3]*(1/255);S[0]+=_,S[1]+=m,S[2]+=o,S[3]+=P,A[0]+=_*_,A[1]+=_*m,A[2]+=_*o,A[3]+=_*P,A[5]+=m*m,A[6]+=m*o,A[7]+=m*P,A[10]+=o*o,A[11]+=o*P,A[15]+=P*P}return A[4]=A[1],A[8]=A[2],A[9]=A[6],A[12]=A[3],A[13]=A[7],A[14]=A[11],{R:A,m:S,N:j}}function p(h){const{R:f}=h,{m:x}=h,{N:A}=h,S=x[0],j=x[1],T=x[2],_=x[3],m=A==0?0:1/A,o=[f[0]-S*S*m,f[1]-S*j*m,f[2]-S*T*m,f[3]-S*_*m,f[4]-j*S*m,f[5]-j*j*m,f[6]-j*T*m,f[7]-j*_*m,f[8]-T*S*m,f[9]-T*j*m,f[10]-T*T*m,f[11]-T*_*m,f[12]-_*S*m,f[13]-_*j*m,f[14]-_*T*m,f[15]-_*_*m],P=o,D=N;let L=[Math.random(),Math.random(),Math.random(),Math.random()],G=0,W=0;if(A!=0)for(let Y=0;Y<16&&(L=D.multVec(P,L),W=Math.sqrt(D.dot(L,L)),L=D.sml(1/W,L),!(Y!=0&&Math.abs(W-G)<1e-9));Y++)G=W;const V=[S*m,j*m,T*m,_*m];return{Cov:o,q:V,e:L,L:G,eMq255:D.dot(D.sml(255,V),L),eMq:D.dot(L,V),rgba:(Math.round(255*V[3])<<24|Math.round(255*V[2])<<16|Math.round(255*V[1])<<8|Math.round(255*V[0])<<0)>>>0}}var N={multVec:(h,f)=>[h[0]*f[0]+h[1]*f[1]+h[2]*f[2]+h[3]*f[3],h[4]*f[0]+h[5]*f[1]+h[6]*f[2]+h[7]*f[3],h[8]*f[0]+h[9]*f[1]+h[10]*f[2]+h[11]*f[3],h[12]*f[0]+h[13]*f[1]+h[14]*f[2]+h[15]*f[3]],dot:(h,f)=>h[0]*f[0]+h[1]*f[1]+h[2]*f[2]+h[3]*f[3],sml:(h,f)=>[h*f[0],h*f[1],h*f[2],h*f[3]]};et.encode=function(f,x,A,S,j,T,_){S==null&&(S=0),_==null&&(_=!1);const m=s(f,x,A,S,[!1,!1,!1,0,_,!1]);return C(m,-1),y(m,x,A,j,T)},et.encodeLL=function(f,x,A,S,j,T,_,m){const o={ctype:0+(S==1?0:2)+(j==0?0:4),depth:T,frames:[]},P=(S+j)*T,D=P*x;for(let L=0;L<f.length;L++)o.frames.push({rect:{x:0,y:0,width:x,height:A},img:new Uint8Array(f[L]),blend:0,dispose:1,bpp:Math.ceil(P/8),bpl:Math.ceil(D/8)});return C(o,0,!0),y(o,x,A,_,m)},et.encode.compress=s,et.encode.dither=i,et.quantize=I,et.quantize.getKDtree=O,et.quantize.getNearest=w})();const Ss={toArrayBuffer(u,v){const R=u.width,c=u.height,e=R<<2,t=u.getContext("2d").getImageData(0,0,R,c),d=new Uint32Array(t.data.buffer),i=(32*R+31)/32<<2,y=i*c,C=122+y,s=new ArrayBuffer(C),r=new DataView(s),n=1<<20;let l,b,I,O,w=n,$=0,B=0,F=0;function H(h){r.setUint16(B,h,!0),B+=2}function p(h){r.setUint32(B,h,!0),B+=4}function N(h){B+=h}H(19778),p(C),N(4),p(122),p(108),p(R),p(-c>>>0),H(1),H(32),p(3),p(y),p(2835),p(2835),N(8),p(16711680),p(65280),p(255),p(4278190080),p(1466527264),function h(){for(;$<c&&w>0;){for(O=122+$*i,l=0;l<e;)w--,b=d[F++],I=b>>>24,r.setUint32(O+l,b<<8|I),l+=4;$++}F<d.length?(w=n,setTimeout(h,Ss._dly)):v(s)}()},toBlob(u,v){this.toArrayBuffer(u,R=>{v(new Blob([R],{type:"image/bmp"}))})},_dly:9};var ze={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Er={[ze.CHROME]:16384,[ze.FIREFOX]:11180,[ze.DESKTOP_SAFARI]:16384,[ze.IE]:8192,[ze.IOS]:4096,[ze.ETC]:8192};const Wn=typeof window<"u",Cs=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,vn=Wn&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),jr=(Wn||Cs)&&(vn&&vn.getOriginalSymbol(window,"File")||typeof File<"u"&&File),ws=(Wn||Cs)&&(vn&&vn.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function Gn(u,v,R=Date.now()){return new Promise(c=>{const e=u.split(","),t=e[0].match(/:(.*?);/)[1],d=globalThis.atob(e[1]);let i=d.length;const y=new Uint8Array(i);for(;i--;)y[i]=d.charCodeAt(i);const C=new Blob([y],{type:t});C.name=v,C.lastModified=R,c(C)})}function _s(u){return new Promise((v,R)=>{const c=new ws;c.onload=()=>v(c.result),c.onerror=e=>R(e),c.readAsDataURL(u)})}function Es(u){return new Promise((v,R)=>{const c=new Image;c.onload=()=>v(c),c.onerror=e=>R(e),c.src=u})}function yt(){if(yt.cachedResult!==void 0)return yt.cachedResult;let u=ze.ETC;const{userAgent:v}=navigator;return/Chrom(e|ium)/i.test(v)?u=ze.CHROME:/iP(ad|od|hone)/i.test(v)&&/WebKit/i.test(v)?u=ze.IOS:/Safari/i.test(v)?u=ze.DESKTOP_SAFARI:/Firefox/i.test(v)?u=ze.FIREFOX:(/MSIE/i.test(v)||document.documentMode)&&(u=ze.IE),yt.cachedResult=u,yt.cachedResult}function js(u,v){const R=yt(),c=Er[R];let e=u,t=v,d=e*t;const i=e>t?t/e:e/t;for(;d>c*c;){const y=(c+e)/2,C=(c+t)/2;y<C?(t=C,e=C*i):(t=y*i,e=y),d=e*t}return{width:e,height:t}}function An(u,v){let R,c;try{if(R=new OffscreenCanvas(u,v),c=R.getContext("2d"),c===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{R=document.createElement("canvas"),c=R.getContext("2d")}return R.width=u,R.height=v,[R,c]}function Is(u,v){const{width:R,height:c}=js(u.width,u.height),[e,t]=An(R,c);return v&&/jpe?g/.test(v)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(u,0,0,e.width,e.height),e}function fn(){return fn.cachedResult!==void 0||(fn.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),fn.cachedResult}function yn(u,v={}){return new Promise(function(R,c){let e,t;var d=function(){try{return t=Is(e,v.fileType||u.type),R([e,t])}catch(y){return c(y)}},i=function(y){try{var C=function(s){try{throw s}catch(r){return c(r)}};try{let s;return _s(u).then(function(r){try{return s=r,Es(s).then(function(n){try{return e=n,function(){try{return d()}catch(l){return c(l)}}()}catch(l){return C(l)}},C)}catch(n){return C(n)}},C)}catch(s){C(s)}}catch(s){return c(s)}};try{if(fn()||[ze.DESKTOP_SAFARI,ze.MOBILE_SAFARI].includes(yt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(u).then(function(y){try{return e=y,d()}catch{return i()}},i)}catch{i()}})}function Tn(u,v,R,c,e=1){return new Promise(function(t,d){let i;if(v==="image/png"){let C,s,r;return C=u.getContext("2d"),{data:s}=C.getImageData(0,0,u.width,u.height),r=et.encode([s.buffer],u.width,u.height,4096*e),i=new Blob([r],{type:v}),i.name=R,i.lastModified=c,y.call(this)}{let C=function(){return y.call(this)};if(v==="image/bmp")return new Promise(s=>Ss.toBlob(u,s)).then((function(s){try{return i=s,i.name=R,i.lastModified=c,C.call(this)}catch(r){return d(r)}}).bind(this),d);{let s=function(){return C.call(this)};if(typeof OffscreenCanvas=="function"&&u instanceof OffscreenCanvas)return u.convertToBlob({type:v,quality:e}).then((function(r){try{return i=r,i.name=R,i.lastModified=c,s.call(this)}catch(n){return d(n)}}).bind(this),d);{let r;return r=u.toDataURL(v,e),Gn(r,R,c).then((function(n){try{return i=n,s.call(this)}catch(l){return d(l)}}).bind(this),d)}}}function y(){return t(i)}})}function rt(u){u.width=0,u.height=0}function jt(){return new Promise(function(u,v){let R,c,e,t;return jt.cachedResult!==void 0?u(jt.cachedResult):Gn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(d){try{return R=d,yn(R).then(function(i){try{return c=i[1],Tn(c,R.type,R.name,R.lastModified).then(function(y){try{return e=y,rt(c),yn(e).then(function(C){try{return t=C[0],jt.cachedResult=t.width===1&&t.height===2,u(jt.cachedResult)}catch(s){return v(s)}},v)}catch(C){return v(C)}},v)}catch(y){return v(y)}},v)}catch(i){return v(i)}},v)})}function Ds(u){return new Promise((v,R)=>{const c=new ws;c.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return v(-2);const d=t.byteLength;let i=2;for(;i<d;){if(t.getUint16(i+2,!1)<=8)return v(-1);const y=t.getUint16(i,!1);if(i+=2,y==65505){if(t.getUint32(i+=2,!1)!=1165519206)return v(-1);const C=t.getUint16(i+=6,!1)==18761;i+=t.getUint32(i+4,C);const s=t.getUint16(i,C);i+=2;for(let r=0;r<s;r++)if(t.getUint16(i+12*r,C)==274)return v(t.getUint16(i+12*r+8,C))}else{if((65280&y)!=65280)break;i+=t.getUint16(i,!1)}}return v(-1)},c.onerror=e=>R(e),c.readAsArrayBuffer(u)})}function Rs(u,v){const{width:R}=u,{height:c}=u,{maxWidthOrHeight:e}=v;let t,d=u;return isFinite(e)&&(R>e||c>e)&&([d,t]=An(R,c),R>c?(d.width=e,d.height=c/R*e):(d.width=R/c*e,d.height=e),t.drawImage(u,0,0,d.width,d.height),rt(u)),d}function Fs(u,v){const{width:R}=u,{height:c}=u,[e,t]=An(R,c);switch(v>4&&v<9?(e.width=c,e.height=R):(e.width=R,e.height=c),v){case 2:t.transform(-1,0,0,1,R,0);break;case 3:t.transform(-1,0,0,-1,R,c);break;case 4:t.transform(1,0,0,-1,0,c);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,c,0);break;case 7:t.transform(0,-1,-1,0,c,R);break;case 8:t.transform(0,-1,1,0,0,R)}return t.drawImage(u,0,0,R,c),rt(u),e}function ns(u,v,R=0){return new Promise(function(c,e){let t,d,i,y,C,s,r,n,l,b,I,O,w,$,B,F,H,p,N,h;function f(A=5){if(v.signal&&v.signal.aborted)throw v.signal.reason;t+=A,v.onProgress(Math.min(t,100))}function x(A){if(v.signal&&v.signal.aborted)throw v.signal.reason;t=Math.min(Math.max(A,t),100),v.onProgress(t)}return t=R,d=v.maxIteration||10,i=1024*v.maxSizeMB*1024,f(),yn(u,v).then((function(A){try{return[,y]=A,f(),C=Rs(y,v),f(),new Promise(function(S,j){var T;if(!(T=v.exifOrientation))return Ds(u).then((function(m){try{return T=m,_.call(this)}catch(o){return j(o)}}).bind(this),j);function _(){return S(T)}return _.call(this)}).then((function(S){try{return s=S,f(),jt().then((function(j){try{return r=j?C:Fs(C,s),f(),n=v.initialQuality||1,l=v.fileType||u.type,Tn(r,l,u.name,u.lastModified,n).then((function(T){try{{let m=function(){if(d--&&(B>i||B>w)){let P,D;return P=h?.95*N.width:N.width,D=h?.95*N.height:N.height,[H,p]=An(P,D),p.drawImage(N,0,0,P,D),n*=l==="image/png"?.85:.95,Tn(H,l,u.name,u.lastModified,n).then(function(L){try{return F=L,rt(N),N=H,B=F.size,x(Math.min(99,Math.floor(($-B)/($-i)*100))),m}catch(G){return e(G)}},e)}return[1]},o=function(){return rt(N),rt(H),rt(C),rt(r),rt(y),x(100),c(F)};if(b=T,f(),I=b.size>i,O=b.size>u.size,!I&&!O)return x(100),c(b);var _;return w=u.size,$=b.size,B=$,N=r,h=!v.alwaysKeepResolution&&I,(_=(function(P){for(;P;){if(P.then)return void P.then(_,e);try{if(P.pop){if(P.length)return P.pop()?o.call(this):P;P=m}else P=P.call(this)}catch(D){return e(D)}}}).bind(this))(m)}}catch(m){return e(m)}}).bind(this),e)}catch(T){return e(T)}}).bind(this),e)}catch(j){return e(j)}}).bind(this),e)}catch(S){return e(S)}}).bind(this),e)})}const Ir=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Dn;function Dr(u,v){return new Promise((R,c)=>{Dn||(Dn=function(d){const i=[];return i.push(d),URL.createObjectURL(new Blob(i))}(Ir));const e=new Worker(Dn);e.addEventListener("message",function(d){if(v.signal&&v.signal.aborted)e.terminate();else if(d.data.progress===void 0){if(d.data.error)return c(new Error(d.data.error)),void e.terminate();R(d.data.file),e.terminate()}else v.onProgress(d.data.progress)}),e.addEventListener("error",c),v.signal&&v.signal.addEventListener("abort",()=>{c(v.signal.reason),e.terminate()}),e.postMessage({file:u,imageCompressionLibUrl:v.libURL,options:{...v,onProgress:void 0,signal:void 0}})})}function Ne(u,v){return new Promise(function(R,c){let e,t,d,i,y,C;if(e={...v},d=0,{onProgress:i}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,y=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=l=>{d=l,typeof i=="function"&&i(d)},!(u instanceof Blob||u instanceof jr))return c(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(u.type))return c(new Error("The file given is not an image"));if(C=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!y||typeof Worker!="function"||C)return ns(u,e).then((function(l){try{return t=l,n.call(this)}catch(b){return c(b)}}).bind(this),c);var s=(function(){try{return n.call(this)}catch(l){return c(l)}}).bind(this),r=function(l){try{return ns(u,e).then(function(b){try{return t=b,s()}catch(I){return c(I)}},c)}catch(b){return c(b)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Dr(u,e).then(function(l){try{return t=l,s()}catch{return r()}},r)}catch{r()}function n(){try{t.name=u.name,t.lastModified=u.lastModified}catch{}try{e.preserveExif&&u.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===u.type)&&(t=As(u,t))}catch{}return R(t)}})}Ne.getDataUrlFromFile=_s,Ne.getFilefromDataUrl=Gn,Ne.loadImage=Es,Ne.drawImageInCanvas=Is,Ne.drawFileInCanvas=yn,Ne.canvasToFile=Tn,Ne.getExifOrientation=Ds,Ne.handleMaxWidthOrHeight=Rs,Ne.followExifOrientation=Fs,Ne.cleanupCanvasMemory=rt,Ne.isAutoOrientationInBrowser=jt,Ne.approximateBelowMaximumCanvasSizeOfBrowser=js,Ne.copyExifWithoutOrientation=As,Ne.getBrowserName=yt,Ne.version="2.0.2";function Rr(u){var v=typeof u;return u!=null&&(v=="object"||v=="function")}var Us=Rr,Fr=typeof on=="object"&&on&&on.Object===Object&&on,Ur=Fr,Or=Ur,kr=typeof self=="object"&&self&&self.Object===Object&&self,Mr=Or||kr||Function("return this")(),Os=Mr,Nr=Os,Lr=function(){return Nr.Date.now()},Pr=Lr,Br=/\s/;function Hr(u){for(var v=u.length;v--&&Br.test(u.charAt(v)););return v}var $r=Hr,zr=$r,Wr=/^\s+/;function Gr(u){return u&&u.slice(0,zr(u)+1).replace(Wr,"")}var Yr=Gr,qr=Os,Vr=qr.Symbol,ks=Vr,ss=ks,Ms=Object.prototype,Qr=Ms.hasOwnProperty,Xr=Ms.toString,Ht=ss?ss.toStringTag:void 0;function Zr(u){var v=Qr.call(u,Ht),R=u[Ht];try{u[Ht]=void 0;var c=!0}catch{}var e=Xr.call(u);return c&&(v?u[Ht]=R:delete u[Ht]),e}var Kr=Zr,Jr=Object.prototype,ei=Jr.toString;function ti(u){return ei.call(u)}var ni=ti,rs=ks,si=Kr,ri=ni,ii="[object Null]",ai="[object Undefined]",is=rs?rs.toStringTag:void 0;function oi(u){return u==null?u===void 0?ai:ii:is&&is in Object(u)?si(u):ri(u)}var li=oi;function ci(u){return u!=null&&typeof u=="object"}var di=ci,ui=li,fi=di,hi="[object Symbol]";function mi(u){return typeof u=="symbol"||fi(u)&&ui(u)==hi}var gi=mi,pi=Yr,as=Us,bi=gi,os=NaN,xi=/^[-+]0x[0-9a-f]+$/i,vi=/^0b[01]+$/i,yi=/^0o[0-7]+$/i,Ti=parseInt;function Ai(u){if(typeof u=="number")return u;if(bi(u))return os;if(as(u)){var v=typeof u.valueOf=="function"?u.valueOf():u;u=as(v)?v+"":v}if(typeof u!="string")return u===0?u:+u;u=pi(u);var R=vi.test(u);return R||yi.test(u)?Ti(u.slice(2),R?2:8):xi.test(u)?os:+u}var Si=Ai,Ci=Us,Rn=Pr,ls=Si,wi="Expected a function",_i=Math.max,Ei=Math.min;function ji(u,v,R){var c,e,t,d,i,y,C=0,s=!1,r=!1,n=!0;if(typeof u!="function")throw new TypeError(wi);v=ls(v)||0,Ci(R)&&(s=!!R.leading,r="maxWait"in R,t=r?_i(ls(R.maxWait)||0,v):t,n="trailing"in R?!!R.trailing:n);function l(p){var N=c,h=e;return c=e=void 0,C=p,d=u.apply(h,N),d}function b(p){return C=p,i=setTimeout(w,v),s?l(p):d}function I(p){var N=p-y,h=p-C,f=v-N;return r?Ei(f,t-h):f}function O(p){var N=p-y,h=p-C;return y===void 0||N>=v||N<0||r&&h>=t}function w(){var p=Rn();if(O(p))return $(p);i=setTimeout(w,I(p))}function $(p){return i=void 0,n&&c?l(p):(c=e=void 0,d)}function B(){i!==void 0&&clearTimeout(i),C=0,c=y=e=i=void 0}function F(){return i===void 0?d:$(Rn())}function H(){var p=Rn(),N=O(p);if(c=arguments,e=this,y=p,N){if(i===void 0)return b(y);if(r)return clearTimeout(i),i=setTimeout(w,v),l(y)}return i===void 0&&(i=setTimeout(w,v)),d}return H.cancel=B,H.flush=F,H}var Ii=ji;const Di=cr(Ii);var Yn={},Ri=mt;Object.defineProperty(Yn,"__esModule",{value:!0});var Ns=Yn.default=void 0,Fi=Ri(ht()),cs=a;Ns=Yn.default=(0,Fi.default)([(0,cs.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,cs.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn");var qn={},Ui=mt;Object.defineProperty(qn,"__esModule",{value:!0});var Ls=qn.default=void 0,Oi=Ui(ht()),ki=a;Ls=qn.default=(0,Oi.default)((0,ki.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut");var Vn={},Mi=mt;Object.defineProperty(Vn,"__esModule",{value:!0});var Ps=Vn.default=void 0,Ni=Mi(ht()),Li=a;Ps=Vn.default=(0,Ni.default)((0,Li.jsx)("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen");var Qn={},Pi=mt;Object.defineProperty(Qn,"__esModule",{value:!0});var Bs=Qn.default=void 0,Bi=Pi(ht()),Hi=a;Bs=Qn.default=(0,Bi.default)((0,Hi.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var Xn={},$i=mt;Object.defineProperty(Xn,"__esModule",{value:!0});var Hs=Xn.default=void 0,zi=$i(ht()),ds=a;Hs=Xn.default=(0,zi.default)([(0,ds.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,ds.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera");const Ft=z.forwardRef(({path:u,initialImages:v=[],onImagesUpdated:R,onDelete:c,isOwnDesign:e},t)=>{const[d,i]=z.useState(v.map(o=>({...o,deleted:!1}))),[y,C]=z.useState(!1),[s,r]=z.useState(0),[n,l]=z.useState(!1),[b,I]=z.useState(null),[O,w]=z.useState(1),[$,B]=z.useState(!1),[F,H]=z.useState(!1),[p,N]=z.useState(""),[h,f]=z.useState("info"),x=z.useRef(null);z.useEffect(()=>{console.log("Initial images received:",v),i(v.map(o=>({...o,deleted:!!o.deleted})))},[v]);const A=async o=>{const P=Array.from(o.target.files||[]);C(!0);const D={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},L=P.map(async(G,W)=>{let V=G;G.size>1024*1024&&(V=await Ne(G,D),N("Your image was compressed before uploading due to file size larger than 1 MB."),f("info"),H(!0));const U=`${new Date().getTime()}-${V.name}`,Z=It(),ue=Dt(Z,`${u}/${U}`),ie=ys(ue,V);return new Promise((se,le)=>{ie.on("state_changed",ce=>{const fe=ce.bytesTransferred/ce.totalBytes*100;r(fe)},ce=>{console.error("Upload failed:",ce),le(ce)},()=>{Ts(ie.snapshot.ref).then(ce=>{se({url:ce,path:ue.fullPath,title:""})})})})});Promise.all(L).then(G=>{const W=[...d,...G];i(W),R&&R(W),N("Images uploaded successfully."),f("success"),H(!0),C(!1),r(0),x.current&&(x.current.value="")}).catch(G=>{console.error("Error uploading images: ",G),N("Failed to upload images."),f("error"),H(!0),C(!1),r(0)})},S=o=>{i(P=>{const D=P.map((L,G)=>G===o?{...L,deleted:!0}:L);return R(D),D}),N("Image marked for deletion. Update to permanently delete."),f("info"),H(!0)},j=async()=>{const o=d.filter(P=>P.deleted);if(console.log("Attempting to delete images:",o),o.length>0){const P=o.map(D=>{const L=It(),G=Dt(L,D.path);return un(G)});try{await Promise.all(P),c(o),i(D=>D.filter(L=>!L.deleted)),N("Deleted images have been permanently removed."),f("success")}catch(D){console.error("Error committing deletions:",D),N("Failed to commit deletions."),f("error")}H(!0)}else console.log("No images marked for deletion.")},T=o=>{B(!$),I(o)};z.useEffect(()=>{const o=()=>{const P=!!document.fullscreenElement;B(P)};return document.addEventListener("fullscreenchange",o),()=>document.removeEventListener("fullscreenchange",o)},[]);const _=(o,P)=>{P!=="clickaway"&&H(!1)},m=z.useCallback(Di((o,P)=>{setTimeout(()=>{i(D=>{const L=D.map((G,W)=>W===o?{...G,title:P}:G);return R&&R(L),L})},0)},30),[R]);return z.useImperativeHandle(t,()=>({commitDeletions:j})),a.jsxs("div",{children:[e&&a.jsx(gn,{title:"Upload Images",children:a.jsxs(Be,{variant:"outlined",component:"label",startIcon:a.jsx(Hs,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",a.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:A,disabled:y,ref:x,accept:"image/*"})]})}),y&&a.jsxs(a.Fragment,{children:[a.jsxs("p",{children:["Uploading... ",Math.round(s),"%"]}),a.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:a.jsx("div",{style:{height:"20px",width:`${s}%`,backgroundColor:"green"}})})]}),d.filter(o=>!o.deleted).map((o,P)=>a.jsxs("div",{children:[a.jsx("img",{src:o.url,alt:`Uploaded design ${P}`,onClick:()=>{l(!0),I(P)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&a.jsx(Xe,{onClick:()=>S(P),children:a.jsx(Vt,{})}),a.jsx("textarea",{value:o.title,onChange:D=>m(P,D.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},P)),a.jsx(Tt,{open:n,onClose:()=>l(!1),fullScreen:$,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:$?"none":void 0,maxHeight:$?"none":void 0,height:$?"100%":void 0,width:$?"100%":void 0,overflowY:"auto"}},children:b!==null&&a.jsxs(At,{children:[a.jsx("div",{style:{textAlign:"center"},children:a.jsx("img",{src:d[b].url,alt:`Zoomed Design ${b}`,style:{maxWidth:"100%",maxHeight:$?"100vh":void 0,transform:`scale(${O})`,transition:"transform 0.2s ease-out"}})}),a.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[a.jsx(Xe,{onClick:()=>w(O*1.2),children:a.jsx(Ns,{})}),a.jsx(Xe,{onClick:()=>w(O/1.2),style:{marginLeft:"10px"},children:a.jsx(Ls,{})}),a.jsx(Xe,{onClick:()=>T(b),style:{marginLeft:"10px"},children:a.jsx(Ps,{})}),$&&a.jsx(Xe,{onClick:()=>T(b),style:{position:"absolute",top:20,right:20},children:a.jsx(Bs,{})})]})]})}),a.jsx(St,{open:F,autoHideDuration:6e3,onClose:_,children:a.jsx(Ct,{onClose:_,severity:h,sx:{width:"100%"},children:p})})]})});/*! @license DOMPurify 3.1.7 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.1.7/LICENSE */const{entries:$s,setPrototypeOf:us,isFrozen:Wi,getPrototypeOf:Gi,getOwnPropertyDescriptor:Yi}=Object;let{freeze:He,seal:Ze,create:zs}=Object,{apply:Bn,construct:Hn}=typeof Reflect<"u"&&Reflect;He||(He=function(v){return v});Ze||(Ze=function(v){return v});Bn||(Bn=function(v,R,c){return v.apply(R,c)});Hn||(Hn=function(v,R){return new v(...R)});const ln=Ge(Array.prototype.forEach),fs=Ge(Array.prototype.pop),$t=Ge(Array.prototype.push),hn=Ge(String.prototype.toLowerCase),Fn=Ge(String.prototype.toString),hs=Ge(String.prototype.match),zt=Ge(String.prototype.replace),qi=Ge(String.prototype.indexOf),Vi=Ge(String.prototype.trim),tt=Ge(Object.prototype.hasOwnProperty),Pe=Ge(RegExp.prototype.test),Wt=Qi(TypeError);function Ge(u){return function(v){for(var R=arguments.length,c=new Array(R>1?R-1:0),e=1;e<R;e++)c[e-1]=arguments[e];return Bn(u,v,c)}}function Qi(u){return function(){for(var v=arguments.length,R=new Array(v),c=0;c<v;c++)R[c]=arguments[c];return Hn(u,R)}}function ae(u,v){let R=arguments.length>2&&arguments[2]!==void 0?arguments[2]:hn;us&&us(u,null);let c=v.length;for(;c--;){let e=v[c];if(typeof e=="string"){const t=R(e);t!==e&&(Wi(v)||(v[c]=t),e=t)}u[e]=!0}return u}function Xi(u){for(let v=0;v<u.length;v++)tt(u,v)||(u[v]=null);return u}function vt(u){const v=zs(null);for(const[R,c]of $s(u))tt(u,R)&&(Array.isArray(c)?v[R]=Xi(c):c&&typeof c=="object"&&c.constructor===Object?v[R]=vt(c):v[R]=c);return v}function Gt(u,v){for(;u!==null;){const c=Yi(u,v);if(c){if(c.get)return Ge(c.get);if(typeof c.value=="function")return Ge(c.value)}u=Gi(u)}function R(){return null}return R}const ms=He(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Un=He(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),On=He(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Zi=He(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),kn=He(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Ki=He(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),gs=He(["#text"]),ps=He(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Mn=He(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),bs=He(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),cn=He(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Ji=Ze(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ea=Ze(/<%[\w\W]*|[\w\W]*%>/gm),ta=Ze(/\${[\w\W]*}/gm),na=Ze(/^data-[\-\w.\u00B7-\uFFFF]/),sa=Ze(/^aria-[\-\w]+$/),Ws=Ze(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ra=Ze(/^(?:\w+script|data):/i),ia=Ze(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Gs=Ze(/^html$/i),aa=Ze(/^[a-z][.\w]*(-[.\w]+)+$/i);var xs=Object.freeze({__proto__:null,MUSTACHE_EXPR:Ji,ERB_EXPR:ea,TMPLIT_EXPR:ta,DATA_ATTR:na,ARIA_ATTR:sa,IS_ALLOWED_URI:Ws,IS_SCRIPT_OR_DATA:ra,ATTR_WHITESPACE:ia,DOCTYPE_NAME:Gs,CUSTOM_ELEMENT:aa});const Yt={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},oa=function(){return typeof window>"u"?null:window},la=function(v,R){if(typeof v!="object"||typeof v.createPolicy!="function")return null;let c=null;const e="data-tt-policy-suffix";R&&R.hasAttribute(e)&&(c=R.getAttribute(e));const t="dompurify"+(c?"#"+c:"");try{return v.createPolicy(t,{createHTML(d){return d},createScriptURL(d){return d}})}catch{return console.warn("TrustedTypes policy "+t+" could not be created."),null}};function Ys(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oa();const v=J=>Ys(J);if(v.version="3.1.7",v.removed=[],!u||!u.document||u.document.nodeType!==Yt.document)return v.isSupported=!1,v;let{document:R}=u;const c=R,e=c.currentScript,{DocumentFragment:t,HTMLTemplateElement:d,Node:i,Element:y,NodeFilter:C,NamedNodeMap:s=u.NamedNodeMap||u.MozNamedAttrMap,HTMLFormElement:r,DOMParser:n,trustedTypes:l}=u,b=y.prototype,I=Gt(b,"cloneNode"),O=Gt(b,"remove"),w=Gt(b,"nextSibling"),$=Gt(b,"childNodes"),B=Gt(b,"parentNode");if(typeof d=="function"){const J=R.createElement("template");J.content&&J.content.ownerDocument&&(R=J.content.ownerDocument)}let F,H="";const{implementation:p,createNodeIterator:N,createDocumentFragment:h,getElementsByTagName:f}=R,{importNode:x}=c;let A={};v.isSupported=typeof $s=="function"&&typeof B=="function"&&p&&p.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:S,ERB_EXPR:j,TMPLIT_EXPR:T,DATA_ATTR:_,ARIA_ATTR:m,IS_SCRIPT_OR_DATA:o,ATTR_WHITESPACE:P,CUSTOM_ELEMENT:D}=xs;let{IS_ALLOWED_URI:L}=xs,G=null;const W=ae({},[...ms,...Un,...On,...kn,...gs]);let V=null;const Y=ae({},[...ps,...Mn,...bs,...cn]);let U=Object.seal(zs(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Z=null,ue=null,ie=!0,se=!0,le=!1,ce=!0,fe=!1,Oe=!0,Te=!1,me=!1,ye=!1,de=!1,he=!1,pe=!1,Se=!0,be=!1;const je="user-content-";let xe=!0,ne=!1,Ce={},we=null;const at=ae({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ae=null;const Ye=ae({},["audio","video","img","source","image","track"]);let te=null;const ke=ae({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),re="http://www.w3.org/1998/Math/MathML",Me="http://www.w3.org/2000/svg",ee="http://www.w3.org/1999/xhtml";let Ee=ee,Ie=!1,gt=null;const pt=ae({},[re,Me,ee],Fn);let st=null;const ot=["application/xhtml+xml","text/html"],Mt="text/html";let ge=null,Re=null;const Ke=R.createElement("form"),We=function(E){return E instanceof RegExp||E instanceof Function},ct=function(){let E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Re&&Re===E)){if((!E||typeof E!="object")&&(E={}),E=vt(E),st=ot.indexOf(E.PARSER_MEDIA_TYPE)===-1?Mt:E.PARSER_MEDIA_TYPE,ge=st==="application/xhtml+xml"?Fn:hn,G=tt(E,"ALLOWED_TAGS")?ae({},E.ALLOWED_TAGS,ge):W,V=tt(E,"ALLOWED_ATTR")?ae({},E.ALLOWED_ATTR,ge):Y,gt=tt(E,"ALLOWED_NAMESPACES")?ae({},E.ALLOWED_NAMESPACES,Fn):pt,te=tt(E,"ADD_URI_SAFE_ATTR")?ae(vt(ke),E.ADD_URI_SAFE_ATTR,ge):ke,Ae=tt(E,"ADD_DATA_URI_TAGS")?ae(vt(Ye),E.ADD_DATA_URI_TAGS,ge):Ye,we=tt(E,"FORBID_CONTENTS")?ae({},E.FORBID_CONTENTS,ge):at,Z=tt(E,"FORBID_TAGS")?ae({},E.FORBID_TAGS,ge):{},ue=tt(E,"FORBID_ATTR")?ae({},E.FORBID_ATTR,ge):{},Ce=tt(E,"USE_PROFILES")?E.USE_PROFILES:!1,ie=E.ALLOW_ARIA_ATTR!==!1,se=E.ALLOW_DATA_ATTR!==!1,le=E.ALLOW_UNKNOWN_PROTOCOLS||!1,ce=E.ALLOW_SELF_CLOSE_IN_ATTR!==!1,fe=E.SAFE_FOR_TEMPLATES||!1,Oe=E.SAFE_FOR_XML!==!1,Te=E.WHOLE_DOCUMENT||!1,de=E.RETURN_DOM||!1,he=E.RETURN_DOM_FRAGMENT||!1,pe=E.RETURN_TRUSTED_TYPE||!1,ye=E.FORCE_BODY||!1,Se=E.SANITIZE_DOM!==!1,be=E.SANITIZE_NAMED_PROPS||!1,xe=E.KEEP_CONTENT!==!1,ne=E.IN_PLACE||!1,L=E.ALLOWED_URI_REGEXP||Ws,Ee=E.NAMESPACE||ee,U=E.CUSTOM_ELEMENT_HANDLING||{},E.CUSTOM_ELEMENT_HANDLING&&We(E.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(U.tagNameCheck=E.CUSTOM_ELEMENT_HANDLING.tagNameCheck),E.CUSTOM_ELEMENT_HANDLING&&We(E.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(U.attributeNameCheck=E.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),E.CUSTOM_ELEMENT_HANDLING&&typeof E.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(U.allowCustomizedBuiltInElements=E.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),fe&&(se=!1),he&&(de=!0),Ce&&(G=ae({},gs),V=[],Ce.html===!0&&(ae(G,ms),ae(V,ps)),Ce.svg===!0&&(ae(G,Un),ae(V,Mn),ae(V,cn)),Ce.svgFilters===!0&&(ae(G,On),ae(V,Mn),ae(V,cn)),Ce.mathMl===!0&&(ae(G,kn),ae(V,bs),ae(V,cn))),E.ADD_TAGS&&(G===W&&(G=vt(G)),ae(G,E.ADD_TAGS,ge)),E.ADD_ATTR&&(V===Y&&(V=vt(V)),ae(V,E.ADD_ATTR,ge)),E.ADD_URI_SAFE_ATTR&&ae(te,E.ADD_URI_SAFE_ATTR,ge),E.FORBID_CONTENTS&&(we===at&&(we=vt(we)),ae(we,E.FORBID_CONTENTS,ge)),xe&&(G["#text"]=!0),Te&&ae(G,["html","head","body"]),G.table&&(ae(G,["tbody"]),delete Z.tbody),E.TRUSTED_TYPES_POLICY){if(typeof E.TRUSTED_TYPES_POLICY.createHTML!="function")throw Wt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof E.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Wt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');F=E.TRUSTED_TYPES_POLICY,H=F.createHTML("")}else F===void 0&&(F=la(l,e)),F!==null&&typeof H=="string"&&(H=F.createHTML(""));He&&He(E),Re=E}},qe=ae({},["mi","mo","mn","ms","mtext"]),Ve=ae({},["annotation-xml"]),Kt=ae({},["title","style","font","a","script"]),Nt=ae({},[...Un,...On,...Zi]),Jt=ae({},[...kn,...Ki]),Sn=function(E){let g=B(E);(!g||!g.tagName)&&(g={namespaceURI:Ee,tagName:"template"});const k=hn(E.tagName),M=hn(g.tagName);return gt[E.namespaceURI]?E.namespaceURI===Me?g.namespaceURI===ee?k==="svg":g.namespaceURI===re?k==="svg"&&(M==="annotation-xml"||qe[M]):!!Nt[k]:E.namespaceURI===re?g.namespaceURI===ee?k==="math":g.namespaceURI===Me?k==="math"&&Ve[M]:!!Jt[k]:E.namespaceURI===ee?g.namespaceURI===Me&&!Ve[M]||g.namespaceURI===re&&!qe[M]?!1:!Jt[k]&&(Kt[k]||!Nt[k]):!!(st==="application/xhtml+xml"&&gt[E.namespaceURI]):!1},Qe=function(E){$t(v.removed,{element:E});try{B(E).removeChild(E)}catch{O(E)}},bt=function(E,g){try{$t(v.removed,{attribute:g.getAttributeNode(E),from:g})}catch{$t(v.removed,{attribute:null,from:g})}if(g.removeAttribute(E),E==="is"&&!V[E])if(de||he)try{Qe(g)}catch{}else try{g.setAttribute(E,"")}catch{}},en=function(E){let g=null,k=null;if(ye)E="<remove></remove>"+E;else{const q=hs(E,/^[\r\n\t ]+/);k=q&&q[0]}st==="application/xhtml+xml"&&Ee===ee&&(E='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+E+"</body></html>");const M=F?F.createHTML(E):E;if(Ee===ee)try{g=new n().parseFromString(M,st)}catch{}if(!g||!g.documentElement){g=p.createDocument(Ee,"template",null);try{g.documentElement.innerHTML=Ie?H:M}catch{}}const Q=g.body||g.documentElement;return E&&k&&Q.insertBefore(R.createTextNode(k),Q.childNodes[0]||null),Ee===ee?f.call(g,Te?"html":"body")[0]:Te?g.documentElement:Q},tn=function(E){return N.call(E.ownerDocument||E,E,C.SHOW_ELEMENT|C.SHOW_COMMENT|C.SHOW_TEXT|C.SHOW_PROCESSING_INSTRUCTION|C.SHOW_CDATA_SECTION,null)},nn=function(E){return E instanceof r&&(typeof E.nodeName!="string"||typeof E.textContent!="string"||typeof E.removeChild!="function"||!(E.attributes instanceof s)||typeof E.removeAttribute!="function"||typeof E.setAttribute!="function"||typeof E.namespaceURI!="string"||typeof E.insertBefore!="function"||typeof E.hasChildNodes!="function")},xt=function(E){return typeof i=="function"&&E instanceof i},Je=function(E,g,k){A[E]&&ln(A[E],M=>{M.call(v,g,k,Re)})},Lt=function(E){let g=null;if(Je("beforeSanitizeElements",E,null),nn(E))return Qe(E),!0;const k=ge(E.nodeName);if(Je("uponSanitizeElement",E,{tagName:k,allowedTags:G}),E.hasChildNodes()&&!xt(E.firstElementChild)&&Pe(/<[/\w]/g,E.innerHTML)&&Pe(/<[/\w]/g,E.textContent)||E.nodeType===Yt.progressingInstruction||Oe&&E.nodeType===Yt.comment&&Pe(/<[/\w]/g,E.data))return Qe(E),!0;if(!G[k]||Z[k]){if(!Z[k]&&sn(k)&&(U.tagNameCheck instanceof RegExp&&Pe(U.tagNameCheck,k)||U.tagNameCheck instanceof Function&&U.tagNameCheck(k)))return!1;if(xe&&!we[k]){const M=B(E)||E.parentNode,Q=$(E)||E.childNodes;if(Q&&M){const q=Q.length;for(let K=q-1;K>=0;--K){const X=I(Q[K],!0);X.__removalCount=(E.__removalCount||0)+1,M.insertBefore(X,w(E))}}}return Qe(E),!0}return E instanceof y&&!Sn(E)||(k==="noscript"||k==="noembed"||k==="noframes")&&Pe(/<\/no(script|embed|frames)/i,E.innerHTML)?(Qe(E),!0):(fe&&E.nodeType===Yt.text&&(g=E.textContent,ln([S,j,T],M=>{g=zt(g,M," ")}),E.textContent!==g&&($t(v.removed,{element:E.cloneNode()}),E.textContent=g)),Je("afterSanitizeElements",E,null),!1)},Pt=function(E,g,k){if(Se&&(g==="id"||g==="name")&&(k in R||k in Ke))return!1;if(!(se&&!ue[g]&&Pe(_,g))){if(!(ie&&Pe(m,g))){if(!V[g]||ue[g]){if(!(sn(E)&&(U.tagNameCheck instanceof RegExp&&Pe(U.tagNameCheck,E)||U.tagNameCheck instanceof Function&&U.tagNameCheck(E))&&(U.attributeNameCheck instanceof RegExp&&Pe(U.attributeNameCheck,g)||U.attributeNameCheck instanceof Function&&U.attributeNameCheck(g))||g==="is"&&U.allowCustomizedBuiltInElements&&(U.tagNameCheck instanceof RegExp&&Pe(U.tagNameCheck,k)||U.tagNameCheck instanceof Function&&U.tagNameCheck(k))))return!1}else if(!te[g]){if(!Pe(L,zt(k,P,""))){if(!((g==="src"||g==="xlink:href"||g==="href")&&E!=="script"&&qi(k,"data:")===0&&Ae[E])){if(!(le&&!Pe(o,zt(k,P,"")))){if(k)return!1}}}}}}return!0},sn=function(E){return E!=="annotation-xml"&&hs(E,D)},rn=function(E){Je("beforeSanitizeAttributes",E,null);const{attributes:g}=E;if(!g)return;const k={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:V};let M=g.length;for(;M--;){const Q=g[M],{name:q,namespaceURI:K,value:X}=Q,Fe=ge(q);let ve=q==="value"?X:Vi(X);if(k.attrName=Fe,k.attrValue=ve,k.keepAttr=!0,k.forceKeepAttr=void 0,Je("uponSanitizeAttribute",E,k),ve=k.attrValue,k.forceKeepAttr||(bt(q,E),!k.keepAttr))continue;if(!ce&&Pe(/\/>/i,ve)){bt(q,E);continue}fe&&ln([S,j,T],an=>{ve=zt(ve,an," ")});const wt=ge(E.nodeName);if(Pt(wt,Fe,ve)){if(be&&(Fe==="id"||Fe==="name")&&(bt(q,E),ve=je+ve),Oe&&Pe(/((--!?|])>)|<\/(style|title)/i,ve)){bt(q,E);continue}if(F&&typeof l=="object"&&typeof l.getAttributeType=="function"&&!K)switch(l.getAttributeType(wt,Fe)){case"TrustedHTML":{ve=F.createHTML(ve);break}case"TrustedScriptURL":{ve=F.createScriptURL(ve);break}}try{K?E.setAttributeNS(K,q,ve):E.setAttribute(q,ve),nn(E)?Qe(E):fs(v.removed)}catch{}}}Je("afterSanitizeAttributes",E,null)},Cn=function J(E){let g=null;const k=tn(E);for(Je("beforeSanitizeShadowDOM",E,null);g=k.nextNode();)Je("uponSanitizeShadowNode",g,null),!Lt(g)&&(g.content instanceof t&&J(g.content),rn(g));Je("afterSanitizeShadowDOM",E,null)};return v.sanitize=function(J){let E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=null,k=null,M=null,Q=null;if(Ie=!J,Ie&&(J="<!-->"),typeof J!="string"&&!xt(J))if(typeof J.toString=="function"){if(J=J.toString(),typeof J!="string")throw Wt("dirty is not a string, aborting")}else throw Wt("toString is not a function");if(!v.isSupported)return J;if(me||ct(E),v.removed=[],typeof J=="string"&&(ne=!1),ne){if(J.nodeName){const X=ge(J.nodeName);if(!G[X]||Z[X])throw Wt("root node is forbidden and cannot be sanitized in-place")}}else if(J instanceof i)g=en("<!---->"),k=g.ownerDocument.importNode(J,!0),k.nodeType===Yt.element&&k.nodeName==="BODY"||k.nodeName==="HTML"?g=k:g.appendChild(k);else{if(!de&&!fe&&!Te&&J.indexOf("<")===-1)return F&&pe?F.createHTML(J):J;if(g=en(J),!g)return de?null:pe?H:""}g&&ye&&Qe(g.firstChild);const q=tn(ne?J:g);for(;M=q.nextNode();)Lt(M)||(M.content instanceof t&&Cn(M.content),rn(M));if(ne)return J;if(de){if(he)for(Q=h.call(g.ownerDocument);g.firstChild;)Q.appendChild(g.firstChild);else Q=g;return(V.shadowroot||V.shadowrootmode)&&(Q=x.call(c,Q,!0)),Q}let K=Te?g.outerHTML:g.innerHTML;return Te&&G["!doctype"]&&g.ownerDocument&&g.ownerDocument.doctype&&g.ownerDocument.doctype.name&&Pe(Gs,g.ownerDocument.doctype.name)&&(K="<!DOCTYPE "+g.ownerDocument.doctype.name+`>
`+K),fe&&ln([S,j,T],X=>{K=zt(K,X," ")}),F&&pe?F.createHTML(K):K},v.setConfig=function(){let J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ct(J),me=!0},v.clearConfig=function(){Re=null,me=!1},v.isValidAttribute=function(J,E,g){Re||ct({});const k=ge(J),M=ge(E);return Pt(k,M,g)},v.addHook=function(J,E){typeof E=="function"&&(A[J]=A[J]||[],$t(A[J],E))},v.removeHook=function(J){if(A[J])return fs(A[J])},v.removeHooks=function(J){A[J]&&(A[J]=[])},v.removeAllHooks=function(){A={}},v}var Nn=Ys();const it=({onChange:u,initialValue:v})=>{const[R,c]=z.useState(Nn.sanitize(v||"")),e=z.useRef(!1),t=z.useRef(null),[d,i]=z.useState("");z.useEffect(()=>{e.current?c(Nn.sanitize(v||"")):e.current=!0},[v]);const y=(l,b)=>{const I=b.getData(),O=Nn.sanitize(I);c(O),u(O)},C=l=>{if(!t.current){console.warn("Editor not initialized");return}const b=t.current;b.model.change(I=>{const O=b.model.document.selection.getFirstPosition();I.insertText(l,O)}),i("")},s=l=>{C(l.target.value)},r=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],n=["°","+","-","=","~","≥","≤","≠",">","<","*","/","%"];return a.jsxs("div",{children:[a.jsxs(dn,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%"},children:[a.jsx(dr,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),a.jsx(ts,{variant:"standard",sx:{m:1,minWidth:40},children:a.jsxs(pn,{labelId:"math-operators-label",id:"math-operators",value:d,onChange:s,displayEmpty:!0,children:[a.jsx(Et,{value:"",disabled:!0,children:"Math"}),n.map(l=>a.jsx(Et,{value:l,children:l},l))]})}),a.jsx(ts,{variant:"standard",sx:{m:1,minWidth:40},children:a.jsxs(pn,{labelId:"greek-letters-label",id:"greek-letters",value:d,onChange:s,displayEmpty:!0,children:[a.jsx(Et,{value:"",disabled:!0,children:"Greek"}),r.map(l=>a.jsx(Et,{value:l,children:l},l))]})})]}),a.jsx(ur.CKEditor,{editor:fr,data:R,onReady:l=>{t.current=l},config:{toolbar:["undo","redo","|","heading","bold","italic","|","bulletedList","numberedList","blockQuote","indent","outdent","|","link","insertTable","|"],table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]}},onChange:y})]})};var Zn={},ca=mt;Object.defineProperty(Zn,"__esModule",{value:!0});var qs=Zn.default=void 0,da=ca(ht()),ua=a;qs=Zn.default=(0,da.default)((0,ua.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile");var Kn={},fa=mt;Object.defineProperty(Kn,"__esModule",{value:!0});var Vs=Kn.default=void 0,ha=fa(ht()),ma=a;Vs=Kn.default=(0,ha.default)((0,ma.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload");const Ut=({path:u,initialFiles:v,onFilesChange:R,isOwnDesign:c})=>{const[e,t]=z.useState(v.map(x=>({...x,deleted:!!x.deleted}))),[d,i]=z.useState(!1),[y,C]=z.useState(0),[s,r]=z.useState({}),[n,l]=z.useState(!1),[b,I]=z.useState(""),[O,w]=z.useState("info"),$=z.useRef(null);z.useEffect(()=>{console.log("Initial files received:",v),t(v.map(x=>({...x,deleted:!!x.deleted})))},[v]),z.useEffect(()=>()=>{r({})},[]);const B=x=>{console.log("Updating files with",x),R(x),t(x)},F=async x=>{if(!x.target.files)return;const S=Array.from(x.target.files).filter(T=>T.size>5242880?(I("File size should not exceed 5 MB"),w("error"),l(!0),!1):!0);i(!0);const j=S.map(T=>{const _=new Date().getTime(),m=`${_}-${T.name}`,o=It(),P=Dt(o,`${u}/${m}`),D=ys(P,T);return new Promise((L,G)=>{D.on("state_changed",W=>{const V=W.bytesTransferred/W.totalBytes*100;C(V)},W=>{console.error("Upload failed:",W),G(W)},()=>{Ts(D.snapshot.ref).then(W=>{L({id:_.toString(),url:W,name:T.name,path:P.fullPath})})})})});Promise.all(j).then(T=>{const _=[...e.filter(m=>!m.deleted),...T];B(_),I("Files uploaded successfully."),w("success"),l(!0),i(!1),C(0),$.current&&($.current.value="")}).catch(T=>{console.error("Error uploading files: ",T),I("Failed to upload files."),w("error"),l(!0),i(!1),C(0)})},H=x=>{const A=e.map(S=>S.id===x?{...S,deleted:!0}:S);B(A),I("File marked for deletion. Update to permanently delete."),w("info"),l(!0)},p=x=>{r(A=>{var S;return{...A,[x]:((S=e.find(j=>j.id===x))==null?void 0:S.name)||""}}),console.log("editStates after handleEditClick:",s)},N=x=>{t(A=>{const S=A.map(j=>j.id===x&&s[x]!==void 0?{...j,name:s[x]}:j);return R(S),S}),r(A=>{const S={...A};return delete S[x],S}),I("File name updated successfully."),w("info"),l(!0)},h=(x,A)=>{r(S=>({...S,[x]:A}))},f=(x,A)=>{A!=="clickaway"&&l(!1)};return a.jsxs("div",{children:[c&&a.jsx(gn,{title:"Upload Files",children:a.jsxs(Be,{variant:"outlined",component:"label",startIcon:a.jsx(Vs,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",a.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:F,disabled:d,ref:$})]})}),d&&a.jsx("div",{children:a.jsxs("p",{children:["Uploading... ",Math.round(y),"%"]})}),a.jsx(hr,{children:e.map(x=>a.jsxs(mr,{component:"div",disabled:x.deleted,children:[a.jsx(Tr,{children:a.jsx(qs,{})}),typeof s[x.id]=="string"?a.jsx(bn,{variant:"outlined",size:"small",value:s[x.id],onChange:A=>h(x.id,A.target.value),onKeyPress:A=>A.key==="Enter"&&N(x.id),fullWidth:!0}):a.jsx(gr,{primary:x.name,secondary:a.jsx("a",{href:x.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),c&&(typeof s[x.id]=="string"?a.jsx(Xe,{onClick:()=>N(x.id),edge:"end","aria-label":"save",children:a.jsx(Pn,{})}):a.jsxs(a.Fragment,{children:[a.jsx(Xe,{onClick:()=>p(x.id),edge:"end","aria-label":"edit",children:a.jsx(vs,{})}),a.jsx(Xe,{onClick:()=>H(x.id),edge:"end","aria-label":"delete",children:a.jsx(Vt,{})})]}))]},x.id))}),a.jsx(St,{open:n,autoHideDuration:6e3,onClose:f,children:a.jsx(Ct,{onClose:f,severity:O,sx:{width:"100%"},children:b})})]})},ga=({designs:u,setDesigns:v,setIsAdding:R,getDesigns:c,onReturnToDashboard:e})=>{const{userDetails:t}=Xt();console.log("Add Design loaded");const[d,i]=z.useState(""),[y,C]=z.useState(""),[s,r]=z.useState(""),[n,l]=z.useState([]),[b,I]=z.useState([]),O=z.useMemo(()=>n,[n]),[w,$]=z.useState(!1),[B,F]=z.useState(""),[H,p]=z.useState("info"),[N,h]=z.useState(!1),[f,x]=z.useState("");console.log("Adding New Design from user:",t);const A=z.useRef(null),S=()=>{h(!1)},j=(_,m)=>{m!=="clickaway"&&$(!1)};z.useEffect(()=>{if(t!=null&&t.classes){const _=Object.entries(t.classes).filter(([,m])=>m.number!=="Public");C(_.length>0?_[0][0]:"")}},[t==null?void 0:t.classes]);const T=async _=>{var D;if(_.preventDefault(),console.log("Files to be saved:",b),!t||!t.uid){console.error("User object is undefined or missing UID."),x("You must be signed in to add a design."),h(!0);return}if(!d){x("All fields are required."),h(!0);return}await((D=A.current)==null?void 0:D.commitDeletions());const m=n.filter(L=>!L.deleted),o=b.filter(L=>!L.deleted).map(L=>({id:L.id,url:L.url,name:L.name,path:L.path})),P={title:s,description:d,course:y,dateCreated:Qt(),dateModified:Qt(),images:m,files:o,userId:t.uid};try{const L=await zn(Ue(oe,"designs"),P),G={...P,id:L.id};v([...u,G]),F(`${s} has been Added.`),p("success"),$(!0),r(""),i(""),l([]),I([]),setTimeout(()=>{R(!1),c()},1e3)}catch(L){console.log(L),x("There was an issue adding your design."),h(!0)}};return a.jsxs("div",{className:"small-container",children:[a.jsx("button",{onClick:e,className:"muted-button margin-top-20",children:"← All Designs"}),a.jsx("div",{className:"design-record",children:a.jsxs("form",{onSubmit:T,children:[a.jsx("h1",{className:"designHeader",children:"New Design"}),a.jsx("div",{style:{display:"flex",alignItems:"center"},children:a.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[a.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),a.jsx("input",{id:"title",type:"text",name:"title",value:s,onChange:_=>r(_.target.value),style:{width:"100%"}})]})}),a.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),a.jsx(pn,{id:"course",value:y,onChange:_=>C(_.target.value),fullWidth:!0,children:(t!=null&&t.classes?Object.entries(t.classes):[]).filter(([,_])=>_.number!=="Public").map(([_,m])=>a.jsx(Et,{value:_,children:`${m.number} - ${m.title}`},_))}),a.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),a.jsxs("ul",{children:[a.jsx("li",{children:"Objective: What is the goal for this design?"}),a.jsx("li",{children:"Rationale: Why is this new design being done?"}),a.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),a.jsx("li",{children:"Functional Modification: What is being done to this target?"}),a.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),a.jsx(it,{onChange:i,initialValue:d}),a.jsx(Ft,{ref:A,path:"designs/images",initialImages:O,onImagesUpdated:l,onDelete:_=>l(n.filter(m=>!_.includes(m)))}),a.jsx(Ut,{path:"designs/files",initialFiles:b,onFilesChange:I}),a.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[a.jsx(Be,{type:"submit",variant:"contained",sx:{fontSize:"1rem",mt:2,textTransform:"none",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"Add"}),a.jsx(Be,{onClick:()=>R(!1),style:{marginLeft:"12px"},variant:"outlined",sx:{fontSize:"1rem",mt:2,textTransform:"none",color:"currentColor",borderColor:"rgba(255, 0, 0, 0.5)",boxShadow:"none","&:hover":{borderColor:"rgba(255, 0, 0, 0.7)",backgroundColor:"rgba(255, 0, 0, 0.1)",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",color:"currentColor",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out, background-color 0.3s ease-in-out"},children:"Cancel"})]})]})}),a.jsxs(Tt,{open:N,onClose:S,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[a.jsx(Ot,{id:"alert-dialog-title",children:"Notification"}),a.jsx(At,{children:a.jsx(Zt,{id:"alert-dialog-description",children:f})}),a.jsx(kt,{children:a.jsx(Be,{onClick:S,autoFocus:!0,children:"Ok"})})]}),a.jsx(St,{open:w,autoHideDuration:1e3,onClose:j,children:a.jsx(Ct,{onClose:j,severity:H,sx:{width:"100%"},children:B})})]})},pa=({designId:u,setIsAddingBuild:v,refreshBuilds:R})=>{const[c,e]=z.useState(""),[t,d]=z.useState(""),[i,y]=z.useState([]),[C,s]=z.useState([]),{userDetails:r}=Xt(),n=A=>{y(A)},l=A=>{s(A)};console.log("AddBuild loaded");const[b,I]=z.useState(!1),[O,w]=z.useState(""),[$,B]=z.useState(!1),[F,H]=z.useState(""),[p,N]=z.useState("info");console.log("Adding New Build by user:",r);const h=()=>{I(!1)},f=(A,S)=>{S!=="clickaway"&&B(!1)},x=async A=>{if(A.preventDefault(),!r||!r.uid){console.error("UserDetails object is undefined or missing UID."),w("You must be signed in to add a build."),I(!0);return}if(!t){w("Build description is required."),I(!0);return}const S=i.filter(T=>!T.deleted),j=C.filter(T=>!T.deleted).map(T=>({id:T.id,url:T.url,name:T.name,path:T.path}));try{const T=await zn(Ue(oe,"builds"),{title:c,description:t,design_ID:u,dateCreated:Qt(),userId:r.uid,images:S,files:j});console.log("Build added with ID: ",T.id),console.log("Added New Build by user:",r),H("Your build has been successfully added."),N("success"),B(!0),setTimeout(()=>{e(""),d(""),y([]),s([]),v(!1),R()},1e3)}catch(T){if(console.error("Error adding build: ",T),T instanceof Error){let _=`Failed to add the build. ${T.message}`;T.message==="permission-denied"&&(_="You do not have permission to perform this operation."),H(_),N("error"),B(!0)}else H("Failed to add the build. Please try again later."),N("error"),B(!0)}};return a.jsxs("div",{className:"small-container",children:[a.jsxs("form",{onSubmit:x,children:[a.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),a.jsx("input",{id:"buildTitle",type:"text",value:c,onChange:A=>e(A.target.value),style:{width:"100%",marginBottom:"20px"}}),a.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),a.jsx(it,{onChange:d,initialValue:t})," ",a.jsx(Ft,{path:`builds/${u}/images`,initialImages:i,onImagesUpdated:n}),a.jsx(Ut,{path:`builds/${u}/files`,initialFiles:C,onFilesChange:l}),a.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[a.jsx("input",{type:"submit",value:"Save"}),a.jsx("button",{style:{marginLeft:"12px"},onClick:()=>v(!1),className:"button muted-button",children:"Cancel"})]})]}),a.jsxs(Tt,{open:b,onClose:h,children:[a.jsx(Ot,{children:"Notification"}),a.jsx(At,{children:a.jsx(Zt,{children:O})}),a.jsx(kt,{children:a.jsx(Be,{onClick:h,children:"OK"})})]}),a.jsx(St,{open:$,autoHideDuration:6e3,onClose:f,children:a.jsx(Ct,{onClose:f,severity:p,sx:{width:"100%"},children:F})})]})},ba=({designId:u,buildId:v,refreshTests:R,setAddingTestIdForBuild:c})=>{const[e,t]=z.useState(""),[d,i]=z.useState(""),[y,C]=z.useState(""),[s,r]=z.useState(""),[n,l]=z.useState([]),[b,I]=z.useState([]),{userDetails:O}=Xt();console.log("AddTest loaded");const[w,$]=z.useState(!1),[B,F]=z.useState(""),[H,p]=z.useState(!1),[N,h]=z.useState(""),[f,x]=z.useState("info"),A=j=>{I(j)},S=async()=>{if(!d){F("Test description cannot be empty!"),$(!0);return}const j=n.filter(_=>!_.deleted),T=b.filter(_=>!_.deleted).map(_=>({id:_.id,url:_.url,name:_.name,path:_.path}));try{await zn(Ue(oe,"tests"),{title:e,build_ID:v,design_ID:u,dateCreated:Qt(),description:d,results:y,conclusions:s,userId:O==null?void 0:O.uid,images:j,files:T}),setTimeout(()=>{R(v),t(""),i(""),C(""),r(""),l([]),I([]),c(!1)},1e3),h("Test added successfully"),x("success"),p(!0)}catch(_){console.error("Error adding test: ",_),h("Failed to add the test"),x("error"),p(!0)}};return a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),a.jsx("input",{id:"testTitle",type:"text",value:e,onChange:j=>t(j.target.value),style:{width:"100%",marginBottom:"20px"}}),a.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),a.jsx(it,{onChange:i,initialValue:d}),a.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),a.jsx(it,{onChange:C,initialValue:y}),a.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),a.jsx(it,{onChange:r,initialValue:s}),a.jsx(Ft,{path:`tests/${v}/images`,initialImages:n,onImagesUpdated:j=>{l(j)}}),a.jsx(Ut,{path:`tests/${v}/files`,initialFiles:b,onFilesChange:A}),a.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[a.jsx("button",{onClick:S,children:"Save"}),a.jsx("button",{style:{marginLeft:"12px"},onClick:()=>c(!1),className:"button muted-button",children:"Cancel"})]}),a.jsxs(Tt,{open:w,onClose:()=>$(!1),children:[a.jsx(Ot,{children:"Notification"}),a.jsx(At,{children:a.jsx(Zt,{children:B})}),a.jsx(kt,{children:a.jsx(Be,{onClick:()=>$(!1),children:"OK"})})]}),a.jsx(St,{open:H,autoHideDuration:6e3,onClose:()=>p(!1),children:a.jsx(Ct,{onClose:()=>p(!1),severity:f,sx:{width:"100%"},children:N})})]})};var Jn={},xa=mt;Object.defineProperty(Jn,"__esModule",{value:!0});var mn=Jn.default=void 0,va=xa(ht()),ya=a;mn=Jn.default=(0,va.default)((0,ya.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff");const qt=u=>u&&u instanceof $n?u.toDate().toLocaleString():"",Ta=({selectedDesign:u,setIsEditing:v,getDesigns:R,onReturnToDashboard:c})=>{const{userDetails:e,loading:t}=Xt(),d=u.id,i=u.userId===(e==null?void 0:e.uid);console.log("Edit page loaded"),console.log("Design ID:",d),console.log("Editing Design by user:",e);const[y,C]=z.useState(""),[s,r]=z.useState(u.description),[n,l]=z.useState(u.course||""),[b,I]=z.useState(qt(u.dateCreated)),[O,w]=z.useState(qt(u.dateModified)),[$,B]=z.useState([]),[F,H]=z.useState([]),p=z.useRef(null),[N,h]=z.useState(!1),[f,x]=z.useState([]),[A,S]=z.useState({}),[j,T]=z.useState({}),[_,m]=z.useState({}),o=z.useRef(null),[P,D]=z.useState({}),[L,G]=z.useState({}),[W,V]=z.useState({}),[Y,U]=z.useState(!1),[Z,ue]=z.useState({}),[ie,se]=z.useState({}),[le,ce]=z.useState({}),[fe,Oe]=z.useState({}),[Te,me]=z.useState({}),ye=z.useRef(null),[de,he]=z.useState({}),[pe,Se]=z.useState({}),[be,je]=z.useState({}),[xe,ne]=z.useState(!1),[Ce,we]=z.useState(""),[at,Ae]=z.useState(()=>{}),[Ye,te]=z.useState(!1),[ke,re]=z.useState(""),[Me,ee]=z.useState("info"),[Ee,Ie]=z.useState({design:!1,builds:!1,tests:!1}),gt=async g=>{if(g.preventDefault(),!s){we("All fields are required."),ne(!0);return}console.log("About to check image deletions",p.current),console.log(p.current),console.log($.some(q=>q.deleted)),p.current&&$.some(q=>q.deleted)&&(console.log("Committing deletions"),await p.current.commitDeletions());const k=$.filter(q=>!q.deleted);F.some(q=>q.deleted)&&await ot();const M=F.filter(q=>!q.deleted);let Q={title:y,description:s,course:n,dateModified:Qt(),images:k.map(q=>({url:q.url,title:q.title,path:q.path})),files:M.map(q=>({id:q.id,url:q.url,name:q.name,path:q.path})),userId:e.uid};try{await ut(De(oe,"designs",d),Q,{merge:!0}),re("Your design has been updated."),ee("success"),te(!0);const q=$n.now();w(qt(q))}catch(q){console.error("Error updating design:",q),re("There was an issue updating your design."),ee("error"),te(!0)}Ie(q=>({...q,design:!1}))};z.useEffect(()=>{u&&(r(u.description||""),C(u.title||""),l(u.course||""),(async()=>{const k=De(oe,"designs",d),M=await pr(k);if(M.exists()){const Q=M.data();console.log("Fetched images:",Q.images),console.log("Fetched files:",Q.files),B(Q.images||[]),H(Q.files||[]),I(qt(Q.dateCreated)),w(qt(Q.dateModified))}})())},[u,d]);const pt=g=>{const k=$.filter(Q=>!g.some(q=>q.path===Q.path));console.log("Remaining images after deletion:",k),B(k);const M=k.map(Q=>({url:Q.url,title:Q.title,path:Q.path}));ut(De(oe,"designs",d),{images:M},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(Q=>console.error("Failed to update Firestore:",Q))},st=g=>{JSON.stringify($)!==JSON.stringify(g)&&(B(g),console.log("Updated images received:",g))},ot=async()=>{const g=F.filter(k=>k.deleted);if(console.log("Files to delete:",g),g.length>0){const k=It(),M=g.map(Q=>{const q=Dt(k,Q.path);return un(q)});try{await Promise.all(M),console.log("Files deleted successfully");const Q=F.filter(q=>!q.deleted);H(Q),await jn(De(oe,"designs",u.id),{files:Q.map(q=>({id:q.id,url:q.url,name:q.name,path:q.path}))}),re("Deleted files have been permanently removed."),ee("success"),te(!0)}catch(Q){console.error("Failed to delete files: ",Q),re("Failed to delete files."),ee("error"),te(!0)}}},Mt=async g=>{var q,K;try{await Jt(g)}catch(X){console.error("Error deleting files:",X),re("Failed to delete build files."),ee("error"),te(!0)}const k=((q=j[g])==null?void 0:q.filter(X=>!X.deleted).map(({url:X,path:Fe,title:ve})=>({url:X,path:Fe,title:ve})))||[],M=((K=_[g])==null?void 0:K.filter(X=>!X.deleted).map(X=>({id:X.id,url:X.url,name:X.name,path:X.path})))||[],Q={};k.length>0&&(Q.images=k),M.length>0&&(Q.files=M),A[g]!==void 0&&(Q.description=A[g]);try{const X=De(oe,"builds",g);await ut(X,Q,{merge:!0}),re("Your build has been updated."),ee("success"),te(!0),We(),Ie(Fe=>({...Fe,builds:!1}))}catch(X){console.error("Error updating build:",X),re("Failed to update build."),ee("error"),te(!0)}},ge=(g,k)=>{G(M=>({...M,[g]:k}))},Re=(g,k)=>{S(M=>({...M,[g]:k})),Ie(M=>({...M,builds:!0}))},Ke=async g=>{const k=L[g];try{const M=De(oe,"builds",g);await ut(M,{title:k},{merge:!0}),G(Q=>{const q={...Q};return delete q[g],q}),We()}catch(M){console.error("Failed to save build title:",M)}},We=async()=>{if(!e){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",e==null?void 0:e.uid),console.log("Selected design ID for query:",u==null?void 0:u.id);let g;e.isAdmin?g=$e(Ue(oe,"builds"),_e("design_ID","==",d),nt("dateCreated")):g=$e(Ue(oe,"builds"),_e("design_ID","==",d),_e("userId","==",e.uid),nt("dateCreated")),console.log("Builds query details:",JSON.stringify(g,null,2));const k=await ft(g);console.log("Builds snapshot details:",JSON.stringify(k.docs.map(Q=>Q.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",k.docs.length);const M=k.docs.map(Q=>(console.log("Build doc path: ",Q.ref.path),{id:Q.id,...Q.data()}));x(M),console.log("New builds state after refresh:",M)}catch(g){console.error("Error refreshing builds:",g),g.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",g):console.error("An unexpected error occurred when trying to refresh builds:",g)}},ct=(g,k)=>{const M=De(oe,"builds",g),Q=j[g].filter(K=>!k.some(X=>X.path===K.path));T(K=>({...K,[g]:Q}));const q=Q.map(K=>({url:K.url,title:K.title,path:K.path}));ut(M,{images:q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),re("Build Image deletions updated."),ee("success")}).catch(K=>{console.error("Failed to update build images in Firestore:",K),re("Failed to update build image deletions."),ee("error")}),te(!0)},qe=async g=>{const k=$e(Ue(oe,"tests"),_e("build_ID","==",g),_e("userId","==",e.uid)),M=await ft(k);for(const Q of M.docs)await Rt(De(oe,"tests",Q.id));await Rt(De(oe,"builds",g)),await We(),re("Build and its tests (if any) deleted successfully."),ee("success"),te(!0)},Ve=g=>{we("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),Ae(()=>()=>qe(g)),ne(!0)},Kt=(g,k)=>{T(M=>({...M,[g]:k}))},Nt=(g,k)=>{m(M=>({...M,[g]:k}))},Jt=async g=>{var M;const k=((M=_[g])==null?void 0:M.filter(Q=>Q.deleted))||[];if(console.log("Build files to delete:",k),k.length>0){const Q=It(),q=k.map(K=>{const X=Dt(Q,K.path);return un(X)});try{await Promise.all(q),console.log("Build files deleted successfully");const K=_[g].filter(X=>!X.deleted);m(X=>({...X,[g]:K})),await jn(De(oe,"builds",g),{files:K.map(X=>({id:X.id,url:X.url,name:X.name,path:X.path}))}),console.log("Firestore successfully updated to remove deleted files"),re("Deleted build files have been permanently removed."),ee("success"),te(!0)}catch(K){console.error("Failed to delete build files: ",K),re("Failed to delete build files."),ee("error"),te(!0)}}},Sn=async(g,k)=>{var K;try{await sn(g)}catch(X){console.error("Error deleting files:",X),re("Failed to delete build files."),ee("error"),te(!0)}const M={},Q=fe[g].filter(X=>!X.deleted).map(({url:X,path:Fe,title:ve})=>({url:X,path:Fe,title:ve})),q=((K=Te[g])==null?void 0:K.filter(X=>!X.deleted).map(X=>({id:X.id,url:X.url,name:X.name,path:X.path})))||[];Z[g]!==void 0&&(M.description=Z[g]),ie[g]!==void 0&&(M.results=ie[g]),le[g]!==void 0&&(M.conclusions=le[g]),M.images=Q,M.files=q;try{const X=De(oe,"tests",g);await ut(X,M,{merge:!0}),re("Your test has been updated."),ee("success"),te(!0),xt(k)}catch(X){console.error(`Error updating test ID: ${g}:`,X),re("There was an issue updating your test."),ee("error"),te(!0)}},Qe=(g,k)=>{Se(M=>({...M,[g]:k}))},bt=async(g,k)=>{const M=pe[g],Q=De(oe,"tests",g);await ut(Q,{title:M},{merge:!0}),Se(q=>{const K={...q};return delete K[g],K}),xt(k)},en=(g,k)=>{console.log(`Updating description for test ID ${g}:`,k),ue(M=>({...M,[g]:k})),Ie(M=>({...M,tests:!0}))},tn=(g,k)=>{console.log(`Updating results for test ID ${g}:`,k),se(M=>({...M,[g]:k})),Ie(M=>({...M,tests:!0}))},nn=(g,k)=>{ce(M=>({...M,[g]:k})),Ie(M=>({...M,tests:!0}))};z.useEffect(()=>{!t&&e&&(async()=>{if(!e)return;let k;e.isAdmin?k=$e(Ue(oe,"builds"),_e("design_ID","==",d),nt("dateCreated")):k=$e(Ue(oe,"builds"),_e("design_ID","==",d),_e("userId","==",e.uid),nt("dateCreated"));const M=await ft(k);let Q=[],q={},K={};for(const X of M.docs){const Fe=X.data(),ve=X.id;Q.push({id:ve,...Fe,images:Fe.images||[],files:Fe.files||[]}),K[ve]=!0;let wt;e.isAdmin?wt=$e(Ue(oe,"tests"),_e("build_ID","==",ve),nt("dateCreated")):wt=$e(Ue(oe,"tests"),_e("build_ID","==",ve),_e("userId","==",e.uid),nt("dateCreated"));const an=await ft(wt);let es=[],wn={},_n={};for(const dt of an.docs){const lt=dt.data();es.push({id:dt.id,...lt}),wn[dt.id]=lt.images||[],_n[dt.id]=lt.files||[]}q[ve]=es,Oe(dt=>{let lt={...dt};for(const Bt in wn)lt[Bt]=wn[Bt];return lt}),me(dt=>{let lt={...dt};for(const Bt in _n)lt[Bt]=_n[Bt];return lt})}x(Q),V(q),je(K)})()},[t,e,u.id,d]);const xt=async g=>{if(!e){console.log("User details not loaded yet");return}try{let k;e.isAdmin?k=$e(Ue(oe,"tests"),_e("build_ID","==",g),nt("dateCreated")):k=$e(Ue(oe,"tests"),_e("build_ID","==",g),_e("userId","==",e.uid),nt("dateCreated"));const Q=(await ft(k)).docs.map(X=>({id:X.id,...X.data(),images:X.data().images||[],files:X.data().files||[]}));V(X=>({...X,[g]:Q}));let q={},K={};Q.forEach(X=>{q[X.id]=X.images,K[X.id]=X.files}),Oe(q),me(K)}catch(k){console.error("Error fetching tests:",k)}},Je=(g,k)=>{const M=De(oe,"tests",g),Q=fe[g].filter(K=>!k.includes(K));Oe(K=>({...K,[g]:Q}));const q=Q.map(({url:K,path:X,title:Fe})=>({url:K,path:X,title:Fe}));ut(M,{images:q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),re("Test Image deletions updated."),ee("success")}).catch(K=>{console.error("Failed to update test images in Firestore:",K),re("Failed to update test image deletions."),ee("error")}),te(!0)},Lt=(g,k)=>{Oe(M=>({...M,[g]:k}))},Pt=(g,k)=>{me(M=>({...M,[g]:k}))},sn=async g=>{var M;const k=((M=Te[g])==null?void 0:M.filter(Q=>Q.deleted))||[];if(k.length>0){const Q=It(),q=k.map(K=>{const X=Dt(Q,K.path);return un(X)});try{await Promise.all(q);const K=Te[g].filter(X=>!X.deleted);me(X=>({...X,[g]:K})),await jn(De(oe,"tests",g),{files:K.map(X=>({id:X.id,url:X.url,name:X.name,path:X.path}))}),re("Deleted test files have been permanently removed."),ee("success"),te(!0)}catch(K){console.error("Failed to delete test files: ",K),re("Failed to delete test files."),ee("error"),te(!0)}}},rn=async(g,k)=>{await Rt(De(oe,"tests",g)),await xt(k),re("Test deleted successfully."),ee("success"),te(!0)},Cn=(g,k)=>{we("Are you sure you want to delete this test? This action cannot be undone."),Ae(()=>()=>rn(g,k)),ne(!0)},J=g=>{je(k=>({...k,[g]:!k[g]}))},E=()=>{const g=Object.entries(Ee).filter(([M,Q])=>Q).map(([M])=>M).join(", ");if(!g.length){c();return}const k=`You have unsaved changes in the following sections: ${g}. Are you sure you want to leave?`;we(k),Ae(()=>()=>{Ie({design:!1,builds:!1,tests:!1}),c()}),ne(!0)};return z.useEffect(()=>{const g=k=>{Object.values(Ee).some(Q=>Q)&&(k.preventDefault(),k.returnValue="")};return window.addEventListener("beforeunload",g),()=>window.removeEventListener("beforeunload",g)},[Ee]),a.jsxs("div",{className:"small-container",children:[a.jsx("button",{onClick:()=>{Object.values(Ee).some(k=>k)?E():c()},className:"muted-button margin-top-20",children:"← All Designs"}),a.jsx("div",{className:"design-record",children:a.jsxs("form",{onSubmit:gt,children:[a.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),a.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[a.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[a.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),a.jsx("input",{id:"title",type:"text",name:"title",value:y,onChange:g=>{C(g.target.value),Ie(k=>({...k,design:!0}))},style:{width:"100%"}})]}),a.jsxs("div",{style:{flexGrow:2},children:[a.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),a.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:b||"",readOnly:!0,style:{width:"100%"}})]}),a.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[a.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),a.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:O||"",readOnly:!0,style:{width:"100%"}})]})]}),a.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),a.jsx(pn,{id:"course",value:n,onChange:g=>{l(g.target.value),Ie(k=>({...k,design:!0}))},fullWidth:!0,children:a.jsx(Et,{value:n,children:n})}),a.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),a.jsxs("ul",{children:[a.jsx("li",{children:"Objective: What is the goal for this design?"}),a.jsx("li",{children:"Rationale: Why is this new design being done?"}),a.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),a.jsx("li",{children:"Functional Modification: What is being done to this target?"}),a.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),a.jsx(it,{initialValue:s,onChange:g=>{r(g),Ie(k=>({...k,design:!0}))}}),a.jsx(Ft,{ref:p,path:`designs/${u.id}/images`,initialImages:$,onImagesUpdated:st,onDelete:pt,isOwnDesign:i}),a.jsx(Ut,{path:`designs/${u.id}/files`,initialFiles:F,onFilesChange:H,isOwnDesign:i}),i&&a.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[a.jsx("input",{type:"submit",value:"Update"}),a.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>v(!1),children:"Cancel"})]})]})}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex-space-between",children:[a.jsx("h2",{className:"buildsHeader",children:"Builds"}),i&&a.jsxs("button",{className:"button muted-button",onClick:()=>{h(!0),setTimeout(()=>{o.current&&o.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[a.jsx("span",{role:"img","aria-label":"Add Build",children:"➕"})," Build"]})]}),f.map((g,k)=>a.jsxs("div",{className:"build-record",children:[a.jsxs("div",{className:"flex-space-between align-items-center",children:[a.jsx("div",{children:L[g.id]!==void 0?a.jsx(bn,{variant:"outlined",size:"small",fullWidth:!0,value:L[g.id],onChange:M=>ge(g.id,M.target.value),onBlur:()=>Ke(g.id),autoFocus:!0,InputProps:{endAdornment:a.jsx(Xe,{onClick:()=>Ke(g.id),size:"small",children:a.jsx(Pn,{})})}}):a.jsx("div",{className:"buildTitle",onClick:()=>G(M=>({...M,[g.id]:g.title||`Build ${k+1}`})),style:{cursor:"pointer"},children:g.title||`Build ${k+1}`})}),a.jsxs("div",{children:[a.jsx("button",{onClick:()=>D(M=>({...M,[g.id]:!M[g.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:P[g.id]?a.jsx(mn,{}):a.jsx(In,{})}),i&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Ve(g.id),children:a.jsx(Vt,{})}),a.jsxs("button",{className:"button muted-button",onClick:()=>{U(g.id),setTimeout(()=>{ye.current&&ye.current.scrollIntoView({behavior:"smooth"})},100)},children:[a.jsx("span",{role:"img","aria-label":"Add Test",children:"➕"})," Test"]})]})]})]}),P[g.id]&&a.jsxs(a.Fragment,{children:[a.jsx(it,{initialValue:A[g.id]||g.description,onChange:M=>{Re(g.id,M)}}),a.jsx(Ft,{path:`builds/${g.id}/images`,initialImages:g.images,onImagesUpdated:M=>Kt(g.id,M),onDelete:M=>ct(g.id,M),isOwnDesign:i}),a.jsx(Ut,{path:`builds/${g.id}/files`,initialFiles:g.files,onFilesChange:M=>Nt(g.id,M),isOwnDesign:i}),i&&a.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:a.jsx("button",{onClick:()=>Mt(g.id),children:"Update"})}),a.jsx("div",{children:W[g.id]&&W[g.id].length>0&&a.jsx("button",{onClick:()=>J(g.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:be[g.id]?a.jsxs(a.Fragment,{children:[a.jsx(In,{style:{marginRight:"8px"}}),"Tests"]}):a.jsxs(a.Fragment,{children:[a.jsx(mn,{style:{marginRight:"8px"}}),"Tests"]})})}),!be[g.id]&&W[g.id]&&W[g.id].map((M,Q)=>a.jsxs("div",{className:"test-record",children:[a.jsxs("div",{className:"flex-space-between align-items-center",children:[a.jsx("div",{children:pe[M.id]!==void 0?a.jsx(bn,{variant:"outlined",size:"small",fullWidth:!0,value:pe[M.id],onChange:q=>Qe(M.id,q.target.value),onBlur:()=>bt(M.id,g.id),autoFocus:!0,InputProps:{endAdornment:a.jsx(Xe,{onClick:()=>bt(M.id,g.id),size:"small",children:a.jsx(Pn,{})})}}):a.jsx("div",{className:"testTitle",onClick:()=>Se(q=>({...q,[M.id]:M.title||`Test ${Q+1}`})),style:{cursor:"pointer"},children:M.title||`Test ${Q+1}`})}),a.jsxs("div",{children:[a.jsx("button",{onClick:()=>he(q=>({...q,[M.id]:!q[M.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:de[M.id]?a.jsx(mn,{}):a.jsx(In,{})}),i&&a.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Cn(M.id,g.id),children:a.jsx(Vt,{})})]})]}),de[M.id]&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",children:"Description"}),a.jsx(it,{initialValue:Z[M.id]||M.description,onChange:q=>{en(M.id,q)}})]}),a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",children:"Results"}),a.jsx(it,{initialValue:ie[M.id]||M.results,onChange:q=>{tn(M.id,q)}})]}),a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",children:"Conclusions"}),a.jsx(it,{initialValue:le[M.id]||M.conclusions,onChange:q=>{nn(M.id,q)}})]}),a.jsxs("div",{children:[a.jsx(Ft,{path:`tests/${M.id}/images`,initialImages:fe[M.id]||[],onImagesUpdated:q=>Lt(M.id,q),onDelete:q=>Je(M.id,q),isOwnDesign:i}),a.jsx(Ut,{path:`tests/${M.id}/files`,initialFiles:Te[M.id]||[],onFilesChange:q=>Pt(M.id,q),isOwnDesign:i})]}),i&&a.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:a.jsx("button",{onClick:()=>Sn(M.id,g.id),children:"Update"})})]})]},M.id))]}),Y===g.id&&a.jsxs("div",{className:"new-test-record",ref:ye,children:[a.jsx("h3",{className:"newTestHeader",children:"New Test"}),a.jsx(ba,{designId:u.id,buildId:g.id,refreshTests:()=>xt(g.id),setAddingTestIdForBuild:U,onImagesUpdated:M=>Lt(g.id,M),onFilesChange:M=>Pt(g.id,M)})]})]},g.id)),a.jsx("div",{children:N&&a.jsxs("div",{className:"new-build-record",ref:o,children:[a.jsx("h3",{className:"newBuildHeader",children:"New Build"}),a.jsx(pa,{designId:u.id,setIsAddingBuild:h,refreshBuilds:We,onImagesUpdated:g=>Kt(build.id,g),onFilesChange:g=>Nt(build.id,g)})]})})]}),a.jsxs(Tt,{open:xe,onClose:()=>ne(!1),children:[a.jsx(Ot,{children:"Confirmation Required"}),a.jsx(At,{children:a.jsx(Zt,{children:Ce})}),a.jsxs(kt,{children:[a.jsx(Be,{onClick:()=>ne(!1),children:"Cancel"}),a.jsx(Be,{onClick:()=>{at(),ne(!1)},autoFocus:!0,children:"Confirm"})]})]}),a.jsx(St,{open:Ye,autoHideDuration:6e3,onClose:()=>te(!1),children:a.jsx(Ct,{onClose:()=>te(!1),severity:Me,sx:{width:"100%"},children:ke})})]})},Aa=()=>{const{userDetails:u,loading:v}=Xt();console.log("Dashboard loaded");const[R,c]=z.useState([]),[e,t]=z.useState([]),[d,i]=z.useState([]),[y,C]=z.useState(null),[s,r]=z.useState(!1),[n,l]=z.useState(!1),[b,I]=z.useState(!1),[O,w]=z.useState(""),[$,B]=z.useState(""),[F,H]=z.useState(!1),[p,N]=z.useState(null),[h,f]=z.useState(!1),[x,A]=z.useState(""),[S,j]=z.useState("info"),T=()=>{l(!1),r(!1),C(null),_()},_=z.useCallback(async()=>{if(!u)return;let D;const L=[],G=[],W=[];if(u.isSuperAdmin)D=$e(Ue(oe,"designs"),nt("dateCreated","desc"));else if(u.isAdmin){const Y=u.classes?Object.keys(u.classes):[];if(Y.length>0)D=$e(Ue(oe,"designs"),_e("course","in",Y),nt("dateCreated","desc"));else{t([]),i([]);return}}else D=$e(Ue(oe,"designs"),_e("userId","==",u.uid),nt("dateCreated","desc"));(await ft(D)).forEach(Y=>{const U=Y.data(),Z={id:Y.id,title:U.title,description:U.description,course:U.course,dateCreated:U.dateCreated,dateModified:U.dateModified,userId:U.userId,images:U.images||[],files:U.files||[]};u.isSuperAdmin?U.userId===u.uid?L.push(Z):U.userId!==u.uid&&U.course&&U.isAdmin?G.push(Z):U.userId!==u.uid&&!U.isAdmin&&W.push(Z):u.isAdmin?U.userId===u.uid?G.push(Z):W.push(Z):U.userId===u.uid&&W.push(Z)}),c(L),t(G),i(W)},[u,oe]);z.useEffect(()=>{!v&&u&&_()},[u,v,_]);const m=D=>{const L=[...R,...e,...d].find(G=>G.id===D);C(L||null),l(!0)},o=D=>{N(D),w("Are you sure you want to delete this design? This action cannot be undone."),I(!0)},P=async()=>{if(p)if($!==(u==null?void 0:u.uid))A("User ID confirmation failed. Enter the correct User ID."),j("error"),f(!0);else try{const D=$e(Ue(oe,"builds"),_e("design_ID","==",p),_e("userId","==",u.uid)),L=await ft(D);for(const G of L.docs){const W=G.id,V=$e(Ue(oe,"tests"),_e("build_ID","==",W),_e("userId","==",u.uid)),Y=await ft(V);for(const U of Y.docs)await Rt(De(oe,"tests",U.id));await Rt(De(oe,"builds",W))}await Rt(De(oe,"designs",p)),c(G=>G.filter(W=>W.id!==p)),t(G=>G.filter(W=>W.id!==p)),i(G=>G.filter(W=>W.id!==p)),A("Your design and its associated builds and tests have been deleted."),j("success"),f(!0)}catch(D){console.error("Error deleting design, builds, and tests: ",D),A("There was an issue deleting your design and its associated builds and tests."),j("error"),f(!0)}finally{B(""),H(!1),N(null)}};return a.jsxs("div",{className:"container",children:[!s&&!n&&a.jsxs(a.Fragment,{children:[a.jsx(Ar,{setIsAdding:r}),(u==null?void 0:u.isSuperAdmin)&&a.jsxs(a.Fragment,{children:[a.jsx("h2",{children:"Super Admin Designs"}),a.jsx(_t,{designs:R,handleEdit:m,handleDelete:o,isAdmin:!0,userDetails:u,showUserIdColumn:!0}),a.jsx("h2",{children:"Educator Designs"}),a.jsx(_t,{designs:e,handleEdit:m,handleDelete:o,isAdmin:!0,userDetails:u,showUserIdColumn:!0}),a.jsx("h2",{children:"Student Designs"}),a.jsx(_t,{designs:d,handleEdit:m,handleDelete:o,isAdmin:!1,userDetails:u,showUserIdColumn:!0})]}),(u==null?void 0:u.isAdmin)&&!u.isSuperAdmin&&a.jsxs(a.Fragment,{children:[a.jsx("h2",{children:"Educator Designs"}),a.jsx(_t,{designs:e,handleEdit:m,handleDelete:o,isAdmin:!0,userDetails:u,showUserIdColumn:!0}),a.jsx("h2",{children:"Student Designs"}),a.jsx(_t,{designs:d,handleEdit:m,handleDelete:o,isAdmin:!1,userDetails:u,showUserIdColumn:!0})]}),!(u!=null&&u.isAdmin)&&!(u!=null&&u.isSuperAdmin)&&a.jsxs(a.Fragment,{children:[a.jsx("h2",{children:"Student Designs"}),a.jsx(_t,{designs:d,handleEdit:m,handleDelete:o,isAdmin:!1,userDetails:u,showUserIdColumn:!1})]})]}),s&&a.jsx(ga,{designs:R.concat(e),setDesigns:t,setIsAdding:r,getDesigns:_,onReturnToDashboard:T}),n&&a.jsx(Ta,{designs:R.concat(e),selectedDesign:y,setDesigns:t,setIsEditing:l,getDesigns:_,onReturnToDashboard:T}),a.jsxs(Tt,{open:b,onClose:()=>I(!1),PaperProps:{style:{minWidth:500}},children:[a.jsx(Ot,{children:"Confirm Deletion"}),a.jsx(At,{children:a.jsx(Zt,{children:O})}),a.jsxs(kt,{children:[a.jsx(Be,{onClick:()=>I(!1),children:"No, cancel"}),a.jsx(Be,{onClick:()=>{H(!0),I(!1)},color:"primary",children:"Yes, delete it"})]})]}),a.jsxs(Tt,{open:F,onClose:()=>H(!1),PaperProps:{style:{minWidth:500}},children:[a.jsx(Ot,{children:"Confirm Your User ID"}),a.jsx(At,{children:a.jsx(bn,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:$,onChange:D=>B(D.target.value)})}),a.jsxs(kt,{children:[a.jsx(Be,{onClick:()=>H(!1),children:"No, cancel"}),a.jsx(Be,{onClick:P,color:"primary",children:"Confirm"})]})]}),a.jsx(St,{open:h,autoHideDuration:6e3,onClose:()=>f(!1),children:a.jsx(Ct,{onClose:()=>f(!1),severity:S,sx:{width:"100%"},children:x})})]})},wa=br.memo(Aa);export{wa as default};
