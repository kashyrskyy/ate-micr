import{H as M,j as e,B as l,p as x,T as a,ax as A,Y as _,ag as q,Z as O,ah as z,ai as Q,ao as Y,av as ie,aq as le,af as E,e as o,ar as B,at as H,as as k,al as L,ay as te,az as ae,G as b,aA as S,Q as c,R as F,U as w,t as ne,A as re}from"./index-D91JtvJk.js";import{d as D}from"./Visibility-CXzVCxcZ.js";const de=()=>{const i=M(),r=()=>{i("/")};return e.jsxs(l,{children:[e.jsx(l,{className:"supplemental-header",children:e.jsx(x,{variant:"text",onClick:r,className:"supplemental-back-button",children:"â† Home Page"})}),e.jsx(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:e.jsx(a,{className:"supplemental-title",children:"Course Materials"})})]})},oe=()=>{const i=M();return e.jsx(x,{className:"add-material-button",variant:"contained",color:"primary",onClick:()=>i("/add-material"),children:"+ Add Material"})},ce=({materialId:i,open:r,onClose:t,onDelete:d})=>{const h=A(),n=async()=>{const u=Y(h,"materials",i);await ie(u),d(),t()};return e.jsxs(_,{open:r,onClose:t,children:[e.jsx(q,{children:"Delete Material"}),e.jsx(O,{children:e.jsx(z,{children:"Are you sure you want to delete this material? This action cannot be undone."})}),e.jsxs(Q,{children:[e.jsx(x,{onClick:t,color:"primary",children:"Cancel"}),e.jsx(x,{onClick:n,color:"secondary",children:"Delete"})]})]})},G=({materialId:i,onClick:r})=>e.jsx(x,{variant:"contained",color:"error",onClick:()=>r(i),sx:{backgroundColor:"#FFCDD2",color:"#C62828",borderRadius:"15px",fontWeight:"bold",padding:"4px 8px",ml:1,textTransform:"none"},children:"Unpublish"}),xe=({materialId:i,open:r,onClose:t,onUnpublish:d})=>{const h=A(),n=async()=>{const u=Y(h,"materials",i);await le(u,{published:!1}),d(),t()};return e.jsxs(_,{open:r,onClose:t,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(q,{id:"alert-dialog-title",children:"Unpublish Material"}),e.jsx(O,{children:e.jsx(z,{id:"alert-dialog-description",children:"Are you sure you want to unpublish this material? It will no longer be visible to users until it is published again."})}),e.jsxs(Q,{children:[e.jsx(x,{onClick:t,color:"primary",children:"Cancel"}),e.jsx(x,{onClick:n,color:"error",autoFocus:!0,children:"Unpublish"})]})]})},he=({selectedCourse:i,onCourseChange:r})=>{const{userDetails:t}=E(),[d,h]=o.useState([]);return o.useEffect(()=>{if(t!=null&&t.classes){const n=Object.entries(t.classes).map(([u,j])=>({id:u,number:j.number,title:j.title}));h(n)}else h([])},[t]),e.jsx(l,{sx:{display:"flex",gap:2,mb:2},children:d.length>0?d.map(n=>e.jsxs(x,{variant:i===n.id?"contained":"outlined",onClick:()=>r(n.id),children:[n.number," - ",n.title]},n.id)):e.jsx(x,{variant:"outlined",disabled:!0,children:"No Courses Available"})})},ue=()=>{const{userDetails:i}=E(),r=A(),[t,d]=o.useState([]),[h,n]=o.useState(!0),[u,j]=o.useState(!1),[m,Z]=o.useState(null),[f,U]=o.useState(null),[g,I]=o.useState({open:!1,materialId:null}),[R,C]=o.useState(null),p=M();o.useEffect(()=>{if(!i)return;n(!0);const s=i.isAdmin?B(L(r,"materials"),k("course","==",m),H("timestamp","desc")):B(L(r,"materials"),k("course","==",m),k("published","==",!0),H("timestamp","desc")),ee=te(s,v=>{const se=v.docs.map($=>({id:$.id,...$.data()}));d(se),n(!1)},v=>{console.error(v),C("Failed to fetch materials"),n(!1)});return()=>ee()},[r,i,m]);const y=s=>{U(s),j(!0)},J=()=>{j(!1),U(null)},K=()=>{d(t.filter(s=>s.id!==f))},N=s=>{I({open:!0,materialId:s})},V=()=>{d(t.map(s=>s.id===g.materialId?{...s,published:!1}:s))},X=()=>{I({open:!1,materialId:null})};if(h)return e.jsx(ae,{});const T=t.filter(s=>!s.published&&!s.scheduledTimestamp),W=t.filter(s=>s.scheduledTimestamp&&!s.published),P=t.filter(s=>s.published);return e.jsxs(l,{sx:{width:"100%"},children:[e.jsx(he,{selectedCourse:m||"",onCourseChange:s=>{n(!0),Z(s)}}),(i==null?void 0:i.isAdmin)&&e.jsxs(e.Fragment,{children:[e.jsx(l,{sx:{backgroundColor:"#FFF9C4",borderRadius:"8px",padding:"4px 8px",display:"inline-block",mb:2},children:e.jsx(a,{variant:"h6",sx:{fontWeight:"bold",color:"#F57C00"},children:"Saved"})}),e.jsx(b,{container:!0,spacing:3,children:T.length===0?e.jsx(a,{variant:"body1",align:"center",sx:{width:"100%"},children:"No saved (unpublished) materials found."}):T.map(s=>e.jsx(b,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(l,{sx:{border:"1px solid #ddd",borderRadius:"8px",padding:2,position:"relative",backgroundColor:"#FFF9C4"},children:[e.jsx(l,{children:s.author===(i==null?void 0:i.uid)&&e.jsx(S,{label:"My Material",variant:"outlined",sx:{borderRadius:"15px",fontWeight:"bold",background:"#C5E1A5",color:"#2E7D32",ml:1}})}),e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(c,{onClick:()=>p(`/view-material/${s.id}`),"aria-label":"view",children:e.jsx(D,{})}),e.jsx(a,{variant:"h6",children:s.title||"Untitled"})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(a,{variant:"body2",color:"textSecondary",children:["Created Date: ",s.timestamp.toDate().toLocaleString()]}),e.jsx(a,{variant:"body2",color:"textSecondary",children:"Status: Saved"})]}),e.jsx(l,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1},children:(i==null?void 0:i.isAdmin)&&e.jsxs(e.Fragment,{children:[e.jsx(c,{onClick:()=>p(`/edit-material/${s.id}`),"aria-label":"edit",children:e.jsx(F,{})}),e.jsx(c,{onClick:()=>y(s.id),"aria-label":"delete",children:e.jsx(w,{})})]})})]})},s.id))}),e.jsx(l,{sx:{backgroundColor:"#E3F2FD",borderRadius:"8px",padding:"4px 8px",display:"inline-block",mt:4,mb:2},children:e.jsx(a,{variant:"h6",sx:{fontWeight:"bold",color:"#0D47A1"},children:"Publish Scheduled"})}),e.jsx(b,{container:!0,spacing:3,children:W.length===0?e.jsx(a,{variant:"body1",align:"center",sx:{width:"100%"},children:"No materials scheduled for publishing found."}):W.map(s=>e.jsx(b,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(l,{sx:{border:"1px solid #ddd",borderRadius:"8px",padding:2,position:"relative",backgroundColor:"#E3F2FD"},children:[e.jsx(l,{children:s.author===(i==null?void 0:i.uid)&&e.jsx(S,{label:"My Material",variant:"outlined",sx:{borderRadius:"15px",fontWeight:"bold",background:"#C5E1A5",color:"#2E7D32",ml:1}})}),e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(c,{onClick:()=>p(`/view-material/${s.id}`),"aria-label":"view",children:e.jsx(D,{})}),e.jsx(a,{variant:"h6",children:s.title||"Untitled"})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(a,{variant:"body2",color:"textSecondary",children:["Created Date: ",s.timestamp.toDate().toLocaleString()]}),e.jsx(a,{variant:"body2",color:"textSecondary",children:"Status: Scheduled for Publishing"})]}),s.scheduledTimestamp&&e.jsx(l,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(l,{sx:{backgroundColor:"#E3F2FD",border:"1px solid #90CAF9",borderRadius:"16px",padding:"4px 8px"},children:e.jsxs(a,{variant:"body2",sx:{color:"#0D47A1",fontWeight:"bold"},children:["Publish Date: ",s.scheduledTimestamp.toDate().toLocaleString()]})})}),e.jsx(l,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1},children:(i==null?void 0:i.isAdmin)&&e.jsxs(e.Fragment,{children:[e.jsx(c,{onClick:()=>p(`/edit-material/${s.id}`),"aria-label":"edit",children:e.jsx(F,{})}),e.jsx(c,{onClick:()=>y(s.id),"aria-label":"delete",children:e.jsx(w,{})}),e.jsx(G,{materialId:s.id,onClick:N})]})})]})},s.id))})]}),e.jsx(l,{sx:{backgroundColor:"#E8F5E9",borderRadius:"8px",padding:"4px 8px",display:"inline-block",mt:4,mb:2},children:e.jsx(a,{variant:"h6",sx:{fontWeight:"bold",color:"#2E7D32"},children:"Published"})}),e.jsx(b,{container:!0,spacing:3,children:P.length===0?e.jsx(a,{variant:"body1",align:"center",sx:{width:"100%"},children:"No published materials found."}):P.map(s=>e.jsx(b,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(l,{sx:{border:"1px solid #ddd",borderRadius:"8px",padding:2,position:"relative",backgroundColor:"#E8F5E9"},children:[e.jsx(l,{children:s.author===(i==null?void 0:i.uid)&&e.jsx(S,{label:"My Material",variant:"outlined",sx:{borderRadius:"15px",fontWeight:"bold",background:"#C5E1A5",color:"#2E7D32",ml:1}})}),e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(c,{onClick:()=>p(`/view-material/${s.id}`),"aria-label":"view",children:e.jsx(D,{})}),e.jsx(a,{variant:"h6",sx:{flexGrow:1,maxWidth:"50%",wordWrap:"break-word"},children:s.title||"Untitled"})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(a,{variant:"body2",color:"textSecondary",children:["Date: ",s.timestamp.toDate().toLocaleString()]}),e.jsx(a,{variant:"body2",color:"textSecondary",children:"Status: Published"})]}),e.jsx(l,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1},children:(i==null?void 0:i.isAdmin)&&e.jsxs(e.Fragment,{children:[e.jsx(c,{onClick:()=>p(`/edit-material/${s.id}`),"aria-label":"edit",children:e.jsx(F,{})}),e.jsx(c,{onClick:()=>y(s.id),"aria-label":"delete",children:e.jsx(w,{})}),e.jsx(G,{materialId:s.id,onClick:N})]})})]})},s.id))}),f&&e.jsx(ce,{materialId:f,open:u,onClose:J,onDelete:K}),g.materialId&&e.jsx(xe,{materialId:g.materialId,open:g.open,onClose:X,onUnpublish:V}),R&&e.jsx(ne,{open:!0,autoHideDuration:6e3,onClose:()=>C(null),children:e.jsx(re,{onClose:()=>C(null),severity:"error",children:R})})]})},je=()=>{const{userDetails:i}=E();return e.jsxs(l,{className:"supplemental-container",children:[e.jsx(de,{}),e.jsxs(l,{className:"supplemental-content",children:[(i==null?void 0:i.isAdmin)&&e.jsx(oe,{}),e.jsx(ue,{})]})]})};export{je as default};
