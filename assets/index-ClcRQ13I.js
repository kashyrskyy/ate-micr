import{s as Xs,_ as Ln,e as $,u as Ks,f as Zs,E as Js,j as a,h as er,i as tr,H as nr,I as sr,B as dn,p as Be,T as rr,J as ir,P as ar,K as or,M as lr,N as En,O as Le,Q as cr,q as gn,R as Xe,U as ys,V as Xt,W as zn,X as on,Y as dr,k as ht,l as mt,Z as Tt,$ as At,t as St,A as wt,a0 as Dt,a1 as Rt,a2 as Ts,a3 as As,a4 as un,a5 as ur,a6 as ts,a7 as pn,a8 as jt,a9 as fr,aa as hr,ab as mr,ac as gr,ad as bn,ae as pr,af as Pn,ag as Zt,ah as kt,ai as Jt,aj as Mt,ak as Kt,al as $n,am as Fe,an as oe,ao as ut,ap as De,aq as br,ar as jn,as as ze,at as _e,au as rt,av as ft,aw as Ft,ax as xr}from"./index-Dz8-YLrt.js";import{d as In}from"./Visibility-BYBnYIPv.js";const vr=["className"],yr=u=>{const{alignItems:v,classes:R}=u;return tr({root:["root",v==="flex-start"&&"alignItemsFlexStart"]},nr,R)},Tr=Xs("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(u,v)=>{const{ownerState:R}=u;return[v.root,R.alignItems==="flex-start"&&v.alignItemsFlexStart]}})(({theme:u,ownerState:v})=>Ln({minWidth:56,color:(u.vars||u).palette.action.active,flexShrink:0,display:"inline-flex"},v.alignItems==="flex-start"&&{marginTop:8})),Ar=$.forwardRef(function(v,R){const c=Ks({props:v,name:"MuiListItemIcon"}),{className:e}=c,t=Zs(c,vr),d=$.useContext(Js),i=Ln({},c,{alignItems:d.alignItems}),y=yr(i);return a.jsx(Tr,Ln({className:er(y.root,e),ownerState:i,ref:R},t))}),Sr=$.memo(({setIsAdding:u})=>{console.log("Header loaded");const v=sr(),R=()=>{v("/")};return a.jsxs(dn,{className:"lab-notebook-container",children:[a.jsx(dn,{sx:{display:"flex",alignItems:"center"},children:a.jsx(Be,{variant:"text",onClick:R,className:"back-home-button",children:"← Home Page"})}),a.jsx(rr,{className:"webpage_title",children:"My Laboratory Notebook"}),a.jsx(dn,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:a.jsx(Be,{className:"create-new-button",variant:"contained",color:"primary",onClick:()=>u(!0),children:"+ Create New"})})]})}),Et=({designs:u,handleEdit:v,handleDelete:R,isAdmin:c,userDetails:e,showUserIdColumn:t})=>{const d=i=>i?i instanceof zn?i.toDate().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):i instanceof Date?i.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A":"N/A";return a.jsx(ir,{component:ar,children:a.jsxs(or,{sx:{"& .MuiTableCell-root":{fontSize:"1rem"},"& .MuiTableCell-head":{fontSize:"1.2rem",backgroundColor:"#1A76D3",color:"white"}},children:[a.jsx(lr,{children:a.jsxs(En,{sx:{height:"60px"},children:[a.jsx(Le,{sx:{fontWeight:"bold",width:t?"30%":"40%"},children:"Title"}),a.jsx(Le,{sx:{fontWeight:"bold",width:"20%"},children:"Course"}),t&&a.jsx(Le,{sx:{fontWeight:"bold",width:"20%"},children:"User ID"}),a.jsx(Le,{sx:{fontWeight:"bold",width:"15%"},children:"Created"}),a.jsx(Le,{sx:{fontWeight:"bold",width:"15%"},children:"Last Edited"}),a.jsx(Le,{sx:{fontWeight:"bold",width:"10%"},children:"Edit"}),a.jsx(Le,{sx:{fontWeight:"bold",width:"10%"},children:"Delete"})]})}),a.jsx(cr,{children:u&&u.length>0?u.map(i=>{const y=i.userId===(e==null?void 0:e.uid);return a.jsxs(En,{sx:{height:"80px"},children:[a.jsx(Le,{children:a.jsx("button",{onClick:()=>v(i.id),className:"hyperlink-style",children:i.title})}),a.jsx(Le,{children:i.course&&(e!=null&&e.classes)&&e.classes[i.course]?`${e.classes[i.course].number} - ${e.classes[i.course].title}`:"N/A"}),t&&a.jsx(Le,{children:i.userId}),a.jsx(Le,{children:d(i.dateCreated)}),a.jsx(Le,{children:d(i.dateModified)}),a.jsx(Le,{children:a.jsx(gn,{title:"Edit",children:a.jsx("span",{children:a.jsx(Xe,{onClick:()=>y&&v(i.id),color:"primary",disabled:!y,children:a.jsx(ys,{})})})})}),a.jsx(Le,{children:a.jsx(gn,{title:"Delete",children:a.jsx("span",{children:a.jsx(Xe,{onClick:()=>y&&R(i.id),color:"error",disabled:!y,children:a.jsx(Xt,{})})})})})]},i.id)}):a.jsx(En,{children:a.jsx(Le,{colSpan:t?6:5,children:"No Designs Found"})})})]})})};function wr(u,v){return v.forEach(function(R){R&&typeof R!="string"&&!Array.isArray(R)&&Object.keys(R).forEach(function(c){if(c!=="default"&&!(c in u)){var e=Object.getOwnPropertyDescriptor(R,c);Object.defineProperty(u,c,e.get?e:{enumerable:!0,get:function(){return R[c]}})}})}),Object.freeze(u)}function Ss(u,v){return new Promise(function(R,c){let e;return Cr(u).then(function(t){try{return e=t,R(new Blob([v.slice(0,2),e,v.slice(2)],{type:"image/jpeg"}))}catch(d){return c(d)}},c)})}const Cr=u=>new Promise((v,R)=>{const c=new FileReader;c.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let d=0;if(t.getUint16(d)!==65496)return R("not a valid JPEG");for(d+=2;;){const i=t.getUint16(d);if(i===65498)break;const y=t.getUint16(d+2);if(i===65505&&t.getUint32(d+4)===1165519206){const w=d+10;let s;switch(t.getUint16(w)){case 18761:s=!0;break;case 19789:s=!1;break;default:return R("TIFF header contains invalid endian")}if(t.getUint16(w+2,s)!==42)return R("TIFF header contains invalid version");const r=t.getUint32(w+4,s),n=w+r+2+12*t.getUint16(w+r,s);for(let l=w+r+2;l<n;l+=12)if(t.getUint16(l,s)==274){if(t.getUint16(l+2,s)!==3)return R("Orientation data type is invalid");if(t.getUint32(l+4,s)!==1)return R("Orientation data count is invalid");t.setUint16(l+8,1,s);break}return v(e.slice(d,d+2+y))}d+=2+y}return v(new Blob)}),c.readAsArrayBuffer(u)});var xn={},_r={get exports(){return xn},set exports(u){xn=u}};(function(u){var v,R,c={};_r.exports=c,c.parse=function(e,t){for(var d=c.bin.readUshort,i=c.bin.readUint,y=0,w={},s=new Uint8Array(e),r=s.length-4;i(s,r)!=101010256;)r--;y=r,y+=4;var n=d(s,y+=4);d(s,y+=2);var l=i(s,y+=2),b=i(s,y+=4);y+=4,y=b;for(var I=0;I<n;I++){i(s,y),y+=4,y+=4,y+=4,i(s,y+=4),l=i(s,y+=4);var U=i(s,y+=4),C=d(s,y+=4),z=d(s,y+2),B=d(s,y+4);y+=6;var F=i(s,y+=8);y+=4,y+=C+z+B,c._readLocal(s,F,w,l,U,t)}return w},c._readLocal=function(e,t,d,i,y,w){var s=c.bin.readUshort,r=c.bin.readUint;r(e,t),s(e,t+=4),s(e,t+=2);var n=s(e,t+=2);r(e,t+=2),r(e,t+=4),t+=4;var l=s(e,t+=8),b=s(e,t+=2);t+=2;var I=c.bin.readUTF8(e,t,l);if(t+=l,t+=b,w)d[I]={size:y,csize:i};else{var U=new Uint8Array(e.buffer,t);if(n==0)d[I]=new Uint8Array(U.buffer.slice(t,t+i));else{if(n!=8)throw"unknown compression method: "+n;var C=new Uint8Array(y);c.inflateRaw(U,C),d[I]=C}}},c.inflateRaw=function(e,t){return c.F.inflate(e,t)},c.inflate=function(e,t){return e[0],e[1],c.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},c.deflate=function(e,t){t==null&&(t={level:6});var d=0,i=new Uint8Array(50+Math.floor(1.1*e.length));i[d]=120,i[d+1]=156,d+=2,d=c.F.deflateRaw(e,i,d,t.level);var y=c.adler(e,0,e.length);return i[d+0]=y>>>24&255,i[d+1]=y>>>16&255,i[d+2]=y>>>8&255,i[d+3]=y>>>0&255,new Uint8Array(i.buffer,0,d+4)},c.deflateRaw=function(e,t){t==null&&(t={level:6});var d=new Uint8Array(50+Math.floor(1.1*e.length)),i=c.F.deflateRaw(e,d,i,t.level);return new Uint8Array(d.buffer,0,i)},c.encode=function(e,t){t==null&&(t=!1);var d=0,i=c.bin.writeUint,y=c.bin.writeUshort,w={};for(var s in e){var r=!c._noNeed(s)&&!t,n=e[s],l=c.crc.crc(n,0,n.length);w[s]={cpr:r,usize:n.length,crc:l,file:r?c.deflateRaw(n):n}}for(var s in w)d+=w[s].file.length+30+46+2*c.bin.sizeUTF8(s);d+=22;var b=new Uint8Array(d),I=0,U=[];for(var s in w){var C=w[s];U.push(I),I=c._writeHeader(b,I,s,C,0)}var z=0,B=I;for(var s in w)C=w[s],U.push(I),I=c._writeHeader(b,I,s,C,1,U[z++]);var F=I-B;return i(b,I,101010256),I+=4,y(b,I+=4,z),y(b,I+=2,z),i(b,I+=2,F),i(b,I+=4,B),I+=4,I+=2,b.buffer},c._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},c._writeHeader=function(e,t,d,i,y,w){var s=c.bin.writeUint,r=c.bin.writeUshort,n=i.file;return s(e,t,y==0?67324752:33639248),t+=4,y==1&&(t+=2),r(e,t,20),r(e,t+=2,0),r(e,t+=2,i.cpr?8:0),s(e,t+=2,0),s(e,t+=4,i.crc),s(e,t+=4,n.length),s(e,t+=4,i.usize),r(e,t+=4,c.bin.sizeUTF8(d)),r(e,t+=2,0),t+=2,y==1&&(t+=2,t+=2,s(e,t+=6,w),t+=4),t+=c.bin.writeUTF8(e,t,d),y==0&&(e.set(n,t),t+=n.length),t},c.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var d=t,i=0;i<8;i++)1&d?d=3988292384^d>>>1:d>>>=1;e[t]=d}return e}(),update:function(e,t,d,i){for(var y=0;y<i;y++)e=c.crc.table[255&(e^t[d+y])]^e>>>8;return e},crc:function(e,t,d){return 4294967295^c.crc.update(4294967295,e,t,d)}},c.adler=function(e,t,d){for(var i=1,y=0,w=t,s=t+d;w<s;){for(var r=Math.min(w+5552,s);w<r;)y+=i+=e[w++];i%=65521,y%=65521}return y<<16|i},c.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255,e[t+2]=d>>16&255,e[t+3]=d>>24&255},readASCII:function(e,t,d){for(var i="",y=0;y<d;y++)i+=String.fromCharCode(e[t+y]);return i},writeASCII:function(e,t,d){for(var i=0;i<d.length;i++)e[t+i]=d.charCodeAt(i)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,d){for(var i,y="",w=0;w<d;w++)y+="%"+c.bin.pad(e[t+w].toString(16));try{i=decodeURIComponent(y)}catch{return c.bin.readASCII(e,t,d)}return i},writeUTF8:function(e,t,d){for(var i=d.length,y=0,w=0;w<i;w++){var s=d.charCodeAt(w);if(!(4294967168&s))e[t+y]=s,y++;else if(!(4294965248&s))e[t+y]=192|s>>6,e[t+y+1]=128|s>>0&63,y+=2;else if(!(4294901760&s))e[t+y]=224|s>>12,e[t+y+1]=128|s>>6&63,e[t+y+2]=128|s>>0&63,y+=3;else{if(4292870144&s)throw"e";e[t+y]=240|s>>18,e[t+y+1]=128|s>>12&63,e[t+y+2]=128|s>>6&63,e[t+y+3]=128|s>>0&63,y+=4}}return y},sizeUTF8:function(e){for(var t=e.length,d=0,i=0;i<t;i++){var y=e.charCodeAt(i);if(!(4294967168&y))d++;else if(!(4294965248&y))d+=2;else if(!(4294901760&y))d+=3;else{if(4292870144&y)throw"e";d+=4}}return d}},c.F={},c.F.deflateRaw=function(e,t,d,i){var y=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][i],w=c.F.U,s=c.F._goodIndex;c.F._hash;var r=c.F._putsE,n=0,l=d<<3,b=0,I=e.length;if(i==0){for(;n<I;)r(t,l,n+(T=Math.min(65535,I-n))==I?1:0),l=c.F._copyExact(e,n,T,t,l+8),n+=T;return l>>>3}var U=w.lits,C=w.strt,z=w.prev,B=0,F=0,H=0,p=0,N=0,h=0;for(I>2&&(C[h=c.F._hash(e,0)]=0),n=0;n<I;n++){if(N=h,n+1<I-2){h=c.F._hash(e,n+1);var f=n+1&32767;z[f]=C[h],C[h]=f}if(b<=n){(B>14e3||F>26697)&&I-n>100&&(b<n&&(U[B]=n-b,B+=2,b=n),l=c.F._writeBlock(n==I-1||b==I?1:0,U,B,p,e,H,n-H,t,l),B=F=p=0,H=n);var x=0;n<I-2&&(x=c.F._bestMatch(e,n,z,N,Math.min(y[2],I-n),y[3]));var T=x>>>16,S=65535&x;if(x!=0){S=65535&x;var j=s(T=x>>>16,w.of0);w.lhst[257+j]++;var A=s(S,w.df0);w.dhst[A]++,p+=w.exb[j]+w.dxb[A],U[B]=T<<23|n-b,U[B+1]=S<<16|j<<8|A,B+=2,b=n+T}else w.lhst[e[n]]++;F++}}for(H==n&&e.length!=0||(b<n&&(U[B]=n-b,B+=2,b=n),l=c.F._writeBlock(1,U,B,p,e,H,n-H,t,l),B=0,F=0,B=F=p=0,H=n);7&l;)l++;return l>>>3},c.F._bestMatch=function(e,t,d,i,y,w){var s=32767&t,r=d[s],n=s-r+32768&32767;if(r==s||i!=c.F._hash(e,t-n))return 0;for(var l=0,b=0,I=Math.min(32767,t);n<=I&&--w!=0&&r!=s;){if(l==0||e[t+l]==e[t+l-n]){var U=c.F._howLong(e,t,n);if(U>l){if(b=n,(l=U)>=y)break;n+2<U&&(U=n+2);for(var C=0,z=0;z<U-2;z++){var B=t-n+z+32768&32767,F=B-d[B]+32768&32767;F>C&&(C=F,r=B)}}}n+=(s=r)-(r=d[s])+32768&32767}return l<<16|b},c.F._howLong=function(e,t,d){if(e[t]!=e[t-d]||e[t+1]!=e[t+1-d]||e[t+2]!=e[t+2-d])return 0;var i=t,y=Math.min(e.length,t+258);for(t+=3;t<y&&e[t]==e[t-d];)t++;return t-i},c.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},c.saved=0,c.F._writeBlock=function(e,t,d,i,y,w,s,r,n){var l,b,I,U,C,z,B,F,H,p=c.F.U,N=c.F._putsF,h=c.F._putsE;p.lhst[256]++,b=(l=c.F.getTrees())[0],I=l[1],U=l[2],C=l[3],z=l[4],B=l[5],F=l[6],H=l[7];var f=32+(n+3&7?8-(n+3&7):0)+(s<<3),x=i+c.F.contSize(p.fltree,p.lhst)+c.F.contSize(p.fdtree,p.dhst),T=i+c.F.contSize(p.ltree,p.lhst)+c.F.contSize(p.dtree,p.dhst);T+=14+3*B+c.F.contSize(p.itree,p.ihst)+(2*p.ihst[16]+3*p.ihst[17]+7*p.ihst[18]);for(var S=0;S<286;S++)p.lhst[S]=0;for(S=0;S<30;S++)p.dhst[S]=0;for(S=0;S<19;S++)p.ihst[S]=0;var j=f<x&&f<T?0:x<T?1:2;if(N(r,n,e),N(r,n+1,j),n+=3,j==0){for(;7&n;)n++;n=c.F._copyExact(y,w,s,r,n)}else{var A,_;if(j==1&&(A=p.fltree,_=p.fdtree),j==2){c.F.makeCodes(p.ltree,b),c.F.revCodes(p.ltree,b),c.F.makeCodes(p.dtree,I),c.F.revCodes(p.dtree,I),c.F.makeCodes(p.itree,U),c.F.revCodes(p.itree,U),A=p.ltree,_=p.dtree,h(r,n,C-257),h(r,n+=5,z-1),h(r,n+=5,B-4),n+=4;for(var m=0;m<B;m++)h(r,n+3*m,p.itree[1+(p.ordr[m]<<1)]);n+=3*B,n=c.F._codeTiny(F,p.itree,r,n),n=c.F._codeTiny(H,p.itree,r,n)}for(var o=w,P=0;P<d;P+=2){for(var D=t[P],L=D>>>23,G=o+(8388607&D);o<G;)n=c.F._writeLit(y[o++],A,r,n);if(L!=0){var W=t[P+1],V=W>>16,Y=W>>8&255,O=255&W;h(r,n=c.F._writeLit(257+Y,A,r,n),L-p.of0[Y]),n+=p.exb[Y],N(r,n=c.F._writeLit(O,_,r,n),V-p.df0[O]),n+=p.dxb[O],o+=L}}n=c.F._writeLit(256,A,r,n)}return n},c.F._copyExact=function(e,t,d,i,y){var w=y>>>3;return i[w]=d,i[w+1]=d>>>8,i[w+2]=255-i[w],i[w+3]=255-i[w+1],w+=4,i.set(new Uint8Array(e.buffer,t,d),w),y+(d+4<<3)},c.F.getTrees=function(){for(var e=c.F.U,t=c.F._hufTree(e.lhst,e.ltree,15),d=c.F._hufTree(e.dhst,e.dtree,15),i=[],y=c.F._lenCodes(e.ltree,i),w=[],s=c.F._lenCodes(e.dtree,w),r=0;r<i.length;r+=2)e.ihst[i[r]]++;for(r=0;r<w.length;r+=2)e.ihst[w[r]]++;for(var n=c.F._hufTree(e.ihst,e.itree,7),l=19;l>4&&e.itree[1+(e.ordr[l-1]<<1)]==0;)l--;return[t,d,n,y,s,l,i,w]},c.F.getSecond=function(e){for(var t=[],d=0;d<e.length;d+=2)t.push(e[d+1]);return t},c.F.nonZero=function(e){for(var t="",d=0;d<e.length;d+=2)e[d+1]!=0&&(t+=(d>>1)+",");return t},c.F.contSize=function(e,t){for(var d=0,i=0;i<t.length;i++)d+=t[i]*e[1+(i<<1)];return d},c.F._codeTiny=function(e,t,d,i){for(var y=0;y<e.length;y+=2){var w=e[y],s=e[y+1];i=c.F._writeLit(w,t,d,i);var r=w==16?2:w==17?3:7;w>15&&(c.F._putsE(d,i,s,r),i+=r)}return i},c.F._lenCodes=function(e,t){for(var d=e.length;d!=2&&e[d-1]==0;)d-=2;for(var i=0;i<d;i+=2){var y=e[i+1],w=i+3<d?e[i+3]:-1,s=i+5<d?e[i+5]:-1,r=i==0?-1:e[i-1];if(y==0&&w==y&&s==y){for(var n=i+5;n+2<d&&e[n+2]==y;)n+=2;(l=Math.min(n+1-i>>>1,138))<11?t.push(17,l-3):t.push(18,l-11),i+=2*l-2}else if(y==r&&w==y&&s==y){for(n=i+5;n+2<d&&e[n+2]==y;)n+=2;var l=Math.min(n+1-i>>>1,6);t.push(16,l-3),i+=2*l-2}else t.push(y,0)}return d>>>1},c.F._hufTree=function(e,t,d){var i=[],y=e.length,w=t.length,s=0;for(s=0;s<w;s+=2)t[s]=0,t[s+1]=0;for(s=0;s<y;s++)e[s]!=0&&i.push({lit:s,f:e[s]});var r=i.length,n=i.slice(0);if(r==0)return 0;if(r==1){var l=i[0].lit;return n=l==0?1:0,t[1+(l<<1)]=1,t[1+(n<<1)]=1,1}i.sort(function(F,H){return F.f-H.f});var b=i[0],I=i[1],U=0,C=1,z=2;for(i[0]={lit:-1,f:b.f+I.f,l:b,r:I,d:0};C!=r-1;)b=U!=C&&(z==r||i[U].f<i[z].f)?i[U++]:i[z++],I=U!=C&&(z==r||i[U].f<i[z].f)?i[U++]:i[z++],i[C++]={lit:-1,f:b.f+I.f,l:b,r:I};var B=c.F.setDepth(i[C-1],0);for(B>d&&(c.F.restrictDepth(n,d,B),B=d),s=0;s<r;s++)t[1+(n[s].lit<<1)]=n[s].d;return B},c.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(c.F.setDepth(e.l,t+1),c.F.setDepth(e.r,t+1))},c.F.restrictDepth=function(e,t,d){var i=0,y=1<<d-t,w=0;for(e.sort(function(r,n){return n.d==r.d?r.f-n.f:n.d-r.d}),i=0;i<e.length&&e[i].d>t;i++){var s=e[i].d;e[i].d=t,w+=y-(1<<d-s)}for(w>>>=d-t;w>0;)(s=e[i].d)<t?(e[i].d++,w-=1<<t-s-1):i++;for(;i>=0;i--)e[i].d==t&&w<0&&(e[i].d--,w++);w!=0&&console.log("debt left")},c.F._goodIndex=function(e,t){var d=0;return t[16|d]<=e&&(d|=16),t[8|d]<=e&&(d|=8),t[4|d]<=e&&(d|=4),t[2|d]<=e&&(d|=2),t[1|d]<=e&&(d|=1),d},c.F._writeLit=function(e,t,d,i){return c.F._putsF(d,i,t[e<<1]),i+t[1+(e<<1)]},c.F.inflate=function(e,t){var d=Uint8Array;if(e[0]==3&&e[1]==0)return t||new d(0);var i=c.F,y=i._bitsF,w=i._bitsE,s=i._decodeTiny,r=i.makeCodes,n=i.codes2map,l=i._get17,b=i.U,I=t==null;I&&(t=new d(e.length>>>2<<3));for(var U,C,z=0,B=0,F=0,H=0,p=0,N=0,h=0,f=0,x=0;z==0;)if(z=y(e,x,1),B=y(e,x+1,2),x+=3,B!=0){if(I&&(t=c.F._check(t,f+(1<<17))),B==1&&(U=b.flmap,C=b.fdmap,N=511,h=31),B==2){F=w(e,x,5)+257,H=w(e,x+5,5)+1,p=w(e,x+10,4)+4,x+=14;for(var T=0;T<38;T+=2)b.itree[T]=0,b.itree[T+1]=0;var S=1;for(T=0;T<p;T++){var j=w(e,x+3*T,3);b.itree[1+(b.ordr[T]<<1)]=j,j>S&&(S=j)}x+=3*p,r(b.itree,S),n(b.itree,S,b.imap),U=b.lmap,C=b.dmap,x=s(b.imap,(1<<S)-1,F+H,e,x,b.ttree);var A=i._copyOut(b.ttree,0,F,b.ltree);N=(1<<A)-1;var _=i._copyOut(b.ttree,F,H,b.dtree);h=(1<<_)-1,r(b.ltree,A),n(b.ltree,A,U),r(b.dtree,_),n(b.dtree,_,C)}for(;;){var m=U[l(e,x)&N];x+=15&m;var o=m>>>4;if(!(o>>>8))t[f++]=o;else{if(o==256)break;var P=f+o-254;if(o>264){var D=b.ldef[o-257];P=f+(D>>>3)+w(e,x,7&D),x+=7&D}var L=C[l(e,x)&h];x+=15&L;var G=L>>>4,W=b.ddef[G],V=(W>>>4)+y(e,x,15&W);for(x+=15&W,I&&(t=c.F._check(t,f+(1<<17)));f<P;)t[f]=t[f++-V],t[f]=t[f++-V],t[f]=t[f++-V],t[f]=t[f++-V];f=P}}}else{7&x&&(x+=8-(7&x));var Y=4+(x>>>3),O=e[Y-4]|e[Y-3]<<8;I&&(t=c.F._check(t,f+O)),t.set(new d(e.buffer,e.byteOffset+Y,O),f),x=Y+O<<3,f+=O}return t.length==f?t:t.slice(0,f)},c.F._check=function(e,t){var d=e.length;if(t<=d)return e;var i=new Uint8Array(Math.max(d<<1,t));return i.set(e,0),i},c.F._decodeTiny=function(e,t,d,i,y,w){for(var s=c.F._bitsE,r=c.F._get17,n=0;n<d;){var l=e[r(i,y)&t];y+=15&l;var b=l>>>4;if(b<=15)w[n]=b,n++;else{var I=0,U=0;b==16?(U=3+s(i,y,2),y+=2,I=w[n-1]):b==17?(U=3+s(i,y,3),y+=3):b==18&&(U=11+s(i,y,7),y+=7);for(var C=n+U;n<C;)w[n]=I,n++}}return y},c.F._copyOut=function(e,t,d,i){for(var y=0,w=0,s=i.length>>>1;w<d;){var r=e[w+t];i[w<<1]=0,i[1+(w<<1)]=r,r>y&&(y=r),w++}for(;w<s;)i[w<<1]=0,i[1+(w<<1)]=0,w++;return y},c.F.makeCodes=function(e,t){for(var d,i,y,w,s=c.F.U,r=e.length,n=s.bl_count,l=0;l<=t;l++)n[l]=0;for(l=1;l<r;l+=2)n[e[l]]++;var b=s.next_code;for(d=0,n[0]=0,i=1;i<=t;i++)d=d+n[i-1]<<1,b[i]=d;for(y=0;y<r;y+=2)(w=e[y+1])!=0&&(e[y]=b[w],b[w]++)},c.F.codes2map=function(e,t,d){for(var i=e.length,y=c.F.U.rev15,w=0;w<i;w+=2)if(e[w+1]!=0)for(var s=w>>1,r=e[w+1],n=s<<4|r,l=t-r,b=e[w]<<l,I=b+(1<<l);b!=I;)d[y[b]>>>15-t]=n,b++},c.F.revCodes=function(e,t){for(var d=c.F.U.rev15,i=15-t,y=0;y<e.length;y+=2){var w=e[y]<<t-e[y+1];e[y]=d[w]>>>i}},c.F._putsE=function(e,t,d){d<<=7&t;var i=t>>>3;e[i]|=d,e[i+1]|=d>>>8},c.F._putsF=function(e,t,d){d<<=7&t;var i=t>>>3;e[i]|=d,e[i+1]|=d>>>8,e[i+2]|=d>>>16},c.F._bitsE=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<d)-1},c.F._bitsF=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<d)-1},c.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},c.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},c.F.U=(v=Uint16Array,R=Uint32Array,{next_code:new v(16),bl_count:new v(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new v(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new R(32),flmap:new v(512),fltree:[],fdmap:new v(32),fdtree:[],lmap:new v(32768),ltree:[],ttree:[],dmap:new v(32768),dtree:[],imap:new v(512),itree:[],rev15:new v(32768),lhst:new R(286),dhst:new R(30),ihst:new R(19),lits:new R(15e3),strt:new v(65536),prev:new v(32768)}),function(){for(var e=c.F.U,t=0;t<32768;t++){var d=t;d=(4278255360&(d=(4042322160&(d=(3435973836&(d=(2863311530&d)>>>1|(1431655765&d)<<1))>>>2|(858993459&d)<<2))>>>4|(252645135&d)<<4))>>>8|(16711935&d)<<8,e.rev15[t]=(d>>>16|d<<16)>>>17}function i(y,w,s){for(;w--!=0;)y.push(0,s)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];i(e.fltree,144,8),i(e.fltree,112,9),i(e.fltree,24,7),i(e.fltree,8,8),c.F.makeCodes(e.fltree,9),c.F.codes2map(e.fltree,9,e.flmap),c.F.revCodes(e.fltree,9),i(e.fdtree,32,5),c.F.makeCodes(e.fdtree,5),c.F.codes2map(e.fdtree,5,e.fdmap),c.F.revCodes(e.fdtree,5),i(e.itree,19,0),i(e.ltree,286,0),i(e.dtree,30,0),i(e.ttree,320,0)}()})();var Er=wr({__proto__:null,default:xn},[xn]);const nt=function(){var u={nextZero(s,r){for(;s[r]!=0;)r++;return r},readUshort:(s,r)=>s[r]<<8|s[r+1],writeUshort(s,r,n){s[r]=n>>8&255,s[r+1]=255&n},readUint:(s,r)=>16777216*s[r]+(s[r+1]<<16|s[r+2]<<8|s[r+3]),writeUint(s,r,n){s[r]=n>>24&255,s[r+1]=n>>16&255,s[r+2]=n>>8&255,s[r+3]=255&n},readASCII(s,r,n){let l="";for(let b=0;b<n;b++)l+=String.fromCharCode(s[r+b]);return l},writeASCII(s,r,n){for(let l=0;l<n.length;l++)s[r+l]=n.charCodeAt(l)},readBytes(s,r,n){const l=[];for(let b=0;b<n;b++)l.push(s[r+b]);return l},pad:s=>s.length<2?`0${s}`:s,readUTF8(s,r,n){let l,b="";for(let I=0;I<n;I++)b+=`%${u.pad(s[r+I].toString(16))}`;try{l=decodeURIComponent(b)}catch{return u.readASCII(s,r,n)}return l}};function v(s,r,n,l){const b=r*n,I=t(l),U=Math.ceil(r*I/8),C=new Uint8Array(4*b),z=new Uint32Array(C.buffer),{ctype:B}=l,{depth:F}=l,H=u.readUshort;if(B==6){const D=b<<2;if(F==8)for(var p=0;p<D;p+=4)C[p]=s[p],C[p+1]=s[p+1],C[p+2]=s[p+2],C[p+3]=s[p+3];if(F==16)for(p=0;p<D;p++)C[p]=s[p<<1]}else if(B==2){const D=l.tabs.tRNS;if(D==null){if(F==8)for(p=0;p<b;p++){var N=3*p;z[p]=255<<24|s[N+2]<<16|s[N+1]<<8|s[N]}if(F==16)for(p=0;p<b;p++)N=6*p,z[p]=255<<24|s[N+4]<<16|s[N+2]<<8|s[N]}else{var h=D[0];const L=D[1],G=D[2];if(F==8)for(p=0;p<b;p++){var f=p<<2;N=3*p,z[p]=255<<24|s[N+2]<<16|s[N+1]<<8|s[N],s[N]==h&&s[N+1]==L&&s[N+2]==G&&(C[f+3]=0)}if(F==16)for(p=0;p<b;p++)f=p<<2,N=6*p,z[p]=255<<24|s[N+4]<<16|s[N+2]<<8|s[N],H(s,N)==h&&H(s,N+2)==L&&H(s,N+4)==G&&(C[f+3]=0)}}else if(B==3){const D=l.tabs.PLTE,L=l.tabs.tRNS,G=L?L.length:0;if(F==1)for(var x=0;x<n;x++){var T=x*U,S=x*r;for(p=0;p<r;p++){f=S+p<<2;var j=3*(A=s[T+(p>>3)]>>7-((7&p)<<0)&1);C[f]=D[j],C[f+1]=D[j+1],C[f+2]=D[j+2],C[f+3]=A<G?L[A]:255}}if(F==2)for(x=0;x<n;x++)for(T=x*U,S=x*r,p=0;p<r;p++)f=S+p<<2,j=3*(A=s[T+(p>>2)]>>6-((3&p)<<1)&3),C[f]=D[j],C[f+1]=D[j+1],C[f+2]=D[j+2],C[f+3]=A<G?L[A]:255;if(F==4)for(x=0;x<n;x++)for(T=x*U,S=x*r,p=0;p<r;p++)f=S+p<<2,j=3*(A=s[T+(p>>1)]>>4-((1&p)<<2)&15),C[f]=D[j],C[f+1]=D[j+1],C[f+2]=D[j+2],C[f+3]=A<G?L[A]:255;if(F==8)for(p=0;p<b;p++){var A;f=p<<2,j=3*(A=s[p]),C[f]=D[j],C[f+1]=D[j+1],C[f+2]=D[j+2],C[f+3]=A<G?L[A]:255}}else if(B==4){if(F==8)for(p=0;p<b;p++){f=p<<2;var _=s[m=p<<1];C[f]=_,C[f+1]=_,C[f+2]=_,C[f+3]=s[m+1]}if(F==16)for(p=0;p<b;p++){var m;f=p<<2,_=s[m=p<<2],C[f]=_,C[f+1]=_,C[f+2]=_,C[f+3]=s[m+2]}}else if(B==0)for(h=l.tabs.tRNS?l.tabs.tRNS:-1,x=0;x<n;x++){const D=x*U,L=x*r;if(F==1)for(var o=0;o<r;o++){var P=(_=255*(s[D+(o>>>3)]>>>7-(7&o)&1))==255*h?0:255;z[L+o]=P<<24|_<<16|_<<8|_}else if(F==2)for(o=0;o<r;o++)P=(_=85*(s[D+(o>>>2)]>>>6-((3&o)<<1)&3))==85*h?0:255,z[L+o]=P<<24|_<<16|_<<8|_;else if(F==4)for(o=0;o<r;o++)P=(_=17*(s[D+(o>>>1)]>>>4-((1&o)<<2)&15))==17*h?0:255,z[L+o]=P<<24|_<<16|_<<8|_;else if(F==8)for(o=0;o<r;o++)P=(_=s[D+o])==h?0:255,z[L+o]=P<<24|_<<16|_<<8|_;else if(F==16)for(o=0;o<r;o++)_=s[D+(o<<1)],P=H(s,D+(o<<1))==h?0:255,z[L+o]=P<<24|_<<16|_<<8|_}return C}function R(s,r,n,l){const b=t(s),I=Math.ceil(n*b/8),U=new Uint8Array((I+1+s.interlace)*l);return r=s.tabs.CgBI?e(r,U):c(r,U),s.interlace==0?r=d(r,s,0,n,l):s.interlace==1&&(r=function(z,B){const F=B.width,H=B.height,p=t(B),N=p>>3,h=Math.ceil(F*p/8),f=new Uint8Array(H*h);let x=0;const T=[0,0,4,0,2,0,1],S=[0,4,0,2,0,1,0],j=[8,8,8,4,4,2,2],A=[8,8,4,4,2,2,1];let _=0;for(;_<7;){const o=j[_],P=A[_];let D=0,L=0,G=T[_];for(;G<H;)G+=o,L++;let W=S[_];for(;W<F;)W+=P,D++;const V=Math.ceil(D*p/8);d(z,B,x,D,L);let Y=0,O=T[_];for(;O<H;){let K=S[_],ue=x+Y*V<<3;for(;K<F;){var m;if(p==1&&(m=(m=z[ue>>3])>>7-(7&ue)&1,f[O*h+(K>>3)]|=m<<7-((7&K)<<0)),p==2&&(m=(m=z[ue>>3])>>6-(7&ue)&3,f[O*h+(K>>2)]|=m<<6-((3&K)<<1)),p==4&&(m=(m=z[ue>>3])>>4-(7&ue)&15,f[O*h+(K>>1)]|=m<<4-((1&K)<<2)),p>=8){const ie=O*h+K*N;for(let se=0;se<N;se++)f[ie+se]=z[(ue>>3)+se]}ue+=p,K+=P}Y++,O+=o}D*L!=0&&(x+=L*(1+V)),_+=1}return f}(r,s)),r}function c(s,r){return e(new Uint8Array(s.buffer,2,s.length-6),r)}var e=function(){const s={H:{}};return s.H.N=function(r,n){const l=Uint8Array;let b,I,U=0,C=0,z=0,B=0,F=0,H=0,p=0,N=0,h=0;if(r[0]==3&&r[1]==0)return n||new l(0);const f=s.H,x=f.b,T=f.e,S=f.R,j=f.n,A=f.A,_=f.Z,m=f.m,o=n==null;for(o&&(n=new l(r.length>>>2<<5));U==0;)if(U=x(r,h,1),C=x(r,h+1,2),h+=3,C!=0){if(o&&(n=s.H.W(n,N+(1<<17))),C==1&&(b=m.J,I=m.h,H=511,p=31),C==2){z=T(r,h,5)+257,B=T(r,h+5,5)+1,F=T(r,h+10,4)+4,h+=14;let D=1;for(var P=0;P<38;P+=2)m.Q[P]=0,m.Q[P+1]=0;for(P=0;P<F;P++){const W=T(r,h+3*P,3);m.Q[1+(m.X[P]<<1)]=W,W>D&&(D=W)}h+=3*F,j(m.Q,D),A(m.Q,D,m.u),b=m.w,I=m.d,h=S(m.u,(1<<D)-1,z+B,r,h,m.v);const L=f.V(m.v,0,z,m.C);H=(1<<L)-1;const G=f.V(m.v,z,B,m.D);p=(1<<G)-1,j(m.C,L),A(m.C,L,b),j(m.D,G),A(m.D,G,I)}for(;;){const D=b[_(r,h)&H];h+=15&D;const L=D>>>4;if(!(L>>>8))n[N++]=L;else{if(L==256)break;{let G=N+L-254;if(L>264){const K=m.q[L-257];G=N+(K>>>3)+T(r,h,7&K),h+=7&K}const W=I[_(r,h)&p];h+=15&W;const V=W>>>4,Y=m.c[V],O=(Y>>>4)+x(r,h,15&Y);for(h+=15&Y;N<G;)n[N]=n[N++-O],n[N]=n[N++-O],n[N]=n[N++-O],n[N]=n[N++-O];N=G}}}}else{7&h&&(h+=8-(7&h));const D=4+(h>>>3),L=r[D-4]|r[D-3]<<8;o&&(n=s.H.W(n,N+L)),n.set(new l(r.buffer,r.byteOffset+D,L),N),h=D+L<<3,N+=L}return n.length==N?n:n.slice(0,N)},s.H.W=function(r,n){const l=r.length;if(n<=l)return r;const b=new Uint8Array(l<<1);return b.set(r,0),b},s.H.R=function(r,n,l,b,I,U){const C=s.H.e,z=s.H.Z;let B=0;for(;B<l;){const F=r[z(b,I)&n];I+=15&F;const H=F>>>4;if(H<=15)U[B]=H,B++;else{let p=0,N=0;H==16?(N=3+C(b,I,2),I+=2,p=U[B-1]):H==17?(N=3+C(b,I,3),I+=3):H==18&&(N=11+C(b,I,7),I+=7);const h=B+N;for(;B<h;)U[B]=p,B++}}return I},s.H.V=function(r,n,l,b){let I=0,U=0;const C=b.length>>>1;for(;U<l;){const z=r[U+n];b[U<<1]=0,b[1+(U<<1)]=z,z>I&&(I=z),U++}for(;U<C;)b[U<<1]=0,b[1+(U<<1)]=0,U++;return I},s.H.n=function(r,n){const l=s.H.m,b=r.length;let I,U,C,z;const B=l.j;for(var F=0;F<=n;F++)B[F]=0;for(F=1;F<b;F+=2)B[r[F]]++;const H=l.K;for(I=0,B[0]=0,U=1;U<=n;U++)I=I+B[U-1]<<1,H[U]=I;for(C=0;C<b;C+=2)z=r[C+1],z!=0&&(r[C]=H[z],H[z]++)},s.H.A=function(r,n,l){const b=r.length,I=s.H.m.r;for(let U=0;U<b;U+=2)if(r[U+1]!=0){const C=U>>1,z=r[U+1],B=C<<4|z,F=n-z;let H=r[U]<<F;const p=H+(1<<F);for(;H!=p;)l[I[H]>>>15-n]=B,H++}},s.H.l=function(r,n){const l=s.H.m.r,b=15-n;for(let I=0;I<r.length;I+=2){const U=r[I]<<n-r[I+1];r[I]=l[U]>>>b}},s.H.M=function(r,n,l){l<<=7&n;const b=n>>>3;r[b]|=l,r[b+1]|=l>>>8},s.H.I=function(r,n,l){l<<=7&n;const b=n>>>3;r[b]|=l,r[b+1]|=l>>>8,r[b+2]|=l>>>16},s.H.e=function(r,n,l){return(r[n>>>3]|r[1+(n>>>3)]<<8)>>>(7&n)&(1<<l)-1},s.H.b=function(r,n,l){return(r[n>>>3]|r[1+(n>>>3)]<<8|r[2+(n>>>3)]<<16)>>>(7&n)&(1<<l)-1},s.H.Z=function(r,n){return(r[n>>>3]|r[1+(n>>>3)]<<8|r[2+(n>>>3)]<<16)>>>(7&n)},s.H.i=function(r,n){return(r[n>>>3]|r[1+(n>>>3)]<<8|r[2+(n>>>3)]<<16|r[3+(n>>>3)]<<24)>>>(7&n)},s.H.m=function(){const r=Uint16Array,n=Uint32Array;return{K:new r(16),j:new r(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new r(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new n(32),J:new r(512),_:[],h:new r(32),$:[],w:new r(32768),C:[],v:[],d:new r(32768),D:[],u:new r(512),Q:[],r:new r(32768),s:new n(286),Y:new n(30),a:new n(19),t:new n(15e3),k:new r(65536),g:new r(32768)}}(),function(){const r=s.H.m;for(var n=0;n<32768;n++){let b=n;b=(2863311530&b)>>>1|(1431655765&b)<<1,b=(3435973836&b)>>>2|(858993459&b)<<2,b=(4042322160&b)>>>4|(252645135&b)<<4,b=(4278255360&b)>>>8|(16711935&b)<<8,r.r[n]=(b>>>16|b<<16)>>>17}function l(b,I,U){for(;I--!=0;)b.push(0,U)}for(n=0;n<32;n++)r.q[n]=r.S[n]<<3|r.T[n],r.c[n]=r.p[n]<<4|r.z[n];l(r._,144,8),l(r._,112,9),l(r._,24,7),l(r._,8,8),s.H.n(r._,9),s.H.A(r._,9,r.J),s.H.l(r._,9),l(r.$,32,5),s.H.n(r.$,5),s.H.A(r.$,5,r.h),s.H.l(r.$,5),l(r.Q,19,0),l(r.C,286,0),l(r.D,30,0),l(r.v,320,0)}(),s.H.N}();function t(s){return[1,null,3,1,2,null,4][s.ctype]*s.depth}function d(s,r,n,l,b){let I=t(r);const U=Math.ceil(l*I/8);let C,z;I=Math.ceil(I/8);let B=s[n],F=0;if(B>1&&(s[n]=[0,0,1][B-2]),B==3)for(F=I;F<U;F++)s[F+1]=s[F+1]+(s[F+1-I]>>>1)&255;for(let H=0;H<b;H++)if(C=n+H*U,z=C+H+1,B=s[z-1],F=0,B==0)for(;F<U;F++)s[C+F]=s[z+F];else if(B==1){for(;F<I;F++)s[C+F]=s[z+F];for(;F<U;F++)s[C+F]=s[z+F]+s[C+F-I]}else if(B==2)for(;F<U;F++)s[C+F]=s[z+F]+s[C+F-U];else if(B==3){for(;F<I;F++)s[C+F]=s[z+F]+(s[C+F-U]>>>1);for(;F<U;F++)s[C+F]=s[z+F]+(s[C+F-U]+s[C+F-I]>>>1)}else{for(;F<I;F++)s[C+F]=s[z+F]+i(0,s[C+F-U],0);for(;F<U;F++)s[C+F]=s[z+F]+i(s[C+F-I],s[C+F-U],s[C+F-I-U])}return s}function i(s,r,n){const l=s+r-n,b=l-s,I=l-r,U=l-n;return b*b<=I*I&&b*b<=U*U?s:I*I<=U*U?r:n}function y(s,r,n){n.width=u.readUint(s,r),r+=4,n.height=u.readUint(s,r),r+=4,n.depth=s[r],r++,n.ctype=s[r],r++,n.compress=s[r],r++,n.filter=s[r],r++,n.interlace=s[r],r++}function w(s,r,n,l,b,I,U,C,z){const B=Math.min(r,b),F=Math.min(n,I);let H=0,p=0;for(let _=0;_<F;_++)for(let m=0;m<B;m++)if(U>=0&&C>=0?(H=_*r+m<<2,p=(C+_)*b+U+m<<2):(H=(-C+_)*r-U+m<<2,p=_*b+m<<2),z==0)l[p]=s[H],l[p+1]=s[H+1],l[p+2]=s[H+2],l[p+3]=s[H+3];else if(z==1){var N=s[H+3]*.00392156862745098,h=s[H]*N,f=s[H+1]*N,x=s[H+2]*N,T=l[p+3]*(1/255),S=l[p]*T,j=l[p+1]*T,A=l[p+2]*T;const o=1-N,P=N+T*o,D=P==0?0:1/P;l[p+3]=255*P,l[p+0]=(h+S*o)*D,l[p+1]=(f+j*o)*D,l[p+2]=(x+A*o)*D}else if(z==2)N=s[H+3],h=s[H],f=s[H+1],x=s[H+2],T=l[p+3],S=l[p],j=l[p+1],A=l[p+2],N==T&&h==S&&f==j&&x==A?(l[p]=0,l[p+1]=0,l[p+2]=0,l[p+3]=0):(l[p]=h,l[p+1]=f,l[p+2]=x,l[p+3]=N);else if(z==3){if(N=s[H+3],h=s[H],f=s[H+1],x=s[H+2],T=l[p+3],S=l[p],j=l[p+1],A=l[p+2],N==T&&h==S&&f==j&&x==A)continue;if(N<220&&T>20)return!1}return!0}return{decode:function(r){const n=new Uint8Array(r);let l=8;const b=u,I=b.readUshort,U=b.readUint,C={tabs:{},frames:[]},z=new Uint8Array(n.length);let B,F=0,H=0;const p=[137,80,78,71,13,10,26,10];for(var N=0;N<8;N++)if(n[N]!=p[N])throw"The input is not a PNG file!";for(;l<n.length;){const _=b.readUint(n,l);l+=4;const m=b.readASCII(n,l,4);if(l+=4,m=="IHDR")y(n,l,C);else if(m=="iCCP"){for(var h=l;n[h]!=0;)h++;b.readASCII(n,l,h-l),n[h+1];const o=n.slice(h+2,l+_);let P=null;try{P=c(o)}catch{P=e(o)}C.tabs[m]=P}else if(m=="CgBI")C.tabs[m]=n.slice(l,l+4);else if(m=="IDAT"){for(N=0;N<_;N++)z[F+N]=n[l+N];F+=_}else if(m=="acTL")C.tabs[m]={num_frames:U(n,l),num_plays:U(n,l+4)},B=new Uint8Array(n.length);else if(m=="fcTL"){H!=0&&((A=C.frames[C.frames.length-1]).data=R(C,B.slice(0,H),A.rect.width,A.rect.height),H=0);const o={x:U(n,l+12),y:U(n,l+16),width:U(n,l+4),height:U(n,l+8)};let P=I(n,l+22);P=I(n,l+20)/(P==0?100:P);const D={rect:o,delay:Math.round(1e3*P),dispose:n[l+24],blend:n[l+25]};C.frames.push(D)}else if(m=="fdAT"){for(N=0;N<_-4;N++)B[H+N]=n[l+N+4];H+=_-4}else if(m=="pHYs")C.tabs[m]=[b.readUint(n,l),b.readUint(n,l+4),n[l+8]];else if(m=="cHRM")for(C.tabs[m]=[],N=0;N<8;N++)C.tabs[m].push(b.readUint(n,l+4*N));else if(m=="tEXt"||m=="zTXt"){C.tabs[m]==null&&(C.tabs[m]={});var f=b.nextZero(n,l),x=b.readASCII(n,l,f-l),T=l+_-f-1;if(m=="tEXt")j=b.readASCII(n,f+1,T);else{var S=c(n.slice(f+2,f+2+T));j=b.readUTF8(S,0,S.length)}C.tabs[m][x]=j}else if(m=="iTXt"){C.tabs[m]==null&&(C.tabs[m]={}),f=0,h=l,f=b.nextZero(n,h),x=b.readASCII(n,h,f-h);const o=n[h=f+1];var j;n[h+1],h+=2,f=b.nextZero(n,h),b.readASCII(n,h,f-h),h=f+1,f=b.nextZero(n,h),b.readUTF8(n,h,f-h),T=_-((h=f+1)-l),o==0?j=b.readUTF8(n,h,T):(S=c(n.slice(h,h+T)),j=b.readUTF8(S,0,S.length)),C.tabs[m][x]=j}else if(m=="PLTE")C.tabs[m]=b.readBytes(n,l,_);else if(m=="hIST"){const o=C.tabs.PLTE.length/3;for(C.tabs[m]=[],N=0;N<o;N++)C.tabs[m].push(I(n,l+2*N))}else if(m=="tRNS")C.ctype==3?C.tabs[m]=b.readBytes(n,l,_):C.ctype==0?C.tabs[m]=I(n,l):C.ctype==2&&(C.tabs[m]=[I(n,l),I(n,l+2),I(n,l+4)]);else if(m=="gAMA")C.tabs[m]=b.readUint(n,l)/1e5;else if(m=="sRGB")C.tabs[m]=n[l];else if(m=="bKGD")C.ctype==0||C.ctype==4?C.tabs[m]=[I(n,l)]:C.ctype==2||C.ctype==6?C.tabs[m]=[I(n,l),I(n,l+2),I(n,l+4)]:C.ctype==3&&(C.tabs[m]=n[l]);else if(m=="IEND")break;l+=_,b.readUint(n,l),l+=4}var A;return H!=0&&((A=C.frames[C.frames.length-1]).data=R(C,B.slice(0,H),A.rect.width,A.rect.height)),C.data=R(C,z,C.width,C.height),delete C.compress,delete C.interlace,delete C.filter,C},toRGBA8:function(r){const n=r.width,l=r.height;if(r.tabs.acTL==null)return[v(r.data,n,l,r).buffer];const b=[];r.frames[0].data==null&&(r.frames[0].data=r.data);const I=n*l*4,U=new Uint8Array(I),C=new Uint8Array(I),z=new Uint8Array(I);for(let F=0;F<r.frames.length;F++){const H=r.frames[F],p=H.rect.x,N=H.rect.y,h=H.rect.width,f=H.rect.height,x=v(H.data,h,f,r);if(F!=0)for(var B=0;B<I;B++)z[B]=U[B];if(H.blend==0?w(x,h,f,U,n,l,p,N,0):H.blend==1&&w(x,h,f,U,n,l,p,N,1),b.push(U.buffer.slice(0)),H.dispose!=0){if(H.dispose==1)w(C,h,f,U,n,l,p,N,0);else if(H.dispose==2)for(B=0;B<I;B++)U[B]=z[B]}}return b},_paeth:i,_copyTile:w,_bin:u}}();(function(){const{_copyTile:u}=nt,{_bin:v}=nt,R=nt._paeth;var c={table:function(){const h=new Uint32Array(256);for(let f=0;f<256;f++){let x=f;for(let T=0;T<8;T++)1&x?x=3988292384^x>>>1:x>>>=1;h[f]=x}return h}(),update(h,f,x,T){for(let S=0;S<T;S++)h=c.table[255&(h^f[x+S])]^h>>>8;return h},crc:(h,f,x)=>4294967295^c.update(4294967295,h,f,x)};function e(h,f,x,T){f[x]+=h[0]*T>>4,f[x+1]+=h[1]*T>>4,f[x+2]+=h[2]*T>>4,f[x+3]+=h[3]*T>>4}function t(h){return Math.max(0,Math.min(255,h))}function d(h,f){const x=h[0]-f[0],T=h[1]-f[1],S=h[2]-f[2],j=h[3]-f[3];return x*x+T*T+S*S+j*j}function i(h,f,x,T,S,j,A){A==null&&(A=1);const _=T.length,m=[];for(var o=0;o<_;o++){const O=T[o];m.push([O>>>0&255,O>>>8&255,O>>>16&255,O>>>24&255])}for(o=0;o<_;o++){let O=4294967295;for(var P=0,D=0;D<_;D++){var L=d(m[o],m[D]);D!=o&&L<O&&(O=L,P=D)}}const G=new Uint32Array(S.buffer),W=new Int16Array(f*x*4),V=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(o=0;o<V.length;o++)V[o]=255*((V[o]+.5)/16-.5);for(let O=0;O<x;O++)for(let K=0;K<f;K++){var Y;o=4*(O*f+K),A!=2?Y=[t(h[o]+W[o]),t(h[o+1]+W[o+1]),t(h[o+2]+W[o+2]),t(h[o+3]+W[o+3])]:(L=V[4*(3&O)+(3&K)],Y=[t(h[o]+L),t(h[o+1]+L),t(h[o+2]+L),t(h[o+3]+L)]),P=0;let ue=16777215;for(D=0;D<_;D++){const le=d(Y,m[D]);le<ue&&(ue=le,P=D)}const ie=m[P],se=[Y[0]-ie[0],Y[1]-ie[1],Y[2]-ie[2],Y[3]-ie[3]];A==1&&(K!=f-1&&e(se,W,o+4,7),O!=x-1&&(K!=0&&e(se,W,o+4*f-4,3),e(se,W,o+4*f,5),K!=f-1&&e(se,W,o+4*f+4,1))),j[o>>2]=P,G[o>>2]=T[P]}}function y(h,f,x,T,S){S==null&&(S={});const{crc:j}=c,A=v.writeUint,_=v.writeUshort,m=v.writeASCII;let o=8;const P=h.frames.length>1;let D,L=!1,G=33+(P?20:0);if(S.sRGB!=null&&(G+=13),S.pHYs!=null&&(G+=21),S.iCCP!=null&&(D=pako.deflate(S.iCCP),G+=21+D.length+4),h.ctype==3){for(var W=h.plte.length,V=0;V<W;V++)h.plte[V]>>>24!=255&&(L=!0);G+=8+3*W+4+(L?8+1*W+4:0)}for(var Y=0;Y<h.frames.length;Y++)P&&(G+=38),G+=(ie=h.frames[Y]).cimg.length+12,Y!=0&&(G+=4);G+=12;const O=new Uint8Array(G),K=[137,80,78,71,13,10,26,10];for(V=0;V<8;V++)O[V]=K[V];if(A(O,o,13),o+=4,m(O,o,"IHDR"),o+=4,A(O,o,f),o+=4,A(O,o,x),o+=4,O[o]=h.depth,o++,O[o]=h.ctype,o++,O[o]=0,o++,O[o]=0,o++,O[o]=0,o++,A(O,o,j(O,o-17,17)),o+=4,S.sRGB!=null&&(A(O,o,1),o+=4,m(O,o,"sRGB"),o+=4,O[o]=S.sRGB,o++,A(O,o,j(O,o-5,5)),o+=4),S.iCCP!=null){const se=13+D.length;A(O,o,se),o+=4,m(O,o,"iCCP"),o+=4,m(O,o,"ICC profile"),o+=11,o+=2,O.set(D,o),o+=D.length,A(O,o,j(O,o-(se+4),se+4)),o+=4}if(S.pHYs!=null&&(A(O,o,9),o+=4,m(O,o,"pHYs"),o+=4,A(O,o,S.pHYs[0]),o+=4,A(O,o,S.pHYs[1]),o+=4,O[o]=S.pHYs[2],o++,A(O,o,j(O,o-13,13)),o+=4),P&&(A(O,o,8),o+=4,m(O,o,"acTL"),o+=4,A(O,o,h.frames.length),o+=4,A(O,o,S.loop!=null?S.loop:0),o+=4,A(O,o,j(O,o-12,12)),o+=4),h.ctype==3){for(A(O,o,3*(W=h.plte.length)),o+=4,m(O,o,"PLTE"),o+=4,V=0;V<W;V++){const se=3*V,le=h.plte[V],ce=255&le,fe=le>>>8&255,Oe=le>>>16&255;O[o+se+0]=ce,O[o+se+1]=fe,O[o+se+2]=Oe}if(o+=3*W,A(O,o,j(O,o-3*W-4,3*W+4)),o+=4,L){for(A(O,o,W),o+=4,m(O,o,"tRNS"),o+=4,V=0;V<W;V++)O[o+V]=h.plte[V]>>>24&255;o+=W,A(O,o,j(O,o-W-4,W+4)),o+=4}}let ue=0;for(Y=0;Y<h.frames.length;Y++){var ie=h.frames[Y];P&&(A(O,o,26),o+=4,m(O,o,"fcTL"),o+=4,A(O,o,ue++),o+=4,A(O,o,ie.rect.width),o+=4,A(O,o,ie.rect.height),o+=4,A(O,o,ie.rect.x),o+=4,A(O,o,ie.rect.y),o+=4,_(O,o,T[Y]),o+=2,_(O,o,1e3),o+=2,O[o]=ie.dispose,o++,O[o]=ie.blend,o++,A(O,o,j(O,o-30,30)),o+=4);const se=ie.cimg;A(O,o,(W=se.length)+(Y==0?0:4)),o+=4;const le=o;m(O,o,Y==0?"IDAT":"fdAT"),o+=4,Y!=0&&(A(O,o,ue++),o+=4),O.set(se,o),o+=W,A(O,o,j(O,le,o-le)),o+=4}return A(O,o,0),o+=4,m(O,o,"IEND"),o+=4,A(O,o,j(O,o-4,4)),o+=4,O.buffer}function w(h,f,x){for(let T=0;T<h.frames.length;T++){const S=h.frames[T];S.rect.width;const j=S.rect.height,A=new Uint8Array(j*S.bpl+j);S.cimg=l(S.img,j,S.bpp,S.bpl,A,f,x)}}function s(h,f,x,T,S){const j=S[0],A=S[1],_=S[2],m=S[3],o=S[4],P=S[5];let D=6,L=8,G=255;for(var W=0;W<h.length;W++){const ye=new Uint8Array(h[W]);for(var V=ye.length,Y=0;Y<V;Y+=4)G&=ye[Y+3]}const O=G!=255,K=function(de,he,pe,Se,be,je){const xe=[];for(var ne=0;ne<de.length;ne++){const te=new Uint8Array(de[ne]),Ue=new Uint32Array(te.buffer);var we;let re=0,ke=0,ee=he,Ee=pe,Ie=Se?1:0;if(ne!=0){const gt=je||Se||ne==1||xe[ne-2].dispose!=0?1:2;let pt=0,lt=1e9;for(let Ye=0;Ye<gt;Ye++){var Ce=new Uint8Array(de[ne-1-Ye]);const Nt=new Uint32Array(de[ne-1-Ye]);let Me=he,qe=pe,Ze=-1,ge=-1;for(let et=0;et<pe;et++)for(let Ve=0;Ve<he;Ve++)Ue[Ae=et*he+Ve]!=Nt[Ae]&&(Ve<Me&&(Me=Ve),Ve>Ze&&(Ze=Ve),et<qe&&(qe=et),et>ge&&(ge=et));Ze==-1&&(Me=qe=Ze=ge=0),be&&((1&Me)==1&&Me--,(1&qe)==1&&qe--);const Je=(Ze-Me+1)*(ge-qe+1);Je<lt&&(lt=Je,pt=Ye,re=Me,ke=qe,ee=Ze-Me+1,Ee=ge-qe+1)}Ce=new Uint8Array(de[ne-1-pt]),pt==1&&(xe[ne-1].dispose=2),we=new Uint8Array(ee*Ee*4),u(Ce,he,pe,we,ee,Ee,-re,-ke,0),Ie=u(te,he,pe,we,ee,Ee,-re,-ke,3)?1:0,Ie==1?n(te,he,pe,we,{x:re,y:ke,width:ee,height:Ee}):u(te,he,pe,we,ee,Ee,-re,-ke,0)}else we=te.slice(0);xe.push({rect:{x:re,y:ke,width:ee,height:Ee},img:we,blend:Ie,dispose:0})}if(Se)for(ne=0;ne<xe.length;ne++){if((Ge=xe[ne]).blend==1)continue;const te=Ge.rect,Ue=xe[ne-1].rect,re=Math.min(te.x,Ue.x),ke=Math.min(te.y,Ue.y),ee={x:re,y:ke,width:Math.max(te.x+te.width,Ue.x+Ue.width)-re,height:Math.max(te.y+te.height,Ue.y+Ue.height)-ke};xe[ne-1].dispose=1,ne-1!=0&&r(de,he,pe,xe,ne-1,ee,be),r(de,he,pe,xe,ne,ee,be)}let ot=0;if(de.length!=1)for(var Ae=0;Ae<xe.length;Ae++){var Ge;ot+=(Ge=xe[Ae]).rect.width*Ge.rect.height}return xe}(h,f,x,j,A,_),ue={},ie=[],se=[];if(T!=0){const ye=[];for(Y=0;Y<K.length;Y++)ye.push(K[Y].img.buffer);const de=function(be){let je=0;for(var xe=0;xe<be.length;xe++)je+=be[xe].byteLength;const ne=new Uint8Array(je);let we=0;for(xe=0;xe<be.length;xe++){const Ce=new Uint8Array(be[xe]),ot=Ce.length;for(let Ae=0;Ae<ot;Ae+=4){let Ge=Ce[Ae],te=Ce[Ae+1],Ue=Ce[Ae+2];const re=Ce[Ae+3];re==0&&(Ge=te=Ue=0),ne[we+Ae]=Ge,ne[we+Ae+1]=te,ne[we+Ae+2]=Ue,ne[we+Ae+3]=re}we+=ot}return ne.buffer}(ye),he=I(de,T);for(Y=0;Y<he.plte.length;Y++)ie.push(he.plte[Y].est.rgba);let pe=0;for(Y=0;Y<K.length;Y++){const Se=(ce=K[Y]).img.length;var le=new Uint8Array(he.inds.buffer,pe>>2,Se>>2);se.push(le);const be=new Uint8Array(he.abuf,pe,Se);P&&i(ce.img,ce.rect.width,ce.rect.height,ie,be,le),ce.img.set(be),pe+=Se}}else for(W=0;W<K.length;W++){var ce=K[W];const ye=new Uint32Array(ce.img.buffer);var fe=ce.rect.width;for(V=ye.length,le=new Uint8Array(V),se.push(le),Y=0;Y<V;Y++){const de=ye[Y];if(Y!=0&&de==ye[Y-1])le[Y]=le[Y-1];else if(Y>fe&&de==ye[Y-fe])le[Y]=le[Y-fe];else{let he=ue[de];if(he==null&&(ue[de]=he=ie.length,ie.push(de),ie.length>=300))break;le[Y]=he}}}const Oe=ie.length;for(Oe<=256&&o==0&&(L=Oe<=2?1:Oe<=4?2:Oe<=16?4:8,L=Math.max(L,m)),W=0;W<K.length;W++){(ce=K[W]).rect.x,ce.rect.y,fe=ce.rect.width;const ye=ce.rect.height;let de=ce.img;new Uint32Array(de.buffer);let he=4*fe,pe=4;if(Oe<=256&&o==0){he=Math.ceil(L*fe/8);var Te=new Uint8Array(he*ye);const Se=se[W];for(let be=0;be<ye;be++){Y=be*he;const je=be*fe;if(L==8)for(var me=0;me<fe;me++)Te[Y+me]=Se[je+me];else if(L==4)for(me=0;me<fe;me++)Te[Y+(me>>1)]|=Se[je+me]<<4-4*(1&me);else if(L==2)for(me=0;me<fe;me++)Te[Y+(me>>2)]|=Se[je+me]<<6-2*(3&me);else if(L==1)for(me=0;me<fe;me++)Te[Y+(me>>3)]|=Se[je+me]<<7-1*(7&me)}de=Te,D=3,pe=1}else if(O==0&&K.length==1){Te=new Uint8Array(fe*ye*3);const Se=fe*ye;for(Y=0;Y<Se;Y++){const be=3*Y,je=4*Y;Te[be]=de[je],Te[be+1]=de[je+1],Te[be+2]=de[je+2]}de=Te,D=2,pe=3,he=3*fe}ce.img=de,ce.bpl=he,ce.bpp=pe}return{ctype:D,depth:L,plte:ie,frames:K}}function r(h,f,x,T,S,j,A){const _=Uint8Array,m=Uint32Array,o=new _(h[S-1]),P=new m(h[S-1]),D=S+1<h.length?new _(h[S+1]):null,L=new _(h[S]),G=new m(L.buffer);let W=f,V=x,Y=-1,O=-1;for(let ue=0;ue<j.height;ue++)for(let ie=0;ie<j.width;ie++){const se=j.x+ie,le=j.y+ue,ce=le*f+se,fe=G[ce];fe==0||T[S-1].dispose==0&&P[ce]==fe&&(D==null||D[4*ce+3]!=0)||(se<W&&(W=se),se>Y&&(Y=se),le<V&&(V=le),le>O&&(O=le))}Y==-1&&(W=V=Y=O=0),A&&((1&W)==1&&W--,(1&V)==1&&V--),j={x:W,y:V,width:Y-W+1,height:O-V+1};const K=T[S];K.rect=j,K.blend=1,K.img=new Uint8Array(j.width*j.height*4),T[S-1].dispose==0?(u(o,f,x,K.img,j.width,j.height,-j.x,-j.y,0),n(L,f,x,K.img,j)):u(L,f,x,K.img,j.width,j.height,-j.x,-j.y,0)}function n(h,f,x,T,S){u(h,f,x,T,S.width,S.height,-S.x,-S.y,2)}function l(h,f,x,T,S,j,A){const _=[];let m,o=[0,1,2,3,4];j!=-1?o=[j]:(f*T>5e5||x==1)&&(o=[0]),A&&(m={level:0});const P=Er;for(var D=0;D<o.length;D++){for(let W=0;W<f;W++)b(S,h,W,T,x,o[D]);_.push(P.deflate(S,m))}let L,G=1e9;for(D=0;D<_.length;D++)_[D].length<G&&(L=D,G=_[D].length);return _[L]}function b(h,f,x,T,S,j){const A=x*T;let _=A+x;if(h[_]=j,_++,j==0)if(T<500)for(var m=0;m<T;m++)h[_+m]=f[A+m];else h.set(new Uint8Array(f.buffer,A,T),_);else if(j==1){for(m=0;m<S;m++)h[_+m]=f[A+m];for(m=S;m<T;m++)h[_+m]=f[A+m]-f[A+m-S]+256&255}else if(x==0){for(m=0;m<S;m++)h[_+m]=f[A+m];if(j==2)for(m=S;m<T;m++)h[_+m]=f[A+m];if(j==3)for(m=S;m<T;m++)h[_+m]=f[A+m]-(f[A+m-S]>>1)+256&255;if(j==4)for(m=S;m<T;m++)h[_+m]=f[A+m]-R(f[A+m-S],0,0)+256&255}else{if(j==2)for(m=0;m<T;m++)h[_+m]=f[A+m]+256-f[A+m-T]&255;if(j==3){for(m=0;m<S;m++)h[_+m]=f[A+m]+256-(f[A+m-T]>>1)&255;for(m=S;m<T;m++)h[_+m]=f[A+m]+256-(f[A+m-T]+f[A+m-S]>>1)&255}if(j==4){for(m=0;m<S;m++)h[_+m]=f[A+m]+256-R(0,f[A+m-T],0)&255;for(m=S;m<T;m++)h[_+m]=f[A+m]+256-R(f[A+m-S],f[A+m-T],f[A+m-S-T])&255}}}function I(h,f){const x=new Uint8Array(h),T=x.slice(0),S=new Uint32Array(T.buffer),j=U(T,f),A=j[0],_=j[1],m=x.length,o=new Uint8Array(m>>2);let P;if(x.length<2e7)for(var D=0;D<m;D+=4)P=C(A,L=x[D]*(1/255),G=x[D+1]*(1/255),W=x[D+2]*(1/255),V=x[D+3]*(1/255)),o[D>>2]=P.ind,S[D>>2]=P.est.rgba;else for(D=0;D<m;D+=4){var L=x[D]*.00392156862745098,G=x[D+1]*(1/255),W=x[D+2]*(1/255),V=x[D+3]*(1/255);for(P=A;P.left;)P=z(P.est,L,G,W,V)<=0?P.left:P.right;o[D>>2]=P.ind,S[D>>2]=P.est.rgba}return{abuf:T.buffer,inds:o,plte:_}}function U(h,f,x){x==null&&(x=1e-4);const T=new Uint32Array(h.buffer),S={i0:0,i1:h.length,bst:null,est:null,tdst:0,left:null,right:null};S.bst=H(h,S.i0,S.i1),S.est=p(S.bst);const j=[S];for(;j.length<f;){let _=0,m=0;for(var A=0;A<j.length;A++)j[A].est.L>_&&(_=j[A].est.L,m=A);if(_<x)break;const o=j[m],P=B(h,T,o.i0,o.i1,o.est.e,o.est.eMq255);if(o.i0>=P||o.i1<=P){o.est.L=0;continue}const D={i0:o.i0,i1:P,bst:null,est:null,tdst:0,left:null,right:null};D.bst=H(h,D.i0,D.i1),D.est=p(D.bst);const L={i0:P,i1:o.i1,bst:null,est:null,tdst:0,left:null,right:null};for(L.bst={R:[],m:[],N:o.bst.N-D.bst.N},A=0;A<16;A++)L.bst.R[A]=o.bst.R[A]-D.bst.R[A];for(A=0;A<4;A++)L.bst.m[A]=o.bst.m[A]-D.bst.m[A];L.est=p(L.bst),o.left=D,o.right=L,j[m]=D,j.push(L)}for(j.sort((_,m)=>m.bst.N-_.bst.N),A=0;A<j.length;A++)j[A].ind=A;return[S,j]}function C(h,f,x,T,S){if(h.left==null)return h.tdst=function(D,L,G,W,V){const Y=L-D[0],O=G-D[1],K=W-D[2],ue=V-D[3];return Y*Y+O*O+K*K+ue*ue}(h.est.q,f,x,T,S),h;const j=z(h.est,f,x,T,S);let A=h.left,_=h.right;j>0&&(A=h.right,_=h.left);const m=C(A,f,x,T,S);if(m.tdst<=j*j)return m;const o=C(_,f,x,T,S);return o.tdst<m.tdst?o:m}function z(h,f,x,T,S){const{e:j}=h;return j[0]*f+j[1]*x+j[2]*T+j[3]*S-h.eMq}function B(h,f,x,T,S,j){for(T-=4;x<T;){for(;F(h,x,S)<=j;)x+=4;for(;F(h,T,S)>j;)T-=4;if(x>=T)break;const A=f[x>>2];f[x>>2]=f[T>>2],f[T>>2]=A,x+=4,T-=4}for(;F(h,x,S)>j;)x-=4;return x+4}function F(h,f,x){return h[f]*x[0]+h[f+1]*x[1]+h[f+2]*x[2]+h[f+3]*x[3]}function H(h,f,x){const T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S=[0,0,0,0],j=x-f>>2;for(let A=f;A<x;A+=4){const _=h[A]*.00392156862745098,m=h[A+1]*(1/255),o=h[A+2]*(1/255),P=h[A+3]*(1/255);S[0]+=_,S[1]+=m,S[2]+=o,S[3]+=P,T[0]+=_*_,T[1]+=_*m,T[2]+=_*o,T[3]+=_*P,T[5]+=m*m,T[6]+=m*o,T[7]+=m*P,T[10]+=o*o,T[11]+=o*P,T[15]+=P*P}return T[4]=T[1],T[8]=T[2],T[9]=T[6],T[12]=T[3],T[13]=T[7],T[14]=T[11],{R:T,m:S,N:j}}function p(h){const{R:f}=h,{m:x}=h,{N:T}=h,S=x[0],j=x[1],A=x[2],_=x[3],m=T==0?0:1/T,o=[f[0]-S*S*m,f[1]-S*j*m,f[2]-S*A*m,f[3]-S*_*m,f[4]-j*S*m,f[5]-j*j*m,f[6]-j*A*m,f[7]-j*_*m,f[8]-A*S*m,f[9]-A*j*m,f[10]-A*A*m,f[11]-A*_*m,f[12]-_*S*m,f[13]-_*j*m,f[14]-_*A*m,f[15]-_*_*m],P=o,D=N;let L=[Math.random(),Math.random(),Math.random(),Math.random()],G=0,W=0;if(T!=0)for(let Y=0;Y<16&&(L=D.multVec(P,L),W=Math.sqrt(D.dot(L,L)),L=D.sml(1/W,L),!(Y!=0&&Math.abs(W-G)<1e-9));Y++)G=W;const V=[S*m,j*m,A*m,_*m];return{Cov:o,q:V,e:L,L:G,eMq255:D.dot(D.sml(255,V),L),eMq:D.dot(L,V),rgba:(Math.round(255*V[3])<<24|Math.round(255*V[2])<<16|Math.round(255*V[1])<<8|Math.round(255*V[0])<<0)>>>0}}var N={multVec:(h,f)=>[h[0]*f[0]+h[1]*f[1]+h[2]*f[2]+h[3]*f[3],h[4]*f[0]+h[5]*f[1]+h[6]*f[2]+h[7]*f[3],h[8]*f[0]+h[9]*f[1]+h[10]*f[2]+h[11]*f[3],h[12]*f[0]+h[13]*f[1]+h[14]*f[2]+h[15]*f[3]],dot:(h,f)=>h[0]*f[0]+h[1]*f[1]+h[2]*f[2]+h[3]*f[3],sml:(h,f)=>[h*f[0],h*f[1],h*f[2],h*f[3]]};nt.encode=function(f,x,T,S,j,A,_){S==null&&(S=0),_==null&&(_=!1);const m=s(f,x,T,S,[!1,!1,!1,0,_,!1]);return w(m,-1),y(m,x,T,j,A)},nt.encodeLL=function(f,x,T,S,j,A,_,m){const o={ctype:0+(S==1?0:2)+(j==0?0:4),depth:A,frames:[]},P=(S+j)*A,D=P*x;for(let L=0;L<f.length;L++)o.frames.push({rect:{x:0,y:0,width:x,height:T},img:new Uint8Array(f[L]),blend:0,dispose:1,bpp:Math.ceil(P/8),bpl:Math.ceil(D/8)});return w(o,0,!0),y(o,x,T,_,m)},nt.encode.compress=s,nt.encode.dither=i,nt.quantize=I,nt.quantize.getKDtree=U,nt.quantize.getNearest=C})();const ws={toArrayBuffer(u,v){const R=u.width,c=u.height,e=R<<2,t=u.getContext("2d").getImageData(0,0,R,c),d=new Uint32Array(t.data.buffer),i=(32*R+31)/32<<2,y=i*c,w=122+y,s=new ArrayBuffer(w),r=new DataView(s),n=1<<20;let l,b,I,U,C=n,z=0,B=0,F=0;function H(h){r.setUint16(B,h,!0),B+=2}function p(h){r.setUint32(B,h,!0),B+=4}function N(h){B+=h}H(19778),p(w),N(4),p(122),p(108),p(R),p(-c>>>0),H(1),H(32),p(3),p(y),p(2835),p(2835),N(8),p(16711680),p(65280),p(255),p(4278190080),p(1466527264),function h(){for(;z<c&&C>0;){for(U=122+z*i,l=0;l<e;)C--,b=d[F++],I=b>>>24,r.setUint32(U+l,b<<8|I),l+=4;z++}F<d.length?(C=n,setTimeout(h,ws._dly)):v(s)}()},toBlob(u,v){this.toArrayBuffer(u,R=>{v(new Blob([R],{type:"image/bmp"}))})},_dly:9};var $e={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},jr={[$e.CHROME]:16384,[$e.FIREFOX]:11180,[$e.DESKTOP_SAFARI]:16384,[$e.IE]:8192,[$e.IOS]:4096,[$e.ETC]:8192};const Wn=typeof window<"u",Cs=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,vn=Wn&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Ir=(Wn||Cs)&&(vn&&vn.getOriginalSymbol(window,"File")||typeof File<"u"&&File),_s=(Wn||Cs)&&(vn&&vn.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function Gn(u,v,R=Date.now()){return new Promise(c=>{const e=u.split(","),t=e[0].match(/:(.*?);/)[1],d=globalThis.atob(e[1]);let i=d.length;const y=new Uint8Array(i);for(;i--;)y[i]=d.charCodeAt(i);const w=new Blob([y],{type:t});w.name=v,w.lastModified=R,c(w)})}function Es(u){return new Promise((v,R)=>{const c=new _s;c.onload=()=>v(c.result),c.onerror=e=>R(e),c.readAsDataURL(u)})}function js(u){return new Promise((v,R)=>{const c=new Image;c.onload=()=>v(c),c.onerror=e=>R(e),c.src=u})}function yt(){if(yt.cachedResult!==void 0)return yt.cachedResult;let u=$e.ETC;const{userAgent:v}=navigator;return/Chrom(e|ium)/i.test(v)?u=$e.CHROME:/iP(ad|od|hone)/i.test(v)&&/WebKit/i.test(v)?u=$e.IOS:/Safari/i.test(v)?u=$e.DESKTOP_SAFARI:/Firefox/i.test(v)?u=$e.FIREFOX:(/MSIE/i.test(v)||document.documentMode)&&(u=$e.IE),yt.cachedResult=u,yt.cachedResult}function Is(u,v){const R=yt(),c=jr[R];let e=u,t=v,d=e*t;const i=e>t?t/e:e/t;for(;d>c*c;){const y=(c+e)/2,w=(c+t)/2;y<w?(t=w,e=w*i):(t=y*i,e=y),d=e*t}return{width:e,height:t}}function An(u,v){let R,c;try{if(R=new OffscreenCanvas(u,v),c=R.getContext("2d"),c===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{R=document.createElement("canvas"),c=R.getContext("2d")}return R.width=u,R.height=v,[R,c]}function Ds(u,v){const{width:R,height:c}=Is(u.width,u.height),[e,t]=An(R,c);return v&&/jpe?g/.test(v)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(u,0,0,e.width,e.height),e}function fn(){return fn.cachedResult!==void 0||(fn.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),fn.cachedResult}function yn(u,v={}){return new Promise(function(R,c){let e,t;var d=function(){try{return t=Ds(e,v.fileType||u.type),R([e,t])}catch(y){return c(y)}},i=function(y){try{var w=function(s){try{throw s}catch(r){return c(r)}};try{let s;return Es(u).then(function(r){try{return s=r,js(s).then(function(n){try{return e=n,function(){try{return d()}catch(l){return c(l)}}()}catch(l){return w(l)}},w)}catch(n){return w(n)}},w)}catch(s){w(s)}}catch(s){return c(s)}};try{if(fn()||[$e.DESKTOP_SAFARI,$e.MOBILE_SAFARI].includes(yt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(u).then(function(y){try{return e=y,d()}catch{return i()}},i)}catch{i()}})}function Tn(u,v,R,c,e=1){return new Promise(function(t,d){let i;if(v==="image/png"){let w,s,r;return w=u.getContext("2d"),{data:s}=w.getImageData(0,0,u.width,u.height),r=nt.encode([s.buffer],u.width,u.height,4096*e),i=new Blob([r],{type:v}),i.name=R,i.lastModified=c,y.call(this)}{let w=function(){return y.call(this)};if(v==="image/bmp")return new Promise(s=>ws.toBlob(u,s)).then((function(s){try{return i=s,i.name=R,i.lastModified=c,w.call(this)}catch(r){return d(r)}}).bind(this),d);{let s=function(){return w.call(this)};if(typeof OffscreenCanvas=="function"&&u instanceof OffscreenCanvas)return u.convertToBlob({type:v,quality:e}).then((function(r){try{return i=r,i.name=R,i.lastModified=c,s.call(this)}catch(n){return d(n)}}).bind(this),d);{let r;return r=u.toDataURL(v,e),Gn(r,R,c).then((function(n){try{return i=n,s.call(this)}catch(l){return d(l)}}).bind(this),d)}}}function y(){return t(i)}})}function it(u){u.width=0,u.height=0}function It(){return new Promise(function(u,v){let R,c,e,t;return It.cachedResult!==void 0?u(It.cachedResult):Gn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(d){try{return R=d,yn(R).then(function(i){try{return c=i[1],Tn(c,R.type,R.name,R.lastModified).then(function(y){try{return e=y,it(c),yn(e).then(function(w){try{return t=w[0],It.cachedResult=t.width===1&&t.height===2,u(It.cachedResult)}catch(s){return v(s)}},v)}catch(w){return v(w)}},v)}catch(y){return v(y)}},v)}catch(i){return v(i)}},v)})}function Rs(u){return new Promise((v,R)=>{const c=new _s;c.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return v(-2);const d=t.byteLength;let i=2;for(;i<d;){if(t.getUint16(i+2,!1)<=8)return v(-1);const y=t.getUint16(i,!1);if(i+=2,y==65505){if(t.getUint32(i+=2,!1)!=1165519206)return v(-1);const w=t.getUint16(i+=6,!1)==18761;i+=t.getUint32(i+4,w);const s=t.getUint16(i,w);i+=2;for(let r=0;r<s;r++)if(t.getUint16(i+12*r,w)==274)return v(t.getUint16(i+12*r+8,w))}else{if((65280&y)!=65280)break;i+=t.getUint16(i,!1)}}return v(-1)},c.onerror=e=>R(e),c.readAsArrayBuffer(u)})}function Fs(u,v){const{width:R}=u,{height:c}=u,{maxWidthOrHeight:e}=v;let t,d=u;return isFinite(e)&&(R>e||c>e)&&([d,t]=An(R,c),R>c?(d.width=e,d.height=c/R*e):(d.width=R/c*e,d.height=e),t.drawImage(u,0,0,d.width,d.height),it(u)),d}function Os(u,v){const{width:R}=u,{height:c}=u,[e,t]=An(R,c);switch(v>4&&v<9?(e.width=c,e.height=R):(e.width=R,e.height=c),v){case 2:t.transform(-1,0,0,1,R,0);break;case 3:t.transform(-1,0,0,-1,R,c);break;case 4:t.transform(1,0,0,-1,0,c);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,c,0);break;case 7:t.transform(0,-1,-1,0,c,R);break;case 8:t.transform(0,-1,1,0,0,R)}return t.drawImage(u,0,0,R,c),it(u),e}function ns(u,v,R=0){return new Promise(function(c,e){let t,d,i,y,w,s,r,n,l,b,I,U,C,z,B,F,H,p,N,h;function f(T=5){if(v.signal&&v.signal.aborted)throw v.signal.reason;t+=T,v.onProgress(Math.min(t,100))}function x(T){if(v.signal&&v.signal.aborted)throw v.signal.reason;t=Math.min(Math.max(T,t),100),v.onProgress(t)}return t=R,d=v.maxIteration||10,i=1024*v.maxSizeMB*1024,f(),yn(u,v).then((function(T){try{return[,y]=T,f(),w=Fs(y,v),f(),new Promise(function(S,j){var A;if(!(A=v.exifOrientation))return Rs(u).then((function(m){try{return A=m,_.call(this)}catch(o){return j(o)}}).bind(this),j);function _(){return S(A)}return _.call(this)}).then((function(S){try{return s=S,f(),It().then((function(j){try{return r=j?w:Os(w,s),f(),n=v.initialQuality||1,l=v.fileType||u.type,Tn(r,l,u.name,u.lastModified,n).then((function(A){try{{let m=function(){if(d--&&(B>i||B>C)){let P,D;return P=h?.95*N.width:N.width,D=h?.95*N.height:N.height,[H,p]=An(P,D),p.drawImage(N,0,0,P,D),n*=l==="image/png"?.85:.95,Tn(H,l,u.name,u.lastModified,n).then(function(L){try{return F=L,it(N),N=H,B=F.size,x(Math.min(99,Math.floor((z-B)/(z-i)*100))),m}catch(G){return e(G)}},e)}return[1]},o=function(){return it(N),it(H),it(w),it(r),it(y),x(100),c(F)};if(b=A,f(),I=b.size>i,U=b.size>u.size,!I&&!U)return x(100),c(b);var _;return C=u.size,z=b.size,B=z,N=r,h=!v.alwaysKeepResolution&&I,(_=(function(P){for(;P;){if(P.then)return void P.then(_,e);try{if(P.pop){if(P.length)return P.pop()?o.call(this):P;P=m}else P=P.call(this)}catch(D){return e(D)}}}).bind(this))(m)}}catch(m){return e(m)}}).bind(this),e)}catch(A){return e(A)}}).bind(this),e)}catch(j){return e(j)}}).bind(this),e)}catch(S){return e(S)}}).bind(this),e)})}const Dr=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Dn;function Rr(u,v){return new Promise((R,c)=>{Dn||(Dn=function(d){const i=[];return i.push(d),URL.createObjectURL(new Blob(i))}(Dr));const e=new Worker(Dn);e.addEventListener("message",function(d){if(v.signal&&v.signal.aborted)e.terminate();else if(d.data.progress===void 0){if(d.data.error)return c(new Error(d.data.error)),void e.terminate();R(d.data.file),e.terminate()}else v.onProgress(d.data.progress)}),e.addEventListener("error",c),v.signal&&v.signal.addEventListener("abort",()=>{c(v.signal.reason),e.terminate()}),e.postMessage({file:u,imageCompressionLibUrl:v.libURL,options:{...v,onProgress:void 0,signal:void 0}})})}function Ne(u,v){return new Promise(function(R,c){let e,t,d,i,y,w;if(e={...v},d=0,{onProgress:i}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,y=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=l=>{d=l,typeof i=="function"&&i(d)},!(u instanceof Blob||u instanceof Ir))return c(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(u.type))return c(new Error("The file given is not an image"));if(w=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!y||typeof Worker!="function"||w)return ns(u,e).then((function(l){try{return t=l,n.call(this)}catch(b){return c(b)}}).bind(this),c);var s=(function(){try{return n.call(this)}catch(l){return c(l)}}).bind(this),r=function(l){try{return ns(u,e).then(function(b){try{return t=b,s()}catch(I){return c(I)}},c)}catch(b){return c(b)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Rr(u,e).then(function(l){try{return t=l,s()}catch{return r()}},r)}catch{r()}function n(){try{t.name=u.name,t.lastModified=u.lastModified}catch{}try{e.preserveExif&&u.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===u.type)&&(t=Ss(u,t))}catch{}return R(t)}})}Ne.getDataUrlFromFile=Es,Ne.getFilefromDataUrl=Gn,Ne.loadImage=js,Ne.drawImageInCanvas=Ds,Ne.drawFileInCanvas=yn,Ne.canvasToFile=Tn,Ne.getExifOrientation=Rs,Ne.handleMaxWidthOrHeight=Fs,Ne.followExifOrientation=Os,Ne.cleanupCanvasMemory=it,Ne.isAutoOrientationInBrowser=It,Ne.approximateBelowMaximumCanvasSizeOfBrowser=Is,Ne.copyExifWithoutOrientation=Ss,Ne.getBrowserName=yt,Ne.version="2.0.2";function Fr(u){var v=typeof u;return u!=null&&(v=="object"||v=="function")}var Us=Fr,Or=typeof on=="object"&&on&&on.Object===Object&&on,Ur=Or,kr=Ur,Mr=typeof self=="object"&&self&&self.Object===Object&&self,Nr=kr||Mr||Function("return this")(),ks=Nr,Lr=ks,Pr=function(){return Lr.Date.now()},Br=Pr,Hr=/\s/;function zr(u){for(var v=u.length;v--&&Hr.test(u.charAt(v)););return v}var $r=zr,Wr=$r,Gr=/^\s+/;function Yr(u){return u&&u.slice(0,Wr(u)+1).replace(Gr,"")}var qr=Yr,Vr=ks,Qr=Vr.Symbol,Ms=Qr,ss=Ms,Ns=Object.prototype,Xr=Ns.hasOwnProperty,Kr=Ns.toString,$t=ss?ss.toStringTag:void 0;function Zr(u){var v=Xr.call(u,$t),R=u[$t];try{u[$t]=void 0;var c=!0}catch{}var e=Kr.call(u);return c&&(v?u[$t]=R:delete u[$t]),e}var Jr=Zr,ei=Object.prototype,ti=ei.toString;function ni(u){return ti.call(u)}var si=ni,rs=Ms,ri=Jr,ii=si,ai="[object Null]",oi="[object Undefined]",is=rs?rs.toStringTag:void 0;function li(u){return u==null?u===void 0?oi:ai:is&&is in Object(u)?ri(u):ii(u)}var ci=li;function di(u){return u!=null&&typeof u=="object"}var ui=di,fi=ci,hi=ui,mi="[object Symbol]";function gi(u){return typeof u=="symbol"||hi(u)&&fi(u)==mi}var pi=gi,bi=qr,as=Us,xi=pi,os=NaN,vi=/^[-+]0x[0-9a-f]+$/i,yi=/^0b[01]+$/i,Ti=/^0o[0-7]+$/i,Ai=parseInt;function Si(u){if(typeof u=="number")return u;if(xi(u))return os;if(as(u)){var v=typeof u.valueOf=="function"?u.valueOf():u;u=as(v)?v+"":v}if(typeof u!="string")return u===0?u:+u;u=bi(u);var R=yi.test(u);return R||Ti.test(u)?Ai(u.slice(2),R?2:8):vi.test(u)?os:+u}var wi=Si,Ci=Us,Rn=Br,ls=wi,_i="Expected a function",Ei=Math.max,ji=Math.min;function Ii(u,v,R){var c,e,t,d,i,y,w=0,s=!1,r=!1,n=!0;if(typeof u!="function")throw new TypeError(_i);v=ls(v)||0,Ci(R)&&(s=!!R.leading,r="maxWait"in R,t=r?Ei(ls(R.maxWait)||0,v):t,n="trailing"in R?!!R.trailing:n);function l(p){var N=c,h=e;return c=e=void 0,w=p,d=u.apply(h,N),d}function b(p){return w=p,i=setTimeout(C,v),s?l(p):d}function I(p){var N=p-y,h=p-w,f=v-N;return r?ji(f,t-h):f}function U(p){var N=p-y,h=p-w;return y===void 0||N>=v||N<0||r&&h>=t}function C(){var p=Rn();if(U(p))return z(p);i=setTimeout(C,I(p))}function z(p){return i=void 0,n&&c?l(p):(c=e=void 0,d)}function B(){i!==void 0&&clearTimeout(i),w=0,c=y=e=i=void 0}function F(){return i===void 0?d:z(Rn())}function H(){var p=Rn(),N=U(p);if(c=arguments,e=this,y=p,N){if(i===void 0)return b(y);if(r)return clearTimeout(i),i=setTimeout(C,v),l(y)}return i===void 0&&(i=setTimeout(C,v)),d}return H.cancel=B,H.flush=F,H}var Di=Ii;const Ri=dr(Di);var Yn={},Fi=mt;Object.defineProperty(Yn,"__esModule",{value:!0});var Ls=Yn.default=void 0,Oi=Fi(ht()),cs=a;Ls=Yn.default=(0,Oi.default)([(0,cs.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,cs.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn");var qn={},Ui=mt;Object.defineProperty(qn,"__esModule",{value:!0});var Ps=qn.default=void 0,ki=Ui(ht()),Mi=a;Ps=qn.default=(0,ki.default)((0,Mi.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut");var Vn={},Ni=mt;Object.defineProperty(Vn,"__esModule",{value:!0});var Bs=Vn.default=void 0,Li=Ni(ht()),Pi=a;Bs=Vn.default=(0,Li.default)((0,Pi.jsx)("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen");var Qn={},Bi=mt;Object.defineProperty(Qn,"__esModule",{value:!0});var Hs=Qn.default=void 0,Hi=Bi(ht()),zi=a;Hs=Qn.default=(0,Hi.default)((0,zi.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var Xn={},$i=mt;Object.defineProperty(Xn,"__esModule",{value:!0});var zs=Xn.default=void 0,Wi=$i(ht()),ds=a;zs=Xn.default=(0,Wi.default)([(0,ds.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,ds.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera");const Ot=$.forwardRef(({path:u,initialImages:v=[],onImagesUpdated:R,onDelete:c,isOwnDesign:e},t)=>{const[d,i]=$.useState(v.map(o=>({...o,deleted:!1}))),[y,w]=$.useState(!1),[s,r]=$.useState(0),[n,l]=$.useState(!1),[b,I]=$.useState(null),[U,C]=$.useState(1),[z,B]=$.useState(!1),[F,H]=$.useState(!1),[p,N]=$.useState(""),[h,f]=$.useState("info"),x=$.useRef(null);$.useEffect(()=>{console.log("Initial images received:",v),i(v.map(o=>({...o,deleted:!!o.deleted})))},[v]);const T=async o=>{const P=Array.from(o.target.files||[]);w(!0);const D={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},L=P.map(async(G,W)=>{let V=G;G.size>1024*1024&&(V=await Ne(G,D),N("Your image was compressed before uploading due to file size larger than 1 MB."),f("info"),H(!0));const O=`${new Date().getTime()}-${V.name}`,K=Dt(),ue=Rt(K,`${u}/${O}`),ie=Ts(ue,V);return new Promise((se,le)=>{ie.on("state_changed",ce=>{const fe=ce.bytesTransferred/ce.totalBytes*100;r(fe)},ce=>{console.error("Upload failed:",ce),le(ce)},()=>{As(ie.snapshot.ref).then(ce=>{se({url:ce,path:ue.fullPath,title:""})})})})});Promise.all(L).then(G=>{const W=[...d,...G];i(W),R&&R(W),N("Images uploaded successfully."),f("success"),H(!0),w(!1),r(0),x.current&&(x.current.value="")}).catch(G=>{console.error("Error uploading images: ",G),N("Failed to upload images."),f("error"),H(!0),w(!1),r(0)})},S=o=>{i(P=>{const D=P.map((L,G)=>G===o?{...L,deleted:!0}:L);return R(D),D}),N("Image marked for deletion. Update to permanently delete."),f("info"),H(!0)},j=async()=>{const o=d.filter(P=>P.deleted);if(console.log("Attempting to delete images:",o),o.length>0){const P=o.map(D=>{const L=Dt(),G=Rt(L,D.path);return un(G)});try{await Promise.all(P),c(o),i(D=>D.filter(L=>!L.deleted)),N("Deleted images have been permanently removed."),f("success")}catch(D){console.error("Error committing deletions:",D),N("Failed to commit deletions."),f("error")}H(!0)}else console.log("No images marked for deletion.")},A=o=>{B(!z),I(o)};$.useEffect(()=>{const o=()=>{const P=!!document.fullscreenElement;B(P)};return document.addEventListener("fullscreenchange",o),()=>document.removeEventListener("fullscreenchange",o)},[]);const _=(o,P)=>{P!=="clickaway"&&H(!1)},m=$.useCallback(Ri((o,P)=>{setTimeout(()=>{i(D=>{const L=D.map((G,W)=>W===o?{...G,title:P}:G);return R&&R(L),L})},0)},30),[R]);return $.useImperativeHandle(t,()=>({commitDeletions:j})),a.jsxs("div",{children:[e&&a.jsx(gn,{title:"Upload Images",children:a.jsxs(Be,{variant:"outlined",component:"label",startIcon:a.jsx(zs,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",a.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:T,disabled:y,ref:x,accept:"image/*"})]})}),y&&a.jsxs(a.Fragment,{children:[a.jsxs("p",{children:["Uploading... ",Math.round(s),"%"]}),a.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:a.jsx("div",{style:{height:"20px",width:`${s}%`,backgroundColor:"green"}})})]}),d.filter(o=>!o.deleted).map((o,P)=>a.jsxs("div",{children:[a.jsx("img",{src:o.url,alt:`Uploaded design ${P}`,onClick:()=>{l(!0),I(P)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&a.jsx(Xe,{onClick:()=>S(P),children:a.jsx(Xt,{})}),a.jsx("textarea",{value:o.title,onChange:D=>m(P,D.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},P)),a.jsx(Tt,{open:n,onClose:()=>l(!1),fullScreen:z,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:z?"none":void 0,maxHeight:z?"none":void 0,height:z?"100%":void 0,width:z?"100%":void 0,overflowY:"auto"}},children:b!==null&&a.jsxs(At,{children:[a.jsx("div",{style:{textAlign:"center"},children:a.jsx("img",{src:d[b].url,alt:`Zoomed Design ${b}`,style:{maxWidth:"100%",maxHeight:z?"100vh":void 0,transform:`scale(${U})`,transition:"transform 0.2s ease-out"}})}),a.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[a.jsx(Xe,{onClick:()=>C(U*1.2),children:a.jsx(Ls,{})}),a.jsx(Xe,{onClick:()=>C(U/1.2),style:{marginLeft:"10px"},children:a.jsx(Ps,{})}),a.jsx(Xe,{onClick:()=>A(b),style:{marginLeft:"10px"},children:a.jsx(Bs,{})}),z&&a.jsx(Xe,{onClick:()=>A(b),style:{position:"absolute",top:20,right:20},children:a.jsx(Hs,{})})]})]})}),a.jsx(St,{open:F,autoHideDuration:6e3,onClose:_,children:a.jsx(wt,{onClose:_,severity:h,sx:{width:"100%"},children:p})})]})});/*! @license DOMPurify 3.2.3 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.3/LICENSE */const{entries:$s,setPrototypeOf:us,isFrozen:Gi,getPrototypeOf:Yi,getOwnPropertyDescriptor:qi}=Object;let{freeze:He,seal:Ke,create:Ws}=Object,{apply:Bn,construct:Hn}=typeof Reflect<"u"&&Reflect;He||(He=function(v){return v});Ke||(Ke=function(v){return v});Bn||(Bn=function(v,R,c){return v.apply(R,c)});Hn||(Hn=function(v,R){return new v(...R)});const ln=We(Array.prototype.forEach),fs=We(Array.prototype.pop),Wt=We(Array.prototype.push),hn=We(String.prototype.toLowerCase),Fn=We(String.prototype.toString),hs=We(String.prototype.match),Gt=We(String.prototype.replace),Vi=We(String.prototype.indexOf),Qi=We(String.prototype.trim),st=We(Object.prototype.hasOwnProperty),Pe=We(RegExp.prototype.test),Yt=Xi(TypeError);function We(u){return function(v){for(var R=arguments.length,c=new Array(R>1?R-1:0),e=1;e<R;e++)c[e-1]=arguments[e];return Bn(u,v,c)}}function Xi(u){return function(){for(var v=arguments.length,R=new Array(v),c=0;c<v;c++)R[c]=arguments[c];return Hn(u,R)}}function ae(u,v){let R=arguments.length>2&&arguments[2]!==void 0?arguments[2]:hn;us&&us(u,null);let c=v.length;for(;c--;){let e=v[c];if(typeof e=="string"){const t=R(e);t!==e&&(Gi(v)||(v[c]=t),e=t)}u[e]=!0}return u}function Ki(u){for(let v=0;v<u.length;v++)st(u,v)||(u[v]=null);return u}function vt(u){const v=Ws(null);for(const[R,c]of $s(u))st(u,R)&&(Array.isArray(c)?v[R]=Ki(c):c&&typeof c=="object"&&c.constructor===Object?v[R]=vt(c):v[R]=c);return v}function qt(u,v){for(;u!==null;){const c=qi(u,v);if(c){if(c.get)return We(c.get);if(typeof c.value=="function")return We(c.value)}u=Yi(u)}function R(){return null}return R}const ms=He(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),On=He(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Un=He(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Zi=He(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),kn=He(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Ji=He(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),gs=He(["#text"]),ps=He(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Mn=He(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),bs=He(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),cn=He(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),ea=Ke(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ta=Ke(/<%[\w\W]*|[\w\W]*%>/gm),na=Ke(/\$\{[\w\W]*}/gm),sa=Ke(/^data-[\-\w.\u00B7-\uFFFF]+$/),ra=Ke(/^aria-[\-\w]+$/),Gs=Ke(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ia=Ke(/^(?:\w+script|data):/i),aa=Ke(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Ys=Ke(/^html$/i),oa=Ke(/^[a-z][.\w]*(-[.\w]+)+$/i);var xs=Object.freeze({__proto__:null,ARIA_ATTR:ra,ATTR_WHITESPACE:aa,CUSTOM_ELEMENT:oa,DATA_ATTR:sa,DOCTYPE_NAME:Ys,ERB_EXPR:ta,IS_ALLOWED_URI:Gs,IS_SCRIPT_OR_DATA:ia,MUSTACHE_EXPR:ea,TMPLIT_EXPR:na});const Vt={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},la=function(){return typeof window>"u"?null:window},ca=function(v,R){if(typeof v!="object"||typeof v.createPolicy!="function")return null;let c=null;const e="data-tt-policy-suffix";R&&R.hasAttribute(e)&&(c=R.getAttribute(e));const t="dompurify"+(c?"#"+c:"");try{return v.createPolicy(t,{createHTML(d){return d},createScriptURL(d){return d}})}catch{return console.warn("TrustedTypes policy "+t+" could not be created."),null}},vs=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function qs(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:la();const v=J=>qs(J);if(v.version="3.2.3",v.removed=[],!u||!u.document||u.document.nodeType!==Vt.document)return v.isSupported=!1,v;let{document:R}=u;const c=R,e=c.currentScript,{DocumentFragment:t,HTMLTemplateElement:d,Node:i,Element:y,NodeFilter:w,NamedNodeMap:s=u.NamedNodeMap||u.MozNamedAttrMap,HTMLFormElement:r,DOMParser:n,trustedTypes:l}=u,b=y.prototype,I=qt(b,"cloneNode"),U=qt(b,"remove"),C=qt(b,"nextSibling"),z=qt(b,"childNodes"),B=qt(b,"parentNode");if(typeof d=="function"){const J=R.createElement("template");J.content&&J.content.ownerDocument&&(R=J.content.ownerDocument)}let F,H="";const{implementation:p,createNodeIterator:N,createDocumentFragment:h,getElementsByTagName:f}=R,{importNode:x}=c;let T=vs();v.isSupported=typeof $s=="function"&&typeof B=="function"&&p&&p.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:S,ERB_EXPR:j,TMPLIT_EXPR:A,DATA_ATTR:_,ARIA_ATTR:m,IS_SCRIPT_OR_DATA:o,ATTR_WHITESPACE:P,CUSTOM_ELEMENT:D}=xs;let{IS_ALLOWED_URI:L}=xs,G=null;const W=ae({},[...ms,...On,...Un,...kn,...gs]);let V=null;const Y=ae({},[...ps,...Mn,...bs,...cn]);let O=Object.seal(Ws(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),K=null,ue=null,ie=!0,se=!0,le=!1,ce=!0,fe=!1,Oe=!0,Te=!1,me=!1,ye=!1,de=!1,he=!1,pe=!1,Se=!0,be=!1;const je="user-content-";let xe=!0,ne=!1,we={},Ce=null;const ot=ae({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ae=null;const Ge=ae({},["audio","video","img","source","image","track"]);let te=null;const Ue=ae({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),re="http://www.w3.org/1998/Math/MathML",ke="http://www.w3.org/2000/svg",ee="http://www.w3.org/1999/xhtml";let Ee=ee,Ie=!1,gt=null;const pt=ae({},[re,ke,ee],Fn);let lt=ae({},["mi","mo","mn","ms","mtext"]),Ye=ae({},["annotation-xml"]);const Nt=ae({},["title","style","font","a","script"]);let Me=null;const qe=["application/xhtml+xml","text/html"],Ze="text/html";let ge=null,Je=null;const et=R.createElement("form"),Ve=function(E){return E instanceof RegExp||E instanceof Function},Ct=function(){let E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Je&&Je===E)){if((!E||typeof E!="object")&&(E={}),E=vt(E),Me=qe.indexOf(E.PARSER_MEDIA_TYPE)===-1?Ze:E.PARSER_MEDIA_TYPE,ge=Me==="application/xhtml+xml"?Fn:hn,G=st(E,"ALLOWED_TAGS")?ae({},E.ALLOWED_TAGS,ge):W,V=st(E,"ALLOWED_ATTR")?ae({},E.ALLOWED_ATTR,ge):Y,gt=st(E,"ALLOWED_NAMESPACES")?ae({},E.ALLOWED_NAMESPACES,Fn):pt,te=st(E,"ADD_URI_SAFE_ATTR")?ae(vt(Ue),E.ADD_URI_SAFE_ATTR,ge):Ue,Ae=st(E,"ADD_DATA_URI_TAGS")?ae(vt(Ge),E.ADD_DATA_URI_TAGS,ge):Ge,Ce=st(E,"FORBID_CONTENTS")?ae({},E.FORBID_CONTENTS,ge):ot,K=st(E,"FORBID_TAGS")?ae({},E.FORBID_TAGS,ge):{},ue=st(E,"FORBID_ATTR")?ae({},E.FORBID_ATTR,ge):{},we=st(E,"USE_PROFILES")?E.USE_PROFILES:!1,ie=E.ALLOW_ARIA_ATTR!==!1,se=E.ALLOW_DATA_ATTR!==!1,le=E.ALLOW_UNKNOWN_PROTOCOLS||!1,ce=E.ALLOW_SELF_CLOSE_IN_ATTR!==!1,fe=E.SAFE_FOR_TEMPLATES||!1,Oe=E.SAFE_FOR_XML!==!1,Te=E.WHOLE_DOCUMENT||!1,de=E.RETURN_DOM||!1,he=E.RETURN_DOM_FRAGMENT||!1,pe=E.RETURN_TRUSTED_TYPE||!1,ye=E.FORCE_BODY||!1,Se=E.SANITIZE_DOM!==!1,be=E.SANITIZE_NAMED_PROPS||!1,xe=E.KEEP_CONTENT!==!1,ne=E.IN_PLACE||!1,L=E.ALLOWED_URI_REGEXP||Gs,Ee=E.NAMESPACE||ee,lt=E.MATHML_TEXT_INTEGRATION_POINTS||lt,Ye=E.HTML_INTEGRATION_POINTS||Ye,O=E.CUSTOM_ELEMENT_HANDLING||{},E.CUSTOM_ELEMENT_HANDLING&&Ve(E.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(O.tagNameCheck=E.CUSTOM_ELEMENT_HANDLING.tagNameCheck),E.CUSTOM_ELEMENT_HANDLING&&Ve(E.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(O.attributeNameCheck=E.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),E.CUSTOM_ELEMENT_HANDLING&&typeof E.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(O.allowCustomizedBuiltInElements=E.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),fe&&(se=!1),he&&(de=!0),we&&(G=ae({},gs),V=[],we.html===!0&&(ae(G,ms),ae(V,ps)),we.svg===!0&&(ae(G,On),ae(V,Mn),ae(V,cn)),we.svgFilters===!0&&(ae(G,Un),ae(V,Mn),ae(V,cn)),we.mathMl===!0&&(ae(G,kn),ae(V,bs),ae(V,cn))),E.ADD_TAGS&&(G===W&&(G=vt(G)),ae(G,E.ADD_TAGS,ge)),E.ADD_ATTR&&(V===Y&&(V=vt(V)),ae(V,E.ADD_ATTR,ge)),E.ADD_URI_SAFE_ATTR&&ae(te,E.ADD_URI_SAFE_ATTR,ge),E.FORBID_CONTENTS&&(Ce===ot&&(Ce=vt(Ce)),ae(Ce,E.FORBID_CONTENTS,ge)),xe&&(G["#text"]=!0),Te&&ae(G,["html","head","body"]),G.table&&(ae(G,["tbody"]),delete K.tbody),E.TRUSTED_TYPES_POLICY){if(typeof E.TRUSTED_TYPES_POLICY.createHTML!="function")throw Yt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof E.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Yt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');F=E.TRUSTED_TYPES_POLICY,H=F.createHTML("")}else F===void 0&&(F=ca(l,e)),F!==null&&typeof H=="string"&&(H=F.createHTML(""));He&&He(E),Je=E}},Lt=ae({},[...On,...Un,...Zi]),en=ae({},[...kn,...Ji]),Sn=function(E){let g=B(E);(!g||!g.tagName)&&(g={namespaceURI:Ee,tagName:"template"});const k=hn(E.tagName),M=hn(g.tagName);return gt[E.namespaceURI]?E.namespaceURI===ke?g.namespaceURI===ee?k==="svg":g.namespaceURI===re?k==="svg"&&(M==="annotation-xml"||lt[M]):!!Lt[k]:E.namespaceURI===re?g.namespaceURI===ee?k==="math":g.namespaceURI===ke?k==="math"&&Ye[M]:!!en[k]:E.namespaceURI===ee?g.namespaceURI===ke&&!Ye[M]||g.namespaceURI===re&&!lt[M]?!1:!en[k]&&(Nt[k]||!Lt[k]):!!(Me==="application/xhtml+xml"&&gt[E.namespaceURI]):!1},Qe=function(E){Wt(v.removed,{element:E});try{B(E).removeChild(E)}catch{U(E)}},bt=function(E,g){try{Wt(v.removed,{attribute:g.getAttributeNode(E),from:g})}catch{Wt(v.removed,{attribute:null,from:g})}if(g.removeAttribute(E),E==="is")if(de||he)try{Qe(g)}catch{}else try{g.setAttribute(E,"")}catch{}},tn=function(E){let g=null,k=null;if(ye)E="<remove></remove>"+E;else{const q=hs(E,/^[\r\n\t ]+/);k=q&&q[0]}Me==="application/xhtml+xml"&&Ee===ee&&(E='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+E+"</body></html>");const M=F?F.createHTML(E):E;if(Ee===ee)try{g=new n().parseFromString(M,Me)}catch{}if(!g||!g.documentElement){g=p.createDocument(Ee,"template",null);try{g.documentElement.innerHTML=Ie?H:M}catch{}}const Q=g.body||g.documentElement;return E&&k&&Q.insertBefore(R.createTextNode(k),Q.childNodes[0]||null),Ee===ee?f.call(g,Te?"html":"body")[0]:Te?g.documentElement:Q},nn=function(E){return N.call(E.ownerDocument||E,E,w.SHOW_ELEMENT|w.SHOW_COMMENT|w.SHOW_TEXT|w.SHOW_PROCESSING_INSTRUCTION|w.SHOW_CDATA_SECTION,null)},Pt=function(E){return E instanceof r&&(typeof E.nodeName!="string"||typeof E.textContent!="string"||typeof E.removeChild!="function"||!(E.attributes instanceof s)||typeof E.removeAttribute!="function"||typeof E.setAttribute!="function"||typeof E.namespaceURI!="string"||typeof E.insertBefore!="function"||typeof E.hasChildNodes!="function")},xt=function(E){return typeof i=="function"&&E instanceof i};function tt(J,E,g){ln(J,k=>{k.call(v,E,g,Je)})}const Bt=function(E){let g=null;if(tt(T.beforeSanitizeElements,E,null),Pt(E))return Qe(E),!0;const k=ge(E.nodeName);if(tt(T.uponSanitizeElement,E,{tagName:k,allowedTags:G}),E.hasChildNodes()&&!xt(E.firstElementChild)&&Pe(/<[/\w]/g,E.innerHTML)&&Pe(/<[/\w]/g,E.textContent)||E.nodeType===Vt.progressingInstruction||Oe&&E.nodeType===Vt.comment&&Pe(/<[/\w]/g,E.data))return Qe(E),!0;if(!G[k]||K[k]){if(!K[k]&&sn(k)&&(O.tagNameCheck instanceof RegExp&&Pe(O.tagNameCheck,k)||O.tagNameCheck instanceof Function&&O.tagNameCheck(k)))return!1;if(xe&&!Ce[k]){const M=B(E)||E.parentNode,Q=z(E)||E.childNodes;if(Q&&M){const q=Q.length;for(let Z=q-1;Z>=0;--Z){const X=I(Q[Z],!0);X.__removalCount=(E.__removalCount||0)+1,M.insertBefore(X,C(E))}}}return Qe(E),!0}return E instanceof y&&!Sn(E)||(k==="noscript"||k==="noembed"||k==="noframes")&&Pe(/<\/no(script|embed|frames)/i,E.innerHTML)?(Qe(E),!0):(fe&&E.nodeType===Vt.text&&(g=E.textContent,ln([S,j,A],M=>{g=Gt(g,M," ")}),E.textContent!==g&&(Wt(v.removed,{element:E.cloneNode()}),E.textContent=g)),tt(T.afterSanitizeElements,E,null),!1)},Ht=function(E,g,k){if(Se&&(g==="id"||g==="name")&&(k in R||k in et))return!1;if(!(se&&!ue[g]&&Pe(_,g))){if(!(ie&&Pe(m,g))){if(!V[g]||ue[g]){if(!(sn(E)&&(O.tagNameCheck instanceof RegExp&&Pe(O.tagNameCheck,E)||O.tagNameCheck instanceof Function&&O.tagNameCheck(E))&&(O.attributeNameCheck instanceof RegExp&&Pe(O.attributeNameCheck,g)||O.attributeNameCheck instanceof Function&&O.attributeNameCheck(g))||g==="is"&&O.allowCustomizedBuiltInElements&&(O.tagNameCheck instanceof RegExp&&Pe(O.tagNameCheck,k)||O.tagNameCheck instanceof Function&&O.tagNameCheck(k))))return!1}else if(!te[g]){if(!Pe(L,Gt(k,P,""))){if(!((g==="src"||g==="xlink:href"||g==="href")&&E!=="script"&&Vi(k,"data:")===0&&Ae[E])){if(!(le&&!Pe(o,Gt(k,P,"")))){if(k)return!1}}}}}}return!0},sn=function(E){return E!=="annotation-xml"&&hs(E,D)},rn=function(E){tt(T.beforeSanitizeAttributes,E,null);const{attributes:g}=E;if(!g||Pt(E))return;const k={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:V,forceKeepAttr:void 0};let M=g.length;for(;M--;){const Q=g[M],{name:q,namespaceURI:Z,value:X}=Q,Re=ge(q);let ve=q==="value"?X:Qi(X);if(k.attrName=Re,k.attrValue=ve,k.keepAttr=!0,k.forceKeepAttr=void 0,tt(T.uponSanitizeAttribute,E,k),ve=k.attrValue,be&&(Re==="id"||Re==="name")&&(bt(q,E),ve=je+ve),Oe&&Pe(/((--!?|])>)|<\/(style|title)/i,ve)){bt(q,E);continue}if(k.forceKeepAttr||(bt(q,E),!k.keepAttr))continue;if(!ce&&Pe(/\/>/i,ve)){bt(q,E);continue}fe&&ln([S,j,A],an=>{ve=Gt(ve,an," ")});const _t=ge(E.nodeName);if(Ht(_t,Re,ve)){if(F&&typeof l=="object"&&typeof l.getAttributeType=="function"&&!Z)switch(l.getAttributeType(_t,Re)){case"TrustedHTML":{ve=F.createHTML(ve);break}case"TrustedScriptURL":{ve=F.createScriptURL(ve);break}}try{Z?E.setAttributeNS(Z,q,ve):E.setAttribute(q,ve),Pt(E)?Qe(E):fs(v.removed)}catch{}}}tt(T.afterSanitizeAttributes,E,null)},wn=function J(E){let g=null;const k=nn(E);for(tt(T.beforeSanitizeShadowDOM,E,null);g=k.nextNode();)tt(T.uponSanitizeShadowNode,g,null),Bt(g),rn(g),g.content instanceof t&&J(g.content);tt(T.afterSanitizeShadowDOM,E,null)};return v.sanitize=function(J){let E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=null,k=null,M=null,Q=null;if(Ie=!J,Ie&&(J="<!-->"),typeof J!="string"&&!xt(J))if(typeof J.toString=="function"){if(J=J.toString(),typeof J!="string")throw Yt("dirty is not a string, aborting")}else throw Yt("toString is not a function");if(!v.isSupported)return J;if(me||Ct(E),v.removed=[],typeof J=="string"&&(ne=!1),ne){if(J.nodeName){const X=ge(J.nodeName);if(!G[X]||K[X])throw Yt("root node is forbidden and cannot be sanitized in-place")}}else if(J instanceof i)g=tn("<!---->"),k=g.ownerDocument.importNode(J,!0),k.nodeType===Vt.element&&k.nodeName==="BODY"||k.nodeName==="HTML"?g=k:g.appendChild(k);else{if(!de&&!fe&&!Te&&J.indexOf("<")===-1)return F&&pe?F.createHTML(J):J;if(g=tn(J),!g)return de?null:pe?H:""}g&&ye&&Qe(g.firstChild);const q=nn(ne?J:g);for(;M=q.nextNode();)Bt(M),rn(M),M.content instanceof t&&wn(M.content);if(ne)return J;if(de){if(he)for(Q=h.call(g.ownerDocument);g.firstChild;)Q.appendChild(g.firstChild);else Q=g;return(V.shadowroot||V.shadowrootmode)&&(Q=x.call(c,Q,!0)),Q}let Z=Te?g.outerHTML:g.innerHTML;return Te&&G["!doctype"]&&g.ownerDocument&&g.ownerDocument.doctype&&g.ownerDocument.doctype.name&&Pe(Ys,g.ownerDocument.doctype.name)&&(Z="<!DOCTYPE "+g.ownerDocument.doctype.name+`>
`+Z),fe&&ln([S,j,A],X=>{Z=Gt(Z,X," ")}),F&&pe?F.createHTML(Z):Z},v.setConfig=function(){let J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ct(J),me=!0},v.clearConfig=function(){Je=null,me=!1},v.isValidAttribute=function(J,E,g){Je||Ct({});const k=ge(J),M=ge(E);return Ht(k,M,g)},v.addHook=function(J,E){typeof E=="function"&&Wt(T[J],E)},v.removeHook=function(J){return fs(T[J])},v.removeHooks=function(J){T[J]=[]},v.removeAllHooks=function(){T=vs()},v}var Nn=qs();const at=({onChange:u,initialValue:v})=>{const[R,c]=$.useState(Nn.sanitize(v||"")),e=$.useRef(!1),t=$.useRef(null),[d,i]=$.useState("");$.useEffect(()=>{e.current?c(Nn.sanitize(v||"")):e.current=!0},[v]);const y=(l,b)=>{const I=b.getData(),U=Nn.sanitize(I);c(U),u(U)},w=l=>{if(!t.current){console.warn("Editor not initialized");return}const b=t.current;b.model.change(I=>{const U=b.model.document.selection.getFirstPosition();I.insertText(l,U)}),i("")},s=l=>{w(l.target.value)},r=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],n=["°","+","-","=","~","≥","≤","≠",">","<","*","/","%"];return a.jsxs("div",{children:[a.jsxs(dn,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%"},children:[a.jsx(ur,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),a.jsx(ts,{variant:"standard",sx:{m:1,minWidth:40},children:a.jsxs(pn,{labelId:"math-operators-label",id:"math-operators",value:d,onChange:s,displayEmpty:!0,children:[a.jsx(jt,{value:"",disabled:!0,children:"Math"}),n.map(l=>a.jsx(jt,{value:l,children:l},l))]})}),a.jsx(ts,{variant:"standard",sx:{m:1,minWidth:40},children:a.jsxs(pn,{labelId:"greek-letters-label",id:"greek-letters",value:d,onChange:s,displayEmpty:!0,children:[a.jsx(jt,{value:"",disabled:!0,children:"Greek"}),r.map(l=>a.jsx(jt,{value:l,children:l},l))]})})]}),a.jsx(fr.CKEditor,{editor:hr,data:R,onReady:l=>{t.current=l},config:{toolbar:["undo","redo","|","heading","bold","italic","|","bulletedList","numberedList","blockQuote","indent","outdent","|","link","insertTable","|"],table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]}},onChange:y})]})};var Kn={},da=mt;Object.defineProperty(Kn,"__esModule",{value:!0});var Vs=Kn.default=void 0,ua=da(ht()),fa=a;Vs=Kn.default=(0,ua.default)((0,fa.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile");var Zn={},ha=mt;Object.defineProperty(Zn,"__esModule",{value:!0});var Qs=Zn.default=void 0,ma=ha(ht()),ga=a;Qs=Zn.default=(0,ma.default)((0,ga.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload");const Ut=({path:u,initialFiles:v,onFilesChange:R,isOwnDesign:c})=>{const[e,t]=$.useState(v.map(x=>({...x,deleted:!!x.deleted}))),[d,i]=$.useState(!1),[y,w]=$.useState(0),[s,r]=$.useState({}),[n,l]=$.useState(!1),[b,I]=$.useState(""),[U,C]=$.useState("info"),z=$.useRef(null);$.useEffect(()=>{console.log("Initial files received:",v),t(v.map(x=>({...x,deleted:!!x.deleted})))},[v]),$.useEffect(()=>()=>{r({})},[]);const B=x=>{console.log("Updating files with",x),R(x),t(x)},F=async x=>{if(!x.target.files)return;const S=Array.from(x.target.files).filter(A=>A.size>5242880?(I("File size should not exceed 5 MB"),C("error"),l(!0),!1):!0);i(!0);const j=S.map(A=>{const _=new Date().getTime(),m=`${_}-${A.name}`,o=Dt(),P=Rt(o,`${u}/${m}`),D=Ts(P,A);return new Promise((L,G)=>{D.on("state_changed",W=>{const V=W.bytesTransferred/W.totalBytes*100;w(V)},W=>{console.error("Upload failed:",W),G(W)},()=>{As(D.snapshot.ref).then(W=>{L({id:_.toString(),url:W,name:A.name,path:P.fullPath})})})})});Promise.all(j).then(A=>{const _=[...e.filter(m=>!m.deleted),...A];B(_),I("Files uploaded successfully."),C("success"),l(!0),i(!1),w(0),z.current&&(z.current.value="")}).catch(A=>{console.error("Error uploading files: ",A),I("Failed to upload files."),C("error"),l(!0),i(!1),w(0)})},H=x=>{const T=e.map(S=>S.id===x?{...S,deleted:!0}:S);B(T),I("File marked for deletion. Update to permanently delete."),C("info"),l(!0)},p=x=>{r(T=>{var S;return{...T,[x]:((S=e.find(j=>j.id===x))==null?void 0:S.name)||""}}),console.log("editStates after handleEditClick:",s)},N=x=>{t(T=>{const S=T.map(j=>j.id===x&&s[x]!==void 0?{...j,name:s[x]}:j);return R(S),S}),r(T=>{const S={...T};return delete S[x],S}),I("File name updated successfully."),C("info"),l(!0)},h=(x,T)=>{r(S=>({...S,[x]:T}))},f=(x,T)=>{T!=="clickaway"&&l(!1)};return a.jsxs("div",{children:[c&&a.jsx(gn,{title:"Upload Files",children:a.jsxs(Be,{variant:"outlined",component:"label",startIcon:a.jsx(Qs,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",a.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:F,disabled:d,ref:z})]})}),d&&a.jsx("div",{children:a.jsxs("p",{children:["Uploading... ",Math.round(y),"%"]})}),a.jsx(mr,{children:e.map(x=>a.jsxs(gr,{component:"div",disabled:x.deleted,children:[a.jsx(Ar,{children:a.jsx(Vs,{})}),typeof s[x.id]=="string"?a.jsx(bn,{variant:"outlined",size:"small",value:s[x.id],onChange:T=>h(x.id,T.target.value),onKeyPress:T=>T.key==="Enter"&&N(x.id),fullWidth:!0}):a.jsx(pr,{primary:x.name,secondary:a.jsx("a",{href:x.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),c&&(typeof s[x.id]=="string"?a.jsx(Xe,{onClick:()=>N(x.id),edge:"end","aria-label":"save",children:a.jsx(Pn,{})}):a.jsxs(a.Fragment,{children:[a.jsx(Xe,{onClick:()=>p(x.id),edge:"end","aria-label":"edit",children:a.jsx(ys,{})}),a.jsx(Xe,{onClick:()=>H(x.id),edge:"end","aria-label":"delete",children:a.jsx(Xt,{})})]}))]},x.id))}),a.jsx(St,{open:n,autoHideDuration:6e3,onClose:f,children:a.jsx(wt,{onClose:f,severity:U,sx:{width:"100%"},children:b})})]})},pa=({designs:u,setDesigns:v,setIsAdding:R,getDesigns:c,onReturnToDashboard:e})=>{const{userDetails:t}=Zt();console.log("Add Design loaded");const[d,i]=$.useState(""),[y,w]=$.useState(""),[s,r]=$.useState(""),[n,l]=$.useState([]),[b,I]=$.useState([]),U=$.useMemo(()=>n,[n]),[C,z]=$.useState(!1),[B,F]=$.useState(""),[H,p]=$.useState("info"),[N,h]=$.useState(!1),[f,x]=$.useState("");console.log("Adding New Design from user:",t);const T=$.useRef(null),S=()=>{h(!1)},j=(_,m)=>{m!=="clickaway"&&z(!1)};$.useEffect(()=>{if(t!=null&&t.classes){const _=Object.entries(t.classes).filter(([,m])=>m.number!=="Public");w(_.length>0?_[0][0]:"")}},[t==null?void 0:t.classes]);const A=async _=>{var D;if(_.preventDefault(),console.log("Files to be saved:",b),!t||!t.uid){console.error("User object is undefined or missing UID."),x("You must be signed in to add a design."),h(!0);return}if(!d){x("All fields are required."),h(!0);return}await((D=T.current)==null?void 0:D.commitDeletions());const m=n.filter(L=>!L.deleted),o=b.filter(L=>!L.deleted).map(L=>({id:L.id,url:L.url,name:L.name,path:L.path})),P={title:s,description:d,course:y,dateCreated:Kt(),dateModified:Kt(),images:m,files:o,userId:t.uid};try{const L=await $n(Fe(oe,"designs"),P),G={...P,id:L.id};v([...u,G]),F(`${s} has been Added.`),p("success"),z(!0),r(""),i(""),l([]),I([]),setTimeout(()=>{R(!1),c()},1e3)}catch(L){console.log(L),x("There was an issue adding your design."),h(!0)}};return a.jsxs("div",{className:"small-container",children:[a.jsx("button",{onClick:e,className:"muted-button margin-top-20",children:"← All Designs"}),a.jsx("div",{className:"design-record",children:a.jsxs("form",{onSubmit:A,children:[a.jsx("h1",{className:"designHeader",children:"New Design"}),a.jsx("div",{style:{display:"flex",alignItems:"center"},children:a.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[a.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),a.jsx("input",{id:"title",type:"text",name:"title",value:s,onChange:_=>r(_.target.value),style:{width:"100%"}})]})}),a.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),a.jsx(pn,{id:"course",value:y,onChange:_=>w(_.target.value),fullWidth:!0,children:(t!=null&&t.classes?Object.entries(t.classes):[]).filter(([,_])=>_.number!=="Public").map(([_,m])=>a.jsx(jt,{value:_,children:`${m.number} - ${m.title}`},_))}),a.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),a.jsxs("ul",{children:[a.jsx("li",{children:"Objective: What is the goal for this design?"}),a.jsx("li",{children:"Rationale: Why is this new design being done?"}),a.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),a.jsx("li",{children:"Functional Modification: What is being done to this target?"}),a.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),a.jsx(at,{onChange:i,initialValue:d}),a.jsx(Ot,{ref:T,path:"designs/images",initialImages:U,onImagesUpdated:l,onDelete:_=>l(n.filter(m=>!_.includes(m)))}),a.jsx(Ut,{path:"designs/files",initialFiles:b,onFilesChange:I}),a.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[a.jsx(Be,{type:"submit",variant:"contained",sx:{fontSize:"1rem",mt:2,textTransform:"none",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"Add"}),a.jsx(Be,{onClick:()=>R(!1),style:{marginLeft:"12px"},variant:"outlined",sx:{fontSize:"1rem",mt:2,textTransform:"none",color:"currentColor",borderColor:"rgba(255, 0, 0, 0.5)",boxShadow:"none","&:hover":{borderColor:"rgba(255, 0, 0, 0.7)",backgroundColor:"rgba(255, 0, 0, 0.1)",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",color:"currentColor",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out, background-color 0.3s ease-in-out"},children:"Cancel"})]})]})}),a.jsxs(Tt,{open:N,onClose:S,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[a.jsx(kt,{id:"alert-dialog-title",children:"Notification"}),a.jsx(At,{children:a.jsx(Jt,{id:"alert-dialog-description",children:f})}),a.jsx(Mt,{children:a.jsx(Be,{onClick:S,autoFocus:!0,children:"Ok"})})]}),a.jsx(St,{open:C,autoHideDuration:1e3,onClose:j,children:a.jsx(wt,{onClose:j,severity:H,sx:{width:"100%"},children:B})})]})},ba=({designId:u,setIsAddingBuild:v,refreshBuilds:R})=>{const[c,e]=$.useState(""),[t,d]=$.useState(""),[i,y]=$.useState([]),[w,s]=$.useState([]),{userDetails:r}=Zt(),n=T=>{y(T)},l=T=>{s(T)};console.log("AddBuild loaded");const[b,I]=$.useState(!1),[U,C]=$.useState(""),[z,B]=$.useState(!1),[F,H]=$.useState(""),[p,N]=$.useState("info");console.log("Adding New Build by user:",r);const h=()=>{I(!1)},f=(T,S)=>{S!=="clickaway"&&B(!1)},x=async T=>{if(T.preventDefault(),!r||!r.uid){console.error("UserDetails object is undefined or missing UID."),C("You must be signed in to add a build."),I(!0);return}if(!t){C("Build description is required."),I(!0);return}const S=i.filter(A=>!A.deleted),j=w.filter(A=>!A.deleted).map(A=>({id:A.id,url:A.url,name:A.name,path:A.path}));try{const A=await $n(Fe(oe,"builds"),{title:c,description:t,design_ID:u,dateCreated:Kt(),userId:r.uid,images:S,files:j});console.log("Build added with ID: ",A.id),console.log("Added New Build by user:",r),H("Your build has been successfully added."),N("success"),B(!0),setTimeout(()=>{e(""),d(""),y([]),s([]),v(!1),R()},1e3)}catch(A){if(console.error("Error adding build: ",A),A instanceof Error){let _=`Failed to add the build. ${A.message}`;A.message==="permission-denied"&&(_="You do not have permission to perform this operation."),H(_),N("error"),B(!0)}else H("Failed to add the build. Please try again later."),N("error"),B(!0)}};return a.jsxs("div",{className:"small-container",children:[a.jsxs("form",{onSubmit:x,children:[a.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),a.jsx("input",{id:"buildTitle",type:"text",value:c,onChange:T=>e(T.target.value),style:{width:"100%",marginBottom:"20px"}}),a.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),a.jsx(at,{onChange:d,initialValue:t})," ",a.jsx(Ot,{path:`builds/${u}/images`,initialImages:i,onImagesUpdated:n}),a.jsx(Ut,{path:`builds/${u}/files`,initialFiles:w,onFilesChange:l}),a.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[a.jsx("input",{type:"submit",value:"Save"}),a.jsx("button",{style:{marginLeft:"12px"},onClick:()=>v(!1),className:"button muted-button",children:"Cancel"})]})]}),a.jsxs(Tt,{open:b,onClose:h,children:[a.jsx(kt,{children:"Notification"}),a.jsx(At,{children:a.jsx(Jt,{children:U})}),a.jsx(Mt,{children:a.jsx(Be,{onClick:h,children:"OK"})})]}),a.jsx(St,{open:z,autoHideDuration:6e3,onClose:f,children:a.jsx(wt,{onClose:f,severity:p,sx:{width:"100%"},children:F})})]})},xa=({designId:u,buildId:v,refreshTests:R,setAddingTestIdForBuild:c})=>{const[e,t]=$.useState(""),[d,i]=$.useState(""),[y,w]=$.useState(""),[s,r]=$.useState(""),[n,l]=$.useState([]),[b,I]=$.useState([]),{userDetails:U}=Zt();console.log("AddTest loaded");const[C,z]=$.useState(!1),[B,F]=$.useState(""),[H,p]=$.useState(!1),[N,h]=$.useState(""),[f,x]=$.useState("info"),T=j=>{I(j)},S=async()=>{if(!d){F("Test description cannot be empty!"),z(!0);return}const j=n.filter(_=>!_.deleted),A=b.filter(_=>!_.deleted).map(_=>({id:_.id,url:_.url,name:_.name,path:_.path}));try{await $n(Fe(oe,"tests"),{title:e,build_ID:v,design_ID:u,dateCreated:Kt(),description:d,results:y,conclusions:s,userId:U==null?void 0:U.uid,images:j,files:A}),setTimeout(()=>{R(v),t(""),i(""),w(""),r(""),l([]),I([]),c(!1)},1e3),h("Test added successfully"),x("success"),p(!0)}catch(_){console.error("Error adding test: ",_),h("Failed to add the test"),x("error"),p(!0)}};return a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),a.jsx("input",{id:"testTitle",type:"text",value:e,onChange:j=>t(j.target.value),style:{width:"100%",marginBottom:"20px"}}),a.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),a.jsx(at,{onChange:i,initialValue:d}),a.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),a.jsx(at,{onChange:w,initialValue:y}),a.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),a.jsx(at,{onChange:r,initialValue:s}),a.jsx(Ot,{path:`tests/${v}/images`,initialImages:n,onImagesUpdated:j=>{l(j)}}),a.jsx(Ut,{path:`tests/${v}/files`,initialFiles:b,onFilesChange:T}),a.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[a.jsx("button",{onClick:S,children:"Save"}),a.jsx("button",{style:{marginLeft:"12px"},onClick:()=>c(!1),className:"button muted-button",children:"Cancel"})]}),a.jsxs(Tt,{open:C,onClose:()=>z(!1),children:[a.jsx(kt,{children:"Notification"}),a.jsx(At,{children:a.jsx(Jt,{children:B})}),a.jsx(Mt,{children:a.jsx(Be,{onClick:()=>z(!1),children:"OK"})})]}),a.jsx(St,{open:H,autoHideDuration:6e3,onClose:()=>p(!1),children:a.jsx(wt,{onClose:()=>p(!1),severity:f,sx:{width:"100%"},children:N})})]})};var Jn={},va=mt;Object.defineProperty(Jn,"__esModule",{value:!0});var mn=Jn.default=void 0,ya=va(ht()),Ta=a;mn=Jn.default=(0,ya.default)((0,Ta.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff");const Qt=u=>u&&u instanceof zn?u.toDate().toLocaleString():"",Aa=({selectedDesign:u,setIsEditing:v,getDesigns:R,onReturnToDashboard:c})=>{const{userDetails:e,loading:t}=Zt(),d=u.id,i=u.userId===(e==null?void 0:e.uid);console.log("Edit page loaded"),console.log("Design ID:",d),console.log("Editing Design by user:",e);const[y,w]=$.useState(""),[s,r]=$.useState(u.description),[n,l]=$.useState(u.course||""),[b,I]=$.useState(Qt(u.dateCreated)),[U,C]=$.useState(Qt(u.dateModified)),[z,B]=$.useState([]),[F,H]=$.useState([]),p=$.useRef(null),[N,h]=$.useState(!1),[f,x]=$.useState([]),[T,S]=$.useState({}),[j,A]=$.useState({}),[_,m]=$.useState({}),o=$.useRef(null),[P,D]=$.useState({}),[L,G]=$.useState({}),[W,V]=$.useState({}),[Y,O]=$.useState(!1),[K,ue]=$.useState({}),[ie,se]=$.useState({}),[le,ce]=$.useState({}),[fe,Oe]=$.useState({}),[Te,me]=$.useState({}),ye=$.useRef(null),[de,he]=$.useState({}),[pe,Se]=$.useState({}),[be,je]=$.useState({}),[xe,ne]=$.useState(!1),[we,Ce]=$.useState(""),[ot,Ae]=$.useState(()=>{}),[Ge,te]=$.useState(!1),[Ue,re]=$.useState(""),[ke,ee]=$.useState("info"),[Ee,Ie]=$.useState({design:!1,builds:!1,tests:!1}),gt=async g=>{if(g.preventDefault(),!s){Ce("All fields are required."),ne(!0);return}console.log("About to check image deletions",p.current),console.log(p.current),console.log(z.some(q=>q.deleted)),p.current&&z.some(q=>q.deleted)&&(console.log("Committing deletions"),await p.current.commitDeletions());const k=z.filter(q=>!q.deleted);F.some(q=>q.deleted)&&await Ye();const M=F.filter(q=>!q.deleted);let Q={title:y,description:s,course:n,dateModified:Kt(),images:k.map(q=>({url:q.url,title:q.title,path:q.path})),files:M.map(q=>({id:q.id,url:q.url,name:q.name,path:q.path})),userId:e.uid};try{await ut(De(oe,"designs",d),Q,{merge:!0}),re("Your design has been updated."),ee("success"),te(!0);const q=zn.now();C(Qt(q))}catch(q){console.error("Error updating design:",q),re("There was an issue updating your design."),ee("error"),te(!0)}Ie(q=>({...q,design:!1}))};$.useEffect(()=>{u&&(r(u.description||""),w(u.title||""),l(u.course||""),(async()=>{const k=De(oe,"designs",d),M=await br(k);if(M.exists()){const Q=M.data();console.log("Fetched images:",Q.images),console.log("Fetched files:",Q.files),B(Q.images||[]),H(Q.files||[]),I(Qt(Q.dateCreated)),C(Qt(Q.dateModified))}})())},[u,d]);const pt=g=>{const k=z.filter(Q=>!g.some(q=>q.path===Q.path));console.log("Remaining images after deletion:",k),B(k);const M=k.map(Q=>({url:Q.url,title:Q.title,path:Q.path}));ut(De(oe,"designs",d),{images:M},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(Q=>console.error("Failed to update Firestore:",Q))},lt=g=>{JSON.stringify(z)!==JSON.stringify(g)&&(B(g),console.log("Updated images received:",g))},Ye=async()=>{const g=F.filter(k=>k.deleted);if(console.log("Files to delete:",g),g.length>0){const k=Dt(),M=g.map(Q=>{const q=Rt(k,Q.path);return un(q)});try{await Promise.all(M),console.log("Files deleted successfully");const Q=F.filter(q=>!q.deleted);H(Q),await jn(De(oe,"designs",u.id),{files:Q.map(q=>({id:q.id,url:q.url,name:q.name,path:q.path}))}),re("Deleted files have been permanently removed."),ee("success"),te(!0)}catch(Q){console.error("Failed to delete files: ",Q),re("Failed to delete files."),ee("error"),te(!0)}}},Nt=async g=>{var q,Z;try{await en(g)}catch(X){console.error("Error deleting files:",X),re("Failed to delete build files."),ee("error"),te(!0)}const k=((q=j[g])==null?void 0:q.filter(X=>!X.deleted).map(({url:X,path:Re,title:ve})=>({url:X,path:Re,title:ve})))||[],M=((Z=_[g])==null?void 0:Z.filter(X=>!X.deleted).map(X=>({id:X.id,url:X.url,name:X.name,path:X.path})))||[],Q={};k.length>0&&(Q.images=k),M.length>0&&(Q.files=M),T[g]!==void 0&&(Q.description=T[g]);try{const X=De(oe,"builds",g);await ut(X,Q,{merge:!0}),re("Your build has been updated."),ee("success"),te(!0),ge(),Ie(Re=>({...Re,builds:!1}))}catch(X){console.error("Error updating build:",X),re("Failed to update build."),ee("error"),te(!0)}},Me=(g,k)=>{G(M=>({...M,[g]:k}))},qe=(g,k)=>{S(M=>({...M,[g]:k})),Ie(M=>({...M,builds:!0}))},Ze=async g=>{const k=L[g];try{const M=De(oe,"builds",g);await ut(M,{title:k},{merge:!0}),G(Q=>{const q={...Q};return delete q[g],q}),ge()}catch(M){console.error("Failed to save build title:",M)}},ge=async()=>{if(!e){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",e==null?void 0:e.uid),console.log("Selected design ID for query:",u==null?void 0:u.id);let g;e.isAdmin?g=ze(Fe(oe,"builds"),_e("design_ID","==",d),rt("dateCreated")):g=ze(Fe(oe,"builds"),_e("design_ID","==",d),_e("userId","==",e.uid),rt("dateCreated")),console.log("Builds query details:",JSON.stringify(g,null,2));const k=await ft(g);console.log("Builds snapshot details:",JSON.stringify(k.docs.map(Q=>Q.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",k.docs.length);const M=k.docs.map(Q=>(console.log("Build doc path: ",Q.ref.path),{id:Q.id,...Q.data()}));x(M),console.log("New builds state after refresh:",M)}catch(g){console.error("Error refreshing builds:",g),g.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",g):console.error("An unexpected error occurred when trying to refresh builds:",g)}},Je=(g,k)=>{const M=De(oe,"builds",g),Q=j[g].filter(Z=>!k.some(X=>X.path===Z.path));A(Z=>({...Z,[g]:Q}));const q=Q.map(Z=>({url:Z.url,title:Z.title,path:Z.path}));ut(M,{images:q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),re("Build Image deletions updated."),ee("success")}).catch(Z=>{console.error("Failed to update build images in Firestore:",Z),re("Failed to update build image deletions."),ee("error")}),te(!0)},et=async g=>{const k=ze(Fe(oe,"tests"),_e("build_ID","==",g),_e("userId","==",e.uid)),M=await ft(k);for(const Q of M.docs)await Ft(De(oe,"tests",Q.id));await Ft(De(oe,"builds",g)),await ge(),re("Build and its tests (if any) deleted successfully."),ee("success"),te(!0)},Ve=g=>{Ce("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),Ae(()=>()=>et(g)),ne(!0)},Ct=(g,k)=>{A(M=>({...M,[g]:k}))},Lt=(g,k)=>{m(M=>({...M,[g]:k}))},en=async g=>{var M;const k=((M=_[g])==null?void 0:M.filter(Q=>Q.deleted))||[];if(console.log("Build files to delete:",k),k.length>0){const Q=Dt(),q=k.map(Z=>{const X=Rt(Q,Z.path);return un(X)});try{await Promise.all(q),console.log("Build files deleted successfully");const Z=_[g].filter(X=>!X.deleted);m(X=>({...X,[g]:Z})),await jn(De(oe,"builds",g),{files:Z.map(X=>({id:X.id,url:X.url,name:X.name,path:X.path}))}),console.log("Firestore successfully updated to remove deleted files"),re("Deleted build files have been permanently removed."),ee("success"),te(!0)}catch(Z){console.error("Failed to delete build files: ",Z),re("Failed to delete build files."),ee("error"),te(!0)}}},Sn=async(g,k)=>{var Z;try{await sn(g)}catch(X){console.error("Error deleting files:",X),re("Failed to delete build files."),ee("error"),te(!0)}const M={},Q=fe[g].filter(X=>!X.deleted).map(({url:X,path:Re,title:ve})=>({url:X,path:Re,title:ve})),q=((Z=Te[g])==null?void 0:Z.filter(X=>!X.deleted).map(X=>({id:X.id,url:X.url,name:X.name,path:X.path})))||[];K[g]!==void 0&&(M.description=K[g]),ie[g]!==void 0&&(M.results=ie[g]),le[g]!==void 0&&(M.conclusions=le[g]),M.images=Q,M.files=q;try{const X=De(oe,"tests",g);await ut(X,M,{merge:!0}),re("Your test has been updated."),ee("success"),te(!0),xt(k)}catch(X){console.error(`Error updating test ID: ${g}:`,X),re("There was an issue updating your test."),ee("error"),te(!0)}},Qe=(g,k)=>{Se(M=>({...M,[g]:k}))},bt=async(g,k)=>{const M=pe[g],Q=De(oe,"tests",g);await ut(Q,{title:M},{merge:!0}),Se(q=>{const Z={...q};return delete Z[g],Z}),xt(k)},tn=(g,k)=>{console.log(`Updating description for test ID ${g}:`,k),ue(M=>({...M,[g]:k})),Ie(M=>({...M,tests:!0}))},nn=(g,k)=>{console.log(`Updating results for test ID ${g}:`,k),se(M=>({...M,[g]:k})),Ie(M=>({...M,tests:!0}))},Pt=(g,k)=>{ce(M=>({...M,[g]:k})),Ie(M=>({...M,tests:!0}))};$.useEffect(()=>{!t&&e&&(async()=>{if(!e)return;let k;e.isAdmin?k=ze(Fe(oe,"builds"),_e("design_ID","==",d),rt("dateCreated")):k=ze(Fe(oe,"builds"),_e("design_ID","==",d),_e("userId","==",e.uid),rt("dateCreated"));const M=await ft(k);let Q=[],q={},Z={};for(const X of M.docs){const Re=X.data(),ve=X.id;Q.push({id:ve,...Re,images:Re.images||[],files:Re.files||[]}),Z[ve]=!0;let _t;e.isAdmin?_t=ze(Fe(oe,"tests"),_e("build_ID","==",ve),rt("dateCreated")):_t=ze(Fe(oe,"tests"),_e("build_ID","==",ve),_e("userId","==",e.uid),rt("dateCreated"));const an=await ft(_t);let es=[],Cn={},_n={};for(const dt of an.docs){const ct=dt.data();es.push({id:dt.id,...ct}),Cn[dt.id]=ct.images||[],_n[dt.id]=ct.files||[]}q[ve]=es,Oe(dt=>{let ct={...dt};for(const zt in Cn)ct[zt]=Cn[zt];return ct}),me(dt=>{let ct={...dt};for(const zt in _n)ct[zt]=_n[zt];return ct})}x(Q),V(q),je(Z)})()},[t,e,u.id,d]);const xt=async g=>{if(!e){console.log("User details not loaded yet");return}try{let k;e.isAdmin?k=ze(Fe(oe,"tests"),_e("build_ID","==",g),rt("dateCreated")):k=ze(Fe(oe,"tests"),_e("build_ID","==",g),_e("userId","==",e.uid),rt("dateCreated"));const Q=(await ft(k)).docs.map(X=>({id:X.id,...X.data(),images:X.data().images||[],files:X.data().files||[]}));V(X=>({...X,[g]:Q}));let q={},Z={};Q.forEach(X=>{q[X.id]=X.images,Z[X.id]=X.files}),Oe(q),me(Z)}catch(k){console.error("Error fetching tests:",k)}},tt=(g,k)=>{const M=De(oe,"tests",g),Q=fe[g].filter(Z=>!k.includes(Z));Oe(Z=>({...Z,[g]:Q}));const q=Q.map(({url:Z,path:X,title:Re})=>({url:Z,path:X,title:Re}));ut(M,{images:q},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),re("Test Image deletions updated."),ee("success")}).catch(Z=>{console.error("Failed to update test images in Firestore:",Z),re("Failed to update test image deletions."),ee("error")}),te(!0)},Bt=(g,k)=>{Oe(M=>({...M,[g]:k}))},Ht=(g,k)=>{me(M=>({...M,[g]:k}))},sn=async g=>{var M;const k=((M=Te[g])==null?void 0:M.filter(Q=>Q.deleted))||[];if(k.length>0){const Q=Dt(),q=k.map(Z=>{const X=Rt(Q,Z.path);return un(X)});try{await Promise.all(q);const Z=Te[g].filter(X=>!X.deleted);me(X=>({...X,[g]:Z})),await jn(De(oe,"tests",g),{files:Z.map(X=>({id:X.id,url:X.url,name:X.name,path:X.path}))}),re("Deleted test files have been permanently removed."),ee("success"),te(!0)}catch(Z){console.error("Failed to delete test files: ",Z),re("Failed to delete test files."),ee("error"),te(!0)}}},rn=async(g,k)=>{await Ft(De(oe,"tests",g)),await xt(k),re("Test deleted successfully."),ee("success"),te(!0)},wn=(g,k)=>{Ce("Are you sure you want to delete this test? This action cannot be undone."),Ae(()=>()=>rn(g,k)),ne(!0)},J=g=>{je(k=>({...k,[g]:!k[g]}))},E=()=>{const g=Object.entries(Ee).filter(([M,Q])=>Q).map(([M])=>M).join(", ");if(!g.length){c();return}const k=`You have unsaved changes in the following sections: ${g}. Are you sure you want to leave?`;Ce(k),Ae(()=>()=>{Ie({design:!1,builds:!1,tests:!1}),c()}),ne(!0)};return $.useEffect(()=>{const g=k=>{Object.values(Ee).some(Q=>Q)&&(k.preventDefault(),k.returnValue="")};return window.addEventListener("beforeunload",g),()=>window.removeEventListener("beforeunload",g)},[Ee]),a.jsxs("div",{className:"small-container",children:[a.jsx("button",{onClick:()=>{Object.values(Ee).some(k=>k)?E():c()},className:"muted-button margin-top-20",children:"← All Designs"}),a.jsx("div",{className:"design-record",children:a.jsxs("form",{onSubmit:gt,children:[a.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),a.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[a.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[a.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),a.jsx("input",{id:"title",type:"text",name:"title",value:y,onChange:g=>{w(g.target.value),Ie(k=>({...k,design:!0}))},style:{width:"100%"}})]}),a.jsxs("div",{style:{flexGrow:2},children:[a.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),a.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:b||"",readOnly:!0,style:{width:"100%"}})]}),a.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[a.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),a.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:U||"",readOnly:!0,style:{width:"100%"}})]})]}),a.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),a.jsx(pn,{id:"course",value:n,onChange:g=>{l(g.target.value),Ie(k=>({...k,design:!0}))},fullWidth:!0,children:a.jsx(jt,{value:n,children:n})}),a.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),a.jsxs("ul",{children:[a.jsx("li",{children:"Objective: What is the goal for this design?"}),a.jsx("li",{children:"Rationale: Why is this new design being done?"}),a.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),a.jsx("li",{children:"Functional Modification: What is being done to this target?"}),a.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),a.jsx(at,{initialValue:s,onChange:g=>{r(g),Ie(k=>({...k,design:!0}))}}),a.jsx(Ot,{ref:p,path:`designs/${u.id}/images`,initialImages:z,onImagesUpdated:lt,onDelete:pt,isOwnDesign:i}),a.jsx(Ut,{path:`designs/${u.id}/files`,initialFiles:F,onFilesChange:H,isOwnDesign:i}),i&&a.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[a.jsx("input",{type:"submit",value:"Update"}),a.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>v(!1),children:"Cancel"})]})]})}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex-space-between",children:[a.jsx("h2",{className:"buildsHeader",children:"Builds"}),i&&a.jsxs("button",{className:"button muted-button",onClick:()=>{h(!0),setTimeout(()=>{o.current&&o.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[a.jsx("span",{role:"img","aria-label":"Add Build",children:"➕"})," Build"]})]}),f.map((g,k)=>a.jsxs("div",{className:"build-record",children:[a.jsxs("div",{className:"flex-space-between align-items-center",children:[a.jsx("div",{children:L[g.id]!==void 0?a.jsx(bn,{variant:"outlined",size:"small",fullWidth:!0,value:L[g.id],onChange:M=>Me(g.id,M.target.value),onBlur:()=>Ze(g.id),autoFocus:!0,InputProps:{endAdornment:a.jsx(Xe,{onClick:()=>Ze(g.id),size:"small",children:a.jsx(Pn,{})})}}):a.jsx("div",{className:"buildTitle",onClick:()=>G(M=>({...M,[g.id]:g.title||`Build ${k+1}`})),style:{cursor:"pointer"},children:g.title||`Build ${k+1}`})}),a.jsxs("div",{children:[a.jsx("button",{onClick:()=>D(M=>({...M,[g.id]:!M[g.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:P[g.id]?a.jsx(mn,{}):a.jsx(In,{})}),i&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Ve(g.id),children:a.jsx(Xt,{})}),a.jsxs("button",{className:"button muted-button",onClick:()=>{O(g.id),setTimeout(()=>{ye.current&&ye.current.scrollIntoView({behavior:"smooth"})},100)},children:[a.jsx("span",{role:"img","aria-label":"Add Test",children:"➕"})," Test"]})]})]})]}),P[g.id]&&a.jsxs(a.Fragment,{children:[a.jsx(at,{initialValue:T[g.id]||g.description,onChange:M=>{qe(g.id,M)}}),a.jsx(Ot,{path:`builds/${g.id}/images`,initialImages:g.images,onImagesUpdated:M=>Ct(g.id,M),onDelete:M=>Je(g.id,M),isOwnDesign:i}),a.jsx(Ut,{path:`builds/${g.id}/files`,initialFiles:g.files,onFilesChange:M=>Lt(g.id,M),isOwnDesign:i}),i&&a.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:a.jsx("button",{onClick:()=>Nt(g.id),children:"Update"})}),a.jsx("div",{children:W[g.id]&&W[g.id].length>0&&a.jsx("button",{onClick:()=>J(g.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:be[g.id]?a.jsxs(a.Fragment,{children:[a.jsx(In,{style:{marginRight:"8px"}}),"Tests"]}):a.jsxs(a.Fragment,{children:[a.jsx(mn,{style:{marginRight:"8px"}}),"Tests"]})})}),!be[g.id]&&W[g.id]&&W[g.id].map((M,Q)=>a.jsxs("div",{className:"test-record",children:[a.jsxs("div",{className:"flex-space-between align-items-center",children:[a.jsx("div",{children:pe[M.id]!==void 0?a.jsx(bn,{variant:"outlined",size:"small",fullWidth:!0,value:pe[M.id],onChange:q=>Qe(M.id,q.target.value),onBlur:()=>bt(M.id,g.id),autoFocus:!0,InputProps:{endAdornment:a.jsx(Xe,{onClick:()=>bt(M.id,g.id),size:"small",children:a.jsx(Pn,{})})}}):a.jsx("div",{className:"testTitle",onClick:()=>Se(q=>({...q,[M.id]:M.title||`Test ${Q+1}`})),style:{cursor:"pointer"},children:M.title||`Test ${Q+1}`})}),a.jsxs("div",{children:[a.jsx("button",{onClick:()=>he(q=>({...q,[M.id]:!q[M.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:de[M.id]?a.jsx(mn,{}):a.jsx(In,{})}),i&&a.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>wn(M.id,g.id),children:a.jsx(Xt,{})})]})]}),de[M.id]&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",children:"Description"}),a.jsx(at,{initialValue:K[M.id]||M.description,onChange:q=>{tn(M.id,q)}})]}),a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",children:"Results"}),a.jsx(at,{initialValue:ie[M.id]||M.results,onChange:q=>{nn(M.id,q)}})]}),a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",children:"Conclusions"}),a.jsx(at,{initialValue:le[M.id]||M.conclusions,onChange:q=>{Pt(M.id,q)}})]}),a.jsxs("div",{children:[a.jsx(Ot,{path:`tests/${M.id}/images`,initialImages:fe[M.id]||[],onImagesUpdated:q=>Bt(M.id,q),onDelete:q=>tt(M.id,q),isOwnDesign:i}),a.jsx(Ut,{path:`tests/${M.id}/files`,initialFiles:Te[M.id]||[],onFilesChange:q=>Ht(M.id,q),isOwnDesign:i})]}),i&&a.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:a.jsx("button",{onClick:()=>Sn(M.id,g.id),children:"Update"})})]})]},M.id))]}),Y===g.id&&a.jsxs("div",{className:"new-test-record",ref:ye,children:[a.jsx("h3",{className:"newTestHeader",children:"New Test"}),a.jsx(xa,{designId:u.id,buildId:g.id,refreshTests:()=>xt(g.id),setAddingTestIdForBuild:O,onImagesUpdated:M=>Bt(g.id,M),onFilesChange:M=>Ht(g.id,M)})]})]},g.id)),a.jsx("div",{children:N&&a.jsxs("div",{className:"new-build-record",ref:o,children:[a.jsx("h3",{className:"newBuildHeader",children:"New Build"}),a.jsx(ba,{designId:u.id,setIsAddingBuild:h,refreshBuilds:ge,onImagesUpdated:g=>Ct(build.id,g),onFilesChange:g=>Lt(build.id,g)})]})})]}),a.jsxs(Tt,{open:xe,onClose:()=>ne(!1),children:[a.jsx(kt,{children:"Confirmation Required"}),a.jsx(At,{children:a.jsx(Jt,{children:we})}),a.jsxs(Mt,{children:[a.jsx(Be,{onClick:()=>ne(!1),children:"Cancel"}),a.jsx(Be,{onClick:()=>{ot(),ne(!1)},autoFocus:!0,children:"Confirm"})]})]}),a.jsx(St,{open:Ge,autoHideDuration:6e3,onClose:()=>te(!1),children:a.jsx(wt,{onClose:()=>te(!1),severity:ke,sx:{width:"100%"},children:Ue})})]})},Sa=()=>{const{userDetails:u,loading:v}=Zt();console.log("Dashboard loaded");const[R,c]=$.useState([]),[e,t]=$.useState([]),[d,i]=$.useState([]),[y,w]=$.useState(null),[s,r]=$.useState(!1),[n,l]=$.useState(!1),[b,I]=$.useState(!1),[U,C]=$.useState(""),[z,B]=$.useState(""),[F,H]=$.useState(!1),[p,N]=$.useState(null),[h,f]=$.useState(!1),[x,T]=$.useState(""),[S,j]=$.useState("info"),A=()=>{l(!1),r(!1),w(null),_()},_=$.useCallback(async()=>{if(!u)return;let D;const L=[],G=[],W=[];if(u.isSuperAdmin)D=ze(Fe(oe,"designs"),rt("dateCreated","desc"));else if(u.isAdmin){const Y=u.classes?Object.keys(u.classes):[];if(Y.length>0)D=ze(Fe(oe,"designs"),_e("course","in",Y),rt("dateCreated","desc"));else{t([]),i([]);return}}else D=ze(Fe(oe,"designs"),_e("userId","==",u.uid),rt("dateCreated","desc"));(await ft(D)).forEach(Y=>{const O=Y.data(),K={id:Y.id,title:O.title,description:O.description,course:O.course,dateCreated:O.dateCreated,dateModified:O.dateModified,userId:O.userId,images:O.images||[],files:O.files||[]};u.isSuperAdmin?O.userId===u.uid?L.push(K):O.userId!==u.uid&&O.course&&O.isAdmin?G.push(K):O.userId!==u.uid&&!O.isAdmin&&W.push(K):u.isAdmin?O.userId===u.uid?G.push(K):W.push(K):O.userId===u.uid&&W.push(K)}),c(L),t(G),i(W)},[u,oe]);$.useEffect(()=>{!v&&u&&_()},[u,v,_]);const m=D=>{const L=[...R,...e,...d].find(G=>G.id===D);w(L||null),l(!0)},o=D=>{N(D),C("Are you sure you want to delete this design? This action cannot be undone."),I(!0)},P=async()=>{if(p)if(z!==(u==null?void 0:u.uid))T("User ID confirmation failed. Enter the correct User ID."),j("error"),f(!0);else try{const D=ze(Fe(oe,"builds"),_e("design_ID","==",p),_e("userId","==",u.uid)),L=await ft(D);for(const G of L.docs){const W=G.id,V=ze(Fe(oe,"tests"),_e("build_ID","==",W),_e("userId","==",u.uid)),Y=await ft(V);for(const O of Y.docs)await Ft(De(oe,"tests",O.id));await Ft(De(oe,"builds",W))}await Ft(De(oe,"designs",p)),c(G=>G.filter(W=>W.id!==p)),t(G=>G.filter(W=>W.id!==p)),i(G=>G.filter(W=>W.id!==p)),T("Your design and its associated builds and tests have been deleted."),j("success"),f(!0)}catch(D){console.error("Error deleting design, builds, and tests: ",D),T("There was an issue deleting your design and its associated builds and tests."),j("error"),f(!0)}finally{B(""),H(!1),N(null)}};return a.jsxs("div",{className:"container",children:[!s&&!n&&a.jsxs(a.Fragment,{children:[a.jsx(Sr,{setIsAdding:r}),(u==null?void 0:u.isSuperAdmin)&&a.jsxs(a.Fragment,{children:[a.jsx("h2",{children:"Super Admin Designs"}),a.jsx(Et,{designs:R,handleEdit:m,handleDelete:o,isAdmin:!0,userDetails:u,showUserIdColumn:!0}),a.jsx("h2",{children:"Educator Designs"}),a.jsx(Et,{designs:e,handleEdit:m,handleDelete:o,isAdmin:!0,userDetails:u,showUserIdColumn:!0}),a.jsx("h2",{children:"Student Designs"}),a.jsx(Et,{designs:d,handleEdit:m,handleDelete:o,isAdmin:!1,userDetails:u,showUserIdColumn:!0})]}),(u==null?void 0:u.isAdmin)&&!u.isSuperAdmin&&a.jsxs(a.Fragment,{children:[a.jsx("h2",{children:"Educator Designs"}),a.jsx(Et,{designs:e,handleEdit:m,handleDelete:o,isAdmin:!0,userDetails:u,showUserIdColumn:!0}),a.jsx("h2",{children:"Student Designs"}),a.jsx(Et,{designs:d,handleEdit:m,handleDelete:o,isAdmin:!1,userDetails:u,showUserIdColumn:!0})]}),!(u!=null&&u.isAdmin)&&!(u!=null&&u.isSuperAdmin)&&a.jsxs(a.Fragment,{children:[a.jsx("h2",{children:"Student Designs"}),a.jsx(Et,{designs:d,handleEdit:m,handleDelete:o,isAdmin:!1,userDetails:u,showUserIdColumn:!1})]})]}),s&&a.jsx(pa,{designs:R.concat(e),setDesigns:t,setIsAdding:r,getDesigns:_,onReturnToDashboard:A}),n&&a.jsx(Aa,{designs:R.concat(e),selectedDesign:y,setDesigns:t,setIsEditing:l,getDesigns:_,onReturnToDashboard:A}),a.jsxs(Tt,{open:b,onClose:()=>I(!1),PaperProps:{style:{minWidth:500}},children:[a.jsx(kt,{children:"Confirm Deletion"}),a.jsx(At,{children:a.jsx(Jt,{children:U})}),a.jsxs(Mt,{children:[a.jsx(Be,{onClick:()=>I(!1),children:"No, cancel"}),a.jsx(Be,{onClick:()=>{H(!0),I(!1)},color:"primary",children:"Yes, delete it"})]})]}),a.jsxs(Tt,{open:F,onClose:()=>H(!1),PaperProps:{style:{minWidth:500}},children:[a.jsx(kt,{children:"Confirm Your User ID"}),a.jsx(At,{children:a.jsx(bn,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:z,onChange:D=>B(D.target.value)})}),a.jsxs(Mt,{children:[a.jsx(Be,{onClick:()=>H(!1),children:"No, cancel"}),a.jsx(Be,{onClick:P,color:"primary",children:"Confirm"})]})]}),a.jsx(St,{open:h,autoHideDuration:6e3,onClose:()=>f(!1),children:a.jsx(wt,{onClose:()=>f(!1),severity:S,sx:{width:"100%"},children:x})})]})},_a=xr.memo(Sa);export{_a as default};
