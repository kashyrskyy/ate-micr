import{n as As,k as Ss,o as Cs,_ as mt,b as G,y as ws,f as _s,Q as Un,j as i,g as Mn,i as Es,B as rr,p as ir,x as an,R as Jn,U as es,V as ar,W as or,X as Nt,Y as lr,F as Qt,I as Me,T as cr,Z as ts,J as Xt,$ as dr,S as gt,K as pt,a0 as ur,a1 as fr,a2 as hr,a3 as mr,a4 as Sn,a5 as ze,a6 as gr,a7 as Qe,a8 as js,a9 as Zt,aa as Bn,ab as on,ac as pr,A as bt,C as xt,ad as St,ae as Ct,af as Dt,ag as Rt,ah as Is,ai as Ds,aj as fn,ak as br,al as ns,am as ss,an as xr,ao as vr,ap as yr,aq as Tr,H as pn,ar as Ar,as as Nn,at as Ut,au as Kt,av as Mt,aw as Hn,ax as $n,ay as Fe,az as ae,aA as ft,aB as De,aC as Sr,aD as Cn,aE as Pe,aF as Ee,aG as rt,aH as ht,aI as Ft,aJ as Cr}from"./index-DLNCr8k-.js";import{d as wn}from"./Visibility-rxqDTiw1.js";function wr(a){return Ss("MuiListItemIcon",a)}const rs=As("MuiListItemIcon",["root","alignItemsFlexStart"]),_r=["className"],Er=a=>{const{alignItems:b,classes:D}=a;return Es({root:["root",b==="flex-start"&&"alignItemsFlexStart"]},wr,D)},jr=Cs("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(a,b)=>{const{ownerState:D}=a;return[b.root,D.alignItems==="flex-start"&&b.alignItemsFlexStart]}})(({theme:a,ownerState:b})=>mt({minWidth:56,color:(a.vars||a).palette.action.active,flexShrink:0,display:"inline-flex"},b.alignItems==="flex-start"&&{marginTop:8})),Ir=G.forwardRef(function(b,D){const c=ws({props:b,name:"MuiListItemIcon"}),{className:e}=c,t=_s(c,_r),f=G.useContext(Un),o=mt({},c,{alignItems:f.alignItems}),p=Er(o);return i.jsx(jr,mt({className:Mn(p.root,e),ownerState:o,ref:D},t))});function Dr(a){return Ss("MuiMenuItem",a)}const zt=As("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),Rr=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],Fr=(a,b)=>{const{ownerState:D}=a;return[b.root,D.dense&&b.dense,D.divider&&b.divider,!D.disableGutters&&b.gutters]},kr=a=>{const{disabled:b,dense:D,divider:c,disableGutters:e,selected:t,classes:f}=a,p=Es({root:["root",D&&"dense",b&&"disabled",!e&&"gutters",c&&"divider",t&&"selected"]},Dr,f);return mt({},f,p)},Or=Cs(rr,{shouldForwardProp:a=>ir(a)||a==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:Fr})(({theme:a,ownerState:b})=>mt({},a.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!b.disableGutters&&{paddingLeft:16,paddingRight:16},b.divider&&{borderBottom:`1px solid ${(a.vars||a).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(a.vars||a).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${zt.selected}`]:{backgroundColor:a.vars?`rgba(${a.vars.palette.primary.mainChannel} / ${a.vars.palette.action.selectedOpacity})`:an(a.palette.primary.main,a.palette.action.selectedOpacity),[`&.${zt.focusVisible}`]:{backgroundColor:a.vars?`rgba(${a.vars.palette.primary.mainChannel} / calc(${a.vars.palette.action.selectedOpacity} + ${a.vars.palette.action.focusOpacity}))`:an(a.palette.primary.main,a.palette.action.selectedOpacity+a.palette.action.focusOpacity)}},[`&.${zt.selected}:hover`]:{backgroundColor:a.vars?`rgba(${a.vars.palette.primary.mainChannel} / calc(${a.vars.palette.action.selectedOpacity} + ${a.vars.palette.action.hoverOpacity}))`:an(a.palette.primary.main,a.palette.action.selectedOpacity+a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:a.vars?`rgba(${a.vars.palette.primary.mainChannel} / ${a.vars.palette.action.selectedOpacity})`:an(a.palette.primary.main,a.palette.action.selectedOpacity)}},[`&.${zt.focusVisible}`]:{backgroundColor:(a.vars||a).palette.action.focus},[`&.${zt.disabled}`]:{opacity:(a.vars||a).palette.action.disabledOpacity},[`& + .${Jn.root}`]:{marginTop:a.spacing(1),marginBottom:a.spacing(1)},[`& + .${Jn.inset}`]:{marginLeft:52},[`& .${es.root}`]:{marginTop:0,marginBottom:0},[`& .${es.inset}`]:{paddingLeft:36},[`& .${rs.root}`]:{minWidth:36}},!b.dense&&{[a.breakpoints.up("sm")]:{minHeight:"auto"}},b.dense&&mt({minHeight:32,paddingTop:4,paddingBottom:4},a.typography.body2,{[`& .${rs.root} svg`]:{fontSize:"1.25rem"}}))),ln=G.forwardRef(function(b,D){const c=ws({props:b,name:"MuiMenuItem"}),{autoFocus:e=!1,component:t="li",dense:f=!1,divider:o=!1,disableGutters:p=!1,focusVisibleClassName:A,role:n="menuitem",tabIndex:r,className:s}=c,d=_s(c,Rr),x=G.useContext(Un),E=G.useMemo(()=>({dense:f||x.dense||!1,disableGutters:p}),[x.dense,f,p]),F=G.useRef(null);ar(()=>{e&&F.current&&F.current.focus()},[e]);const w=mt({},c,{dense:E.dense,divider:o,disableGutters:p}),H=kr(c),N=or(F,D);let k;return c.disabled||(k=r!==void 0?r:-1),i.jsx(Un.Provider,{value:E,children:i.jsx(Or,mt({ref:N,role:n,tabIndex:k,component:t,focusVisibleClassName:Mn(H.focusVisible,A),className:Mn(H.root,s)},d,{ownerState:w,classes:H}))})}),Ur=G.memo(({setIsAdding:a})=>{const{userDetails:b}=Nt();console.log("Header loaded");const D=lr(),[c,e]=G.useState(!1),[t,f]=G.useState(!1),o=()=>{b!=null&&b.uid?navigator.clipboard.writeText(b.uid).then(()=>{e(!0),f(!0)}).catch(n=>{console.error("Could not copy text: ",n)}):console.error("User details are null or undefined")},p=(n,r)=>{r!=="clickaway"&&e(!1)},A=()=>{D("/")};return i.jsxs(Qt,{sx:{mt:3,mb:2},children:[i.jsx(Qt,{sx:{display:"flex",alignItems:"center"},children:i.jsx(Me,{variant:"text",onClick:A,sx:{mr:2},children:"â† Home Page"})}),i.jsx(cr,{variant:"h4",component:"h1",gutterBottom:!0,textAlign:"left",sx:{fontWeight:"bold"},children:"My Laboratory Notebook"}),b&&i.jsxs(Qt,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:[b.isAdmin&&i.jsx(ts,{label:"Admin",variant:"outlined",sx:{borderRadius:"15px",fontWeight:"bold",background:"#ffcdd2",color:"#c62828",mr:1}}),i.jsx(Xt,{title:t?"Copied!":"Click to Copy",enterDelay:300,leaveDelay:200,children:i.jsx(ts,{label:`User ID: ${b.uid}`,variant:"outlined",onClick:o,sx:{borderRadius:"15px",fontWeight:"bold",background:"#e0f2f1",color:"#00695c",mr:1,cursor:"pointer",transition:"background-color 0.3s"}})})]}),i.jsxs(Qt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx(Me,{variant:"contained",color:"primary",onClick:()=>a(!0),sx:{fontSize:"1.2rem",mt:2,textTransform:"none",minWidth:"150px",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"+ Create New"}),i.jsx(dr,{})]}),i.jsx(gt,{open:c,autoHideDuration:6e3,onClose:p,children:i.jsx(pt,{onClose:p,severity:"success",sx:{width:"100%"},children:"User ID copied to clipboard!"})})]})}),_n=({designs:a,handleEdit:b,handleDelete:D,isAdmin:c,userDetails:e,showUserIdColumn:t})=>{const f=p=>p?p instanceof Bn?p.toDate().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):p instanceof Date?p.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A":"N/A",o=p=>{if(!p)return"";let A=typeof p=="string"?p:"";p instanceof Date&&(A=p.toISOString().split("T")[0]),p.toDate&&(A=p.toDate().toISOString().split("T")[0]);const[n,r,s]=A.split("-").map(x=>parseInt(x,10));return new Date(n,r-1,s).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})};return i.jsx(ur,{component:fr,children:i.jsxs(hr,{sx:{"& .MuiTableCell-root":{fontSize:"1rem"},"& .MuiTableCell-head":{fontSize:"1.2rem",backgroundColor:"#1A76D3",color:"white"}},children:[i.jsx(mr,{children:i.jsxs(Sn,{sx:{height:"60px"},children:[i.jsx(ze,{sx:{fontWeight:"bold",width:t?"30%":"40%"},children:"Title"}),t&&i.jsx(ze,{sx:{fontWeight:"bold",width:"20%"},children:"User ID"}),i.jsx(ze,{sx:{fontWeight:"bold",width:"15%"},children:"Created"}),i.jsx(ze,{sx:{fontWeight:"bold",width:"15%"},children:"Due"}),i.jsx(ze,{sx:{fontWeight:"bold",width:"10%"},children:"Edit"}),i.jsx(ze,{sx:{fontWeight:"bold",width:"10%"},children:"Delete"})]})}),i.jsx(gr,{children:a&&a.length>0?a.map(p=>{const A=p.userId===(e==null?void 0:e.uid);return i.jsxs(Sn,{sx:{height:"80px"},children:[i.jsx(ze,{children:i.jsx("button",{onClick:()=>b(p.id),className:"hyperlink-style",children:p.title})}),t&&i.jsx(ze,{children:p.userId}),i.jsx(ze,{children:f(p.dateCreated)}),i.jsx(ze,{children:o(p.dateDue)}),i.jsx(ze,{children:i.jsx(Xt,{title:"Edit",children:i.jsx("span",{children:i.jsx(Qe,{onClick:()=>A&&b(p.id),color:"primary",disabled:!A,children:i.jsx(js,{})})})})}),i.jsx(ze,{children:i.jsx(Xt,{title:"Delete",children:i.jsx("span",{children:i.jsx(Qe,{onClick:()=>A&&D(p.id),color:"error",disabled:!A,children:i.jsx(Zt,{})})})})})]},p.id)}):i.jsx(Sn,{children:i.jsx(ze,{colSpan:t?6:5,children:"No Designs Found"})})})]})})};function Mr(a,b){return b.forEach(function(D){D&&typeof D!="string"&&!Array.isArray(D)&&Object.keys(D).forEach(function(c){if(c!=="default"&&!(c in a)){var e=Object.getOwnPropertyDescriptor(D,c);Object.defineProperty(a,c,e.get?e:{enumerable:!0,get:function(){return D[c]}})}})}),Object.freeze(a)}function Rs(a,b){return new Promise(function(D,c){let e;return Nr(a).then(function(t){try{return e=t,D(new Blob([b.slice(0,2),e,b.slice(2)],{type:"image/jpeg"}))}catch(f){return c(f)}},c)})}const Nr=a=>new Promise((b,D)=>{const c=new FileReader;c.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let f=0;if(t.getUint16(f)!==65496)return D("not a valid JPEG");for(f+=2;;){const o=t.getUint16(f);if(o===65498)break;const p=t.getUint16(f+2);if(o===65505&&t.getUint32(f+4)===1165519206){const A=f+10;let n;switch(t.getUint16(A)){case 18761:n=!0;break;case 19789:n=!1;break;default:return D("TIFF header contains invalid endian")}if(t.getUint16(A+2,n)!==42)return D("TIFF header contains invalid version");const r=t.getUint32(A+4,n),s=A+r+2+12*t.getUint16(A+r,n);for(let d=A+r+2;d<s;d+=12)if(t.getUint16(d,n)==274){if(t.getUint16(d+2,n)!==3)return D("Orientation data type is invalid");if(t.getUint32(d+4,n)!==1)return D("Orientation data count is invalid");t.setUint16(d+8,1,n);break}return b(e.slice(f,f+2+p))}f+=2+p}return b(new Blob)}),c.readAsArrayBuffer(a)});var bn={},Lr={get exports(){return bn},set exports(a){bn=a}};(function(a){var b,D,c={};Lr.exports=c,c.parse=function(e,t){for(var f=c.bin.readUshort,o=c.bin.readUint,p=0,A={},n=new Uint8Array(e),r=n.length-4;o(n,r)!=101010256;)r--;p=r,p+=4;var s=f(n,p+=4);f(n,p+=2);var d=o(n,p+=2),x=o(n,p+=4);p+=4,p=x;for(var E=0;E<s;E++){o(n,p),p+=4,p+=4,p+=4,o(n,p+=4),d=o(n,p+=4);var F=o(n,p+=4),w=f(n,p+=4),H=f(n,p+2),N=f(n,p+4);p+=6;var k=o(n,p+=8);p+=4,p+=w+H+N,c._readLocal(n,k,A,d,F,t)}return A},c._readLocal=function(e,t,f,o,p,A){var n=c.bin.readUshort,r=c.bin.readUint;r(e,t),n(e,t+=4),n(e,t+=2);var s=n(e,t+=2);r(e,t+=2),r(e,t+=4),t+=4;var d=n(e,t+=8),x=n(e,t+=2);t+=2;var E=c.bin.readUTF8(e,t,d);if(t+=d,t+=x,A)f[E]={size:p,csize:o};else{var F=new Uint8Array(e.buffer,t);if(s==0)f[E]=new Uint8Array(F.buffer.slice(t,t+o));else{if(s!=8)throw"unknown compression method: "+s;var w=new Uint8Array(p);c.inflateRaw(F,w),f[E]=w}}},c.inflateRaw=function(e,t){return c.F.inflate(e,t)},c.inflate=function(e,t){return e[0],e[1],c.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},c.deflate=function(e,t){t==null&&(t={level:6});var f=0,o=new Uint8Array(50+Math.floor(1.1*e.length));o[f]=120,o[f+1]=156,f+=2,f=c.F.deflateRaw(e,o,f,t.level);var p=c.adler(e,0,e.length);return o[f+0]=p>>>24&255,o[f+1]=p>>>16&255,o[f+2]=p>>>8&255,o[f+3]=p>>>0&255,new Uint8Array(o.buffer,0,f+4)},c.deflateRaw=function(e,t){t==null&&(t={level:6});var f=new Uint8Array(50+Math.floor(1.1*e.length)),o=c.F.deflateRaw(e,f,o,t.level);return new Uint8Array(f.buffer,0,o)},c.encode=function(e,t){t==null&&(t=!1);var f=0,o=c.bin.writeUint,p=c.bin.writeUshort,A={};for(var n in e){var r=!c._noNeed(n)&&!t,s=e[n],d=c.crc.crc(s,0,s.length);A[n]={cpr:r,usize:s.length,crc:d,file:r?c.deflateRaw(s):s}}for(var n in A)f+=A[n].file.length+30+46+2*c.bin.sizeUTF8(n);f+=22;var x=new Uint8Array(f),E=0,F=[];for(var n in A){var w=A[n];F.push(E),E=c._writeHeader(x,E,n,w,0)}var H=0,N=E;for(var n in A)w=A[n],F.push(E),E=c._writeHeader(x,E,n,w,1,F[H++]);var k=E-N;return o(x,E,101010256),E+=4,p(x,E+=4,H),p(x,E+=2,H),o(x,E+=2,k),o(x,E+=4,N),E+=4,E+=2,x.buffer},c._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},c._writeHeader=function(e,t,f,o,p,A){var n=c.bin.writeUint,r=c.bin.writeUshort,s=o.file;return n(e,t,p==0?67324752:33639248),t+=4,p==1&&(t+=2),r(e,t,20),r(e,t+=2,0),r(e,t+=2,o.cpr?8:0),n(e,t+=2,0),n(e,t+=4,o.crc),n(e,t+=4,s.length),n(e,t+=4,o.usize),r(e,t+=4,c.bin.sizeUTF8(f)),r(e,t+=2,0),t+=2,p==1&&(t+=2,t+=2,n(e,t+=6,A),t+=4),t+=c.bin.writeUTF8(e,t,f),p==0&&(e.set(s,t),t+=s.length),t},c.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var f=t,o=0;o<8;o++)1&f?f=3988292384^f>>>1:f>>>=1;e[t]=f}return e}(),update:function(e,t,f,o){for(var p=0;p<o;p++)e=c.crc.table[255&(e^t[f+p])]^e>>>8;return e},crc:function(e,t,f){return 4294967295^c.crc.update(4294967295,e,t,f)}},c.adler=function(e,t,f){for(var o=1,p=0,A=t,n=t+f;A<n;){for(var r=Math.min(A+5552,n);A<r;)p+=o+=e[A++];o%=65521,p%=65521}return p<<16|o},c.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,f){e[t]=255&f,e[t+1]=f>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,f){e[t]=255&f,e[t+1]=f>>8&255,e[t+2]=f>>16&255,e[t+3]=f>>24&255},readASCII:function(e,t,f){for(var o="",p=0;p<f;p++)o+=String.fromCharCode(e[t+p]);return o},writeASCII:function(e,t,f){for(var o=0;o<f.length;o++)e[t+o]=f.charCodeAt(o)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,f){for(var o,p="",A=0;A<f;A++)p+="%"+c.bin.pad(e[t+A].toString(16));try{o=decodeURIComponent(p)}catch{return c.bin.readASCII(e,t,f)}return o},writeUTF8:function(e,t,f){for(var o=f.length,p=0,A=0;A<o;A++){var n=f.charCodeAt(A);if(!(4294967168&n))e[t+p]=n,p++;else if(!(4294965248&n))e[t+p]=192|n>>6,e[t+p+1]=128|n>>0&63,p+=2;else if(!(4294901760&n))e[t+p]=224|n>>12,e[t+p+1]=128|n>>6&63,e[t+p+2]=128|n>>0&63,p+=3;else{if(4292870144&n)throw"e";e[t+p]=240|n>>18,e[t+p+1]=128|n>>12&63,e[t+p+2]=128|n>>6&63,e[t+p+3]=128|n>>0&63,p+=4}}return p},sizeUTF8:function(e){for(var t=e.length,f=0,o=0;o<t;o++){var p=e.charCodeAt(o);if(!(4294967168&p))f++;else if(!(4294965248&p))f+=2;else if(!(4294901760&p))f+=3;else{if(4292870144&p)throw"e";f+=4}}return f}},c.F={},c.F.deflateRaw=function(e,t,f,o){var p=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][o],A=c.F.U,n=c.F._goodIndex;c.F._hash;var r=c.F._putsE,s=0,d=f<<3,x=0,E=e.length;if(o==0){for(;s<E;)r(t,d,s+(S=Math.min(65535,E-s))==E?1:0),d=c.F._copyExact(e,s,S,t,d+8),s+=S;return d>>>3}var F=A.lits,w=A.strt,H=A.prev,N=0,k=0,$=0,y=0,U=0,m=0;for(E>2&&(w[m=c.F._hash(e,0)]=0),s=0;s<E;s++){if(U=m,s+1<E-2){m=c.F._hash(e,s+1);var h=s+1&32767;H[h]=w[m],w[m]=h}if(x<=s){(N>14e3||k>26697)&&E-s>100&&(x<s&&(F[N]=s-x,N+=2,x=s),d=c.F._writeBlock(s==E-1||x==E?1:0,F,N,y,e,$,s-$,t,d),N=k=y=0,$=s);var v=0;s<E-2&&(v=c.F._bestMatch(e,s,H,U,Math.min(p[2],E-s),p[3]));var S=v>>>16,C=65535&v;if(v!=0){C=65535&v;var _=n(S=v>>>16,A.of0);A.lhst[257+_]++;var T=n(C,A.df0);A.dhst[T]++,y+=A.exb[_]+A.dxb[T],F[N]=S<<23|s-x,F[N+1]=C<<16|_<<8|T,N+=2,x=s+S}else A.lhst[e[s]]++;k++}}for($==s&&e.length!=0||(x<s&&(F[N]=s-x,N+=2,x=s),d=c.F._writeBlock(1,F,N,y,e,$,s-$,t,d),N=0,k=0,N=k=y=0,$=s);7&d;)d++;return d>>>3},c.F._bestMatch=function(e,t,f,o,p,A){var n=32767&t,r=f[n],s=n-r+32768&32767;if(r==n||o!=c.F._hash(e,t-s))return 0;for(var d=0,x=0,E=Math.min(32767,t);s<=E&&--A!=0&&r!=n;){if(d==0||e[t+d]==e[t+d-s]){var F=c.F._howLong(e,t,s);if(F>d){if(x=s,(d=F)>=p)break;s+2<F&&(F=s+2);for(var w=0,H=0;H<F-2;H++){var N=t-s+H+32768&32767,k=N-f[N]+32768&32767;k>w&&(w=k,r=N)}}}s+=(n=r)-(r=f[n])+32768&32767}return d<<16|x},c.F._howLong=function(e,t,f){if(e[t]!=e[t-f]||e[t+1]!=e[t+1-f]||e[t+2]!=e[t+2-f])return 0;var o=t,p=Math.min(e.length,t+258);for(t+=3;t<p&&e[t]==e[t-f];)t++;return t-o},c.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},c.saved=0,c.F._writeBlock=function(e,t,f,o,p,A,n,r,s){var d,x,E,F,w,H,N,k,$,y=c.F.U,U=c.F._putsF,m=c.F._putsE;y.lhst[256]++,x=(d=c.F.getTrees())[0],E=d[1],F=d[2],w=d[3],H=d[4],N=d[5],k=d[6],$=d[7];var h=32+(s+3&7?8-(s+3&7):0)+(n<<3),v=o+c.F.contSize(y.fltree,y.lhst)+c.F.contSize(y.fdtree,y.dhst),S=o+c.F.contSize(y.ltree,y.lhst)+c.F.contSize(y.dtree,y.dhst);S+=14+3*N+c.F.contSize(y.itree,y.ihst)+(2*y.ihst[16]+3*y.ihst[17]+7*y.ihst[18]);for(var C=0;C<286;C++)y.lhst[C]=0;for(C=0;C<30;C++)y.dhst[C]=0;for(C=0;C<19;C++)y.ihst[C]=0;var _=h<v&&h<S?0:v<S?1:2;if(U(r,s,e),U(r,s+1,_),s+=3,_==0){for(;7&s;)s++;s=c.F._copyExact(p,A,n,r,s)}else{var T,I;if(_==1&&(T=y.fltree,I=y.fdtree),_==2){c.F.makeCodes(y.ltree,x),c.F.revCodes(y.ltree,x),c.F.makeCodes(y.dtree,E),c.F.revCodes(y.dtree,E),c.F.makeCodes(y.itree,F),c.F.revCodes(y.itree,F),T=y.ltree,I=y.dtree,m(r,s,w-257),m(r,s+=5,H-1),m(r,s+=5,N-4),s+=4;for(var g=0;g<N;g++)m(r,s+3*g,y.itree[1+(y.ordr[g]<<1)]);s+=3*N,s=c.F._codeTiny(k,y.itree,r,s),s=c.F._codeTiny($,y.itree,r,s)}for(var l=A,P=0;P<f;P+=2){for(var j=t[P],O=j>>>23,q=l+(8388607&j);l<q;)s=c.F._writeLit(p[l++],T,r,s);if(O!=0){var W=t[P+1],Q=W>>16,V=W>>8&255,z=255&W;m(r,s=c.F._writeLit(257+V,T,r,s),O-y.of0[V]),s+=y.exb[V],U(r,s=c.F._writeLit(z,I,r,s),Q-y.df0[z]),s+=y.dxb[z],l+=O}}s=c.F._writeLit(256,T,r,s)}return s},c.F._copyExact=function(e,t,f,o,p){var A=p>>>3;return o[A]=f,o[A+1]=f>>>8,o[A+2]=255-o[A],o[A+3]=255-o[A+1],A+=4,o.set(new Uint8Array(e.buffer,t,f),A),p+(f+4<<3)},c.F.getTrees=function(){for(var e=c.F.U,t=c.F._hufTree(e.lhst,e.ltree,15),f=c.F._hufTree(e.dhst,e.dtree,15),o=[],p=c.F._lenCodes(e.ltree,o),A=[],n=c.F._lenCodes(e.dtree,A),r=0;r<o.length;r+=2)e.ihst[o[r]]++;for(r=0;r<A.length;r+=2)e.ihst[A[r]]++;for(var s=c.F._hufTree(e.ihst,e.itree,7),d=19;d>4&&e.itree[1+(e.ordr[d-1]<<1)]==0;)d--;return[t,f,s,p,n,d,o,A]},c.F.getSecond=function(e){for(var t=[],f=0;f<e.length;f+=2)t.push(e[f+1]);return t},c.F.nonZero=function(e){for(var t="",f=0;f<e.length;f+=2)e[f+1]!=0&&(t+=(f>>1)+",");return t},c.F.contSize=function(e,t){for(var f=0,o=0;o<t.length;o++)f+=t[o]*e[1+(o<<1)];return f},c.F._codeTiny=function(e,t,f,o){for(var p=0;p<e.length;p+=2){var A=e[p],n=e[p+1];o=c.F._writeLit(A,t,f,o);var r=A==16?2:A==17?3:7;A>15&&(c.F._putsE(f,o,n,r),o+=r)}return o},c.F._lenCodes=function(e,t){for(var f=e.length;f!=2&&e[f-1]==0;)f-=2;for(var o=0;o<f;o+=2){var p=e[o+1],A=o+3<f?e[o+3]:-1,n=o+5<f?e[o+5]:-1,r=o==0?-1:e[o-1];if(p==0&&A==p&&n==p){for(var s=o+5;s+2<f&&e[s+2]==p;)s+=2;(d=Math.min(s+1-o>>>1,138))<11?t.push(17,d-3):t.push(18,d-11),o+=2*d-2}else if(p==r&&A==p&&n==p){for(s=o+5;s+2<f&&e[s+2]==p;)s+=2;var d=Math.min(s+1-o>>>1,6);t.push(16,d-3),o+=2*d-2}else t.push(p,0)}return f>>>1},c.F._hufTree=function(e,t,f){var o=[],p=e.length,A=t.length,n=0;for(n=0;n<A;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<p;n++)e[n]!=0&&o.push({lit:n,f:e[n]});var r=o.length,s=o.slice(0);if(r==0)return 0;if(r==1){var d=o[0].lit;return s=d==0?1:0,t[1+(d<<1)]=1,t[1+(s<<1)]=1,1}o.sort(function(k,$){return k.f-$.f});var x=o[0],E=o[1],F=0,w=1,H=2;for(o[0]={lit:-1,f:x.f+E.f,l:x,r:E,d:0};w!=r-1;)x=F!=w&&(H==r||o[F].f<o[H].f)?o[F++]:o[H++],E=F!=w&&(H==r||o[F].f<o[H].f)?o[F++]:o[H++],o[w++]={lit:-1,f:x.f+E.f,l:x,r:E};var N=c.F.setDepth(o[w-1],0);for(N>f&&(c.F.restrictDepth(s,f,N),N=f),n=0;n<r;n++)t[1+(s[n].lit<<1)]=s[n].d;return N},c.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(c.F.setDepth(e.l,t+1),c.F.setDepth(e.r,t+1))},c.F.restrictDepth=function(e,t,f){var o=0,p=1<<f-t,A=0;for(e.sort(function(r,s){return s.d==r.d?r.f-s.f:s.d-r.d}),o=0;o<e.length&&e[o].d>t;o++){var n=e[o].d;e[o].d=t,A+=p-(1<<f-n)}for(A>>>=f-t;A>0;)(n=e[o].d)<t?(e[o].d++,A-=1<<t-n-1):o++;for(;o>=0;o--)e[o].d==t&&A<0&&(e[o].d--,A++);A!=0&&console.log("debt left")},c.F._goodIndex=function(e,t){var f=0;return t[16|f]<=e&&(f|=16),t[8|f]<=e&&(f|=8),t[4|f]<=e&&(f|=4),t[2|f]<=e&&(f|=2),t[1|f]<=e&&(f|=1),f},c.F._writeLit=function(e,t,f,o){return c.F._putsF(f,o,t[e<<1]),o+t[1+(e<<1)]},c.F.inflate=function(e,t){var f=Uint8Array;if(e[0]==3&&e[1]==0)return t||new f(0);var o=c.F,p=o._bitsF,A=o._bitsE,n=o._decodeTiny,r=o.makeCodes,s=o.codes2map,d=o._get17,x=o.U,E=t==null;E&&(t=new f(e.length>>>2<<3));for(var F,w,H=0,N=0,k=0,$=0,y=0,U=0,m=0,h=0,v=0;H==0;)if(H=p(e,v,1),N=p(e,v+1,2),v+=3,N!=0){if(E&&(t=c.F._check(t,h+(1<<17))),N==1&&(F=x.flmap,w=x.fdmap,U=511,m=31),N==2){k=A(e,v,5)+257,$=A(e,v+5,5)+1,y=A(e,v+10,4)+4,v+=14;for(var S=0;S<38;S+=2)x.itree[S]=0,x.itree[S+1]=0;var C=1;for(S=0;S<y;S++){var _=A(e,v+3*S,3);x.itree[1+(x.ordr[S]<<1)]=_,_>C&&(C=_)}v+=3*y,r(x.itree,C),s(x.itree,C,x.imap),F=x.lmap,w=x.dmap,v=n(x.imap,(1<<C)-1,k+$,e,v,x.ttree);var T=o._copyOut(x.ttree,0,k,x.ltree);U=(1<<T)-1;var I=o._copyOut(x.ttree,k,$,x.dtree);m=(1<<I)-1,r(x.ltree,T),s(x.ltree,T,F),r(x.dtree,I),s(x.dtree,I,w)}for(;;){var g=F[d(e,v)&U];v+=15&g;var l=g>>>4;if(!(l>>>8))t[h++]=l;else{if(l==256)break;var P=h+l-254;if(l>264){var j=x.ldef[l-257];P=h+(j>>>3)+A(e,v,7&j),v+=7&j}var O=w[d(e,v)&m];v+=15&O;var q=O>>>4,W=x.ddef[q],Q=(W>>>4)+p(e,v,15&W);for(v+=15&W,E&&(t=c.F._check(t,h+(1<<17)));h<P;)t[h]=t[h++-Q],t[h]=t[h++-Q],t[h]=t[h++-Q],t[h]=t[h++-Q];h=P}}}else{7&v&&(v+=8-(7&v));var V=4+(v>>>3),z=e[V-4]|e[V-3]<<8;E&&(t=c.F._check(t,h+z)),t.set(new f(e.buffer,e.byteOffset+V,z),h),v=V+z<<3,h+=z}return t.length==h?t:t.slice(0,h)},c.F._check=function(e,t){var f=e.length;if(t<=f)return e;var o=new Uint8Array(Math.max(f<<1,t));return o.set(e,0),o},c.F._decodeTiny=function(e,t,f,o,p,A){for(var n=c.F._bitsE,r=c.F._get17,s=0;s<f;){var d=e[r(o,p)&t];p+=15&d;var x=d>>>4;if(x<=15)A[s]=x,s++;else{var E=0,F=0;x==16?(F=3+n(o,p,2),p+=2,E=A[s-1]):x==17?(F=3+n(o,p,3),p+=3):x==18&&(F=11+n(o,p,7),p+=7);for(var w=s+F;s<w;)A[s]=E,s++}}return p},c.F._copyOut=function(e,t,f,o){for(var p=0,A=0,n=o.length>>>1;A<f;){var r=e[A+t];o[A<<1]=0,o[1+(A<<1)]=r,r>p&&(p=r),A++}for(;A<n;)o[A<<1]=0,o[1+(A<<1)]=0,A++;return p},c.F.makeCodes=function(e,t){for(var f,o,p,A,n=c.F.U,r=e.length,s=n.bl_count,d=0;d<=t;d++)s[d]=0;for(d=1;d<r;d+=2)s[e[d]]++;var x=n.next_code;for(f=0,s[0]=0,o=1;o<=t;o++)f=f+s[o-1]<<1,x[o]=f;for(p=0;p<r;p+=2)(A=e[p+1])!=0&&(e[p]=x[A],x[A]++)},c.F.codes2map=function(e,t,f){for(var o=e.length,p=c.F.U.rev15,A=0;A<o;A+=2)if(e[A+1]!=0)for(var n=A>>1,r=e[A+1],s=n<<4|r,d=t-r,x=e[A]<<d,E=x+(1<<d);x!=E;)f[p[x]>>>15-t]=s,x++},c.F.revCodes=function(e,t){for(var f=c.F.U.rev15,o=15-t,p=0;p<e.length;p+=2){var A=e[p]<<t-e[p+1];e[p]=f[A]>>>o}},c.F._putsE=function(e,t,f){f<<=7&t;var o=t>>>3;e[o]|=f,e[o+1]|=f>>>8},c.F._putsF=function(e,t,f){f<<=7&t;var o=t>>>3;e[o]|=f,e[o+1]|=f>>>8,e[o+2]|=f>>>16},c.F._bitsE=function(e,t,f){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<f)-1},c.F._bitsF=function(e,t,f){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<f)-1},c.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},c.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},c.F.U=(b=Uint16Array,D=Uint32Array,{next_code:new b(16),bl_count:new b(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new b(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new D(32),flmap:new b(512),fltree:[],fdmap:new b(32),fdtree:[],lmap:new b(32768),ltree:[],ttree:[],dmap:new b(32768),dtree:[],imap:new b(512),itree:[],rev15:new b(32768),lhst:new D(286),dhst:new D(30),ihst:new D(19),lits:new D(15e3),strt:new b(65536),prev:new b(32768)}),function(){for(var e=c.F.U,t=0;t<32768;t++){var f=t;f=(4278255360&(f=(4042322160&(f=(3435973836&(f=(2863311530&f)>>>1|(1431655765&f)<<1))>>>2|(858993459&f)<<2))>>>4|(252645135&f)<<4))>>>8|(16711935&f)<<8,e.rev15[t]=(f>>>16|f<<16)>>>17}function o(p,A,n){for(;A--!=0;)p.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];o(e.fltree,144,8),o(e.fltree,112,9),o(e.fltree,24,7),o(e.fltree,8,8),c.F.makeCodes(e.fltree,9),c.F.codes2map(e.fltree,9,e.flmap),c.F.revCodes(e.fltree,9),o(e.fdtree,32,5),c.F.makeCodes(e.fdtree,5),c.F.codes2map(e.fdtree,5,e.fdmap),c.F.revCodes(e.fdtree,5),o(e.itree,19,0),o(e.ltree,286,0),o(e.dtree,30,0),o(e.ttree,320,0)}()})();var Pr=Mr({__proto__:null,default:bn},[bn]);const tt=function(){var a={nextZero(n,r){for(;n[r]!=0;)r++;return r},readUshort:(n,r)=>n[r]<<8|n[r+1],writeUshort(n,r,s){n[r]=s>>8&255,n[r+1]=255&s},readUint:(n,r)=>16777216*n[r]+(n[r+1]<<16|n[r+2]<<8|n[r+3]),writeUint(n,r,s){n[r]=s>>24&255,n[r+1]=s>>16&255,n[r+2]=s>>8&255,n[r+3]=255&s},readASCII(n,r,s){let d="";for(let x=0;x<s;x++)d+=String.fromCharCode(n[r+x]);return d},writeASCII(n,r,s){for(let d=0;d<s.length;d++)n[r+d]=s.charCodeAt(d)},readBytes(n,r,s){const d=[];for(let x=0;x<s;x++)d.push(n[r+x]);return d},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,r,s){let d,x="";for(let E=0;E<s;E++)x+=`%${a.pad(n[r+E].toString(16))}`;try{d=decodeURIComponent(x)}catch{return a.readASCII(n,r,s)}return d}};function b(n,r,s,d){const x=r*s,E=t(d),F=Math.ceil(r*E/8),w=new Uint8Array(4*x),H=new Uint32Array(w.buffer),{ctype:N}=d,{depth:k}=d,$=a.readUshort;if(N==6){const j=x<<2;if(k==8)for(var y=0;y<j;y+=4)w[y]=n[y],w[y+1]=n[y+1],w[y+2]=n[y+2],w[y+3]=n[y+3];if(k==16)for(y=0;y<j;y++)w[y]=n[y<<1]}else if(N==2){const j=d.tabs.tRNS;if(j==null){if(k==8)for(y=0;y<x;y++){var U=3*y;H[y]=255<<24|n[U+2]<<16|n[U+1]<<8|n[U]}if(k==16)for(y=0;y<x;y++)U=6*y,H[y]=255<<24|n[U+4]<<16|n[U+2]<<8|n[U]}else{var m=j[0];const O=j[1],q=j[2];if(k==8)for(y=0;y<x;y++){var h=y<<2;U=3*y,H[y]=255<<24|n[U+2]<<16|n[U+1]<<8|n[U],n[U]==m&&n[U+1]==O&&n[U+2]==q&&(w[h+3]=0)}if(k==16)for(y=0;y<x;y++)h=y<<2,U=6*y,H[y]=255<<24|n[U+4]<<16|n[U+2]<<8|n[U],$(n,U)==m&&$(n,U+2)==O&&$(n,U+4)==q&&(w[h+3]=0)}}else if(N==3){const j=d.tabs.PLTE,O=d.tabs.tRNS,q=O?O.length:0;if(k==1)for(var v=0;v<s;v++){var S=v*F,C=v*r;for(y=0;y<r;y++){h=C+y<<2;var _=3*(T=n[S+(y>>3)]>>7-((7&y)<<0)&1);w[h]=j[_],w[h+1]=j[_+1],w[h+2]=j[_+2],w[h+3]=T<q?O[T]:255}}if(k==2)for(v=0;v<s;v++)for(S=v*F,C=v*r,y=0;y<r;y++)h=C+y<<2,_=3*(T=n[S+(y>>2)]>>6-((3&y)<<1)&3),w[h]=j[_],w[h+1]=j[_+1],w[h+2]=j[_+2],w[h+3]=T<q?O[T]:255;if(k==4)for(v=0;v<s;v++)for(S=v*F,C=v*r,y=0;y<r;y++)h=C+y<<2,_=3*(T=n[S+(y>>1)]>>4-((1&y)<<2)&15),w[h]=j[_],w[h+1]=j[_+1],w[h+2]=j[_+2],w[h+3]=T<q?O[T]:255;if(k==8)for(y=0;y<x;y++){var T;h=y<<2,_=3*(T=n[y]),w[h]=j[_],w[h+1]=j[_+1],w[h+2]=j[_+2],w[h+3]=T<q?O[T]:255}}else if(N==4){if(k==8)for(y=0;y<x;y++){h=y<<2;var I=n[g=y<<1];w[h]=I,w[h+1]=I,w[h+2]=I,w[h+3]=n[g+1]}if(k==16)for(y=0;y<x;y++){var g;h=y<<2,I=n[g=y<<2],w[h]=I,w[h+1]=I,w[h+2]=I,w[h+3]=n[g+2]}}else if(N==0)for(m=d.tabs.tRNS?d.tabs.tRNS:-1,v=0;v<s;v++){const j=v*F,O=v*r;if(k==1)for(var l=0;l<r;l++){var P=(I=255*(n[j+(l>>>3)]>>>7-(7&l)&1))==255*m?0:255;H[O+l]=P<<24|I<<16|I<<8|I}else if(k==2)for(l=0;l<r;l++)P=(I=85*(n[j+(l>>>2)]>>>6-((3&l)<<1)&3))==85*m?0:255,H[O+l]=P<<24|I<<16|I<<8|I;else if(k==4)for(l=0;l<r;l++)P=(I=17*(n[j+(l>>>1)]>>>4-((1&l)<<2)&15))==17*m?0:255,H[O+l]=P<<24|I<<16|I<<8|I;else if(k==8)for(l=0;l<r;l++)P=(I=n[j+l])==m?0:255,H[O+l]=P<<24|I<<16|I<<8|I;else if(k==16)for(l=0;l<r;l++)I=n[j+(l<<1)],P=$(n,j+(l<<1))==m?0:255,H[O+l]=P<<24|I<<16|I<<8|I}return w}function D(n,r,s,d){const x=t(n),E=Math.ceil(s*x/8),F=new Uint8Array((E+1+n.interlace)*d);return r=n.tabs.CgBI?e(r,F):c(r,F),n.interlace==0?r=f(r,n,0,s,d):n.interlace==1&&(r=function(H,N){const k=N.width,$=N.height,y=t(N),U=y>>3,m=Math.ceil(k*y/8),h=new Uint8Array($*m);let v=0;const S=[0,0,4,0,2,0,1],C=[0,4,0,2,0,1,0],_=[8,8,8,4,4,2,2],T=[8,8,4,4,2,2,1];let I=0;for(;I<7;){const l=_[I],P=T[I];let j=0,O=0,q=S[I];for(;q<$;)q+=l,O++;let W=C[I];for(;W<k;)W+=P,j++;const Q=Math.ceil(j*y/8);f(H,N,v,j,O);let V=0,z=S[I];for(;z<$;){let Z=C[I],le=v+V*Q<<3;for(;Z<k;){var g;if(y==1&&(g=(g=H[le>>3])>>7-(7&le)&1,h[z*m+(Z>>3)]|=g<<7-((7&Z)<<0)),y==2&&(g=(g=H[le>>3])>>6-(7&le)&3,h[z*m+(Z>>2)]|=g<<6-((3&Z)<<1)),y==4&&(g=(g=H[le>>3])>>4-(7&le)&15,h[z*m+(Z>>1)]|=g<<4-((1&Z)<<2)),y>=8){const ne=z*m+Z*U;for(let J=0;J<U;J++)h[ne+J]=H[(le>>3)+J]}le+=y,Z+=P}V++,z+=l}j*O!=0&&(v+=O*(1+Q)),I+=1}return h}(r,n)),r}function c(n,r){return e(new Uint8Array(n.buffer,2,n.length-6),r)}var e=function(){const n={H:{}};return n.H.N=function(r,s){const d=Uint8Array;let x,E,F=0,w=0,H=0,N=0,k=0,$=0,y=0,U=0,m=0;if(r[0]==3&&r[1]==0)return s||new d(0);const h=n.H,v=h.b,S=h.e,C=h.R,_=h.n,T=h.A,I=h.Z,g=h.m,l=s==null;for(l&&(s=new d(r.length>>>2<<5));F==0;)if(F=v(r,m,1),w=v(r,m+1,2),m+=3,w!=0){if(l&&(s=n.H.W(s,U+(1<<17))),w==1&&(x=g.J,E=g.h,$=511,y=31),w==2){H=S(r,m,5)+257,N=S(r,m+5,5)+1,k=S(r,m+10,4)+4,m+=14;let j=1;for(var P=0;P<38;P+=2)g.Q[P]=0,g.Q[P+1]=0;for(P=0;P<k;P++){const W=S(r,m+3*P,3);g.Q[1+(g.X[P]<<1)]=W,W>j&&(j=W)}m+=3*k,_(g.Q,j),T(g.Q,j,g.u),x=g.w,E=g.d,m=C(g.u,(1<<j)-1,H+N,r,m,g.v);const O=h.V(g.v,0,H,g.C);$=(1<<O)-1;const q=h.V(g.v,H,N,g.D);y=(1<<q)-1,_(g.C,O),T(g.C,O,x),_(g.D,q),T(g.D,q,E)}for(;;){const j=x[I(r,m)&$];m+=15&j;const O=j>>>4;if(!(O>>>8))s[U++]=O;else{if(O==256)break;{let q=U+O-254;if(O>264){const Z=g.q[O-257];q=U+(Z>>>3)+S(r,m,7&Z),m+=7&Z}const W=E[I(r,m)&y];m+=15&W;const Q=W>>>4,V=g.c[Q],z=(V>>>4)+v(r,m,15&V);for(m+=15&V;U<q;)s[U]=s[U++-z],s[U]=s[U++-z],s[U]=s[U++-z],s[U]=s[U++-z];U=q}}}}else{7&m&&(m+=8-(7&m));const j=4+(m>>>3),O=r[j-4]|r[j-3]<<8;l&&(s=n.H.W(s,U+O)),s.set(new d(r.buffer,r.byteOffset+j,O),U),m=j+O<<3,U+=O}return s.length==U?s:s.slice(0,U)},n.H.W=function(r,s){const d=r.length;if(s<=d)return r;const x=new Uint8Array(d<<1);return x.set(r,0),x},n.H.R=function(r,s,d,x,E,F){const w=n.H.e,H=n.H.Z;let N=0;for(;N<d;){const k=r[H(x,E)&s];E+=15&k;const $=k>>>4;if($<=15)F[N]=$,N++;else{let y=0,U=0;$==16?(U=3+w(x,E,2),E+=2,y=F[N-1]):$==17?(U=3+w(x,E,3),E+=3):$==18&&(U=11+w(x,E,7),E+=7);const m=N+U;for(;N<m;)F[N]=y,N++}}return E},n.H.V=function(r,s,d,x){let E=0,F=0;const w=x.length>>>1;for(;F<d;){const H=r[F+s];x[F<<1]=0,x[1+(F<<1)]=H,H>E&&(E=H),F++}for(;F<w;)x[F<<1]=0,x[1+(F<<1)]=0,F++;return E},n.H.n=function(r,s){const d=n.H.m,x=r.length;let E,F,w,H;const N=d.j;for(var k=0;k<=s;k++)N[k]=0;for(k=1;k<x;k+=2)N[r[k]]++;const $=d.K;for(E=0,N[0]=0,F=1;F<=s;F++)E=E+N[F-1]<<1,$[F]=E;for(w=0;w<x;w+=2)H=r[w+1],H!=0&&(r[w]=$[H],$[H]++)},n.H.A=function(r,s,d){const x=r.length,E=n.H.m.r;for(let F=0;F<x;F+=2)if(r[F+1]!=0){const w=F>>1,H=r[F+1],N=w<<4|H,k=s-H;let $=r[F]<<k;const y=$+(1<<k);for(;$!=y;)d[E[$]>>>15-s]=N,$++}},n.H.l=function(r,s){const d=n.H.m.r,x=15-s;for(let E=0;E<r.length;E+=2){const F=r[E]<<s-r[E+1];r[E]=d[F]>>>x}},n.H.M=function(r,s,d){d<<=7&s;const x=s>>>3;r[x]|=d,r[x+1]|=d>>>8},n.H.I=function(r,s,d){d<<=7&s;const x=s>>>3;r[x]|=d,r[x+1]|=d>>>8,r[x+2]|=d>>>16},n.H.e=function(r,s,d){return(r[s>>>3]|r[1+(s>>>3)]<<8)>>>(7&s)&(1<<d)-1},n.H.b=function(r,s,d){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16)>>>(7&s)&(1<<d)-1},n.H.Z=function(r,s){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16)>>>(7&s)},n.H.i=function(r,s){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16|r[3+(s>>>3)]<<24)>>>(7&s)},n.H.m=function(){const r=Uint16Array,s=Uint32Array;return{K:new r(16),j:new r(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new r(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new s(32),J:new r(512),_:[],h:new r(32),$:[],w:new r(32768),C:[],v:[],d:new r(32768),D:[],u:new r(512),Q:[],r:new r(32768),s:new s(286),Y:new s(30),a:new s(19),t:new s(15e3),k:new r(65536),g:new r(32768)}}(),function(){const r=n.H.m;for(var s=0;s<32768;s++){let x=s;x=(2863311530&x)>>>1|(1431655765&x)<<1,x=(3435973836&x)>>>2|(858993459&x)<<2,x=(4042322160&x)>>>4|(252645135&x)<<4,x=(4278255360&x)>>>8|(16711935&x)<<8,r.r[s]=(x>>>16|x<<16)>>>17}function d(x,E,F){for(;E--!=0;)x.push(0,F)}for(s=0;s<32;s++)r.q[s]=r.S[s]<<3|r.T[s],r.c[s]=r.p[s]<<4|r.z[s];d(r._,144,8),d(r._,112,9),d(r._,24,7),d(r._,8,8),n.H.n(r._,9),n.H.A(r._,9,r.J),n.H.l(r._,9),d(r.$,32,5),n.H.n(r.$,5),n.H.A(r.$,5,r.h),n.H.l(r.$,5),d(r.Q,19,0),d(r.C,286,0),d(r.D,30,0),d(r.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function f(n,r,s,d,x){let E=t(r);const F=Math.ceil(d*E/8);let w,H;E=Math.ceil(E/8);let N=n[s],k=0;if(N>1&&(n[s]=[0,0,1][N-2]),N==3)for(k=E;k<F;k++)n[k+1]=n[k+1]+(n[k+1-E]>>>1)&255;for(let $=0;$<x;$++)if(w=s+$*F,H=w+$+1,N=n[H-1],k=0,N==0)for(;k<F;k++)n[w+k]=n[H+k];else if(N==1){for(;k<E;k++)n[w+k]=n[H+k];for(;k<F;k++)n[w+k]=n[H+k]+n[w+k-E]}else if(N==2)for(;k<F;k++)n[w+k]=n[H+k]+n[w+k-F];else if(N==3){for(;k<E;k++)n[w+k]=n[H+k]+(n[w+k-F]>>>1);for(;k<F;k++)n[w+k]=n[H+k]+(n[w+k-F]+n[w+k-E]>>>1)}else{for(;k<E;k++)n[w+k]=n[H+k]+o(0,n[w+k-F],0);for(;k<F;k++)n[w+k]=n[H+k]+o(n[w+k-E],n[w+k-F],n[w+k-E-F])}return n}function o(n,r,s){const d=n+r-s,x=d-n,E=d-r,F=d-s;return x*x<=E*E&&x*x<=F*F?n:E*E<=F*F?r:s}function p(n,r,s){s.width=a.readUint(n,r),r+=4,s.height=a.readUint(n,r),r+=4,s.depth=n[r],r++,s.ctype=n[r],r++,s.compress=n[r],r++,s.filter=n[r],r++,s.interlace=n[r],r++}function A(n,r,s,d,x,E,F,w,H){const N=Math.min(r,x),k=Math.min(s,E);let $=0,y=0;for(let I=0;I<k;I++)for(let g=0;g<N;g++)if(F>=0&&w>=0?($=I*r+g<<2,y=(w+I)*x+F+g<<2):($=(-w+I)*r-F+g<<2,y=I*x+g<<2),H==0)d[y]=n[$],d[y+1]=n[$+1],d[y+2]=n[$+2],d[y+3]=n[$+3];else if(H==1){var U=n[$+3]*.00392156862745098,m=n[$]*U,h=n[$+1]*U,v=n[$+2]*U,S=d[y+3]*(1/255),C=d[y]*S,_=d[y+1]*S,T=d[y+2]*S;const l=1-U,P=U+S*l,j=P==0?0:1/P;d[y+3]=255*P,d[y+0]=(m+C*l)*j,d[y+1]=(h+_*l)*j,d[y+2]=(v+T*l)*j}else if(H==2)U=n[$+3],m=n[$],h=n[$+1],v=n[$+2],S=d[y+3],C=d[y],_=d[y+1],T=d[y+2],U==S&&m==C&&h==_&&v==T?(d[y]=0,d[y+1]=0,d[y+2]=0,d[y+3]=0):(d[y]=m,d[y+1]=h,d[y+2]=v,d[y+3]=U);else if(H==3){if(U=n[$+3],m=n[$],h=n[$+1],v=n[$+2],S=d[y+3],C=d[y],_=d[y+1],T=d[y+2],U==S&&m==C&&h==_&&v==T)continue;if(U<220&&S>20)return!1}return!0}return{decode:function(r){const s=new Uint8Array(r);let d=8;const x=a,E=x.readUshort,F=x.readUint,w={tabs:{},frames:[]},H=new Uint8Array(s.length);let N,k=0,$=0;const y=[137,80,78,71,13,10,26,10];for(var U=0;U<8;U++)if(s[U]!=y[U])throw"The input is not a PNG file!";for(;d<s.length;){const I=x.readUint(s,d);d+=4;const g=x.readASCII(s,d,4);if(d+=4,g=="IHDR")p(s,d,w);else if(g=="iCCP"){for(var m=d;s[m]!=0;)m++;x.readASCII(s,d,m-d),s[m+1];const l=s.slice(m+2,d+I);let P=null;try{P=c(l)}catch{P=e(l)}w.tabs[g]=P}else if(g=="CgBI")w.tabs[g]=s.slice(d,d+4);else if(g=="IDAT"){for(U=0;U<I;U++)H[k+U]=s[d+U];k+=I}else if(g=="acTL")w.tabs[g]={num_frames:F(s,d),num_plays:F(s,d+4)},N=new Uint8Array(s.length);else if(g=="fcTL"){$!=0&&((T=w.frames[w.frames.length-1]).data=D(w,N.slice(0,$),T.rect.width,T.rect.height),$=0);const l={x:F(s,d+12),y:F(s,d+16),width:F(s,d+4),height:F(s,d+8)};let P=E(s,d+22);P=E(s,d+20)/(P==0?100:P);const j={rect:l,delay:Math.round(1e3*P),dispose:s[d+24],blend:s[d+25]};w.frames.push(j)}else if(g=="fdAT"){for(U=0;U<I-4;U++)N[$+U]=s[d+U+4];$+=I-4}else if(g=="pHYs")w.tabs[g]=[x.readUint(s,d),x.readUint(s,d+4),s[d+8]];else if(g=="cHRM")for(w.tabs[g]=[],U=0;U<8;U++)w.tabs[g].push(x.readUint(s,d+4*U));else if(g=="tEXt"||g=="zTXt"){w.tabs[g]==null&&(w.tabs[g]={});var h=x.nextZero(s,d),v=x.readASCII(s,d,h-d),S=d+I-h-1;if(g=="tEXt")_=x.readASCII(s,h+1,S);else{var C=c(s.slice(h+2,h+2+S));_=x.readUTF8(C,0,C.length)}w.tabs[g][v]=_}else if(g=="iTXt"){w.tabs[g]==null&&(w.tabs[g]={}),h=0,m=d,h=x.nextZero(s,m),v=x.readASCII(s,m,h-m);const l=s[m=h+1];var _;s[m+1],m+=2,h=x.nextZero(s,m),x.readASCII(s,m,h-m),m=h+1,h=x.nextZero(s,m),x.readUTF8(s,m,h-m),S=I-((m=h+1)-d),l==0?_=x.readUTF8(s,m,S):(C=c(s.slice(m,m+S)),_=x.readUTF8(C,0,C.length)),w.tabs[g][v]=_}else if(g=="PLTE")w.tabs[g]=x.readBytes(s,d,I);else if(g=="hIST"){const l=w.tabs.PLTE.length/3;for(w.tabs[g]=[],U=0;U<l;U++)w.tabs[g].push(E(s,d+2*U))}else if(g=="tRNS")w.ctype==3?w.tabs[g]=x.readBytes(s,d,I):w.ctype==0?w.tabs[g]=E(s,d):w.ctype==2&&(w.tabs[g]=[E(s,d),E(s,d+2),E(s,d+4)]);else if(g=="gAMA")w.tabs[g]=x.readUint(s,d)/1e5;else if(g=="sRGB")w.tabs[g]=s[d];else if(g=="bKGD")w.ctype==0||w.ctype==4?w.tabs[g]=[E(s,d)]:w.ctype==2||w.ctype==6?w.tabs[g]=[E(s,d),E(s,d+2),E(s,d+4)]:w.ctype==3&&(w.tabs[g]=s[d]);else if(g=="IEND")break;d+=I,x.readUint(s,d),d+=4}var T;return $!=0&&((T=w.frames[w.frames.length-1]).data=D(w,N.slice(0,$),T.rect.width,T.rect.height)),w.data=D(w,H,w.width,w.height),delete w.compress,delete w.interlace,delete w.filter,w},toRGBA8:function(r){const s=r.width,d=r.height;if(r.tabs.acTL==null)return[b(r.data,s,d,r).buffer];const x=[];r.frames[0].data==null&&(r.frames[0].data=r.data);const E=s*d*4,F=new Uint8Array(E),w=new Uint8Array(E),H=new Uint8Array(E);for(let k=0;k<r.frames.length;k++){const $=r.frames[k],y=$.rect.x,U=$.rect.y,m=$.rect.width,h=$.rect.height,v=b($.data,m,h,r);if(k!=0)for(var N=0;N<E;N++)H[N]=F[N];if($.blend==0?A(v,m,h,F,s,d,y,U,0):$.blend==1&&A(v,m,h,F,s,d,y,U,1),x.push(F.buffer.slice(0)),$.dispose!=0){if($.dispose==1)A(w,m,h,F,s,d,y,U,0);else if($.dispose==2)for(N=0;N<E;N++)F[N]=H[N]}}return x},_paeth:o,_copyTile:A,_bin:a}}();(function(){const{_copyTile:a}=tt,{_bin:b}=tt,D=tt._paeth;var c={table:function(){const m=new Uint32Array(256);for(let h=0;h<256;h++){let v=h;for(let S=0;S<8;S++)1&v?v=3988292384^v>>>1:v>>>=1;m[h]=v}return m}(),update(m,h,v,S){for(let C=0;C<S;C++)m=c.table[255&(m^h[v+C])]^m>>>8;return m},crc:(m,h,v)=>4294967295^c.update(4294967295,m,h,v)};function e(m,h,v,S){h[v]+=m[0]*S>>4,h[v+1]+=m[1]*S>>4,h[v+2]+=m[2]*S>>4,h[v+3]+=m[3]*S>>4}function t(m){return Math.max(0,Math.min(255,m))}function f(m,h){const v=m[0]-h[0],S=m[1]-h[1],C=m[2]-h[2],_=m[3]-h[3];return v*v+S*S+C*C+_*_}function o(m,h,v,S,C,_,T){T==null&&(T=1);const I=S.length,g=[];for(var l=0;l<I;l++){const z=S[l];g.push([z>>>0&255,z>>>8&255,z>>>16&255,z>>>24&255])}for(l=0;l<I;l++){let z=4294967295;for(var P=0,j=0;j<I;j++){var O=f(g[l],g[j]);j!=l&&O<z&&(z=O,P=j)}}const q=new Uint32Array(C.buffer),W=new Int16Array(h*v*4),Q=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(l=0;l<Q.length;l++)Q[l]=255*((Q[l]+.5)/16-.5);for(let z=0;z<v;z++)for(let Z=0;Z<h;Z++){var V;l=4*(z*h+Z),T!=2?V=[t(m[l]+W[l]),t(m[l+1]+W[l+1]),t(m[l+2]+W[l+2]),t(m[l+3]+W[l+3])]:(O=Q[4*(3&z)+(3&Z)],V=[t(m[l]+O),t(m[l+1]+O),t(m[l+2]+O),t(m[l+3]+O)]),P=0;let le=16777215;for(j=0;j<I;j++){const ie=f(V,g[j]);ie<le&&(le=ie,P=j)}const ne=g[P],J=[V[0]-ne[0],V[1]-ne[1],V[2]-ne[2],V[3]-ne[3]];T==1&&(Z!=h-1&&e(J,W,l+4,7),z!=v-1&&(Z!=0&&e(J,W,l+4*h-4,3),e(J,W,l+4*h,5),Z!=h-1&&e(J,W,l+4*h+4,1))),_[l>>2]=P,q[l>>2]=S[P]}}function p(m,h,v,S,C){C==null&&(C={});const{crc:_}=c,T=b.writeUint,I=b.writeUshort,g=b.writeASCII;let l=8;const P=m.frames.length>1;let j,O=!1,q=33+(P?20:0);if(C.sRGB!=null&&(q+=13),C.pHYs!=null&&(q+=21),C.iCCP!=null&&(j=pako.deflate(C.iCCP),q+=21+j.length+4),m.ctype==3){for(var W=m.plte.length,Q=0;Q<W;Q++)m.plte[Q]>>>24!=255&&(O=!0);q+=8+3*W+4+(O?8+1*W+4:0)}for(var V=0;V<m.frames.length;V++)P&&(q+=38),q+=(ne=m.frames[V]).cimg.length+12,V!=0&&(q+=4);q+=12;const z=new Uint8Array(q),Z=[137,80,78,71,13,10,26,10];for(Q=0;Q<8;Q++)z[Q]=Z[Q];if(T(z,l,13),l+=4,g(z,l,"IHDR"),l+=4,T(z,l,h),l+=4,T(z,l,v),l+=4,z[l]=m.depth,l++,z[l]=m.ctype,l++,z[l]=0,l++,z[l]=0,l++,z[l]=0,l++,T(z,l,_(z,l-17,17)),l+=4,C.sRGB!=null&&(T(z,l,1),l+=4,g(z,l,"sRGB"),l+=4,z[l]=C.sRGB,l++,T(z,l,_(z,l-5,5)),l+=4),C.iCCP!=null){const J=13+j.length;T(z,l,J),l+=4,g(z,l,"iCCP"),l+=4,g(z,l,"ICC profile"),l+=11,l+=2,z.set(j,l),l+=j.length,T(z,l,_(z,l-(J+4),J+4)),l+=4}if(C.pHYs!=null&&(T(z,l,9),l+=4,g(z,l,"pHYs"),l+=4,T(z,l,C.pHYs[0]),l+=4,T(z,l,C.pHYs[1]),l+=4,z[l]=C.pHYs[2],l++,T(z,l,_(z,l-13,13)),l+=4),P&&(T(z,l,8),l+=4,g(z,l,"acTL"),l+=4,T(z,l,m.frames.length),l+=4,T(z,l,C.loop!=null?C.loop:0),l+=4,T(z,l,_(z,l-12,12)),l+=4),m.ctype==3){for(T(z,l,3*(W=m.plte.length)),l+=4,g(z,l,"PLTE"),l+=4,Q=0;Q<W;Q++){const J=3*Q,ie=m.plte[Q],K=255&ie,fe=ie>>>8&255,je=ie>>>16&255;z[l+J+0]=K,z[l+J+1]=fe,z[l+J+2]=je}if(l+=3*W,T(z,l,_(z,l-3*W-4,3*W+4)),l+=4,O){for(T(z,l,W),l+=4,g(z,l,"tRNS"),l+=4,Q=0;Q<W;Q++)z[l+Q]=m.plte[Q]>>>24&255;l+=W,T(z,l,_(z,l-W-4,W+4)),l+=4}}let le=0;for(V=0;V<m.frames.length;V++){var ne=m.frames[V];P&&(T(z,l,26),l+=4,g(z,l,"fcTL"),l+=4,T(z,l,le++),l+=4,T(z,l,ne.rect.width),l+=4,T(z,l,ne.rect.height),l+=4,T(z,l,ne.rect.x),l+=4,T(z,l,ne.rect.y),l+=4,I(z,l,S[V]),l+=2,I(z,l,1e3),l+=2,z[l]=ne.dispose,l++,z[l]=ne.blend,l++,T(z,l,_(z,l-30,30)),l+=4);const J=ne.cimg;T(z,l,(W=J.length)+(V==0?0:4)),l+=4;const ie=l;g(z,l,V==0?"IDAT":"fdAT"),l+=4,V!=0&&(T(z,l,le++),l+=4),z.set(J,l),l+=W,T(z,l,_(z,ie,l-ie)),l+=4}return T(z,l,0),l+=4,g(z,l,"IEND"),l+=4,T(z,l,_(z,l-4,4)),l+=4,z.buffer}function A(m,h,v){for(let S=0;S<m.frames.length;S++){const C=m.frames[S];C.rect.width;const _=C.rect.height,T=new Uint8Array(_*C.bpl+_);C.cimg=d(C.img,_,C.bpp,C.bpl,T,h,v)}}function n(m,h,v,S,C){const _=C[0],T=C[1],I=C[2],g=C[3],l=C[4],P=C[5];let j=6,O=8,q=255;for(var W=0;W<m.length;W++){const pe=new Uint8Array(m[W]);for(var Q=pe.length,V=0;V<Q;V+=4)q&=pe[V+3]}const z=q!=255,Z=function(ce,oe,Te,be,ve,Ae){const me=[];for(var re=0;re<ce.length;re++){const te=new Uint8Array(ce[re]),Ce=new Uint32Array(te.buffer);var Se;let ge=0,we=0,_e=oe,$e=Te,lt=be?1:0;if(re!=0){const Lt=Ae||be||re==1||me[re-2].dispose!=0?1:2;let Ze=0,wt=1e9;for(let st=0;st<Lt;st++){var de=new Uint8Array(ce[re-1-st]);const xe=new Uint32Array(ce[re-1-st]);let Re=oe,Ge=Te,Ke=-1,Ve=-1;for(let Ye=0;Ye<Te;Ye++)for(let Je=0;Je<oe;Je++)Ce[ee=Ye*oe+Je]!=xe[ee]&&(Je<Re&&(Re=Je),Je>Ke&&(Ke=Je),Ye<Ge&&(Ge=Ye),Ye>Ve&&(Ve=Ye));Ke==-1&&(Re=Ge=Ke=Ve=0),ve&&((1&Re)==1&&Re--,(1&Ge)==1&&Ge--);const dt=(Ke-Re+1)*(Ve-Ge+1);dt<wt&&(wt=dt,Ze=st,ge=Re,we=Ge,_e=Ke-Re+1,$e=Ve-Ge+1)}de=new Uint8Array(ce[re-1-Ze]),Ze==1&&(me[re-1].dispose=2),Se=new Uint8Array(_e*$e*4),a(de,oe,Te,Se,_e,$e,-ge,-we,0),lt=a(te,oe,Te,Se,_e,$e,-ge,-we,3)?1:0,lt==1?s(te,oe,Te,Se,{x:ge,y:we,width:_e,height:$e}):a(te,oe,Te,Se,_e,$e,-ge,-we,0)}else Se=te.slice(0);me.push({rect:{x:ge,y:we,width:_e,height:$e},img:Se,blend:lt,dispose:0})}if(be)for(re=0;re<me.length;re++){if((He=me[re]).blend==1)continue;const te=He.rect,Ce=me[re-1].rect,ge=Math.min(te.x,Ce.x),we=Math.min(te.y,Ce.y),_e={x:ge,y:we,width:Math.max(te.x+te.width,Ce.x+Ce.width)-ge,height:Math.max(te.y+te.height,Ce.y+Ce.height)-we};me[re-1].dispose=1,re-1!=0&&r(ce,oe,Te,me,re-1,_e,ve),r(ce,oe,Te,me,re,_e,ve)}let ot=0;if(ce.length!=1)for(var ee=0;ee<me.length;ee++){var He;ot+=(He=me[ee]).rect.width*He.rect.height}return me}(m,h,v,_,T,I),le={},ne=[],J=[];if(S!=0){const pe=[];for(V=0;V<Z.length;V++)pe.push(Z[V].img.buffer);const ce=function(ve){let Ae=0;for(var me=0;me<ve.length;me++)Ae+=ve[me].byteLength;const re=new Uint8Array(Ae);let Se=0;for(me=0;me<ve.length;me++){const de=new Uint8Array(ve[me]),ot=de.length;for(let ee=0;ee<ot;ee+=4){let He=de[ee],te=de[ee+1],Ce=de[ee+2];const ge=de[ee+3];ge==0&&(He=te=Ce=0),re[Se+ee]=He,re[Se+ee+1]=te,re[Se+ee+2]=Ce,re[Se+ee+3]=ge}Se+=ot}return re.buffer}(pe),oe=E(ce,S);for(V=0;V<oe.plte.length;V++)ne.push(oe.plte[V].est.rgba);let Te=0;for(V=0;V<Z.length;V++){const be=(K=Z[V]).img.length;var ie=new Uint8Array(oe.inds.buffer,Te>>2,be>>2);J.push(ie);const ve=new Uint8Array(oe.abuf,Te,be);P&&o(K.img,K.rect.width,K.rect.height,ne,ve,ie),K.img.set(ve),Te+=be}}else for(W=0;W<Z.length;W++){var K=Z[W];const pe=new Uint32Array(K.img.buffer);var fe=K.rect.width;for(Q=pe.length,ie=new Uint8Array(Q),J.push(ie),V=0;V<Q;V++){const ce=pe[V];if(V!=0&&ce==pe[V-1])ie[V]=ie[V-1];else if(V>fe&&ce==pe[V-fe])ie[V]=ie[V-fe];else{let oe=le[ce];if(oe==null&&(le[ce]=oe=ne.length,ne.push(ce),ne.length>=300))break;ie[V]=oe}}}const je=ne.length;for(je<=256&&l==0&&(O=je<=2?1:je<=4?2:je<=16?4:8,O=Math.max(O,g)),W=0;W<Z.length;W++){(K=Z[W]).rect.x,K.rect.y,fe=K.rect.width;const pe=K.rect.height;let ce=K.img;new Uint32Array(ce.buffer);let oe=4*fe,Te=4;if(je<=256&&l==0){oe=Math.ceil(O*fe/8);var ke=new Uint8Array(oe*pe);const be=J[W];for(let ve=0;ve<pe;ve++){V=ve*oe;const Ae=ve*fe;if(O==8)for(var ue=0;ue<fe;ue++)ke[V+ue]=be[Ae+ue];else if(O==4)for(ue=0;ue<fe;ue++)ke[V+(ue>>1)]|=be[Ae+ue]<<4-4*(1&ue);else if(O==2)for(ue=0;ue<fe;ue++)ke[V+(ue>>2)]|=be[Ae+ue]<<6-2*(3&ue);else if(O==1)for(ue=0;ue<fe;ue++)ke[V+(ue>>3)]|=be[Ae+ue]<<7-1*(7&ue)}ce=ke,j=3,Te=1}else if(z==0&&Z.length==1){ke=new Uint8Array(fe*pe*3);const be=fe*pe;for(V=0;V<be;V++){const ve=3*V,Ae=4*V;ke[ve]=ce[Ae],ke[ve+1]=ce[Ae+1],ke[ve+2]=ce[Ae+2]}ce=ke,j=2,Te=3,oe=3*fe}K.img=ce,K.bpl=oe,K.bpp=Te}return{ctype:j,depth:O,plte:ne,frames:Z}}function r(m,h,v,S,C,_,T){const I=Uint8Array,g=Uint32Array,l=new I(m[C-1]),P=new g(m[C-1]),j=C+1<m.length?new I(m[C+1]):null,O=new I(m[C]),q=new g(O.buffer);let W=h,Q=v,V=-1,z=-1;for(let le=0;le<_.height;le++)for(let ne=0;ne<_.width;ne++){const J=_.x+ne,ie=_.y+le,K=ie*h+J,fe=q[K];fe==0||S[C-1].dispose==0&&P[K]==fe&&(j==null||j[4*K+3]!=0)||(J<W&&(W=J),J>V&&(V=J),ie<Q&&(Q=ie),ie>z&&(z=ie))}V==-1&&(W=Q=V=z=0),T&&((1&W)==1&&W--,(1&Q)==1&&Q--),_={x:W,y:Q,width:V-W+1,height:z-Q+1};const Z=S[C];Z.rect=_,Z.blend=1,Z.img=new Uint8Array(_.width*_.height*4),S[C-1].dispose==0?(a(l,h,v,Z.img,_.width,_.height,-_.x,-_.y,0),s(O,h,v,Z.img,_)):a(O,h,v,Z.img,_.width,_.height,-_.x,-_.y,0)}function s(m,h,v,S,C){a(m,h,v,S,C.width,C.height,-C.x,-C.y,2)}function d(m,h,v,S,C,_,T){const I=[];let g,l=[0,1,2,3,4];_!=-1?l=[_]:(h*S>5e5||v==1)&&(l=[0]),T&&(g={level:0});const P=Pr;for(var j=0;j<l.length;j++){for(let W=0;W<h;W++)x(C,m,W,S,v,l[j]);I.push(P.deflate(C,g))}let O,q=1e9;for(j=0;j<I.length;j++)I[j].length<q&&(O=j,q=I[j].length);return I[O]}function x(m,h,v,S,C,_){const T=v*S;let I=T+v;if(m[I]=_,I++,_==0)if(S<500)for(var g=0;g<S;g++)m[I+g]=h[T+g];else m.set(new Uint8Array(h.buffer,T,S),I);else if(_==1){for(g=0;g<C;g++)m[I+g]=h[T+g];for(g=C;g<S;g++)m[I+g]=h[T+g]-h[T+g-C]+256&255}else if(v==0){for(g=0;g<C;g++)m[I+g]=h[T+g];if(_==2)for(g=C;g<S;g++)m[I+g]=h[T+g];if(_==3)for(g=C;g<S;g++)m[I+g]=h[T+g]-(h[T+g-C]>>1)+256&255;if(_==4)for(g=C;g<S;g++)m[I+g]=h[T+g]-D(h[T+g-C],0,0)+256&255}else{if(_==2)for(g=0;g<S;g++)m[I+g]=h[T+g]+256-h[T+g-S]&255;if(_==3){for(g=0;g<C;g++)m[I+g]=h[T+g]+256-(h[T+g-S]>>1)&255;for(g=C;g<S;g++)m[I+g]=h[T+g]+256-(h[T+g-S]+h[T+g-C]>>1)&255}if(_==4){for(g=0;g<C;g++)m[I+g]=h[T+g]+256-D(0,h[T+g-S],0)&255;for(g=C;g<S;g++)m[I+g]=h[T+g]+256-D(h[T+g-C],h[T+g-S],h[T+g-C-S])&255}}}function E(m,h){const v=new Uint8Array(m),S=v.slice(0),C=new Uint32Array(S.buffer),_=F(S,h),T=_[0],I=_[1],g=v.length,l=new Uint8Array(g>>2);let P;if(v.length<2e7)for(var j=0;j<g;j+=4)P=w(T,O=v[j]*(1/255),q=v[j+1]*(1/255),W=v[j+2]*(1/255),Q=v[j+3]*(1/255)),l[j>>2]=P.ind,C[j>>2]=P.est.rgba;else for(j=0;j<g;j+=4){var O=v[j]*.00392156862745098,q=v[j+1]*(1/255),W=v[j+2]*(1/255),Q=v[j+3]*(1/255);for(P=T;P.left;)P=H(P.est,O,q,W,Q)<=0?P.left:P.right;l[j>>2]=P.ind,C[j>>2]=P.est.rgba}return{abuf:S.buffer,inds:l,plte:I}}function F(m,h,v){v==null&&(v=1e-4);const S=new Uint32Array(m.buffer),C={i0:0,i1:m.length,bst:null,est:null,tdst:0,left:null,right:null};C.bst=$(m,C.i0,C.i1),C.est=y(C.bst);const _=[C];for(;_.length<h;){let I=0,g=0;for(var T=0;T<_.length;T++)_[T].est.L>I&&(I=_[T].est.L,g=T);if(I<v)break;const l=_[g],P=N(m,S,l.i0,l.i1,l.est.e,l.est.eMq255);if(l.i0>=P||l.i1<=P){l.est.L=0;continue}const j={i0:l.i0,i1:P,bst:null,est:null,tdst:0,left:null,right:null};j.bst=$(m,j.i0,j.i1),j.est=y(j.bst);const O={i0:P,i1:l.i1,bst:null,est:null,tdst:0,left:null,right:null};for(O.bst={R:[],m:[],N:l.bst.N-j.bst.N},T=0;T<16;T++)O.bst.R[T]=l.bst.R[T]-j.bst.R[T];for(T=0;T<4;T++)O.bst.m[T]=l.bst.m[T]-j.bst.m[T];O.est=y(O.bst),l.left=j,l.right=O,_[g]=j,_.push(O)}for(_.sort((I,g)=>g.bst.N-I.bst.N),T=0;T<_.length;T++)_[T].ind=T;return[C,_]}function w(m,h,v,S,C){if(m.left==null)return m.tdst=function(j,O,q,W,Q){const V=O-j[0],z=q-j[1],Z=W-j[2],le=Q-j[3];return V*V+z*z+Z*Z+le*le}(m.est.q,h,v,S,C),m;const _=H(m.est,h,v,S,C);let T=m.left,I=m.right;_>0&&(T=m.right,I=m.left);const g=w(T,h,v,S,C);if(g.tdst<=_*_)return g;const l=w(I,h,v,S,C);return l.tdst<g.tdst?l:g}function H(m,h,v,S,C){const{e:_}=m;return _[0]*h+_[1]*v+_[2]*S+_[3]*C-m.eMq}function N(m,h,v,S,C,_){for(S-=4;v<S;){for(;k(m,v,C)<=_;)v+=4;for(;k(m,S,C)>_;)S-=4;if(v>=S)break;const T=h[v>>2];h[v>>2]=h[S>>2],h[S>>2]=T,v+=4,S-=4}for(;k(m,v,C)>_;)v-=4;return v+4}function k(m,h,v){return m[h]*v[0]+m[h+1]*v[1]+m[h+2]*v[2]+m[h+3]*v[3]}function $(m,h,v){const S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C=[0,0,0,0],_=v-h>>2;for(let T=h;T<v;T+=4){const I=m[T]*.00392156862745098,g=m[T+1]*(1/255),l=m[T+2]*(1/255),P=m[T+3]*(1/255);C[0]+=I,C[1]+=g,C[2]+=l,C[3]+=P,S[0]+=I*I,S[1]+=I*g,S[2]+=I*l,S[3]+=I*P,S[5]+=g*g,S[6]+=g*l,S[7]+=g*P,S[10]+=l*l,S[11]+=l*P,S[15]+=P*P}return S[4]=S[1],S[8]=S[2],S[9]=S[6],S[12]=S[3],S[13]=S[7],S[14]=S[11],{R:S,m:C,N:_}}function y(m){const{R:h}=m,{m:v}=m,{N:S}=m,C=v[0],_=v[1],T=v[2],I=v[3],g=S==0?0:1/S,l=[h[0]-C*C*g,h[1]-C*_*g,h[2]-C*T*g,h[3]-C*I*g,h[4]-_*C*g,h[5]-_*_*g,h[6]-_*T*g,h[7]-_*I*g,h[8]-T*C*g,h[9]-T*_*g,h[10]-T*T*g,h[11]-T*I*g,h[12]-I*C*g,h[13]-I*_*g,h[14]-I*T*g,h[15]-I*I*g],P=l,j=U;let O=[Math.random(),Math.random(),Math.random(),Math.random()],q=0,W=0;if(S!=0)for(let V=0;V<16&&(O=j.multVec(P,O),W=Math.sqrt(j.dot(O,O)),O=j.sml(1/W,O),!(V!=0&&Math.abs(W-q)<1e-9));V++)q=W;const Q=[C*g,_*g,T*g,I*g];return{Cov:l,q:Q,e:O,L:q,eMq255:j.dot(j.sml(255,Q),O),eMq:j.dot(O,Q),rgba:(Math.round(255*Q[3])<<24|Math.round(255*Q[2])<<16|Math.round(255*Q[1])<<8|Math.round(255*Q[0])<<0)>>>0}}var U={multVec:(m,h)=>[m[0]*h[0]+m[1]*h[1]+m[2]*h[2]+m[3]*h[3],m[4]*h[0]+m[5]*h[1]+m[6]*h[2]+m[7]*h[3],m[8]*h[0]+m[9]*h[1]+m[10]*h[2]+m[11]*h[3],m[12]*h[0]+m[13]*h[1]+m[14]*h[2]+m[15]*h[3]],dot:(m,h)=>m[0]*h[0]+m[1]*h[1]+m[2]*h[2]+m[3]*h[3],sml:(m,h)=>[m*h[0],m*h[1],m*h[2],m*h[3]]};tt.encode=function(h,v,S,C,_,T,I){C==null&&(C=0),I==null&&(I=!1);const g=n(h,v,S,C,[!1,!1,!1,0,I,!1]);return A(g,-1),p(g,v,S,_,T)},tt.encodeLL=function(h,v,S,C,_,T,I,g){const l={ctype:0+(C==1?0:2)+(_==0?0:4),depth:T,frames:[]},P=(C+_)*T,j=P*v;for(let O=0;O<h.length;O++)l.frames.push({rect:{x:0,y:0,width:v,height:S},img:new Uint8Array(h[O]),blend:0,dispose:1,bpp:Math.ceil(P/8),bpl:Math.ceil(j/8)});return A(l,0,!0),p(l,v,S,I,g)},tt.encode.compress=n,tt.encode.dither=o,tt.quantize=E,tt.quantize.getKDtree=F,tt.quantize.getNearest=w})();const Fs={toArrayBuffer(a,b){const D=a.width,c=a.height,e=D<<2,t=a.getContext("2d").getImageData(0,0,D,c),f=new Uint32Array(t.data.buffer),o=(32*D+31)/32<<2,p=o*c,A=122+p,n=new ArrayBuffer(A),r=new DataView(n),s=1<<20;let d,x,E,F,w=s,H=0,N=0,k=0;function $(m){r.setUint16(N,m,!0),N+=2}function y(m){r.setUint32(N,m,!0),N+=4}function U(m){N+=m}$(19778),y(A),U(4),y(122),y(108),y(D),y(-c>>>0),$(1),$(32),y(3),y(p),y(2835),y(2835),U(8),y(16711680),y(65280),y(255),y(4278190080),y(1466527264),function m(){for(;H<c&&w>0;){for(F=122+H*o,d=0;d<e;)w--,x=f[k++],E=x>>>24,r.setUint32(F+d,x<<8|E),d+=4;H++}k<f.length?(w=s,setTimeout(m,Fs._dly)):b(n)}()},toBlob(a,b){this.toArrayBuffer(a,D=>{b(new Blob([D],{type:"image/bmp"}))})},_dly:9};var Be={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Br={[Be.CHROME]:16384,[Be.FIREFOX]:11180,[Be.DESKTOP_SAFARI]:16384,[Be.IE]:8192,[Be.IOS]:4096,[Be.ETC]:8192};const zn=typeof window<"u",ks=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,xn=zn&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Hr=(zn||ks)&&(xn&&xn.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Os=(zn||ks)&&(xn&&xn.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function Wn(a,b,D=Date.now()){return new Promise(c=>{const e=a.split(","),t=e[0].match(/:(.*?);/)[1],f=globalThis.atob(e[1]);let o=f.length;const p=new Uint8Array(o);for(;o--;)p[o]=f.charCodeAt(o);const A=new Blob([p],{type:t});A.name=b,A.lastModified=D,c(A)})}function Us(a){return new Promise((b,D)=>{const c=new Os;c.onload=()=>b(c.result),c.onerror=e=>D(e),c.readAsDataURL(a)})}function Ms(a){return new Promise((b,D)=>{const c=new Image;c.onload=()=>b(c),c.onerror=e=>D(e),c.src=a})}function At(){if(At.cachedResult!==void 0)return At.cachedResult;let a=Be.ETC;const{userAgent:b}=navigator;return/Chrom(e|ium)/i.test(b)?a=Be.CHROME:/iP(ad|od|hone)/i.test(b)&&/WebKit/i.test(b)?a=Be.IOS:/Safari/i.test(b)?a=Be.DESKTOP_SAFARI:/Firefox/i.test(b)?a=Be.FIREFOX:(/MSIE/i.test(b)||document.documentMode)&&(a=Be.IE),At.cachedResult=a,At.cachedResult}function Ns(a,b){const D=At(),c=Br[D];let e=a,t=b,f=e*t;const o=e>t?t/e:e/t;for(;f>c*c;){const p=(c+e)/2,A=(c+t)/2;p<A?(t=A,e=A*o):(t=p*o,e=p),f=e*t}return{width:e,height:t}}function Tn(a,b){let D,c;try{if(D=new OffscreenCanvas(a,b),c=D.getContext("2d"),c===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{D=document.createElement("canvas"),c=D.getContext("2d")}return D.width=a,D.height=b,[D,c]}function Ls(a,b){const{width:D,height:c}=Ns(a.width,a.height),[e,t]=Tn(D,c);return b&&/jpe?g/.test(b)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(a,0,0,e.width,e.height),e}function hn(){return hn.cachedResult!==void 0||(hn.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),hn.cachedResult}function vn(a,b={}){return new Promise(function(D,c){let e,t;var f=function(){try{return t=Ls(e,b.fileType||a.type),D([e,t])}catch(p){return c(p)}},o=function(p){try{var A=function(n){try{throw n}catch(r){return c(r)}};try{let n;return Us(a).then(function(r){try{return n=r,Ms(n).then(function(s){try{return e=s,function(){try{return f()}catch(d){return c(d)}}()}catch(d){return A(d)}},A)}catch(s){return A(s)}},A)}catch(n){A(n)}}catch(n){return c(n)}};try{if(hn()||[Be.DESKTOP_SAFARI,Be.MOBILE_SAFARI].includes(At()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(a).then(function(p){try{return e=p,f()}catch{return o()}},o)}catch{o()}})}function yn(a,b,D,c,e=1){return new Promise(function(t,f){let o;if(b==="image/png"){let A,n,r;return A=a.getContext("2d"),{data:n}=A.getImageData(0,0,a.width,a.height),r=tt.encode([n.buffer],a.width,a.height,4096*e),o=new Blob([r],{type:b}),o.name=D,o.lastModified=c,p.call(this)}{let A=function(){return p.call(this)};if(b==="image/bmp")return new Promise(n=>Fs.toBlob(a,n)).then((function(n){try{return o=n,o.name=D,o.lastModified=c,A.call(this)}catch(r){return f(r)}}).bind(this),f);{let n=function(){return A.call(this)};if(typeof OffscreenCanvas=="function"&&a instanceof OffscreenCanvas)return a.convertToBlob({type:b,quality:e}).then((function(r){try{return o=r,o.name=D,o.lastModified=c,n.call(this)}catch(s){return f(s)}}).bind(this),f);{let r;return r=a.toDataURL(b,e),Wn(r,D,c).then((function(s){try{return o=s,n.call(this)}catch(d){return f(d)}}).bind(this),f)}}}function p(){return t(o)}})}function it(a){a.width=0,a.height=0}function It(){return new Promise(function(a,b){let D,c,e,t;return It.cachedResult!==void 0?a(It.cachedResult):Wn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(f){try{return D=f,vn(D).then(function(o){try{return c=o[1],yn(c,D.type,D.name,D.lastModified).then(function(p){try{return e=p,it(c),vn(e).then(function(A){try{return t=A[0],It.cachedResult=t.width===1&&t.height===2,a(It.cachedResult)}catch(n){return b(n)}},b)}catch(A){return b(A)}},b)}catch(p){return b(p)}},b)}catch(o){return b(o)}},b)})}function Ps(a){return new Promise((b,D)=>{const c=new Os;c.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return b(-2);const f=t.byteLength;let o=2;for(;o<f;){if(t.getUint16(o+2,!1)<=8)return b(-1);const p=t.getUint16(o,!1);if(o+=2,p==65505){if(t.getUint32(o+=2,!1)!=1165519206)return b(-1);const A=t.getUint16(o+=6,!1)==18761;o+=t.getUint32(o+4,A);const n=t.getUint16(o,A);o+=2;for(let r=0;r<n;r++)if(t.getUint16(o+12*r,A)==274)return b(t.getUint16(o+12*r+8,A))}else{if((65280&p)!=65280)break;o+=t.getUint16(o,!1)}}return b(-1)},c.onerror=e=>D(e),c.readAsArrayBuffer(a)})}function Bs(a,b){const{width:D}=a,{height:c}=a,{maxWidthOrHeight:e}=b;let t,f=a;return isFinite(e)&&(D>e||c>e)&&([f,t]=Tn(D,c),D>c?(f.width=e,f.height=c/D*e):(f.width=D/c*e,f.height=e),t.drawImage(a,0,0,f.width,f.height),it(a)),f}function Hs(a,b){const{width:D}=a,{height:c}=a,[e,t]=Tn(D,c);switch(b>4&&b<9?(e.width=c,e.height=D):(e.width=D,e.height=c),b){case 2:t.transform(-1,0,0,1,D,0);break;case 3:t.transform(-1,0,0,-1,D,c);break;case 4:t.transform(1,0,0,-1,0,c);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,c,0);break;case 7:t.transform(0,-1,-1,0,c,D);break;case 8:t.transform(0,-1,1,0,0,D)}return t.drawImage(a,0,0,D,c),it(a),e}function is(a,b,D=0){return new Promise(function(c,e){let t,f,o,p,A,n,r,s,d,x,E,F,w,H,N,k,$,y,U,m;function h(S=5){if(b.signal&&b.signal.aborted)throw b.signal.reason;t+=S,b.onProgress(Math.min(t,100))}function v(S){if(b.signal&&b.signal.aborted)throw b.signal.reason;t=Math.min(Math.max(S,t),100),b.onProgress(t)}return t=D,f=b.maxIteration||10,o=1024*b.maxSizeMB*1024,h(),vn(a,b).then((function(S){try{return[,p]=S,h(),A=Bs(p,b),h(),new Promise(function(C,_){var T;if(!(T=b.exifOrientation))return Ps(a).then((function(g){try{return T=g,I.call(this)}catch(l){return _(l)}}).bind(this),_);function I(){return C(T)}return I.call(this)}).then((function(C){try{return n=C,h(),It().then((function(_){try{return r=_?A:Hs(A,n),h(),s=b.initialQuality||1,d=b.fileType||a.type,yn(r,d,a.name,a.lastModified,s).then((function(T){try{{let g=function(){if(f--&&(N>o||N>w)){let P,j;return P=m?.95*U.width:U.width,j=m?.95*U.height:U.height,[$,y]=Tn(P,j),y.drawImage(U,0,0,P,j),s*=d==="image/png"?.85:.95,yn($,d,a.name,a.lastModified,s).then(function(O){try{return k=O,it(U),U=$,N=k.size,v(Math.min(99,Math.floor((H-N)/(H-o)*100))),g}catch(q){return e(q)}},e)}return[1]},l=function(){return it(U),it($),it(A),it(r),it(p),v(100),c(k)};if(x=T,h(),E=x.size>o,F=x.size>a.size,!E&&!F)return v(100),c(x);var I;return w=a.size,H=x.size,N=H,U=r,m=!b.alwaysKeepResolution&&E,(I=(function(P){for(;P;){if(P.then)return void P.then(I,e);try{if(P.pop){if(P.length)return P.pop()?l.call(this):P;P=g}else P=P.call(this)}catch(j){return e(j)}}}).bind(this))(g)}}catch(g){return e(g)}}).bind(this),e)}catch(T){return e(T)}}).bind(this),e)}catch(_){return e(_)}}).bind(this),e)}catch(C){return e(C)}}).bind(this),e)})}const $r=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let En;function zr(a,b){return new Promise((D,c)=>{En||(En=function(f){const o=[];return o.push(f),URL.createObjectURL(new Blob(o))}($r));const e=new Worker(En);e.addEventListener("message",function(f){if(b.signal&&b.signal.aborted)e.terminate();else if(f.data.progress===void 0){if(f.data.error)return c(new Error(f.data.error)),void e.terminate();D(f.data.file),e.terminate()}else b.onProgress(f.data.progress)}),e.addEventListener("error",c),b.signal&&b.signal.addEventListener("abort",()=>{c(b.signal.reason),e.terminate()}),e.postMessage({file:a,imageCompressionLibUrl:b.libURL,options:{...b,onProgress:void 0,signal:void 0}})})}function Oe(a,b){return new Promise(function(D,c){let e,t,f,o,p,A;if(e={...b},f=0,{onProgress:o}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,p=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=d=>{f=d,typeof o=="function"&&o(f)},!(a instanceof Blob||a instanceof Hr))return c(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(a.type))return c(new Error("The file given is not an image"));if(A=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!p||typeof Worker!="function"||A)return is(a,e).then((function(d){try{return t=d,s.call(this)}catch(x){return c(x)}}).bind(this),c);var n=(function(){try{return s.call(this)}catch(d){return c(d)}}).bind(this),r=function(d){try{return is(a,e).then(function(x){try{return t=x,n()}catch(E){return c(E)}},c)}catch(x){return c(x)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",zr(a,e).then(function(d){try{return t=d,n()}catch{return r()}},r)}catch{r()}function s(){try{t.name=a.name,t.lastModified=a.lastModified}catch{}try{e.preserveExif&&a.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===a.type)&&(t=Rs(a,t))}catch{}return D(t)}})}Oe.getDataUrlFromFile=Us,Oe.getFilefromDataUrl=Wn,Oe.loadImage=Ms,Oe.drawImageInCanvas=Ls,Oe.drawFileInCanvas=vn,Oe.canvasToFile=yn,Oe.getExifOrientation=Ps,Oe.handleMaxWidthOrHeight=Bs,Oe.followExifOrientation=Hs,Oe.cleanupCanvasMemory=it,Oe.isAutoOrientationInBrowser=It,Oe.approximateBelowMaximumCanvasSizeOfBrowser=Ns,Oe.copyExifWithoutOrientation=Rs,Oe.getBrowserName=At,Oe.version="2.0.2";function Wr(a){var b=typeof a;return a!=null&&(b=="object"||b=="function")}var $s=Wr,Gr=typeof on=="object"&&on&&on.Object===Object&&on,Vr=Gr,Yr=Vr,qr=typeof self=="object"&&self&&self.Object===Object&&self,Qr=Yr||qr||Function("return this")(),zs=Qr,Xr=zs,Zr=function(){return Xr.Date.now()},Kr=Zr,Jr=/\s/;function ei(a){for(var b=a.length;b--&&Jr.test(a.charAt(b)););return b}var ti=ei,ni=ti,si=/^\s+/;function ri(a){return a&&a.slice(0,ni(a)+1).replace(si,"")}var ii=ri,ai=zs,oi=ai.Symbol,Ws=oi,as=Ws,Gs=Object.prototype,li=Gs.hasOwnProperty,ci=Gs.toString,Wt=as?as.toStringTag:void 0;function di(a){var b=li.call(a,Wt),D=a[Wt];try{a[Wt]=void 0;var c=!0}catch{}var e=ci.call(a);return c&&(b?a[Wt]=D:delete a[Wt]),e}var ui=di,fi=Object.prototype,hi=fi.toString;function mi(a){return hi.call(a)}var gi=mi,os=Ws,pi=ui,bi=gi,xi="[object Null]",vi="[object Undefined]",ls=os?os.toStringTag:void 0;function yi(a){return a==null?a===void 0?vi:xi:ls&&ls in Object(a)?pi(a):bi(a)}var Ti=yi;function Ai(a){return a!=null&&typeof a=="object"}var Si=Ai,Ci=Ti,wi=Si,_i="[object Symbol]";function Ei(a){return typeof a=="symbol"||wi(a)&&Ci(a)==_i}var ji=Ei,Ii=ii,cs=$s,Di=ji,ds=NaN,Ri=/^[-+]0x[0-9a-f]+$/i,Fi=/^0b[01]+$/i,ki=/^0o[0-7]+$/i,Oi=parseInt;function Ui(a){if(typeof a=="number")return a;if(Di(a))return ds;if(cs(a)){var b=typeof a.valueOf=="function"?a.valueOf():a;a=cs(b)?b+"":b}if(typeof a!="string")return a===0?a:+a;a=Ii(a);var D=Fi.test(a);return D||ki.test(a)?Oi(a.slice(2),D?2:8):Ri.test(a)?ds:+a}var Mi=Ui,Ni=$s,jn=Kr,us=Mi,Li="Expected a function",Pi=Math.max,Bi=Math.min;function Hi(a,b,D){var c,e,t,f,o,p,A=0,n=!1,r=!1,s=!0;if(typeof a!="function")throw new TypeError(Li);b=us(b)||0,Ni(D)&&(n=!!D.leading,r="maxWait"in D,t=r?Pi(us(D.maxWait)||0,b):t,s="trailing"in D?!!D.trailing:s);function d(y){var U=c,m=e;return c=e=void 0,A=y,f=a.apply(m,U),f}function x(y){return A=y,o=setTimeout(w,b),n?d(y):f}function E(y){var U=y-p,m=y-A,h=b-U;return r?Bi(h,t-m):h}function F(y){var U=y-p,m=y-A;return p===void 0||U>=b||U<0||r&&m>=t}function w(){var y=jn();if(F(y))return H(y);o=setTimeout(w,E(y))}function H(y){return o=void 0,s&&c?d(y):(c=e=void 0,f)}function N(){o!==void 0&&clearTimeout(o),A=0,c=p=e=o=void 0}function k(){return o===void 0?f:H(jn())}function $(){var y=jn(),U=F(y);if(c=arguments,e=this,p=y,U){if(o===void 0)return x(p);if(r)return clearTimeout(o),o=setTimeout(w,b),d(p)}return o===void 0&&(o=setTimeout(w,b)),f}return $.cancel=N,$.flush=k,$}var $i=Hi;const zi=pr($i);var Gn={},Wi=xt;Object.defineProperty(Gn,"__esModule",{value:!0});var Vs=Gn.default=void 0,Gi=Wi(bt()),fs=i;Vs=Gn.default=(0,Gi.default)([(0,fs.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,fs.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn");var Vn={},Vi=xt;Object.defineProperty(Vn,"__esModule",{value:!0});var Ys=Vn.default=void 0,Yi=Vi(bt()),qi=i;Ys=Vn.default=(0,Yi.default)((0,qi.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut");var Yn={},Qi=xt;Object.defineProperty(Yn,"__esModule",{value:!0});var qs=Yn.default=void 0,Xi=Qi(bt()),Zi=i;qs=Yn.default=(0,Xi.default)((0,Zi.jsx)("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen");var qn={},Ki=xt;Object.defineProperty(qn,"__esModule",{value:!0});var Qs=qn.default=void 0,Ji=Ki(bt()),ea=i;Qs=qn.default=(0,Ji.default)((0,ea.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var Qn={},ta=xt;Object.defineProperty(Qn,"__esModule",{value:!0});var Xs=Qn.default=void 0,na=ta(bt()),hs=i;Xs=Qn.default=(0,na.default)([(0,hs.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,hs.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera");const kt=G.forwardRef(({path:a,initialImages:b=[],onImagesUpdated:D,onDelete:c,isOwnDesign:e},t)=>{const[f,o]=G.useState(b.map(l=>({...l,deleted:!1}))),[p,A]=G.useState(!1),[n,r]=G.useState(0),[s,d]=G.useState(!1),[x,E]=G.useState(null),[F,w]=G.useState(1),[H,N]=G.useState(!1),[k,$]=G.useState(!1),[y,U]=G.useState(""),[m,h]=G.useState("info"),v=G.useRef(null);G.useEffect(()=>{console.log("Initial images received:",b),o(b.map(l=>({...l,deleted:!!l.deleted})))},[b]);const S=async l=>{const P=Array.from(l.target.files||[]);A(!0);const j={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},O=P.map(async(q,W)=>{let Q=q;q.size>1024*1024&&(Q=await Oe(q,j),U("Your image was compressed before uploading due to file size larger than 1 MB."),h("info"),$(!0));const z=`${new Date().getTime()}-${Q.name}`,Z=Dt(),le=Rt(Z,`${a}/${z}`),ne=Is(le,Q);return new Promise((J,ie)=>{ne.on("state_changed",K=>{const fe=K.bytesTransferred/K.totalBytes*100;r(fe)},K=>{console.error("Upload failed:",K),ie(K)},()=>{Ds(ne.snapshot.ref).then(K=>{J({url:K,path:le.fullPath,title:""})})})})});Promise.all(O).then(q=>{const W=[...f,...q];o(W),D&&D(W),U("Images uploaded successfully."),h("success"),$(!0),A(!1),r(0),v.current&&(v.current.value="")}).catch(q=>{console.error("Error uploading images: ",q),U("Failed to upload images."),h("error"),$(!0),A(!1),r(0)})},C=l=>{o(P=>{const j=P.map((O,q)=>q===l?{...O,deleted:!0}:O);return D(j),j}),U("Image marked for deletion. Update to permanently delete."),h("info"),$(!0)},_=async()=>{const l=f.filter(P=>P.deleted);if(console.log("Attempting to delete images:",l),l.length>0){const P=l.map(j=>{const O=Dt(),q=Rt(O,j.path);return fn(q)});try{await Promise.all(P),c(l),o(j=>j.filter(O=>!O.deleted)),U("Deleted images have been permanently removed."),h("success")}catch(j){console.error("Error committing deletions:",j),U("Failed to commit deletions."),h("error")}$(!0)}else console.log("No images marked for deletion.")},T=l=>{N(!H),E(l)};G.useEffect(()=>{const l=()=>{const P=!!document.fullscreenElement;N(P)};return document.addEventListener("fullscreenchange",l),()=>document.removeEventListener("fullscreenchange",l)},[]);const I=(l,P)=>{P!=="clickaway"&&$(!1)},g=G.useCallback(zi((l,P)=>{setTimeout(()=>{o(j=>{const O=j.map((q,W)=>W===l?{...q,title:P}:q);return D&&D(O),O})},0)},30),[D]);return G.useImperativeHandle(t,()=>({commitDeletions:_})),i.jsxs("div",{children:[e&&i.jsx(Xt,{title:"Upload Images",children:i.jsxs(Me,{variant:"outlined",component:"label",startIcon:i.jsx(Xs,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:S,disabled:p,ref:v,accept:"image/*"})]})}),p&&i.jsxs(i.Fragment,{children:[i.jsxs("p",{children:["Uploading... ",Math.round(n),"%"]}),i.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:i.jsx("div",{style:{height:"20px",width:`${n}%`,backgroundColor:"green"}})})]}),f.filter(l=>!l.deleted).map((l,P)=>i.jsxs("div",{children:[i.jsx("img",{src:l.url,alt:`Uploaded design ${P}`,onClick:()=>{d(!0),E(P)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&i.jsx(Qe,{onClick:()=>C(P),children:i.jsx(Zt,{})}),i.jsx("textarea",{value:l.title,onChange:j=>g(P,j.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},P)),i.jsx(St,{open:s,onClose:()=>d(!1),fullScreen:H,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:H?"none":void 0,maxHeight:H?"none":void 0,height:H?"100%":void 0,width:H?"100%":void 0,overflowY:"auto"}},children:x!==null&&i.jsxs(Ct,{children:[i.jsx("div",{style:{textAlign:"center"},children:i.jsx("img",{src:f[x].url,alt:`Zoomed Design ${x}`,style:{maxWidth:"100%",maxHeight:H?"100vh":void 0,transform:`scale(${F})`,transition:"transform 0.2s ease-out"}})}),i.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[i.jsx(Qe,{onClick:()=>w(F*1.2),children:i.jsx(Vs,{})}),i.jsx(Qe,{onClick:()=>w(F/1.2),style:{marginLeft:"10px"},children:i.jsx(Ys,{})}),i.jsx(Qe,{onClick:()=>T(x),style:{marginLeft:"10px"},children:i.jsx(qs,{})}),H&&i.jsx(Qe,{onClick:()=>T(x),style:{position:"absolute",top:20,right:20},children:i.jsx(Qs,{})})]})]})}),i.jsx(gt,{open:k,autoHideDuration:6e3,onClose:I,children:i.jsx(pt,{onClose:I,severity:m,sx:{width:"100%"},children:y})})]})});/*! @license DOMPurify 3.1.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.1.5/LICENSE */const{entries:Zs,setPrototypeOf:ms,isFrozen:sa,getPrototypeOf:ra,getOwnPropertyDescriptor:ia}=Object;let{freeze:Ne,seal:Xe,create:Ks}=Object,{apply:Ln,construct:Pn}=typeof Reflect<"u"&&Reflect;Ne||(Ne=function(b){return b});Xe||(Xe=function(b){return b});Ln||(Ln=function(b,D,c){return b.apply(D,c)});Pn||(Pn=function(b,D){return new b(...D)});const cn=We(Array.prototype.forEach),gs=We(Array.prototype.pop),Gt=We(Array.prototype.push),mn=We(String.prototype.toLowerCase),In=We(String.prototype.toString),ps=We(String.prototype.match),Vt=We(String.prototype.replace),aa=We(String.prototype.indexOf),oa=We(String.prototype.trim),nt=We(Object.prototype.hasOwnProperty),Ue=We(RegExp.prototype.test),Yt=la(TypeError);function We(a){return function(b){for(var D=arguments.length,c=new Array(D>1?D-1:0),e=1;e<D;e++)c[e-1]=arguments[e];return Ln(a,b,c)}}function la(a){return function(){for(var b=arguments.length,D=new Array(b),c=0;c<b;c++)D[c]=arguments[c];return Pn(a,D)}}function se(a,b){let D=arguments.length>2&&arguments[2]!==void 0?arguments[2]:mn;ms&&ms(a,null);let c=b.length;for(;c--;){let e=b[c];if(typeof e=="string"){const t=D(e);t!==e&&(sa(b)||(b[c]=t),e=t)}a[e]=!0}return a}function ca(a){for(let b=0;b<a.length;b++)nt(a,b)||(a[b]=null);return a}function Tt(a){const b=Ks(null);for(const[D,c]of Zs(a))nt(a,D)&&(Array.isArray(c)?b[D]=ca(c):c&&typeof c=="object"&&c.constructor===Object?b[D]=Tt(c):b[D]=c);return b}function dn(a,b){for(;a!==null;){const c=ia(a,b);if(c){if(c.get)return We(c.get);if(typeof c.value=="function")return We(c.value)}a=ra(a)}function D(){return null}return D}const bs=Ne(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Dn=Ne(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Rn=Ne(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),da=Ne(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Fn=Ne(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),ua=Ne(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),xs=Ne(["#text"]),vs=Ne(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),kn=Ne(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),ys=Ne(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),un=Ne(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),fa=Xe(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ha=Xe(/<%[\w\W]*|[\w\W]*%>/gm),ma=Xe(/\${[\w\W]*}/gm),ga=Xe(/^data-[\-\w.\u00B7-\uFFFF]/),pa=Xe(/^aria-[\-\w]+$/),Js=Xe(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ba=Xe(/^(?:\w+script|data):/i),xa=Xe(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),er=Xe(/^html$/i),va=Xe(/^[a-z][.\w]*(-[.\w]+)+$/i);var Ts=Object.freeze({__proto__:null,MUSTACHE_EXPR:fa,ERB_EXPR:ha,TMPLIT_EXPR:ma,DATA_ATTR:ga,ARIA_ATTR:pa,IS_ALLOWED_URI:Js,IS_SCRIPT_OR_DATA:ba,ATTR_WHITESPACE:xa,DOCTYPE_NAME:er,CUSTOM_ELEMENT:va});const qt={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},ya=function(){return typeof window>"u"?null:window},Ta=function(b,D){if(typeof b!="object"||typeof b.createPolicy!="function")return null;let c=null;const e="data-tt-policy-suffix";D&&D.hasAttribute(e)&&(c=D.getAttribute(e));const t="dompurify"+(c?"#"+c:"");try{return b.createPolicy(t,{createHTML(f){return f},createScriptURL(f){return f}})}catch{return console.warn("TrustedTypes policy "+t+" could not be created."),null}};function tr(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ya();const b=L=>tr(L);if(b.version="3.1.5",b.removed=[],!a||!a.document||a.document.nodeType!==qt.document)return b.isSupported=!1,b;let{document:D}=a;const c=D,e=c.currentScript,{DocumentFragment:t,HTMLTemplateElement:f,Node:o,Element:p,NodeFilter:A,NamedNodeMap:n=a.NamedNodeMap||a.MozNamedAttrMap,HTMLFormElement:r,DOMParser:s,trustedTypes:d}=a,x=p.prototype,E=dn(x,"cloneNode"),F=dn(x,"nextSibling"),w=dn(x,"childNodes"),H=dn(x,"parentNode");if(typeof f=="function"){const L=D.createElement("template");L.content&&L.content.ownerDocument&&(D=L.content.ownerDocument)}let N,k="";const{implementation:$,createNodeIterator:y,createDocumentFragment:U,getElementsByTagName:m}=D,{importNode:h}=c;let v={};b.isSupported=typeof Zs=="function"&&typeof H=="function"&&$&&$.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:S,ERB_EXPR:C,TMPLIT_EXPR:_,DATA_ATTR:T,ARIA_ATTR:I,IS_SCRIPT_OR_DATA:g,ATTR_WHITESPACE:l,CUSTOM_ELEMENT:P}=Ts;let{IS_ALLOWED_URI:j}=Ts,O=null;const q=se({},[...bs,...Dn,...Rn,...Fn,...xs]);let W=null;const Q=se({},[...vs,...kn,...ys,...un]);let V=Object.seal(Ks(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),z=null,Z=null,le=!0,ne=!0,J=!1,ie=!0,K=!1,fe=!0,je=!1,ke=!1,ue=!1,pe=!1,ce=!1,oe=!1,Te=!0,be=!1;const ve="user-content-";let Ae=!0,me=!1,re={},Se=null;const de=se({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ot=null;const ee=se({},["audio","video","img","source","image","track"]);let He=null;const te=se({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ce="http://www.w3.org/1998/Math/MathML",ge="http://www.w3.org/2000/svg",we="http://www.w3.org/1999/xhtml";let _e=we,$e=!1,lt=null;const Lt=se({},[Ce,ge,we],In);let Ze=null;const wt=["application/xhtml+xml","text/html"],st="text/html";let xe=null,Re=null;const Ge=D.createElement("form"),Ke=function(u){return u instanceof RegExp||u instanceof Function},Ve=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Re&&Re===u)){if((!u||typeof u!="object")&&(u={}),u=Tt(u),Ze=wt.indexOf(u.PARSER_MEDIA_TYPE)===-1?st:u.PARSER_MEDIA_TYPE,xe=Ze==="application/xhtml+xml"?In:mn,O=nt(u,"ALLOWED_TAGS")?se({},u.ALLOWED_TAGS,xe):q,W=nt(u,"ALLOWED_ATTR")?se({},u.ALLOWED_ATTR,xe):Q,lt=nt(u,"ALLOWED_NAMESPACES")?se({},u.ALLOWED_NAMESPACES,In):Lt,He=nt(u,"ADD_URI_SAFE_ATTR")?se(Tt(te),u.ADD_URI_SAFE_ATTR,xe):te,ot=nt(u,"ADD_DATA_URI_TAGS")?se(Tt(ee),u.ADD_DATA_URI_TAGS,xe):ee,Se=nt(u,"FORBID_CONTENTS")?se({},u.FORBID_CONTENTS,xe):de,z=nt(u,"FORBID_TAGS")?se({},u.FORBID_TAGS,xe):{},Z=nt(u,"FORBID_ATTR")?se({},u.FORBID_ATTR,xe):{},re=nt(u,"USE_PROFILES")?u.USE_PROFILES:!1,le=u.ALLOW_ARIA_ATTR!==!1,ne=u.ALLOW_DATA_ATTR!==!1,J=u.ALLOW_UNKNOWN_PROTOCOLS||!1,ie=u.ALLOW_SELF_CLOSE_IN_ATTR!==!1,K=u.SAFE_FOR_TEMPLATES||!1,fe=u.SAFE_FOR_XML!==!1,je=u.WHOLE_DOCUMENT||!1,pe=u.RETURN_DOM||!1,ce=u.RETURN_DOM_FRAGMENT||!1,oe=u.RETURN_TRUSTED_TYPE||!1,ue=u.FORCE_BODY||!1,Te=u.SANITIZE_DOM!==!1,be=u.SANITIZE_NAMED_PROPS||!1,Ae=u.KEEP_CONTENT!==!1,me=u.IN_PLACE||!1,j=u.ALLOWED_URI_REGEXP||Js,_e=u.NAMESPACE||we,V=u.CUSTOM_ELEMENT_HANDLING||{},u.CUSTOM_ELEMENT_HANDLING&&Ke(u.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(V.tagNameCheck=u.CUSTOM_ELEMENT_HANDLING.tagNameCheck),u.CUSTOM_ELEMENT_HANDLING&&Ke(u.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(V.attributeNameCheck=u.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),u.CUSTOM_ELEMENT_HANDLING&&typeof u.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(V.allowCustomizedBuiltInElements=u.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),K&&(ne=!1),ce&&(pe=!0),re&&(O=se({},xs),W=[],re.html===!0&&(se(O,bs),se(W,vs)),re.svg===!0&&(se(O,Dn),se(W,kn),se(W,un)),re.svgFilters===!0&&(se(O,Rn),se(W,kn),se(W,un)),re.mathMl===!0&&(se(O,Fn),se(W,ys),se(W,un))),u.ADD_TAGS&&(O===q&&(O=Tt(O)),se(O,u.ADD_TAGS,xe)),u.ADD_ATTR&&(W===Q&&(W=Tt(W)),se(W,u.ADD_ATTR,xe)),u.ADD_URI_SAFE_ATTR&&se(He,u.ADD_URI_SAFE_ATTR,xe),u.FORBID_CONTENTS&&(Se===de&&(Se=Tt(Se)),se(Se,u.FORBID_CONTENTS,xe)),Ae&&(O["#text"]=!0),je&&se(O,["html","head","body"]),O.table&&(se(O,["tbody"]),delete z.tbody),u.TRUSTED_TYPES_POLICY){if(typeof u.TRUSTED_TYPES_POLICY.createHTML!="function")throw Yt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof u.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Yt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');N=u.TRUSTED_TYPES_POLICY,k=N.createHTML("")}else N===void 0&&(N=Ta(d,e)),N!==null&&typeof k=="string"&&(k=N.createHTML(""));Ne&&Ne(u),Re=u}},dt=se({},["mi","mo","mn","ms","mtext"]),Ye=se({},["foreignobject","annotation-xml"]),Je=se({},["title","style","font","a","script"]),Jt=se({},[...Dn,...Rn,...da]),Pt=se({},[...Fn,...ua]),An=function(u){let M=H(u);(!M||!M.tagName)&&(M={namespaceURI:_e,tagName:"template"});const B=mn(u.tagName),X=mn(M.tagName);return lt[u.namespaceURI]?u.namespaceURI===ge?M.namespaceURI===we?B==="svg":M.namespaceURI===Ce?B==="svg"&&(X==="annotation-xml"||dt[X]):!!Jt[B]:u.namespaceURI===Ce?M.namespaceURI===we?B==="math":M.namespaceURI===ge?B==="math"&&Ye[X]:!!Pt[B]:u.namespaceURI===we?M.namespaceURI===ge&&!Ye[X]||M.namespaceURI===Ce&&!dt[X]?!1:!Pt[B]&&(Je[B]||!Jt[B]):!!(Ze==="application/xhtml+xml"&&lt[u.namespaceURI]):!1},qe=function(u){Gt(b.removed,{element:u});try{u.parentNode.removeChild(u)}catch{u.remove()}},_t=function(u,M){try{Gt(b.removed,{attribute:M.getAttributeNode(u),from:M})}catch{Gt(b.removed,{attribute:null,from:M})}if(M.removeAttribute(u),u==="is"&&!W[u])if(pe||ce)try{qe(M)}catch{}else try{M.setAttribute(u,"")}catch{}},vt=function(u){let M=null,B=null;if(ue)u="<remove></remove>"+u;else{const he=ps(u,/^[\r\n\t ]+/);B=he&&he[0]}Ze==="application/xhtml+xml"&&_e===we&&(u='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+u+"</body></html>");const X=N?N.createHTML(u):u;if(_e===we)try{M=new s().parseFromString(X,Ze)}catch{}if(!M||!M.documentElement){M=$.createDocument(_e,"template",null);try{M.documentElement.innerHTML=$e?k:X}catch{}}const Y=M.body||M.documentElement;return u&&B&&Y.insertBefore(D.createTextNode(B),Y.childNodes[0]||null),_e===we?m.call(M,je?"html":"body")[0]:je?M.documentElement:Y},en=function(u){return y.call(u.ownerDocument||u,u,A.SHOW_ELEMENT|A.SHOW_COMMENT|A.SHOW_TEXT|A.SHOW_PROCESSING_INSTRUCTION|A.SHOW_CDATA_SECTION,null)},Bt=function(u){return u instanceof r&&(typeof u.nodeName!="string"||typeof u.textContent!="string"||typeof u.removeChild!="function"||!(u.attributes instanceof n)||typeof u.removeAttribute!="function"||typeof u.setAttribute!="function"||typeof u.namespaceURI!="string"||typeof u.insertBefore!="function"||typeof u.hasChildNodes!="function")},Ht=function(u){return typeof o=="function"&&u instanceof o},et=function(u,M,B){v[u]&&cn(v[u],X=>{X.call(b,M,B,Re)})},tn=function(u){let M=null;if(et("beforeSanitizeElements",u,null),Bt(u))return qe(u),!0;const B=xe(u.nodeName);if(et("uponSanitizeElement",u,{tagName:B,allowedTags:O}),u.hasChildNodes()&&!Ht(u.firstElementChild)&&Ue(/<[/\w]/g,u.innerHTML)&&Ue(/<[/\w]/g,u.textContent)||u.nodeType===qt.progressingInstruction||fe&&u.nodeType===qt.comment&&Ue(/<[/\w]/g,u.data))return qe(u),!0;if(!O[B]||z[B]){if(!z[B]&&sn(B)&&(V.tagNameCheck instanceof RegExp&&Ue(V.tagNameCheck,B)||V.tagNameCheck instanceof Function&&V.tagNameCheck(B)))return!1;if(Ae&&!Se[B]){const X=H(u)||u.parentNode,Y=w(u)||u.childNodes;if(Y&&X){const he=Y.length;for(let ye=he-1;ye>=0;--ye){const Le=E(Y[ye],!0);Le.__removalCount=(u.__removalCount||0)+1,X.insertBefore(Le,F(u))}}}return qe(u),!0}return u instanceof p&&!An(u)||(B==="noscript"||B==="noembed"||B==="noframes")&&Ue(/<\/no(script|embed|frames)/i,u.innerHTML)?(qe(u),!0):(K&&u.nodeType===qt.text&&(M=u.textContent,cn([S,C,_],X=>{M=Vt(M,X," ")}),u.textContent!==M&&(Gt(b.removed,{element:u.cloneNode()}),u.textContent=M)),et("afterSanitizeElements",u,null),!1)},nn=function(u,M,B){if(Te&&(M==="id"||M==="name")&&(B in D||B in Ge))return!1;if(!(ne&&!Z[M]&&Ue(T,M))){if(!(le&&Ue(I,M))){if(!W[M]||Z[M]){if(!(sn(u)&&(V.tagNameCheck instanceof RegExp&&Ue(V.tagNameCheck,u)||V.tagNameCheck instanceof Function&&V.tagNameCheck(u))&&(V.attributeNameCheck instanceof RegExp&&Ue(V.attributeNameCheck,M)||V.attributeNameCheck instanceof Function&&V.attributeNameCheck(M))||M==="is"&&V.allowCustomizedBuiltInElements&&(V.tagNameCheck instanceof RegExp&&Ue(V.tagNameCheck,B)||V.tagNameCheck instanceof Function&&V.tagNameCheck(B))))return!1}else if(!He[M]){if(!Ue(j,Vt(B,l,""))){if(!((M==="src"||M==="xlink:href"||M==="href")&&u!=="script"&&aa(B,"data:")===0&&ot[u])){if(!(J&&!Ue(g,Vt(B,l,"")))){if(B)return!1}}}}}}return!0},sn=function(u){return u!=="annotation-xml"&&ps(u,P)},rn=function(u){et("beforeSanitizeAttributes",u,null);const{attributes:M}=u;if(!M)return;const B={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:W};let X=M.length;for(;X--;){const Y=M[X],{name:he,namespaceURI:ye,value:Le}=Y,yt=xe(he);let Ie=he==="value"?Le:oa(Le);if(B.attrName=yt,B.attrValue=Ie,B.keepAttr=!0,B.forceKeepAttr=void 0,et("uponSanitizeAttribute",u,B),Ie=B.attrValue,B.forceKeepAttr||(_t(he,u),!B.keepAttr))continue;if(!ie&&Ue(/\/>/i,Ie)){_t(he,u);continue}if(fe&&Ue(/((--!?|])>)|<\/(style|title)/i,Ie)){_t(he,u);continue}K&&cn([S,C,_],jt=>{Ie=Vt(Ie,jt," ")});const Et=xe(u.nodeName);if(nn(Et,yt,Ie)){if(be&&(yt==="id"||yt==="name")&&(_t(he,u),Ie=ve+Ie),N&&typeof d=="object"&&typeof d.getAttributeType=="function"&&!ye)switch(d.getAttributeType(Et,yt)){case"TrustedHTML":{Ie=N.createHTML(Ie);break}case"TrustedScriptURL":{Ie=N.createScriptURL(Ie);break}}try{ye?u.setAttributeNS(ye,he,Ie):u.setAttribute(he,Ie),Bt(u)?qe(u):gs(b.removed)}catch{}}}et("afterSanitizeAttributes",u,null)},R=function L(u){let M=null;const B=en(u);for(et("beforeSanitizeShadowDOM",u,null);M=B.nextNode();)et("uponSanitizeShadowNode",M,null),!tn(M)&&(M.content instanceof t&&L(M.content),rn(M));et("afterSanitizeShadowDOM",u,null)};return b.sanitize=function(L){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},M=null,B=null,X=null,Y=null;if($e=!L,$e&&(L="<!-->"),typeof L!="string"&&!Ht(L))if(typeof L.toString=="function"){if(L=L.toString(),typeof L!="string")throw Yt("dirty is not a string, aborting")}else throw Yt("toString is not a function");if(!b.isSupported)return L;if(ke||Ve(u),b.removed=[],typeof L=="string"&&(me=!1),me){if(L.nodeName){const Le=xe(L.nodeName);if(!O[Le]||z[Le])throw Yt("root node is forbidden and cannot be sanitized in-place")}}else if(L instanceof o)M=vt("<!---->"),B=M.ownerDocument.importNode(L,!0),B.nodeType===qt.element&&B.nodeName==="BODY"||B.nodeName==="HTML"?M=B:M.appendChild(B);else{if(!pe&&!K&&!je&&L.indexOf("<")===-1)return N&&oe?N.createHTML(L):L;if(M=vt(L),!M)return pe?null:oe?k:""}M&&ue&&qe(M.firstChild);const he=en(me?L:M);for(;X=he.nextNode();)tn(X)||(X.content instanceof t&&R(X.content),rn(X));if(me)return L;if(pe){if(ce)for(Y=U.call(M.ownerDocument);M.firstChild;)Y.appendChild(M.firstChild);else Y=M;return(W.shadowroot||W.shadowrootmode)&&(Y=h.call(c,Y,!0)),Y}let ye=je?M.outerHTML:M.innerHTML;return je&&O["!doctype"]&&M.ownerDocument&&M.ownerDocument.doctype&&M.ownerDocument.doctype.name&&Ue(er,M.ownerDocument.doctype.name)&&(ye="<!DOCTYPE "+M.ownerDocument.doctype.name+`>
`+ye),K&&cn([S,C,_],Le=>{ye=Vt(ye,Le," ")}),N&&oe?N.createHTML(ye):ye},b.setConfig=function(){let L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ve(L),ke=!0},b.clearConfig=function(){Re=null,ke=!1},b.isValidAttribute=function(L,u,M){Re||Ve({});const B=xe(L),X=xe(u);return nn(B,X,M)},b.addHook=function(L,u){typeof u=="function"&&(v[L]=v[L]||[],Gt(v[L],u))},b.removeHook=function(L){if(v[L])return gs(v[L])},b.removeHooks=function(L){v[L]&&(v[L]=[])},b.removeAllHooks=function(){v={}},b}var On=tr();const at=({onChange:a,initialValue:b})=>{const[D,c]=G.useState(On.sanitize(b||"")),e=G.useRef(!1),t=G.useRef(null),[f,o]=G.useState("");G.useEffect(()=>{e.current?c(On.sanitize(b||"")):e.current=!0},[b]);const p=(d,x)=>{const E=x.getData(),F=On.sanitize(E);c(F),a(F)},A=d=>{if(!t.current){console.warn("Editor not initialized");return}const x=t.current;x.model.change(E=>{const F=x.model.document.selection.getFirstPosition();E.insertText(d,F)}),o("")},n=d=>{A(d.target.value)},r=["Î±","Î²","Î³","Î´","Îµ","Î¶","Î·","Î¸","Î¹","Îº","Î»","Î¼","Î½","Î¾","Î¿","Ï€","Ï","Ïƒ","Ï„","Ï…","Ï†","Ï‡","Ïˆ","Ï‰"],s=["Â°","+","-","=","~","â‰¥","â‰¤","â‰ ",">","<","*","/","%"];return i.jsxs("div",{children:[i.jsxs(Qt,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%"},children:[i.jsx(br,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),i.jsx(ns,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(ss,{labelId:"math-operators-label",id:"math-operators",value:f,onChange:n,displayEmpty:!0,children:[i.jsx(ln,{value:"",disabled:!0,children:"Math"}),s.map(d=>i.jsx(ln,{value:d,children:d},d))]})}),i.jsx(ns,{variant:"standard",sx:{m:1,minWidth:40},children:i.jsxs(ss,{labelId:"greek-letters-label",id:"greek-letters",value:f,onChange:n,displayEmpty:!0,children:[i.jsx(ln,{value:"",disabled:!0,children:"Greek"}),r.map(d=>i.jsx(ln,{value:d,children:d},d))]})})]}),i.jsx(xr.CKEditor,{editor:vr,data:D,onReady:d=>{t.current=d},config:{toolbar:["undo","redo","|","heading","bold","italic","|","bulletedList","numberedList","blockQuote","indent","outdent","|","link","insertTable","|"],table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]}},onChange:p})]})};var Xn={},Aa=xt;Object.defineProperty(Xn,"__esModule",{value:!0});var nr=Xn.default=void 0,Sa=Aa(bt()),Ca=i;nr=Xn.default=(0,Sa.default)((0,Ca.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile");var Zn={},wa=xt;Object.defineProperty(Zn,"__esModule",{value:!0});var sr=Zn.default=void 0,_a=wa(bt()),Ea=i;sr=Zn.default=(0,_a.default)((0,Ea.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload");const Ot=({path:a,initialFiles:b,onFilesChange:D,isOwnDesign:c})=>{const[e,t]=G.useState(b.map(v=>({...v,deleted:!!v.deleted}))),[f,o]=G.useState(!1),[p,A]=G.useState(0),[n,r]=G.useState({}),[s,d]=G.useState(!1),[x,E]=G.useState(""),[F,w]=G.useState("info"),H=G.useRef(null);G.useEffect(()=>{console.log("Initial files received:",b),t(b.map(v=>({...v,deleted:!!v.deleted})))},[b]),G.useEffect(()=>()=>{r({})},[]);const N=v=>{console.log("Updating files with",v),D(v),t(v)},k=async v=>{if(!v.target.files)return;const C=Array.from(v.target.files).filter(T=>T.size>5242880?(E("File size should not exceed 5 MB"),w("error"),d(!0),!1):!0);o(!0);const _=C.map(T=>{const I=new Date().getTime(),g=`${I}-${T.name}`,l=Dt(),P=Rt(l,`${a}/${g}`),j=Is(P,T);return new Promise((O,q)=>{j.on("state_changed",W=>{const Q=W.bytesTransferred/W.totalBytes*100;A(Q)},W=>{console.error("Upload failed:",W),q(W)},()=>{Ds(j.snapshot.ref).then(W=>{O({id:I.toString(),url:W,name:T.name,path:P.fullPath})})})})});Promise.all(_).then(T=>{const I=[...e.filter(g=>!g.deleted),...T];N(I),E("Files uploaded successfully."),w("success"),d(!0),o(!1),A(0),H.current&&(H.current.value="")}).catch(T=>{console.error("Error uploading files: ",T),E("Failed to upload files."),w("error"),d(!0),o(!1),A(0)})},$=v=>{const S=e.map(C=>C.id===v?{...C,deleted:!0}:C);N(S),E("File marked for deletion. Update to permanently delete."),w("info"),d(!0)},y=v=>{r(S=>{var C;return{...S,[v]:((C=e.find(_=>_.id===v))==null?void 0:C.name)||""}}),console.log("editStates after handleEditClick:",n)},U=v=>{t(S=>{const C=S.map(_=>_.id===v&&n[v]!==void 0?{..._,name:n[v]}:_);return D(C),C}),r(S=>{const C={...S};return delete C[v],C}),E("File name updated successfully."),w("info"),d(!0)},m=(v,S)=>{r(C=>({...C,[v]:S}))},h=(v,S)=>{S!=="clickaway"&&d(!1)};return i.jsxs("div",{children:[c&&i.jsx(Xt,{title:"Upload Files",children:i.jsxs(Me,{variant:"outlined",component:"label",startIcon:i.jsx(sr,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",i.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:k,disabled:f,ref:H})]})}),f&&i.jsx("div",{children:i.jsxs("p",{children:["Uploading... ",Math.round(p),"%"]})}),i.jsx(yr,{children:e.map(v=>i.jsxs(Tr,{component:"div",disabled:v.deleted,children:[i.jsx(Ir,{children:i.jsx(nr,{})}),typeof n[v.id]=="string"?i.jsx(pn,{variant:"outlined",size:"small",value:n[v.id],onChange:S=>m(v.id,S.target.value),onKeyPress:S=>S.key==="Enter"&&U(v.id),fullWidth:!0}):i.jsx(Ar,{primary:v.name,secondary:i.jsx("a",{href:v.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),c&&(typeof n[v.id]=="string"?i.jsx(Qe,{onClick:()=>U(v.id),edge:"end","aria-label":"save",children:i.jsx(Nn,{})}):i.jsxs(i.Fragment,{children:[i.jsx(Qe,{onClick:()=>y(v.id),edge:"end","aria-label":"edit",children:i.jsx(js,{})}),i.jsx(Qe,{onClick:()=>$(v.id),edge:"end","aria-label":"delete",children:i.jsx(Zt,{})})]}))]},v.id))}),i.jsx(gt,{open:s,autoHideDuration:6e3,onClose:h,children:i.jsx(pt,{onClose:h,severity:F,sx:{width:"100%"},children:x})})]})},ja=({designs:a,setDesigns:b,setIsAdding:D,getDesigns:c,onReturnToDashboard:e})=>{const{userDetails:t}=Nt();console.log("Add Design loaded");const[f,o]=G.useState(""),[p,A]=G.useState(""),[n,r]=G.useState(""),[s,d]=G.useState([]),[x,E]=G.useState([]),F=G.useMemo(()=>s,[s]),[w,H]=G.useState(!1),[N,k]=G.useState(""),[$,y]=G.useState("info"),[U,m]=G.useState(!1),[h,v]=G.useState("");console.log("Adding New Design from user:",t);const S=G.useRef(null),C=()=>{m(!1)},_=(I,g)=>{g!=="clickaway"&&H(!1)},T=async I=>{var j;if(I.preventDefault(),console.log("Files to be saved:",x),!t||!t.uid){console.error("User object is undefined or missing UID."),v("You must be signed in to add a design."),m(!0);return}if(!f||!p){v("All fields are required."),m(!0);return}await((j=S.current)==null?void 0:j.commitDeletions());const g=s.filter(O=>!O.deleted),l=x.filter(O=>!O.deleted).map(O=>({id:O.id,url:O.url,name:O.name,path:O.path})),P={title:n,description:f,dateDue:Bn.fromDate(new Date(p)),dateCreated:Hn(),images:g,files:l,userId:t.uid};try{const O=await $n(Fe(ae,"designs"),P),q={...P,id:O.id};b([...a,q]),setTimeout(()=>{D(!1),c()},1e3),k(`${n} has been Added.`),y("success"),H(!0),r(""),o(""),A(""),d([]),E([])}catch(O){console.log(O),v("There was an issue adding your design."),m(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsx("button",{onClick:e,className:"muted-button margin-top-20",children:"â† All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:T,children:[i.jsx("h1",{className:"designHeader",children:"New Design"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:n,onChange:I=>r(I.target.value),style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateDue",children:"Date"}),i.jsx("input",{id:"date",type:"date",name:"date",value:p,onChange:I=>A(I.target.value),style:{width:"100%"}})]})]}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(at,{onChange:o,initialValue:f}),i.jsx(kt,{ref:S,path:"designs/images",initialImages:F,onImagesUpdated:d,onDelete:I=>d(s.filter(g=>!I.includes(g)))}),i.jsx(Ot,{path:"designs/files",initialFiles:x,onFilesChange:E}),i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx(Me,{type:"submit",variant:"contained",sx:{fontSize:"1rem",mt:2,textTransform:"none",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"Add"}),i.jsx(Me,{onClick:()=>D(!1),style:{marginLeft:"12px"},variant:"outlined",sx:{fontSize:"1rem",mt:2,textTransform:"none",color:"currentColor",borderColor:"rgba(255, 0, 0, 0.5)",boxShadow:"none","&:hover":{borderColor:"rgba(255, 0, 0, 0.7)",backgroundColor:"rgba(255, 0, 0, 0.1)",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",color:"currentColor",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out, background-color 0.3s ease-in-out"},children:"Cancel"})]})]})}),i.jsxs(St,{open:U,onClose:C,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[i.jsx(Ut,{id:"alert-dialog-title",children:"Notification"}),i.jsx(Ct,{children:i.jsx(Kt,{id:"alert-dialog-description",children:h})}),i.jsx(Mt,{children:i.jsx(Me,{onClick:C,autoFocus:!0,children:"Ok"})})]}),i.jsx(gt,{open:w,autoHideDuration:1e3,onClose:_,children:i.jsx(pt,{onClose:_,severity:$,sx:{width:"100%"},children:N})})]})},Ia=({designId:a,setIsAddingBuild:b,refreshBuilds:D})=>{const[c,e]=G.useState(""),[t,f]=G.useState(""),[o,p]=G.useState([]),[A,n]=G.useState([]),{userDetails:r}=Nt(),s=S=>{p(S)},d=S=>{n(S)};console.log("AddBuild loaded");const[x,E]=G.useState(!1),[F,w]=G.useState(""),[H,N]=G.useState(!1),[k,$]=G.useState(""),[y,U]=G.useState("info");console.log("Adding New Build by user:",r);const m=()=>{E(!1)},h=(S,C)=>{C!=="clickaway"&&N(!1)},v=async S=>{if(S.preventDefault(),!r||!r.uid){console.error("UserDetails object is undefined or missing UID."),w("You must be signed in to add a build."),E(!0);return}if(!t){w("Build description is required."),E(!0);return}const C=o.filter(T=>!T.deleted),_=A.filter(T=>!T.deleted).map(T=>({id:T.id,url:T.url,name:T.name,path:T.path}));try{const T=await $n(Fe(ae,"builds"),{title:c,description:t,design_ID:a,dateCreated:Hn(),userId:r.uid,images:C,files:_});console.log("Build added with ID: ",T.id),console.log("Added New Build by user:",r),$("Your build has been successfully added."),U("success"),N(!0),setTimeout(()=>{e(""),f(""),p([]),n([]),b(!1),D()},1e3)}catch(T){if(console.error("Error adding build: ",T),T instanceof Error){let I=`Failed to add the build. ${T.message}`;T.message==="permission-denied"&&(I="You do not have permission to perform this operation."),$(I),U("error"),N(!0)}else $("Failed to add the build. Please try again later."),U("error"),N(!0)}};return i.jsxs("div",{className:"small-container",children:[i.jsxs("form",{onSubmit:v,children:[i.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),i.jsx("input",{id:"buildTitle",type:"text",value:c,onChange:S=>e(S.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),i.jsx(at,{onChange:f,initialValue:t})," ",i.jsx(kt,{path:`builds/${a}/images`,initialImages:o,onImagesUpdated:s}),i.jsx(Ot,{path:`builds/${a}/files`,initialFiles:A,onFilesChange:d}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>b(!1),className:"button muted-button",children:"Cancel"})]})]}),i.jsxs(St,{open:x,onClose:m,children:[i.jsx(Ut,{children:"Notification"}),i.jsx(Ct,{children:i.jsx(Kt,{children:F})}),i.jsx(Mt,{children:i.jsx(Me,{onClick:m,children:"OK"})})]}),i.jsx(gt,{open:H,autoHideDuration:6e3,onClose:h,children:i.jsx(pt,{onClose:h,severity:y,sx:{width:"100%"},children:k})})]})},Da=({designId:a,buildId:b,refreshTests:D,setAddingTestIdForBuild:c})=>{const[e,t]=G.useState(""),[f,o]=G.useState(""),[p,A]=G.useState(""),[n,r]=G.useState(""),[s,d]=G.useState([]),[x,E]=G.useState([]),{userDetails:F}=Nt();console.log("AddTest loaded");const[w,H]=G.useState(!1),[N,k]=G.useState(""),[$,y]=G.useState(!1),[U,m]=G.useState(""),[h,v]=G.useState("info"),S=_=>{E(_)},C=async()=>{if(!f){k("Test description cannot be empty!"),H(!0);return}const _=s.filter(I=>!I.deleted),T=x.filter(I=>!I.deleted).map(I=>({id:I.id,url:I.url,name:I.name,path:I.path}));try{await $n(Fe(ae,"tests"),{title:e,build_ID:b,design_ID:a,dateCreated:Hn(),description:f,results:p,conclusions:n,userId:F==null?void 0:F.uid,images:_,files:T}),setTimeout(()=>{D(b),t(""),o(""),A(""),r(""),d([]),E([]),c(!1)},1e3),m("Test added successfully"),v("success"),y(!0)}catch(I){console.error("Error adding test: ",I),m("Failed to add the test"),v("error"),y(!0)}};return i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),i.jsx("input",{id:"testTitle",type:"text",value:e,onChange:_=>t(_.target.value),style:{width:"100%",marginBottom:"20px"}}),i.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),i.jsx(at,{onChange:o,initialValue:f}),i.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),i.jsx(at,{onChange:A,initialValue:p}),i.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),i.jsx(at,{onChange:r,initialValue:n}),i.jsx(kt,{path:`tests/${b}/images`,initialImages:s,onImagesUpdated:_=>{d(_)}}),i.jsx(Ot,{path:`tests/${b}/files`,initialFiles:x,onFilesChange:S}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i.jsx("button",{onClick:C,children:"Save"}),i.jsx("button",{style:{marginLeft:"12px"},onClick:()=>c(!1),className:"button muted-button",children:"Cancel"})]}),i.jsxs(St,{open:w,onClose:()=>H(!1),children:[i.jsx(Ut,{children:"Notification"}),i.jsx(Ct,{children:i.jsx(Kt,{children:N})}),i.jsx(Mt,{children:i.jsx(Me,{onClick:()=>H(!1),children:"OK"})})]}),i.jsx(gt,{open:$,autoHideDuration:6e3,onClose:()=>y(!1),children:i.jsx(pt,{onClose:()=>y(!1),severity:h,sx:{width:"100%"},children:U})})]})};var Kn={},Ra=xt;Object.defineProperty(Kn,"__esModule",{value:!0});var gn=Kn.default=void 0,Fa=Ra(bt()),ka=i;gn=Kn.default=(0,Fa.default)((0,ka.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff");const Oa=({selectedDesign:a,setIsEditing:b,getDesigns:D,onReturnToDashboard:c})=>{const{userDetails:e,loading:t}=Nt(),f=a.id,o=a.userId===(e==null?void 0:e.uid);console.log("Edit page loaded"),console.log("Design ID:",f),console.log("Editing Design by user:",e);const[p,A]=G.useState(""),[n,r]=G.useState(a.description),[s,d]=G.useState(a.dateDue||""),[x,E]=G.useState([]),[F,w]=G.useState([]),H=G.useRef(null),[N,k]=G.useState(!1),[$,y]=G.useState([]),[U,m]=G.useState({}),[h,v]=G.useState({}),[S,C]=G.useState({}),_=G.useRef(null),[T,I]=G.useState({}),[g,l]=G.useState({}),[P,j]=G.useState({}),[O,q]=G.useState(!1),[W,Q]=G.useState({}),[V,z]=G.useState({}),[Z,le]=G.useState({}),[ne,J]=G.useState({}),[ie,K]=G.useState({}),fe=G.useRef(null),[je,ke]=G.useState({}),[ue,pe]=G.useState({}),[ce,oe]=G.useState({}),[Te,be]=G.useState(!1),[ve,Ae]=G.useState(""),[me,re]=G.useState(()=>{}),[Se,de]=G.useState(!1),[ot,ee]=G.useState(""),[He,te]=G.useState("info"),[Ce,ge]=G.useState({design:!1,builds:!1,tests:!1}),we=async R=>{if(R.preventDefault(),!n||!s){Ae("All fields are required."),be(!0);return}console.log("About to check image deletions",H.current),console.log(H.current),console.log(x.some(B=>B.deleted)),H.current&&x.some(B=>B.deleted)&&(console.log("Committing deletions"),await H.current.commitDeletions());const L=x.filter(B=>!B.deleted);F.some(B=>B.deleted)&&await lt();const u=F.filter(B=>!B.deleted);let M={title:p,description:n,dateDue:Bn.fromDate(new Date(s)),images:L.map(B=>({url:B.url,title:B.title,path:B.path})),files:u.map(B=>({id:B.id,url:B.url,name:B.name,path:B.path})),userId:e.uid};try{await ft(De(ae,"designs",f),M,{merge:!0}),ee("Your design has been updated."),te("success"),de(!0)}catch(B){console.error("Error updating design:",B),ee("There was an issue updating your design."),te("error"),de(!0)}ge(B=>({...B,design:!1}))};G.useEffect(()=>{if(a){r(a.description||""),A(a.title||""),(async()=>{const u=De(ae,"designs",f),M=await Sr(u);if(M.exists()){const B=M.data();console.log("Fetched images:",B.images),console.log("Fetched files:",B.files),E(B.images||[]),w(B.files||[])}})();let L;a.dateDue?(typeof a.dateDue=="string"?L=a.dateDue:a.dateDue.toDate&&(L=a.dateDue.toDate().toISOString().split("T")[0]),d(L)):d("")}},[a,f]);const _e=R=>{const L=x.filter(M=>!R.some(B=>B.path===M.path));console.log("Remaining images after deletion:",L),E(L);const u=L.map(M=>({url:M.url,title:M.title,path:M.path}));ft(De(ae,"designs",f),{images:u},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(M=>console.error("Failed to update Firestore:",M))},$e=R=>{JSON.stringify(x)!==JSON.stringify(R)&&(E(R),console.log("Updated images received:",R))},lt=async()=>{const R=F.filter(L=>L.deleted);if(console.log("Files to delete:",R),R.length>0){const L=Dt(),u=R.map(M=>{const B=Rt(L,M.path);return fn(B)});try{await Promise.all(u),console.log("Files deleted successfully");const M=F.filter(B=>!B.deleted);w(M),await Cn(De(ae,"designs",a.id),{files:M.map(B=>({id:B.id,url:B.url,name:B.name,path:B.path}))}),ee("Deleted files have been permanently removed."),te("success"),de(!0)}catch(M){console.error("Failed to delete files: ",M),ee("Failed to delete files."),te("error"),de(!0)}}},Lt=async R=>{var B,X;try{await Ye(R)}catch(Y){console.error("Error deleting files:",Y),ee("Failed to delete build files."),te("error"),de(!0)}const L=((B=h[R])==null?void 0:B.filter(Y=>!Y.deleted).map(({url:Y,path:he,title:ye})=>({url:Y,path:he,title:ye})))||[],u=((X=S[R])==null?void 0:X.filter(Y=>!Y.deleted).map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path})))||[],M={};L.length>0&&(M.images=L),u.length>0&&(M.files=u),U[R]!==void 0&&(M.description=U[R]);try{const Y=De(ae,"builds",R);await ft(Y,M,{merge:!0}),ee("Your build has been updated."),te("success"),de(!0),xe(),ge(he=>({...he,builds:!1}))}catch(Y){console.error("Error updating build:",Y),ee("Failed to update build."),te("error"),de(!0)}},Ze=(R,L)=>{l(u=>({...u,[R]:L}))},wt=(R,L)=>{m(u=>({...u,[R]:L})),ge(u=>({...u,builds:!0}))},st=async R=>{const L=g[R];try{const u=De(ae,"builds",R);await ft(u,{title:L},{merge:!0}),l(M=>{const B={...M};return delete B[R],B}),xe()}catch(u){console.error("Failed to save build title:",u)}},xe=async()=>{if(!e){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",e==null?void 0:e.uid),console.log("Selected design ID for query:",a==null?void 0:a.id);let R;e.isAdmin?R=Pe(Fe(ae,"builds"),Ee("design_ID","==",f),rt("dateCreated")):R=Pe(Fe(ae,"builds"),Ee("design_ID","==",f),Ee("userId","==",e.uid),rt("dateCreated")),console.log("Builds query details:",JSON.stringify(R,null,2));const L=await ht(R);console.log("Builds snapshot details:",JSON.stringify(L.docs.map(M=>M.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",L.docs.length);const u=L.docs.map(M=>(console.log("Build doc path: ",M.ref.path),{id:M.id,...M.data()}));y(u),console.log("New builds state after refresh:",u)}catch(R){console.error("Error refreshing builds:",R),R.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",R):console.error("An unexpected error occurred when trying to refresh builds:",R)}},Re=(R,L)=>{const u=De(ae,"builds",R),M=h[R].filter(X=>!L.some(Y=>Y.path===X.path));v(X=>({...X,[R]:M}));const B=M.map(X=>({url:X.url,title:X.title,path:X.path}));ft(u,{images:B},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),ee("Build Image deletions updated."),te("success")}).catch(X=>{console.error("Failed to update build images in Firestore:",X),ee("Failed to update build image deletions."),te("error")}),de(!0)},Ge=async R=>{const L=Pe(Fe(ae,"tests"),Ee("build_ID","==",R),Ee("userId","==",e.uid)),u=await ht(L);for(const M of u.docs)await Ft(De(ae,"tests",M.id));await Ft(De(ae,"builds",R)),await xe(),ee("Build and its tests (if any) deleted successfully."),te("success"),de(!0)},Ke=R=>{Ae("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),re(()=>()=>Ge(R)),be(!0)},Ve=(R,L)=>{v(u=>({...u,[R]:L}))},dt=(R,L)=>{C(u=>({...u,[R]:L}))},Ye=async R=>{var u;const L=((u=S[R])==null?void 0:u.filter(M=>M.deleted))||[];if(console.log("Build files to delete:",L),L.length>0){const M=Dt(),B=L.map(X=>{const Y=Rt(M,X.path);return fn(Y)});try{await Promise.all(B),console.log("Build files deleted successfully");const X=S[R].filter(Y=>!Y.deleted);C(Y=>({...Y,[R]:X})),await Cn(De(ae,"builds",R),{files:X.map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path}))}),console.log("Firestore successfully updated to remove deleted files"),ee("Deleted build files have been permanently removed."),te("success"),de(!0)}catch(X){console.error("Failed to delete build files: ",X),ee("Failed to delete build files."),te("error"),de(!0)}}},Je=async(R,L)=>{var X;try{await et(R)}catch(Y){console.error("Error deleting files:",Y),ee("Failed to delete build files."),te("error"),de(!0)}const u={},M=ne[R].filter(Y=>!Y.deleted).map(({url:Y,path:he,title:ye})=>({url:Y,path:he,title:ye})),B=((X=ie[R])==null?void 0:X.filter(Y=>!Y.deleted).map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path})))||[];W[R]!==void 0&&(u.description=W[R]),V[R]!==void 0&&(u.results=V[R]),Z[R]!==void 0&&(u.conclusions=Z[R]),u.images=M,u.files=B;try{const Y=De(ae,"tests",R);await ft(Y,u,{merge:!0}),ee("Your test has been updated."),te("success"),de(!0),vt(L)}catch(Y){console.error(`Error updating test ID: ${R}:`,Y),ee("There was an issue updating your test."),te("error"),de(!0)}},Jt=(R,L)=>{pe(u=>({...u,[R]:L}))},Pt=async(R,L)=>{const u=ue[R],M=De(ae,"tests",R);await ft(M,{title:u},{merge:!0}),pe(B=>{const X={...B};return delete X[R],X}),vt(L)},An=(R,L)=>{console.log(`Updating description for test ID ${R}:`,L),Q(u=>({...u,[R]:L})),ge(u=>({...u,tests:!0}))},qe=(R,L)=>{console.log(`Updating results for test ID ${R}:`,L),z(u=>({...u,[R]:L})),ge(u=>({...u,tests:!0}))},_t=(R,L)=>{le(u=>({...u,[R]:L})),ge(u=>({...u,tests:!0}))};G.useEffect(()=>{!t&&e&&(async()=>{if(!e)return;let L;e.isAdmin?L=Pe(Fe(ae,"builds"),Ee("design_ID","==",f),rt("dateCreated")):L=Pe(Fe(ae,"builds"),Ee("design_ID","==",f),Ee("userId","==",e.uid),rt("dateCreated"));const u=await ht(L);let M=[],B={},X={};for(const Y of u.docs){const he=Y.data(),ye=Y.id;M.push({id:ye,...he,images:he.images||[],files:he.files||[]}),X[ye]=!0;let Le;e.isAdmin?Le=Pe(Fe(ae,"tests"),Ee("build_ID","==",ye),rt("dateCreated")):Le=Pe(Fe(ae,"tests"),Ee("build_ID","==",ye),Ee("userId","==",e.uid),rt("dateCreated"));const yt=await ht(Le);let Ie=[],Et={},jt={};for(const ut of yt.docs){const ct=ut.data();Ie.push({id:ut.id,...ct}),Et[ut.id]=ct.images||[],jt[ut.id]=ct.files||[]}B[ye]=Ie,J(ut=>{let ct={...ut};for(const $t in Et)ct[$t]=Et[$t];return ct}),K(ut=>{let ct={...ut};for(const $t in jt)ct[$t]=jt[$t];return ct})}y(M),j(B),oe(X)})()},[t,e,a.id,f]);const vt=async R=>{if(!e){console.log("User details not loaded yet");return}try{let L;e.isAdmin?L=Pe(Fe(ae,"tests"),Ee("build_ID","==",R),rt("dateCreated")):L=Pe(Fe(ae,"tests"),Ee("build_ID","==",R),Ee("userId","==",e.uid),rt("dateCreated"));const M=(await ht(L)).docs.map(Y=>({id:Y.id,...Y.data(),images:Y.data().images||[],files:Y.data().files||[]}));j(Y=>({...Y,[R]:M}));let B={},X={};M.forEach(Y=>{B[Y.id]=Y.images,X[Y.id]=Y.files}),J(B),K(X)}catch(L){console.error("Error fetching tests:",L)}},en=(R,L)=>{const u=De(ae,"tests",R),M=ne[R].filter(X=>!L.includes(X));J(X=>({...X,[R]:M}));const B=M.map(({url:X,path:Y,title:he})=>({url:X,path:Y,title:he}));ft(u,{images:B},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),ee("Test Image deletions updated."),te("success")}).catch(X=>{console.error("Failed to update test images in Firestore:",X),ee("Failed to update test image deletions."),te("error")}),de(!0)},Bt=(R,L)=>{J(u=>({...u,[R]:L}))},Ht=(R,L)=>{K(u=>({...u,[R]:L}))},et=async R=>{var u;const L=((u=ie[R])==null?void 0:u.filter(M=>M.deleted))||[];if(L.length>0){const M=Dt(),B=L.map(X=>{const Y=Rt(M,X.path);return fn(Y)});try{await Promise.all(B);const X=ie[R].filter(Y=>!Y.deleted);K(Y=>({...Y,[R]:X})),await Cn(De(ae,"tests",R),{files:X.map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path}))}),ee("Deleted test files have been permanently removed."),te("success"),de(!0)}catch(X){console.error("Failed to delete test files: ",X),ee("Failed to delete test files."),te("error"),de(!0)}}},tn=async(R,L)=>{await Ft(De(ae,"tests",R)),await vt(L),ee("Test deleted successfully."),te("success"),de(!0)},nn=(R,L)=>{Ae("Are you sure you want to delete this test? This action cannot be undone."),re(()=>()=>tn(R,L)),be(!0)},sn=R=>{oe(L=>({...L,[R]:!L[R]}))},rn=()=>{const R=Object.entries(Ce).filter(([u,M])=>M).map(([u])=>u).join(", ");if(!R.length){c();return}const L=`You have unsaved changes in the following sections: ${R}. Are you sure you want to leave?`;Ae(L),re(()=>()=>{ge({design:!1,builds:!1,tests:!1}),c()}),be(!0)};return G.useEffect(()=>{const R=L=>{Object.values(Ce).some(M=>M)&&(L.preventDefault(),L.returnValue="")};return window.addEventListener("beforeunload",R),()=>window.removeEventListener("beforeunload",R)},[Ce]),i.jsxs("div",{className:"small-container",children:[i.jsx("button",{onClick:()=>{Object.values(Ce).some(L=>L)?rn():c()},className:"muted-button margin-top-20",children:"â† All Designs"}),i.jsx("div",{className:"design-record",children:i.jsxs("form",{onSubmit:we,children:[i.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[i.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),i.jsx("input",{id:"title",type:"text",name:"title",value:p,onChange:R=>{A(R.target.value),ge(L=>({...L,design:!0}))},style:{width:"100%"}})]}),i.jsxs("div",{style:{flexGrow:2},children:[i.jsx("label",{className:"designTitles",htmlFor:"dateDue",children:"Date"}),i.jsx("input",{id:"dateDue",type:"date",name:"dateDue",value:s,onChange:R=>{d(R.target.value),ge(L=>({...L,design:!0}))},style:{width:"100%"}})]})]}),i.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),i.jsxs("ul",{children:[i.jsx("li",{children:"Objective: What is the goal for this design?"}),i.jsx("li",{children:"Rationale: Why is this new design being done?"}),i.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),i.jsx("li",{children:"Functional Modification: What is being done to this target?"}),i.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),i.jsx(at,{initialValue:n,onChange:R=>{r(R),ge(L=>({...L,design:!0}))}}),i.jsx(kt,{ref:H,path:`designs/${a.id}/images`,initialImages:x,onImagesUpdated:$e,onDelete:_e,isOwnDesign:o}),i.jsx(Ot,{path:`designs/${a.id}/files`,initialFiles:F,onFilesChange:w,isOwnDesign:o}),o&&i.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[i.jsx("input",{type:"submit",value:"Update"}),i.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>b(!1),children:"Cancel"})]})]})}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex-space-between",children:[i.jsx("h2",{className:"buildsHeader",children:"Builds"}),o&&i.jsxs("button",{className:"button muted-button",onClick:()=>{k(!0),setTimeout(()=>{_.current&&_.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[i.jsx("span",{role:"img","aria-label":"Add Build",children:"âž•"})," Build"]})]}),$.map((R,L)=>i.jsxs("div",{className:"build-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:g[R.id]!==void 0?i.jsx(pn,{variant:"outlined",size:"small",fullWidth:!0,value:g[R.id],onChange:u=>Ze(R.id,u.target.value),onBlur:()=>st(R.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Qe,{onClick:()=>st(R.id),size:"small",children:i.jsx(Nn,{})})}}):i.jsx("div",{className:"buildTitle",onClick:()=>l(u=>({...u,[R.id]:R.title||`Build ${L+1}`})),style:{cursor:"pointer"},children:R.title||`Build ${L+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>I(u=>({...u,[R.id]:!u[R.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:T[R.id]?i.jsx(gn,{}):i.jsx(wn,{})}),o&&i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Ke(R.id),children:i.jsx(Zt,{})}),i.jsxs("button",{className:"button muted-button",onClick:()=>{q(R.id),setTimeout(()=>{fe.current&&fe.current.scrollIntoView({behavior:"smooth"})},100)},children:[i.jsx("span",{role:"img","aria-label":"Add Test",children:"âž•"})," Test"]})]})]})]}),T[R.id]&&i.jsxs(i.Fragment,{children:[i.jsx(at,{initialValue:U[R.id]||R.description,onChange:u=>{wt(R.id,u)}}),i.jsx(kt,{path:`builds/${R.id}/images`,initialImages:R.images,onImagesUpdated:u=>Ve(R.id,u),onDelete:u=>Re(R.id,u),isOwnDesign:o}),i.jsx(Ot,{path:`builds/${R.id}/files`,initialFiles:R.files,onFilesChange:u=>dt(R.id,u),isOwnDesign:o}),o&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>Lt(R.id),children:"Update"})}),i.jsx("div",{children:P[R.id]&&P[R.id].length>0&&i.jsx("button",{onClick:()=>sn(R.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:ce[R.id]?i.jsxs(i.Fragment,{children:[i.jsx(wn,{style:{marginRight:"8px"}}),"Tests"]}):i.jsxs(i.Fragment,{children:[i.jsx(gn,{style:{marginRight:"8px"}}),"Tests"]})})}),!ce[R.id]&&P[R.id]&&P[R.id].map((u,M)=>i.jsxs("div",{className:"test-record",children:[i.jsxs("div",{className:"flex-space-between align-items-center",children:[i.jsx("div",{children:ue[u.id]!==void 0?i.jsx(pn,{variant:"outlined",size:"small",fullWidth:!0,value:ue[u.id],onChange:B=>Jt(u.id,B.target.value),onBlur:()=>Pt(u.id,R.id),autoFocus:!0,InputProps:{endAdornment:i.jsx(Qe,{onClick:()=>Pt(u.id,R.id),size:"small",children:i.jsx(Nn,{})})}}):i.jsx("div",{className:"testTitle",onClick:()=>pe(B=>({...B,[u.id]:u.title||`Test ${M+1}`})),style:{cursor:"pointer"},children:u.title||`Test ${M+1}`})}),i.jsxs("div",{children:[i.jsx("button",{onClick:()=>ke(B=>({...B,[u.id]:!B[u.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:je[u.id]?i.jsx(gn,{}):i.jsx(wn,{})}),o&&i.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>nn(u.id,R.id),children:i.jsx(Zt,{})})]})]}),je[u.id]&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Description"}),i.jsx(at,{initialValue:W[u.id]||u.description,onChange:B=>{An(u.id,B)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Results"}),i.jsx(at,{initialValue:V[u.id]||u.results,onChange:B=>{qe(u.id,B)}})]}),i.jsxs("div",{children:[i.jsx("label",{className:"testTitles",children:"Conclusions"}),i.jsx(at,{initialValue:Z[u.id]||u.conclusions,onChange:B=>{_t(u.id,B)}})]}),i.jsxs("div",{children:[i.jsx(kt,{path:`tests/${u.id}/images`,initialImages:ne[u.id]||[],onImagesUpdated:B=>Bt(u.id,B),onDelete:B=>en(u.id,B),isOwnDesign:o}),i.jsx(Ot,{path:`tests/${u.id}/files`,initialFiles:ie[u.id]||[],onFilesChange:B=>Ht(u.id,B),isOwnDesign:o})]}),o&&i.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:()=>Je(u.id,R.id),children:"Update"})})]})]},u.id))]}),O===R.id&&i.jsxs("div",{className:"new-test-record",ref:fe,children:[i.jsx("h3",{className:"newTestHeader",children:"New Test"}),i.jsx(Da,{designId:a.id,buildId:R.id,refreshTests:()=>vt(R.id),setAddingTestIdForBuild:q,onImagesUpdated:u=>Bt(R.id,u),onFilesChange:u=>Ht(R.id,u)})]})]},R.id)),i.jsx("div",{children:N&&i.jsxs("div",{className:"new-build-record",ref:_,children:[i.jsx("h3",{className:"newBuildHeader",children:"New Build"}),i.jsx(Ia,{designId:a.id,setIsAddingBuild:k,refreshBuilds:xe,onImagesUpdated:R=>Ve(build.id,R),onFilesChange:R=>dt(build.id,R)})]})})]}),i.jsxs(St,{open:Te,onClose:()=>be(!1),children:[i.jsx(Ut,{children:"Confirmation Required"}),i.jsx(Ct,{children:i.jsx(Kt,{children:ve})}),i.jsxs(Mt,{children:[i.jsx(Me,{onClick:()=>be(!1),children:"Cancel"}),i.jsx(Me,{onClick:()=>{me(),be(!1)},autoFocus:!0,children:"Confirm"})]})]}),i.jsx(gt,{open:Se,autoHideDuration:6e3,onClose:()=>de(!1),children:i.jsx(pt,{onClose:()=>de(!1),severity:He,sx:{width:"100%"},children:ot})})]})},Ua=()=>{const{userDetails:a,loading:b}=Nt();console.log("Dashboard loaded");const[D,c]=G.useState([]),[e,t]=G.useState([]),[f,o]=G.useState(null),[p,A]=G.useState(!1),[n,r]=G.useState(!1),[s,d]=G.useState(!1),[x,E]=G.useState(""),[F,w]=G.useState(""),[H,N]=G.useState(!1),[k,$]=G.useState(null),[y,U]=G.useState(!1),[m,h]=G.useState(""),[v,S]=G.useState("info"),C=()=>{r(!1),A(!1),o(null),_()},_=G.useCallback(async()=>{let l;a&&a.isAdmin?l=Pe(Fe(ae,"designs"),rt("dateCreated","desc")):a&&(l=Pe(Fe(ae,"designs"),Ee("userId","==",a.uid),rt("dateCreated","desc")));const P=await ht(l||Pe(Fe(ae,"designs"))),j=[],O=[];P.forEach(q=>{const W=q.data(),Q={id:q.id,title:W.title,description:W.description,dateDue:W.dateDue,dateCreated:W.dateCreated,userId:W.userId,images:W.images||[],files:W.files||[]};W.userId===(a==null?void 0:a.uid)?j.push(Q):O.push(Q)}),c(j),t(O)},[a]);G.useEffect(()=>{!b&&a&&_()},[a,b,_]);const T=l=>{const P=[...D,...e].find(j=>j.id===l);o(P||null),r(!0)},I=l=>{$(l),E("Are you sure you want to delete this design? This action cannot be undone."),d(!0)},g=async()=>{if(k)if(F!==(a==null?void 0:a.uid))h("User ID confirmation failed. Enter the correct User ID."),S("error"),U(!0);else try{const l=Pe(Fe(ae,"builds"),Ee("design_ID","==",k),Ee("userId","==",a.uid)),P=await ht(l);for(const j of P.docs){const O=j.id,q=Pe(Fe(ae,"tests"),Ee("build_ID","==",O),Ee("userId","==",a.uid)),W=await ht(q);for(const Q of W.docs)await Ft(De(ae,"tests",Q.id));await Ft(De(ae,"builds",O))}await Ft(De(ae,"designs",k)),c(j=>j.filter(O=>O.id!==k)),t(j=>j.filter(O=>O.id!==k)),h("Your design and its associated builds and tests have been deleted."),S("success"),U(!0)}catch(l){console.error("Error deleting design, builds, and tests: ",l),h("There was an issue deleting your design and its associated builds and tests."),S("error"),U(!0)}finally{w(""),N(!1),$(null)}};return i.jsxs("div",{className:"container",children:[!p&&!n&&i.jsxs(i.Fragment,{children:[i.jsx(Ur,{setIsAdding:A}),(a==null?void 0:a.isAdmin)&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{children:"Admin Designs"}),i.jsx(_n,{designs:D,handleEdit:T,handleDelete:I,isAdmin:!0,userDetails:a,showUserIdColumn:!0}),i.jsx("h2",{children:"Users' Designs"}),i.jsx(_n,{designs:e,handleEdit:T,handleDelete:I,isAdmin:!1,userDetails:a,showUserIdColumn:!0})]}),!(a!=null&&a.isAdmin)&&i.jsx(_n,{designs:D,handleEdit:T,handleDelete:I,isAdmin:!1,userDetails:a,showUserIdColumn:!1})]}),p&&i.jsx(ja,{designs:D,setDesigns:c,setIsAdding:A,getDesigns:_,onReturnToDashboard:C}),n&&i.jsx(Oa,{designs:D,selectedDesign:f,setDesigns:c,setIsEditing:r,getDesigns:_,onReturnToDashboard:C}),i.jsxs(St,{open:s,onClose:()=>d(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(Ut,{children:"Confirm Deletion"}),i.jsx(Ct,{children:i.jsx(Kt,{children:x})}),i.jsxs(Mt,{children:[i.jsx(Me,{onClick:()=>d(!1),children:"No, cancel"}),i.jsx(Me,{onClick:()=>{N(!0),d(!1)},color:"primary",children:"Yes, delete it"})]})]}),i.jsxs(St,{open:H,onClose:()=>N(!1),PaperProps:{style:{minWidth:500}},children:[i.jsx(Ut,{children:"Confirm Your User ID"}),i.jsx(Ct,{children:i.jsx(pn,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:F,onChange:l=>w(l.target.value)})}),i.jsxs(Mt,{children:[i.jsx(Me,{onClick:()=>N(!1),children:"No, cancel"}),i.jsx(Me,{onClick:g,color:"primary",children:"Confirm"})]})]}),i.jsx(gt,{open:y,autoHideDuration:6e3,onClose:()=>U(!1),children:i.jsx(pt,{onClose:()=>U(!1),severity:v,sx:{width:"100%"},children:m})})]})},La=Cr.memo(Ua);export{La as default};
