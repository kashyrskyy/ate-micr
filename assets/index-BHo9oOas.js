import{s as Xs,m as Ks,d as W,u as Zs,z as Js,j as o,e as er,f as tr,E as nr,H as sr,B as ln,o as Be,T as rr,I as ir,P as or,J as ar,K as lr,M as wn,N as Le,O as cr,p as fn,Q as Xe,R as js,U as Vt,V as Zn,W as rn,X as dr,c as Tt,Y as yt,Z as vt,_ as ur,q as At,A as St,$ as It,a0 as Rt,a1 as Is,a2 as Rs,a3 as cn,a4 as fr,a5 as ss,a6 as hn,a7 as _t,a8 as hr,a9 as mr,aa as gr,ab as pr,ac as mn,ad as br,ae as Qn,af as Xt,ag as kt,ah as Kt,ai as Ut,aj as Qt,ak as Jn,al as Fe,am as ae,an as ut,ao as Re,ap as xr,aq as Cn,ar as ze,as as Ee,at as rt,au as ft,av as Dt,aw as yr}from"./index-B55qB_44.js";import{V as En}from"./Visibility-CDX8GwYu.js";const vr=m=>{const{alignItems:b,classes:D}=m;return tr({root:["root",b==="flex-start"&&"alignItemsFlexStart"]},nr,D)},Tr=Xs("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(m,b)=>{const{ownerState:D}=m;return[b.root,D.alignItems==="flex-start"&&b.alignItemsFlexStart]}})(Ks(({theme:m})=>({minWidth:56,color:(m.vars||m).palette.action.active,flexShrink:0,display:"inline-flex",variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}))),Ar=W.forwardRef(function(b,D){const a=Zs({props:b,name:"MuiListItemIcon"}),{className:e,...t}=a,d=W.useContext(Js),i={...a,alignItems:d.alignItems},v=vr(i);return o.jsx(Tr,{className:er(v.root,e),ownerState:i,ref:D,...t})}),Sr=W.memo(({setIsAdding:m})=>{console.log("Header loaded");const b=sr(),D=()=>{b("/")};return o.jsxs(ln,{className:"lab-notebook-container",children:[o.jsx(ln,{sx:{display:"flex",alignItems:"center"},children:o.jsx(Be,{variant:"text",onClick:D,className:"back-home-button",children:"â† Home Page"})}),o.jsx(rr,{className:"webpage_title",children:"My Laboratory Notebook"}),o.jsx(ln,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:o.jsx(Be,{className:"create-new-button",variant:"contained",color:"primary",onClick:()=>m(!0),children:"+ Create New"})})]})}),Et=({designs:m,handleEdit:b,handleDelete:D,isAdmin:a,userDetails:e,showUserIdColumn:t})=>{const d=i=>i?i instanceof Zn?i.toDate().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):i instanceof Date?i.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A":"N/A";return o.jsx(ir,{component:or,children:o.jsxs(ar,{sx:{"& .MuiTableCell-root":{fontSize:"1rem"},"& .MuiTableCell-head":{fontSize:"1.2rem",backgroundColor:"#1A76D3",color:"white"}},children:[o.jsx(lr,{children:o.jsxs(wn,{sx:{height:"60px"},children:[o.jsx(Le,{sx:{fontWeight:"bold",width:t?"30%":"40%"},children:"Title"}),o.jsx(Le,{sx:{fontWeight:"bold",width:"20%"},children:"Course"}),t&&o.jsx(Le,{sx:{fontWeight:"bold",width:"20%"},children:"User ID"}),o.jsx(Le,{sx:{fontWeight:"bold",width:"15%"},children:"Created"}),o.jsx(Le,{sx:{fontWeight:"bold",width:"15%"},children:"Last Edited"}),o.jsx(Le,{sx:{fontWeight:"bold",width:"10%"},children:"Edit"}),o.jsx(Le,{sx:{fontWeight:"bold",width:"10%"},children:"Delete"})]})}),o.jsx(cr,{children:m&&m.length>0?m.map(i=>{const v=i.userId===(e==null?void 0:e.uid);return o.jsxs(wn,{sx:{height:"80px"},children:[o.jsx(Le,{children:o.jsx("button",{onClick:()=>b(i.id),className:"hyperlink-style",children:i.title})}),o.jsx(Le,{children:i.course&&(e!=null&&e.classes)&&e.classes[i.course]?`${e.classes[i.course].number} - ${e.classes[i.course].title}`:"N/A"}),t&&o.jsx(Le,{children:i.userId}),o.jsx(Le,{children:d(i.dateCreated)}),o.jsx(Le,{children:d(i.dateModified)}),o.jsx(Le,{children:o.jsx(fn,{title:"Edit",children:o.jsx("span",{children:o.jsx(Xe,{onClick:()=>v&&b(i.id),color:"primary",disabled:!v,children:o.jsx(js,{})})})})}),o.jsx(Le,{children:o.jsx(fn,{title:"Delete",children:o.jsx("span",{children:o.jsx(Xe,{onClick:()=>v&&D(i.id),color:"error",disabled:!v,children:o.jsx(Vt,{})})})})})]},i.id)}):o.jsx(wn,{children:o.jsx(Le,{colSpan:t?6:5,children:"No Designs Found"})})})]})})};function wr(m,b){return b.forEach(function(D){D&&typeof D!="string"&&!Array.isArray(D)&&Object.keys(D).forEach(function(a){if(a!=="default"&&!(a in m)){var e=Object.getOwnPropertyDescriptor(D,a);Object.defineProperty(m,a,e.get?e:{enumerable:!0,get:function(){return D[a]}})}})}),Object.freeze(m)}function Ds(m,b){return new Promise(function(D,a){let e;return Cr(m).then(function(t){try{return e=t,D(new Blob([b.slice(0,2),e,b.slice(2)],{type:"image/jpeg"}))}catch(d){return a(d)}},a)})}const Cr=m=>new Promise((b,D)=>{const a=new FileReader;a.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let d=0;if(t.getUint16(d)!==65496)return D("not a valid JPEG");for(d+=2;;){const i=t.getUint16(d);if(i===65498)break;const v=t.getUint16(d+2);if(i===65505&&t.getUint32(d+4)===1165519206){const T=d+10;let n;switch(t.getUint16(T)){case 18761:n=!0;break;case 19789:n=!1;break;default:return D("TIFF header contains invalid endian")}if(t.getUint16(T+2,n)!==42)return D("TIFF header contains invalid version");const r=t.getUint32(T+4,n),s=T+r+2+12*t.getUint16(T+r,n);for(let c=T+r+2;c<s;c+=12)if(t.getUint16(c,n)==274){if(t.getUint16(c+2,n)!==3)return D("Orientation data type is invalid");if(t.getUint32(c+4,n)!==1)return D("Orientation data count is invalid");t.setUint16(c+8,1,n);break}return b(e.slice(d,d+2+v))}d+=2+v}return b(new Blob)}),a.readAsArrayBuffer(m)});var gn={},Er={get exports(){return gn},set exports(m){gn=m}};(function(m){var b,D,a={};Er.exports=a,a.parse=function(e,t){for(var d=a.bin.readUshort,i=a.bin.readUint,v=0,T={},n=new Uint8Array(e),r=n.length-4;i(n,r)!=101010256;)r--;v=r,v+=4;var s=d(n,v+=4);d(n,v+=2);var c=i(n,v+=2),p=i(n,v+=4);v+=4,v=p;for(var j=0;j<s;j++){i(n,v),v+=4,v+=4,v+=4,i(n,v+=4),c=i(n,v+=4);var k=i(n,v+=4),E=d(n,v+=4),H=d(n,v+2),B=d(n,v+4);v+=6;var F=i(n,v+=8);v+=4,v+=E+H+B,a._readLocal(n,F,T,c,k,t)}return T},a._readLocal=function(e,t,d,i,v,T){var n=a.bin.readUshort,r=a.bin.readUint;r(e,t),n(e,t+=4),n(e,t+=2);var s=n(e,t+=2);r(e,t+=2),r(e,t+=4),t+=4;var c=n(e,t+=8),p=n(e,t+=2);t+=2;var j=a.bin.readUTF8(e,t,c);if(t+=c,t+=p,T)d[j]={size:v,csize:i};else{var k=new Uint8Array(e.buffer,t);if(s==0)d[j]=new Uint8Array(k.buffer.slice(t,t+i));else{if(s!=8)throw"unknown compression method: "+s;var E=new Uint8Array(v);a.inflateRaw(k,E),d[j]=E}}},a.inflateRaw=function(e,t){return a.F.inflate(e,t)},a.inflate=function(e,t){return e[0],e[1],a.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},a.deflate=function(e,t){t==null&&(t={level:6});var d=0,i=new Uint8Array(50+Math.floor(1.1*e.length));i[d]=120,i[d+1]=156,d+=2,d=a.F.deflateRaw(e,i,d,t.level);var v=a.adler(e,0,e.length);return i[d+0]=v>>>24&255,i[d+1]=v>>>16&255,i[d+2]=v>>>8&255,i[d+3]=v>>>0&255,new Uint8Array(i.buffer,0,d+4)},a.deflateRaw=function(e,t){t==null&&(t={level:6});var d=new Uint8Array(50+Math.floor(1.1*e.length)),i=a.F.deflateRaw(e,d,i,t.level);return new Uint8Array(d.buffer,0,i)},a.encode=function(e,t){t==null&&(t=!1);var d=0,i=a.bin.writeUint,v=a.bin.writeUshort,T={};for(var n in e){var r=!a._noNeed(n)&&!t,s=e[n],c=a.crc.crc(s,0,s.length);T[n]={cpr:r,usize:s.length,crc:c,file:r?a.deflateRaw(s):s}}for(var n in T)d+=T[n].file.length+30+46+2*a.bin.sizeUTF8(n);d+=22;var p=new Uint8Array(d),j=0,k=[];for(var n in T){var E=T[n];k.push(j),j=a._writeHeader(p,j,n,E,0)}var H=0,B=j;for(var n in T)E=T[n],k.push(j),j=a._writeHeader(p,j,n,E,1,k[H++]);var F=j-B;return i(p,j,101010256),j+=4,v(p,j+=4,H),v(p,j+=2,H),i(p,j+=2,F),i(p,j+=4,B),j+=4,j+=2,p.buffer},a._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},a._writeHeader=function(e,t,d,i,v,T){var n=a.bin.writeUint,r=a.bin.writeUshort,s=i.file;return n(e,t,v==0?67324752:33639248),t+=4,v==1&&(t+=2),r(e,t,20),r(e,t+=2,0),r(e,t+=2,i.cpr?8:0),n(e,t+=2,0),n(e,t+=4,i.crc),n(e,t+=4,s.length),n(e,t+=4,i.usize),r(e,t+=4,a.bin.sizeUTF8(d)),r(e,t+=2,0),t+=2,v==1&&(t+=2,t+=2,n(e,t+=6,T),t+=4),t+=a.bin.writeUTF8(e,t,d),v==0&&(e.set(s,t),t+=s.length),t},a.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var d=t,i=0;i<8;i++)1&d?d=3988292384^d>>>1:d>>>=1;e[t]=d}return e}(),update:function(e,t,d,i){for(var v=0;v<i;v++)e=a.crc.table[255&(e^t[d+v])]^e>>>8;return e},crc:function(e,t,d){return 4294967295^a.crc.update(4294967295,e,t,d)}},a.adler=function(e,t,d){for(var i=1,v=0,T=t,n=t+d;T<n;){for(var r=Math.min(T+5552,n);T<r;)v+=i+=e[T++];i%=65521,v%=65521}return v<<16|i},a.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255,e[t+2]=d>>16&255,e[t+3]=d>>24&255},readASCII:function(e,t,d){for(var i="",v=0;v<d;v++)i+=String.fromCharCode(e[t+v]);return i},writeASCII:function(e,t,d){for(var i=0;i<d.length;i++)e[t+i]=d.charCodeAt(i)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,d){for(var i,v="",T=0;T<d;T++)v+="%"+a.bin.pad(e[t+T].toString(16));try{i=decodeURIComponent(v)}catch{return a.bin.readASCII(e,t,d)}return i},writeUTF8:function(e,t,d){for(var i=d.length,v=0,T=0;T<i;T++){var n=d.charCodeAt(T);if(!(4294967168&n))e[t+v]=n,v++;else if(!(4294965248&n))e[t+v]=192|n>>6,e[t+v+1]=128|n>>0&63,v+=2;else if(!(4294901760&n))e[t+v]=224|n>>12,e[t+v+1]=128|n>>6&63,e[t+v+2]=128|n>>0&63,v+=3;else{if(4292870144&n)throw"e";e[t+v]=240|n>>18,e[t+v+1]=128|n>>12&63,e[t+v+2]=128|n>>6&63,e[t+v+3]=128|n>>0&63,v+=4}}return v},sizeUTF8:function(e){for(var t=e.length,d=0,i=0;i<t;i++){var v=e.charCodeAt(i);if(!(4294967168&v))d++;else if(!(4294965248&v))d+=2;else if(!(4294901760&v))d+=3;else{if(4292870144&v)throw"e";d+=4}}return d}},a.F={},a.F.deflateRaw=function(e,t,d,i){var v=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][i],T=a.F.U,n=a.F._goodIndex;a.F._hash;var r=a.F._putsE,s=0,c=d<<3,p=0,j=e.length;if(i==0){for(;s<j;)r(t,c,s+(S=Math.min(65535,j-s))==j?1:0),c=a.F._copyExact(e,s,S,t,c+8),s+=S;return c>>>3}var k=T.lits,E=T.strt,H=T.prev,B=0,F=0,z=0,A=0,N=0,h=0;for(j>2&&(E[h=a.F._hash(e,0)]=0),s=0;s<j;s++){if(N=h,s+1<j-2){h=a.F._hash(e,s+1);var u=s+1&32767;H[u]=E[h],E[h]=u}if(p<=s){(B>14e3||F>26697)&&j-s>100&&(p<s&&(k[B]=s-p,B+=2,p=s),c=a.F._writeBlock(s==j-1||p==j?1:0,k,B,A,e,z,s-z,t,c),B=F=A=0,z=s);var x=0;s<j-2&&(x=a.F._bestMatch(e,s,H,N,Math.min(v[2],j-s),v[3]));var S=x>>>16,w=65535&x;if(x!=0){w=65535&x;var C=n(S=x>>>16,T.of0);T.lhst[257+C]++;var y=n(w,T.df0);T.dhst[y]++,A+=T.exb[C]+T.dxb[y],k[B]=S<<23|s-p,k[B+1]=w<<16|C<<8|y,B+=2,p=s+S}else T.lhst[e[s]]++;F++}}for(z==s&&e.length!=0||(p<s&&(k[B]=s-p,B+=2,p=s),c=a.F._writeBlock(1,k,B,A,e,z,s-z,t,c),B=0,F=0,B=F=A=0,z=s);7&c;)c++;return c>>>3},a.F._bestMatch=function(e,t,d,i,v,T){var n=32767&t,r=d[n],s=n-r+32768&32767;if(r==n||i!=a.F._hash(e,t-s))return 0;for(var c=0,p=0,j=Math.min(32767,t);s<=j&&--T!=0&&r!=n;){if(c==0||e[t+c]==e[t+c-s]){var k=a.F._howLong(e,t,s);if(k>c){if(p=s,(c=k)>=v)break;s+2<k&&(k=s+2);for(var E=0,H=0;H<k-2;H++){var B=t-s+H+32768&32767,F=B-d[B]+32768&32767;F>E&&(E=F,r=B)}}}s+=(n=r)-(r=d[n])+32768&32767}return c<<16|p},a.F._howLong=function(e,t,d){if(e[t]!=e[t-d]||e[t+1]!=e[t+1-d]||e[t+2]!=e[t+2-d])return 0;var i=t,v=Math.min(e.length,t+258);for(t+=3;t<v&&e[t]==e[t-d];)t++;return t-i},a.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},a.saved=0,a.F._writeBlock=function(e,t,d,i,v,T,n,r,s){var c,p,j,k,E,H,B,F,z,A=a.F.U,N=a.F._putsF,h=a.F._putsE;A.lhst[256]++,p=(c=a.F.getTrees())[0],j=c[1],k=c[2],E=c[3],H=c[4],B=c[5],F=c[6],z=c[7];var u=32+(s+3&7?8-(s+3&7):0)+(n<<3),x=i+a.F.contSize(A.fltree,A.lhst)+a.F.contSize(A.fdtree,A.dhst),S=i+a.F.contSize(A.ltree,A.lhst)+a.F.contSize(A.dtree,A.dhst);S+=14+3*B+a.F.contSize(A.itree,A.ihst)+(2*A.ihst[16]+3*A.ihst[17]+7*A.ihst[18]);for(var w=0;w<286;w++)A.lhst[w]=0;for(w=0;w<30;w++)A.dhst[w]=0;for(w=0;w<19;w++)A.ihst[w]=0;var C=u<x&&u<S?0:x<S?1:2;if(N(r,s,e),N(r,s+1,C),s+=3,C==0){for(;7&s;)s++;s=a.F._copyExact(v,T,n,r,s)}else{var y,_;if(C==1&&(y=A.fltree,_=A.fdtree),C==2){a.F.makeCodes(A.ltree,p),a.F.revCodes(A.ltree,p),a.F.makeCodes(A.dtree,j),a.F.revCodes(A.dtree,j),a.F.makeCodes(A.itree,k),a.F.revCodes(A.itree,k),y=A.ltree,_=A.dtree,h(r,s,E-257),h(r,s+=5,H-1),h(r,s+=5,B-4),s+=4;for(var f=0;f<B;f++)h(r,s+3*f,A.itree[1+(A.ordr[f]<<1)]);s+=3*B,s=a.F._codeTiny(F,A.itree,r,s),s=a.F._codeTiny(z,A.itree,r,s)}for(var l=T,P=0;P<d;P+=2){for(var R=t[P],L=R>>>23,q=l+(8388607&R);l<q;)s=a.F._writeLit(v[l++],y,r,s);if(L!=0){var G=t[P+1],V=G>>16,$=G>>8&255,O=255&G;h(r,s=a.F._writeLit(257+$,y,r,s),L-A.of0[$]),s+=A.exb[$],N(r,s=a.F._writeLit(O,_,r,s),V-A.df0[O]),s+=A.dxb[O],l+=L}}s=a.F._writeLit(256,y,r,s)}return s},a.F._copyExact=function(e,t,d,i,v){var T=v>>>3;return i[T]=d,i[T+1]=d>>>8,i[T+2]=255-i[T],i[T+3]=255-i[T+1],T+=4,i.set(new Uint8Array(e.buffer,t,d),T),v+(d+4<<3)},a.F.getTrees=function(){for(var e=a.F.U,t=a.F._hufTree(e.lhst,e.ltree,15),d=a.F._hufTree(e.dhst,e.dtree,15),i=[],v=a.F._lenCodes(e.ltree,i),T=[],n=a.F._lenCodes(e.dtree,T),r=0;r<i.length;r+=2)e.ihst[i[r]]++;for(r=0;r<T.length;r+=2)e.ihst[T[r]]++;for(var s=a.F._hufTree(e.ihst,e.itree,7),c=19;c>4&&e.itree[1+(e.ordr[c-1]<<1)]==0;)c--;return[t,d,s,v,n,c,i,T]},a.F.getSecond=function(e){for(var t=[],d=0;d<e.length;d+=2)t.push(e[d+1]);return t},a.F.nonZero=function(e){for(var t="",d=0;d<e.length;d+=2)e[d+1]!=0&&(t+=(d>>1)+",");return t},a.F.contSize=function(e,t){for(var d=0,i=0;i<t.length;i++)d+=t[i]*e[1+(i<<1)];return d},a.F._codeTiny=function(e,t,d,i){for(var v=0;v<e.length;v+=2){var T=e[v],n=e[v+1];i=a.F._writeLit(T,t,d,i);var r=T==16?2:T==17?3:7;T>15&&(a.F._putsE(d,i,n,r),i+=r)}return i},a.F._lenCodes=function(e,t){for(var d=e.length;d!=2&&e[d-1]==0;)d-=2;for(var i=0;i<d;i+=2){var v=e[i+1],T=i+3<d?e[i+3]:-1,n=i+5<d?e[i+5]:-1,r=i==0?-1:e[i-1];if(v==0&&T==v&&n==v){for(var s=i+5;s+2<d&&e[s+2]==v;)s+=2;(c=Math.min(s+1-i>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),i+=2*c-2}else if(v==r&&T==v&&n==v){for(s=i+5;s+2<d&&e[s+2]==v;)s+=2;var c=Math.min(s+1-i>>>1,6);t.push(16,c-3),i+=2*c-2}else t.push(v,0)}return d>>>1},a.F._hufTree=function(e,t,d){var i=[],v=e.length,T=t.length,n=0;for(n=0;n<T;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<v;n++)e[n]!=0&&i.push({lit:n,f:e[n]});var r=i.length,s=i.slice(0);if(r==0)return 0;if(r==1){var c=i[0].lit;return s=c==0?1:0,t[1+(c<<1)]=1,t[1+(s<<1)]=1,1}i.sort(function(F,z){return F.f-z.f});var p=i[0],j=i[1],k=0,E=1,H=2;for(i[0]={lit:-1,f:p.f+j.f,l:p,r:j,d:0};E!=r-1;)p=k!=E&&(H==r||i[k].f<i[H].f)?i[k++]:i[H++],j=k!=E&&(H==r||i[k].f<i[H].f)?i[k++]:i[H++],i[E++]={lit:-1,f:p.f+j.f,l:p,r:j};var B=a.F.setDepth(i[E-1],0);for(B>d&&(a.F.restrictDepth(s,d,B),B=d),n=0;n<r;n++)t[1+(s[n].lit<<1)]=s[n].d;return B},a.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(a.F.setDepth(e.l,t+1),a.F.setDepth(e.r,t+1))},a.F.restrictDepth=function(e,t,d){var i=0,v=1<<d-t,T=0;for(e.sort(function(r,s){return s.d==r.d?r.f-s.f:s.d-r.d}),i=0;i<e.length&&e[i].d>t;i++){var n=e[i].d;e[i].d=t,T+=v-(1<<d-n)}for(T>>>=d-t;T>0;)(n=e[i].d)<t?(e[i].d++,T-=1<<t-n-1):i++;for(;i>=0;i--)e[i].d==t&&T<0&&(e[i].d--,T++);T!=0&&console.log("debt left")},a.F._goodIndex=function(e,t){var d=0;return t[16|d]<=e&&(d|=16),t[8|d]<=e&&(d|=8),t[4|d]<=e&&(d|=4),t[2|d]<=e&&(d|=2),t[1|d]<=e&&(d|=1),d},a.F._writeLit=function(e,t,d,i){return a.F._putsF(d,i,t[e<<1]),i+t[1+(e<<1)]},a.F.inflate=function(e,t){var d=Uint8Array;if(e[0]==3&&e[1]==0)return t||new d(0);var i=a.F,v=i._bitsF,T=i._bitsE,n=i._decodeTiny,r=i.makeCodes,s=i.codes2map,c=i._get17,p=i.U,j=t==null;j&&(t=new d(e.length>>>2<<3));for(var k,E,H=0,B=0,F=0,z=0,A=0,N=0,h=0,u=0,x=0;H==0;)if(H=v(e,x,1),B=v(e,x+1,2),x+=3,B!=0){if(j&&(t=a.F._check(t,u+(1<<17))),B==1&&(k=p.flmap,E=p.fdmap,N=511,h=31),B==2){F=T(e,x,5)+257,z=T(e,x+5,5)+1,A=T(e,x+10,4)+4,x+=14;for(var S=0;S<38;S+=2)p.itree[S]=0,p.itree[S+1]=0;var w=1;for(S=0;S<A;S++){var C=T(e,x+3*S,3);p.itree[1+(p.ordr[S]<<1)]=C,C>w&&(w=C)}x+=3*A,r(p.itree,w),s(p.itree,w,p.imap),k=p.lmap,E=p.dmap,x=n(p.imap,(1<<w)-1,F+z,e,x,p.ttree);var y=i._copyOut(p.ttree,0,F,p.ltree);N=(1<<y)-1;var _=i._copyOut(p.ttree,F,z,p.dtree);h=(1<<_)-1,r(p.ltree,y),s(p.ltree,y,k),r(p.dtree,_),s(p.dtree,_,E)}for(;;){var f=k[c(e,x)&N];x+=15&f;var l=f>>>4;if(!(l>>>8))t[u++]=l;else{if(l==256)break;var P=u+l-254;if(l>264){var R=p.ldef[l-257];P=u+(R>>>3)+T(e,x,7&R),x+=7&R}var L=E[c(e,x)&h];x+=15&L;var q=L>>>4,G=p.ddef[q],V=(G>>>4)+v(e,x,15&G);for(x+=15&G,j&&(t=a.F._check(t,u+(1<<17)));u<P;)t[u]=t[u++-V],t[u]=t[u++-V],t[u]=t[u++-V],t[u]=t[u++-V];u=P}}}else{7&x&&(x+=8-(7&x));var $=4+(x>>>3),O=e[$-4]|e[$-3]<<8;j&&(t=a.F._check(t,u+O)),t.set(new d(e.buffer,e.byteOffset+$,O),u),x=$+O<<3,u+=O}return t.length==u?t:t.slice(0,u)},a.F._check=function(e,t){var d=e.length;if(t<=d)return e;var i=new Uint8Array(Math.max(d<<1,t));return i.set(e,0),i},a.F._decodeTiny=function(e,t,d,i,v,T){for(var n=a.F._bitsE,r=a.F._get17,s=0;s<d;){var c=e[r(i,v)&t];v+=15&c;var p=c>>>4;if(p<=15)T[s]=p,s++;else{var j=0,k=0;p==16?(k=3+n(i,v,2),v+=2,j=T[s-1]):p==17?(k=3+n(i,v,3),v+=3):p==18&&(k=11+n(i,v,7),v+=7);for(var E=s+k;s<E;)T[s]=j,s++}}return v},a.F._copyOut=function(e,t,d,i){for(var v=0,T=0,n=i.length>>>1;T<d;){var r=e[T+t];i[T<<1]=0,i[1+(T<<1)]=r,r>v&&(v=r),T++}for(;T<n;)i[T<<1]=0,i[1+(T<<1)]=0,T++;return v},a.F.makeCodes=function(e,t){for(var d,i,v,T,n=a.F.U,r=e.length,s=n.bl_count,c=0;c<=t;c++)s[c]=0;for(c=1;c<r;c+=2)s[e[c]]++;var p=n.next_code;for(d=0,s[0]=0,i=1;i<=t;i++)d=d+s[i-1]<<1,p[i]=d;for(v=0;v<r;v+=2)(T=e[v+1])!=0&&(e[v]=p[T],p[T]++)},a.F.codes2map=function(e,t,d){for(var i=e.length,v=a.F.U.rev15,T=0;T<i;T+=2)if(e[T+1]!=0)for(var n=T>>1,r=e[T+1],s=n<<4|r,c=t-r,p=e[T]<<c,j=p+(1<<c);p!=j;)d[v[p]>>>15-t]=s,p++},a.F.revCodes=function(e,t){for(var d=a.F.U.rev15,i=15-t,v=0;v<e.length;v+=2){var T=e[v]<<t-e[v+1];e[v]=d[T]>>>i}},a.F._putsE=function(e,t,d){d<<=7&t;var i=t>>>3;e[i]|=d,e[i+1]|=d>>>8},a.F._putsF=function(e,t,d){d<<=7&t;var i=t>>>3;e[i]|=d,e[i+1]|=d>>>8,e[i+2]|=d>>>16},a.F._bitsE=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<d)-1},a.F._bitsF=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<d)-1},a.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},a.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},a.F.U=(b=Uint16Array,D=Uint32Array,{next_code:new b(16),bl_count:new b(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new b(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new D(32),flmap:new b(512),fltree:[],fdmap:new b(32),fdtree:[],lmap:new b(32768),ltree:[],ttree:[],dmap:new b(32768),dtree:[],imap:new b(512),itree:[],rev15:new b(32768),lhst:new D(286),dhst:new D(30),ihst:new D(19),lits:new D(15e3),strt:new b(65536),prev:new b(32768)}),function(){for(var e=a.F.U,t=0;t<32768;t++){var d=t;d=(4278255360&(d=(4042322160&(d=(3435973836&(d=(2863311530&d)>>>1|(1431655765&d)<<1))>>>2|(858993459&d)<<2))>>>4|(252645135&d)<<4))>>>8|(16711935&d)<<8,e.rev15[t]=(d>>>16|d<<16)>>>17}function i(v,T,n){for(;T--!=0;)v.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];i(e.fltree,144,8),i(e.fltree,112,9),i(e.fltree,24,7),i(e.fltree,8,8),a.F.makeCodes(e.fltree,9),a.F.codes2map(e.fltree,9,e.flmap),a.F.revCodes(e.fltree,9),i(e.fdtree,32,5),a.F.makeCodes(e.fdtree,5),a.F.codes2map(e.fdtree,5,e.fdmap),a.F.revCodes(e.fdtree,5),i(e.itree,19,0),i(e.ltree,286,0),i(e.dtree,30,0),i(e.ttree,320,0)}()})();var _r=wr({__proto__:null,default:gn},[gn]);const nt=function(){var m={nextZero(n,r){for(;n[r]!=0;)r++;return r},readUshort:(n,r)=>n[r]<<8|n[r+1],writeUshort(n,r,s){n[r]=s>>8&255,n[r+1]=255&s},readUint:(n,r)=>16777216*n[r]+(n[r+1]<<16|n[r+2]<<8|n[r+3]),writeUint(n,r,s){n[r]=s>>24&255,n[r+1]=s>>16&255,n[r+2]=s>>8&255,n[r+3]=255&s},readASCII(n,r,s){let c="";for(let p=0;p<s;p++)c+=String.fromCharCode(n[r+p]);return c},writeASCII(n,r,s){for(let c=0;c<s.length;c++)n[r+c]=s.charCodeAt(c)},readBytes(n,r,s){const c=[];for(let p=0;p<s;p++)c.push(n[r+p]);return c},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,r,s){let c,p="";for(let j=0;j<s;j++)p+=`%${m.pad(n[r+j].toString(16))}`;try{c=decodeURIComponent(p)}catch{return m.readASCII(n,r,s)}return c}};function b(n,r,s,c){const p=r*s,j=t(c),k=Math.ceil(r*j/8),E=new Uint8Array(4*p),H=new Uint32Array(E.buffer),{ctype:B}=c,{depth:F}=c,z=m.readUshort;if(B==6){const R=p<<2;if(F==8)for(var A=0;A<R;A+=4)E[A]=n[A],E[A+1]=n[A+1],E[A+2]=n[A+2],E[A+3]=n[A+3];if(F==16)for(A=0;A<R;A++)E[A]=n[A<<1]}else if(B==2){const R=c.tabs.tRNS;if(R==null){if(F==8)for(A=0;A<p;A++){var N=3*A;H[A]=255<<24|n[N+2]<<16|n[N+1]<<8|n[N]}if(F==16)for(A=0;A<p;A++)N=6*A,H[A]=255<<24|n[N+4]<<16|n[N+2]<<8|n[N]}else{var h=R[0];const L=R[1],q=R[2];if(F==8)for(A=0;A<p;A++){var u=A<<2;N=3*A,H[A]=255<<24|n[N+2]<<16|n[N+1]<<8|n[N],n[N]==h&&n[N+1]==L&&n[N+2]==q&&(E[u+3]=0)}if(F==16)for(A=0;A<p;A++)u=A<<2,N=6*A,H[A]=255<<24|n[N+4]<<16|n[N+2]<<8|n[N],z(n,N)==h&&z(n,N+2)==L&&z(n,N+4)==q&&(E[u+3]=0)}}else if(B==3){const R=c.tabs.PLTE,L=c.tabs.tRNS,q=L?L.length:0;if(F==1)for(var x=0;x<s;x++){var S=x*k,w=x*r;for(A=0;A<r;A++){u=w+A<<2;var C=3*(y=n[S+(A>>3)]>>7-((7&A)<<0)&1);E[u]=R[C],E[u+1]=R[C+1],E[u+2]=R[C+2],E[u+3]=y<q?L[y]:255}}if(F==2)for(x=0;x<s;x++)for(S=x*k,w=x*r,A=0;A<r;A++)u=w+A<<2,C=3*(y=n[S+(A>>2)]>>6-((3&A)<<1)&3),E[u]=R[C],E[u+1]=R[C+1],E[u+2]=R[C+2],E[u+3]=y<q?L[y]:255;if(F==4)for(x=0;x<s;x++)for(S=x*k,w=x*r,A=0;A<r;A++)u=w+A<<2,C=3*(y=n[S+(A>>1)]>>4-((1&A)<<2)&15),E[u]=R[C],E[u+1]=R[C+1],E[u+2]=R[C+2],E[u+3]=y<q?L[y]:255;if(F==8)for(A=0;A<p;A++){var y;u=A<<2,C=3*(y=n[A]),E[u]=R[C],E[u+1]=R[C+1],E[u+2]=R[C+2],E[u+3]=y<q?L[y]:255}}else if(B==4){if(F==8)for(A=0;A<p;A++){u=A<<2;var _=n[f=A<<1];E[u]=_,E[u+1]=_,E[u+2]=_,E[u+3]=n[f+1]}if(F==16)for(A=0;A<p;A++){var f;u=A<<2,_=n[f=A<<2],E[u]=_,E[u+1]=_,E[u+2]=_,E[u+3]=n[f+2]}}else if(B==0)for(h=c.tabs.tRNS?c.tabs.tRNS:-1,x=0;x<s;x++){const R=x*k,L=x*r;if(F==1)for(var l=0;l<r;l++){var P=(_=255*(n[R+(l>>>3)]>>>7-(7&l)&1))==255*h?0:255;H[L+l]=P<<24|_<<16|_<<8|_}else if(F==2)for(l=0;l<r;l++)P=(_=85*(n[R+(l>>>2)]>>>6-((3&l)<<1)&3))==85*h?0:255,H[L+l]=P<<24|_<<16|_<<8|_;else if(F==4)for(l=0;l<r;l++)P=(_=17*(n[R+(l>>>1)]>>>4-((1&l)<<2)&15))==17*h?0:255,H[L+l]=P<<24|_<<16|_<<8|_;else if(F==8)for(l=0;l<r;l++)P=(_=n[R+l])==h?0:255,H[L+l]=P<<24|_<<16|_<<8|_;else if(F==16)for(l=0;l<r;l++)_=n[R+(l<<1)],P=z(n,R+(l<<1))==h?0:255,H[L+l]=P<<24|_<<16|_<<8|_}return E}function D(n,r,s,c){const p=t(n),j=Math.ceil(s*p/8),k=new Uint8Array((j+1+n.interlace)*c);return r=n.tabs.CgBI?e(r,k):a(r,k),n.interlace==0?r=d(r,n,0,s,c):n.interlace==1&&(r=function(H,B){const F=B.width,z=B.height,A=t(B),N=A>>3,h=Math.ceil(F*A/8),u=new Uint8Array(z*h);let x=0;const S=[0,0,4,0,2,0,1],w=[0,4,0,2,0,1,0],C=[8,8,8,4,4,2,2],y=[8,8,4,4,2,2,1];let _=0;for(;_<7;){const l=C[_],P=y[_];let R=0,L=0,q=S[_];for(;q<z;)q+=l,L++;let G=w[_];for(;G<F;)G+=P,R++;const V=Math.ceil(R*A/8);d(H,B,x,R,L);let $=0,O=S[_];for(;O<z;){let K=w[_],ue=x+$*V<<3;for(;K<F;){var f;if(A==1&&(f=(f=H[ue>>3])>>7-(7&ue)&1,u[O*h+(K>>3)]|=f<<7-((7&K)<<0)),A==2&&(f=(f=H[ue>>3])>>6-(7&ue)&3,u[O*h+(K>>2)]|=f<<6-((3&K)<<1)),A==4&&(f=(f=H[ue>>3])>>4-(7&ue)&15,u[O*h+(K>>1)]|=f<<4-((1&K)<<2)),A>=8){const ie=O*h+K*N;for(let se=0;se<N;se++)u[ie+se]=H[(ue>>3)+se]}ue+=A,K+=P}$++,O+=l}R*L!=0&&(x+=L*(1+V)),_+=1}return u}(r,n)),r}function a(n,r){return e(new Uint8Array(n.buffer,2,n.length-6),r)}var e=function(){const n={H:{}};return n.H.N=function(r,s){const c=Uint8Array;let p,j,k=0,E=0,H=0,B=0,F=0,z=0,A=0,N=0,h=0;if(r[0]==3&&r[1]==0)return s||new c(0);const u=n.H,x=u.b,S=u.e,w=u.R,C=u.n,y=u.A,_=u.Z,f=u.m,l=s==null;for(l&&(s=new c(r.length>>>2<<5));k==0;)if(k=x(r,h,1),E=x(r,h+1,2),h+=3,E!=0){if(l&&(s=n.H.W(s,N+(1<<17))),E==1&&(p=f.J,j=f.h,z=511,A=31),E==2){H=S(r,h,5)+257,B=S(r,h+5,5)+1,F=S(r,h+10,4)+4,h+=14;let R=1;for(var P=0;P<38;P+=2)f.Q[P]=0,f.Q[P+1]=0;for(P=0;P<F;P++){const G=S(r,h+3*P,3);f.Q[1+(f.X[P]<<1)]=G,G>R&&(R=G)}h+=3*F,C(f.Q,R),y(f.Q,R,f.u),p=f.w,j=f.d,h=w(f.u,(1<<R)-1,H+B,r,h,f.v);const L=u.V(f.v,0,H,f.C);z=(1<<L)-1;const q=u.V(f.v,H,B,f.D);A=(1<<q)-1,C(f.C,L),y(f.C,L,p),C(f.D,q),y(f.D,q,j)}for(;;){const R=p[_(r,h)&z];h+=15&R;const L=R>>>4;if(!(L>>>8))s[N++]=L;else{if(L==256)break;{let q=N+L-254;if(L>264){const K=f.q[L-257];q=N+(K>>>3)+S(r,h,7&K),h+=7&K}const G=j[_(r,h)&A];h+=15&G;const V=G>>>4,$=f.c[V],O=($>>>4)+x(r,h,15&$);for(h+=15&$;N<q;)s[N]=s[N++-O],s[N]=s[N++-O],s[N]=s[N++-O],s[N]=s[N++-O];N=q}}}}else{7&h&&(h+=8-(7&h));const R=4+(h>>>3),L=r[R-4]|r[R-3]<<8;l&&(s=n.H.W(s,N+L)),s.set(new c(r.buffer,r.byteOffset+R,L),N),h=R+L<<3,N+=L}return s.length==N?s:s.slice(0,N)},n.H.W=function(r,s){const c=r.length;if(s<=c)return r;const p=new Uint8Array(c<<1);return p.set(r,0),p},n.H.R=function(r,s,c,p,j,k){const E=n.H.e,H=n.H.Z;let B=0;for(;B<c;){const F=r[H(p,j)&s];j+=15&F;const z=F>>>4;if(z<=15)k[B]=z,B++;else{let A=0,N=0;z==16?(N=3+E(p,j,2),j+=2,A=k[B-1]):z==17?(N=3+E(p,j,3),j+=3):z==18&&(N=11+E(p,j,7),j+=7);const h=B+N;for(;B<h;)k[B]=A,B++}}return j},n.H.V=function(r,s,c,p){let j=0,k=0;const E=p.length>>>1;for(;k<c;){const H=r[k+s];p[k<<1]=0,p[1+(k<<1)]=H,H>j&&(j=H),k++}for(;k<E;)p[k<<1]=0,p[1+(k<<1)]=0,k++;return j},n.H.n=function(r,s){const c=n.H.m,p=r.length;let j,k,E,H;const B=c.j;for(var F=0;F<=s;F++)B[F]=0;for(F=1;F<p;F+=2)B[r[F]]++;const z=c.K;for(j=0,B[0]=0,k=1;k<=s;k++)j=j+B[k-1]<<1,z[k]=j;for(E=0;E<p;E+=2)H=r[E+1],H!=0&&(r[E]=z[H],z[H]++)},n.H.A=function(r,s,c){const p=r.length,j=n.H.m.r;for(let k=0;k<p;k+=2)if(r[k+1]!=0){const E=k>>1,H=r[k+1],B=E<<4|H,F=s-H;let z=r[k]<<F;const A=z+(1<<F);for(;z!=A;)c[j[z]>>>15-s]=B,z++}},n.H.l=function(r,s){const c=n.H.m.r,p=15-s;for(let j=0;j<r.length;j+=2){const k=r[j]<<s-r[j+1];r[j]=c[k]>>>p}},n.H.M=function(r,s,c){c<<=7&s;const p=s>>>3;r[p]|=c,r[p+1]|=c>>>8},n.H.I=function(r,s,c){c<<=7&s;const p=s>>>3;r[p]|=c,r[p+1]|=c>>>8,r[p+2]|=c>>>16},n.H.e=function(r,s,c){return(r[s>>>3]|r[1+(s>>>3)]<<8)>>>(7&s)&(1<<c)-1},n.H.b=function(r,s,c){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16)>>>(7&s)&(1<<c)-1},n.H.Z=function(r,s){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16)>>>(7&s)},n.H.i=function(r,s){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16|r[3+(s>>>3)]<<24)>>>(7&s)},n.H.m=function(){const r=Uint16Array,s=Uint32Array;return{K:new r(16),j:new r(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new r(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new s(32),J:new r(512),_:[],h:new r(32),$:[],w:new r(32768),C:[],v:[],d:new r(32768),D:[],u:new r(512),Q:[],r:new r(32768),s:new s(286),Y:new s(30),a:new s(19),t:new s(15e3),k:new r(65536),g:new r(32768)}}(),function(){const r=n.H.m;for(var s=0;s<32768;s++){let p=s;p=(2863311530&p)>>>1|(1431655765&p)<<1,p=(3435973836&p)>>>2|(858993459&p)<<2,p=(4042322160&p)>>>4|(252645135&p)<<4,p=(4278255360&p)>>>8|(16711935&p)<<8,r.r[s]=(p>>>16|p<<16)>>>17}function c(p,j,k){for(;j--!=0;)p.push(0,k)}for(s=0;s<32;s++)r.q[s]=r.S[s]<<3|r.T[s],r.c[s]=r.p[s]<<4|r.z[s];c(r._,144,8),c(r._,112,9),c(r._,24,7),c(r._,8,8),n.H.n(r._,9),n.H.A(r._,9,r.J),n.H.l(r._,9),c(r.$,32,5),n.H.n(r.$,5),n.H.A(r.$,5,r.h),n.H.l(r.$,5),c(r.Q,19,0),c(r.C,286,0),c(r.D,30,0),c(r.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function d(n,r,s,c,p){let j=t(r);const k=Math.ceil(c*j/8);let E,H;j=Math.ceil(j/8);let B=n[s],F=0;if(B>1&&(n[s]=[0,0,1][B-2]),B==3)for(F=j;F<k;F++)n[F+1]=n[F+1]+(n[F+1-j]>>>1)&255;for(let z=0;z<p;z++)if(E=s+z*k,H=E+z+1,B=n[H-1],F=0,B==0)for(;F<k;F++)n[E+F]=n[H+F];else if(B==1){for(;F<j;F++)n[E+F]=n[H+F];for(;F<k;F++)n[E+F]=n[H+F]+n[E+F-j]}else if(B==2)for(;F<k;F++)n[E+F]=n[H+F]+n[E+F-k];else if(B==3){for(;F<j;F++)n[E+F]=n[H+F]+(n[E+F-k]>>>1);for(;F<k;F++)n[E+F]=n[H+F]+(n[E+F-k]+n[E+F-j]>>>1)}else{for(;F<j;F++)n[E+F]=n[H+F]+i(0,n[E+F-k],0);for(;F<k;F++)n[E+F]=n[H+F]+i(n[E+F-j],n[E+F-k],n[E+F-j-k])}return n}function i(n,r,s){const c=n+r-s,p=c-n,j=c-r,k=c-s;return p*p<=j*j&&p*p<=k*k?n:j*j<=k*k?r:s}function v(n,r,s){s.width=m.readUint(n,r),r+=4,s.height=m.readUint(n,r),r+=4,s.depth=n[r],r++,s.ctype=n[r],r++,s.compress=n[r],r++,s.filter=n[r],r++,s.interlace=n[r],r++}function T(n,r,s,c,p,j,k,E,H){const B=Math.min(r,p),F=Math.min(s,j);let z=0,A=0;for(let _=0;_<F;_++)for(let f=0;f<B;f++)if(k>=0&&E>=0?(z=_*r+f<<2,A=(E+_)*p+k+f<<2):(z=(-E+_)*r-k+f<<2,A=_*p+f<<2),H==0)c[A]=n[z],c[A+1]=n[z+1],c[A+2]=n[z+2],c[A+3]=n[z+3];else if(H==1){var N=n[z+3]*.00392156862745098,h=n[z]*N,u=n[z+1]*N,x=n[z+2]*N,S=c[A+3]*(1/255),w=c[A]*S,C=c[A+1]*S,y=c[A+2]*S;const l=1-N,P=N+S*l,R=P==0?0:1/P;c[A+3]=255*P,c[A+0]=(h+w*l)*R,c[A+1]=(u+C*l)*R,c[A+2]=(x+y*l)*R}else if(H==2)N=n[z+3],h=n[z],u=n[z+1],x=n[z+2],S=c[A+3],w=c[A],C=c[A+1],y=c[A+2],N==S&&h==w&&u==C&&x==y?(c[A]=0,c[A+1]=0,c[A+2]=0,c[A+3]=0):(c[A]=h,c[A+1]=u,c[A+2]=x,c[A+3]=N);else if(H==3){if(N=n[z+3],h=n[z],u=n[z+1],x=n[z+2],S=c[A+3],w=c[A],C=c[A+1],y=c[A+2],N==S&&h==w&&u==C&&x==y)continue;if(N<220&&S>20)return!1}return!0}return{decode:function(r){const s=new Uint8Array(r);let c=8;const p=m,j=p.readUshort,k=p.readUint,E={tabs:{},frames:[]},H=new Uint8Array(s.length);let B,F=0,z=0;const A=[137,80,78,71,13,10,26,10];for(var N=0;N<8;N++)if(s[N]!=A[N])throw"The input is not a PNG file!";for(;c<s.length;){const _=p.readUint(s,c);c+=4;const f=p.readASCII(s,c,4);if(c+=4,f=="IHDR")v(s,c,E);else if(f=="iCCP"){for(var h=c;s[h]!=0;)h++;p.readASCII(s,c,h-c),s[h+1];const l=s.slice(h+2,c+_);let P=null;try{P=a(l)}catch{P=e(l)}E.tabs[f]=P}else if(f=="CgBI")E.tabs[f]=s.slice(c,c+4);else if(f=="IDAT"){for(N=0;N<_;N++)H[F+N]=s[c+N];F+=_}else if(f=="acTL")E.tabs[f]={num_frames:k(s,c),num_plays:k(s,c+4)},B=new Uint8Array(s.length);else if(f=="fcTL"){z!=0&&((y=E.frames[E.frames.length-1]).data=D(E,B.slice(0,z),y.rect.width,y.rect.height),z=0);const l={x:k(s,c+12),y:k(s,c+16),width:k(s,c+4),height:k(s,c+8)};let P=j(s,c+22);P=j(s,c+20)/(P==0?100:P);const R={rect:l,delay:Math.round(1e3*P),dispose:s[c+24],blend:s[c+25]};E.frames.push(R)}else if(f=="fdAT"){for(N=0;N<_-4;N++)B[z+N]=s[c+N+4];z+=_-4}else if(f=="pHYs")E.tabs[f]=[p.readUint(s,c),p.readUint(s,c+4),s[c+8]];else if(f=="cHRM")for(E.tabs[f]=[],N=0;N<8;N++)E.tabs[f].push(p.readUint(s,c+4*N));else if(f=="tEXt"||f=="zTXt"){E.tabs[f]==null&&(E.tabs[f]={});var u=p.nextZero(s,c),x=p.readASCII(s,c,u-c),S=c+_-u-1;if(f=="tEXt")C=p.readASCII(s,u+1,S);else{var w=a(s.slice(u+2,u+2+S));C=p.readUTF8(w,0,w.length)}E.tabs[f][x]=C}else if(f=="iTXt"){E.tabs[f]==null&&(E.tabs[f]={}),u=0,h=c,u=p.nextZero(s,h),x=p.readASCII(s,h,u-h);const l=s[h=u+1];var C;s[h+1],h+=2,u=p.nextZero(s,h),p.readASCII(s,h,u-h),h=u+1,u=p.nextZero(s,h),p.readUTF8(s,h,u-h),S=_-((h=u+1)-c),l==0?C=p.readUTF8(s,h,S):(w=a(s.slice(h,h+S)),C=p.readUTF8(w,0,w.length)),E.tabs[f][x]=C}else if(f=="PLTE")E.tabs[f]=p.readBytes(s,c,_);else if(f=="hIST"){const l=E.tabs.PLTE.length/3;for(E.tabs[f]=[],N=0;N<l;N++)E.tabs[f].push(j(s,c+2*N))}else if(f=="tRNS")E.ctype==3?E.tabs[f]=p.readBytes(s,c,_):E.ctype==0?E.tabs[f]=j(s,c):E.ctype==2&&(E.tabs[f]=[j(s,c),j(s,c+2),j(s,c+4)]);else if(f=="gAMA")E.tabs[f]=p.readUint(s,c)/1e5;else if(f=="sRGB")E.tabs[f]=s[c];else if(f=="bKGD")E.ctype==0||E.ctype==4?E.tabs[f]=[j(s,c)]:E.ctype==2||E.ctype==6?E.tabs[f]=[j(s,c),j(s,c+2),j(s,c+4)]:E.ctype==3&&(E.tabs[f]=s[c]);else if(f=="IEND")break;c+=_,p.readUint(s,c),c+=4}var y;return z!=0&&((y=E.frames[E.frames.length-1]).data=D(E,B.slice(0,z),y.rect.width,y.rect.height)),E.data=D(E,H,E.width,E.height),delete E.compress,delete E.interlace,delete E.filter,E},toRGBA8:function(r){const s=r.width,c=r.height;if(r.tabs.acTL==null)return[b(r.data,s,c,r).buffer];const p=[];r.frames[0].data==null&&(r.frames[0].data=r.data);const j=s*c*4,k=new Uint8Array(j),E=new Uint8Array(j),H=new Uint8Array(j);for(let F=0;F<r.frames.length;F++){const z=r.frames[F],A=z.rect.x,N=z.rect.y,h=z.rect.width,u=z.rect.height,x=b(z.data,h,u,r);if(F!=0)for(var B=0;B<j;B++)H[B]=k[B];if(z.blend==0?T(x,h,u,k,s,c,A,N,0):z.blend==1&&T(x,h,u,k,s,c,A,N,1),p.push(k.buffer.slice(0)),z.dispose!=0){if(z.dispose==1)T(E,h,u,k,s,c,A,N,0);else if(z.dispose==2)for(B=0;B<j;B++)k[B]=H[B]}}return p},_paeth:i,_copyTile:T,_bin:m}}();(function(){const{_copyTile:m}=nt,{_bin:b}=nt,D=nt._paeth;var a={table:function(){const h=new Uint32Array(256);for(let u=0;u<256;u++){let x=u;for(let S=0;S<8;S++)1&x?x=3988292384^x>>>1:x>>>=1;h[u]=x}return h}(),update(h,u,x,S){for(let w=0;w<S;w++)h=a.table[255&(h^u[x+w])]^h>>>8;return h},crc:(h,u,x)=>4294967295^a.update(4294967295,h,u,x)};function e(h,u,x,S){u[x]+=h[0]*S>>4,u[x+1]+=h[1]*S>>4,u[x+2]+=h[2]*S>>4,u[x+3]+=h[3]*S>>4}function t(h){return Math.max(0,Math.min(255,h))}function d(h,u){const x=h[0]-u[0],S=h[1]-u[1],w=h[2]-u[2],C=h[3]-u[3];return x*x+S*S+w*w+C*C}function i(h,u,x,S,w,C,y){y==null&&(y=1);const _=S.length,f=[];for(var l=0;l<_;l++){const O=S[l];f.push([O>>>0&255,O>>>8&255,O>>>16&255,O>>>24&255])}for(l=0;l<_;l++){let O=4294967295;for(var P=0,R=0;R<_;R++){var L=d(f[l],f[R]);R!=l&&L<O&&(O=L,P=R)}}const q=new Uint32Array(w.buffer),G=new Int16Array(u*x*4),V=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(l=0;l<V.length;l++)V[l]=255*((V[l]+.5)/16-.5);for(let O=0;O<x;O++)for(let K=0;K<u;K++){var $;l=4*(O*u+K),y!=2?$=[t(h[l]+G[l]),t(h[l+1]+G[l+1]),t(h[l+2]+G[l+2]),t(h[l+3]+G[l+3])]:(L=V[4*(3&O)+(3&K)],$=[t(h[l]+L),t(h[l+1]+L),t(h[l+2]+L),t(h[l+3]+L)]),P=0;let ue=16777215;for(R=0;R<_;R++){const le=d($,f[R]);le<ue&&(ue=le,P=R)}const ie=f[P],se=[$[0]-ie[0],$[1]-ie[1],$[2]-ie[2],$[3]-ie[3]];y==1&&(K!=u-1&&e(se,G,l+4,7),O!=x-1&&(K!=0&&e(se,G,l+4*u-4,3),e(se,G,l+4*u,5),K!=u-1&&e(se,G,l+4*u+4,1))),C[l>>2]=P,q[l>>2]=S[P]}}function v(h,u,x,S,w){w==null&&(w={});const{crc:C}=a,y=b.writeUint,_=b.writeUshort,f=b.writeASCII;let l=8;const P=h.frames.length>1;let R,L=!1,q=33+(P?20:0);if(w.sRGB!=null&&(q+=13),w.pHYs!=null&&(q+=21),w.iCCP!=null&&(R=pako.deflate(w.iCCP),q+=21+R.length+4),h.ctype==3){for(var G=h.plte.length,V=0;V<G;V++)h.plte[V]>>>24!=255&&(L=!0);q+=8+3*G+4+(L?8+1*G+4:0)}for(var $=0;$<h.frames.length;$++)P&&(q+=38),q+=(ie=h.frames[$]).cimg.length+12,$!=0&&(q+=4);q+=12;const O=new Uint8Array(q),K=[137,80,78,71,13,10,26,10];for(V=0;V<8;V++)O[V]=K[V];if(y(O,l,13),l+=4,f(O,l,"IHDR"),l+=4,y(O,l,u),l+=4,y(O,l,x),l+=4,O[l]=h.depth,l++,O[l]=h.ctype,l++,O[l]=0,l++,O[l]=0,l++,O[l]=0,l++,y(O,l,C(O,l-17,17)),l+=4,w.sRGB!=null&&(y(O,l,1),l+=4,f(O,l,"sRGB"),l+=4,O[l]=w.sRGB,l++,y(O,l,C(O,l-5,5)),l+=4),w.iCCP!=null){const se=13+R.length;y(O,l,se),l+=4,f(O,l,"iCCP"),l+=4,f(O,l,"ICC profile"),l+=11,l+=2,O.set(R,l),l+=R.length,y(O,l,C(O,l-(se+4),se+4)),l+=4}if(w.pHYs!=null&&(y(O,l,9),l+=4,f(O,l,"pHYs"),l+=4,y(O,l,w.pHYs[0]),l+=4,y(O,l,w.pHYs[1]),l+=4,O[l]=w.pHYs[2],l++,y(O,l,C(O,l-13,13)),l+=4),P&&(y(O,l,8),l+=4,f(O,l,"acTL"),l+=4,y(O,l,h.frames.length),l+=4,y(O,l,w.loop!=null?w.loop:0),l+=4,y(O,l,C(O,l-12,12)),l+=4),h.ctype==3){for(y(O,l,3*(G=h.plte.length)),l+=4,f(O,l,"PLTE"),l+=4,V=0;V<G;V++){const se=3*V,le=h.plte[V],ce=255&le,fe=le>>>8&255,Oe=le>>>16&255;O[l+se+0]=ce,O[l+se+1]=fe,O[l+se+2]=Oe}if(l+=3*G,y(O,l,C(O,l-3*G-4,3*G+4)),l+=4,L){for(y(O,l,G),l+=4,f(O,l,"tRNS"),l+=4,V=0;V<G;V++)O[l+V]=h.plte[V]>>>24&255;l+=G,y(O,l,C(O,l-G-4,G+4)),l+=4}}let ue=0;for($=0;$<h.frames.length;$++){var ie=h.frames[$];P&&(y(O,l,26),l+=4,f(O,l,"fcTL"),l+=4,y(O,l,ue++),l+=4,y(O,l,ie.rect.width),l+=4,y(O,l,ie.rect.height),l+=4,y(O,l,ie.rect.x),l+=4,y(O,l,ie.rect.y),l+=4,_(O,l,S[$]),l+=2,_(O,l,1e3),l+=2,O[l]=ie.dispose,l++,O[l]=ie.blend,l++,y(O,l,C(O,l-30,30)),l+=4);const se=ie.cimg;y(O,l,(G=se.length)+($==0?0:4)),l+=4;const le=l;f(O,l,$==0?"IDAT":"fdAT"),l+=4,$!=0&&(y(O,l,ue++),l+=4),O.set(se,l),l+=G,y(O,l,C(O,le,l-le)),l+=4}return y(O,l,0),l+=4,f(O,l,"IEND"),l+=4,y(O,l,C(O,l-4,4)),l+=4,O.buffer}function T(h,u,x){for(let S=0;S<h.frames.length;S++){const w=h.frames[S];w.rect.width;const C=w.rect.height,y=new Uint8Array(C*w.bpl+C);w.cimg=c(w.img,C,w.bpp,w.bpl,y,u,x)}}function n(h,u,x,S,w){const C=w[0],y=w[1],_=w[2],f=w[3],l=w[4],P=w[5];let R=6,L=8,q=255;for(var G=0;G<h.length;G++){const ve=new Uint8Array(h[G]);for(var V=ve.length,$=0;$<V;$+=4)q&=ve[$+3]}const O=q!=255,K=function(de,he,pe,Se,be,je){const xe=[];for(var ne=0;ne<de.length;ne++){const te=new Uint8Array(de[ne]),ke=new Uint32Array(te.buffer);var we;let re=0,Ue=0,ee=he,_e=pe,Ie=Se?1:0;if(ne!=0){const ht=je||Se||ne==1||xe[ne-2].dispose!=0?1:2;let mt=0,lt=1e9;for(let $e=0;$e<ht;$e++){var Ce=new Uint8Array(de[ne-1-$e]);const Mt=new Uint32Array(de[ne-1-$e]);let Me=he,Ye=pe,Ze=-1,ge=-1;for(let et=0;et<pe;et++)for(let Ve=0;Ve<he;Ve++)ke[Ae=et*he+Ve]!=Mt[Ae]&&(Ve<Me&&(Me=Ve),Ve>Ze&&(Ze=Ve),et<Ye&&(Ye=et),et>ge&&(ge=et));Ze==-1&&(Me=Ye=Ze=ge=0),be&&((1&Me)==1&&Me--,(1&Ye)==1&&Ye--);const Je=(Ze-Me+1)*(ge-Ye+1);Je<lt&&(lt=Je,mt=$e,re=Me,Ue=Ye,ee=Ze-Me+1,_e=ge-Ye+1)}Ce=new Uint8Array(de[ne-1-mt]),mt==1&&(xe[ne-1].dispose=2),we=new Uint8Array(ee*_e*4),m(Ce,he,pe,we,ee,_e,-re,-Ue,0),Ie=m(te,he,pe,we,ee,_e,-re,-Ue,3)?1:0,Ie==1?s(te,he,pe,we,{x:re,y:Ue,width:ee,height:_e}):m(te,he,pe,we,ee,_e,-re,-Ue,0)}else we=te.slice(0);xe.push({rect:{x:re,y:Ue,width:ee,height:_e},img:we,blend:Ie,dispose:0})}if(Se)for(ne=0;ne<xe.length;ne++){if((qe=xe[ne]).blend==1)continue;const te=qe.rect,ke=xe[ne-1].rect,re=Math.min(te.x,ke.x),Ue=Math.min(te.y,ke.y),ee={x:re,y:Ue,width:Math.max(te.x+te.width,ke.x+ke.width)-re,height:Math.max(te.y+te.height,ke.y+ke.height)-Ue};xe[ne-1].dispose=1,ne-1!=0&&r(de,he,pe,xe,ne-1,ee,be),r(de,he,pe,xe,ne,ee,be)}let at=0;if(de.length!=1)for(var Ae=0;Ae<xe.length;Ae++){var qe;at+=(qe=xe[Ae]).rect.width*qe.rect.height}return xe}(h,u,x,C,y,_),ue={},ie=[],se=[];if(S!=0){const ve=[];for($=0;$<K.length;$++)ve.push(K[$].img.buffer);const de=function(be){let je=0;for(var xe=0;xe<be.length;xe++)je+=be[xe].byteLength;const ne=new Uint8Array(je);let we=0;for(xe=0;xe<be.length;xe++){const Ce=new Uint8Array(be[xe]),at=Ce.length;for(let Ae=0;Ae<at;Ae+=4){let qe=Ce[Ae],te=Ce[Ae+1],ke=Ce[Ae+2];const re=Ce[Ae+3];re==0&&(qe=te=ke=0),ne[we+Ae]=qe,ne[we+Ae+1]=te,ne[we+Ae+2]=ke,ne[we+Ae+3]=re}we+=at}return ne.buffer}(ve),he=j(de,S);for($=0;$<he.plte.length;$++)ie.push(he.plte[$].est.rgba);let pe=0;for($=0;$<K.length;$++){const Se=(ce=K[$]).img.length;var le=new Uint8Array(he.inds.buffer,pe>>2,Se>>2);se.push(le);const be=new Uint8Array(he.abuf,pe,Se);P&&i(ce.img,ce.rect.width,ce.rect.height,ie,be,le),ce.img.set(be),pe+=Se}}else for(G=0;G<K.length;G++){var ce=K[G];const ve=new Uint32Array(ce.img.buffer);var fe=ce.rect.width;for(V=ve.length,le=new Uint8Array(V),se.push(le),$=0;$<V;$++){const de=ve[$];if($!=0&&de==ve[$-1])le[$]=le[$-1];else if($>fe&&de==ve[$-fe])le[$]=le[$-fe];else{let he=ue[de];if(he==null&&(ue[de]=he=ie.length,ie.push(de),ie.length>=300))break;le[$]=he}}}const Oe=ie.length;for(Oe<=256&&l==0&&(L=Oe<=2?1:Oe<=4?2:Oe<=16?4:8,L=Math.max(L,f)),G=0;G<K.length;G++){(ce=K[G]).rect.x,ce.rect.y,fe=ce.rect.width;const ve=ce.rect.height;let de=ce.img;new Uint32Array(de.buffer);let he=4*fe,pe=4;if(Oe<=256&&l==0){he=Math.ceil(L*fe/8);var Te=new Uint8Array(he*ve);const Se=se[G];for(let be=0;be<ve;be++){$=be*he;const je=be*fe;if(L==8)for(var me=0;me<fe;me++)Te[$+me]=Se[je+me];else if(L==4)for(me=0;me<fe;me++)Te[$+(me>>1)]|=Se[je+me]<<4-4*(1&me);else if(L==2)for(me=0;me<fe;me++)Te[$+(me>>2)]|=Se[je+me]<<6-2*(3&me);else if(L==1)for(me=0;me<fe;me++)Te[$+(me>>3)]|=Se[je+me]<<7-1*(7&me)}de=Te,R=3,pe=1}else if(O==0&&K.length==1){Te=new Uint8Array(fe*ve*3);const Se=fe*ve;for($=0;$<Se;$++){const be=3*$,je=4*$;Te[be]=de[je],Te[be+1]=de[je+1],Te[be+2]=de[je+2]}de=Te,R=2,pe=3,he=3*fe}ce.img=de,ce.bpl=he,ce.bpp=pe}return{ctype:R,depth:L,plte:ie,frames:K}}function r(h,u,x,S,w,C,y){const _=Uint8Array,f=Uint32Array,l=new _(h[w-1]),P=new f(h[w-1]),R=w+1<h.length?new _(h[w+1]):null,L=new _(h[w]),q=new f(L.buffer);let G=u,V=x,$=-1,O=-1;for(let ue=0;ue<C.height;ue++)for(let ie=0;ie<C.width;ie++){const se=C.x+ie,le=C.y+ue,ce=le*u+se,fe=q[ce];fe==0||S[w-1].dispose==0&&P[ce]==fe&&(R==null||R[4*ce+3]!=0)||(se<G&&(G=se),se>$&&($=se),le<V&&(V=le),le>O&&(O=le))}$==-1&&(G=V=$=O=0),y&&((1&G)==1&&G--,(1&V)==1&&V--),C={x:G,y:V,width:$-G+1,height:O-V+1};const K=S[w];K.rect=C,K.blend=1,K.img=new Uint8Array(C.width*C.height*4),S[w-1].dispose==0?(m(l,u,x,K.img,C.width,C.height,-C.x,-C.y,0),s(L,u,x,K.img,C)):m(L,u,x,K.img,C.width,C.height,-C.x,-C.y,0)}function s(h,u,x,S,w){m(h,u,x,S,w.width,w.height,-w.x,-w.y,2)}function c(h,u,x,S,w,C,y){const _=[];let f,l=[0,1,2,3,4];C!=-1?l=[C]:(u*S>5e5||x==1)&&(l=[0]),y&&(f={level:0});const P=_r;for(var R=0;R<l.length;R++){for(let G=0;G<u;G++)p(w,h,G,S,x,l[R]);_.push(P.deflate(w,f))}let L,q=1e9;for(R=0;R<_.length;R++)_[R].length<q&&(L=R,q=_[R].length);return _[L]}function p(h,u,x,S,w,C){const y=x*S;let _=y+x;if(h[_]=C,_++,C==0)if(S<500)for(var f=0;f<S;f++)h[_+f]=u[y+f];else h.set(new Uint8Array(u.buffer,y,S),_);else if(C==1){for(f=0;f<w;f++)h[_+f]=u[y+f];for(f=w;f<S;f++)h[_+f]=u[y+f]-u[y+f-w]+256&255}else if(x==0){for(f=0;f<w;f++)h[_+f]=u[y+f];if(C==2)for(f=w;f<S;f++)h[_+f]=u[y+f];if(C==3)for(f=w;f<S;f++)h[_+f]=u[y+f]-(u[y+f-w]>>1)+256&255;if(C==4)for(f=w;f<S;f++)h[_+f]=u[y+f]-D(u[y+f-w],0,0)+256&255}else{if(C==2)for(f=0;f<S;f++)h[_+f]=u[y+f]+256-u[y+f-S]&255;if(C==3){for(f=0;f<w;f++)h[_+f]=u[y+f]+256-(u[y+f-S]>>1)&255;for(f=w;f<S;f++)h[_+f]=u[y+f]+256-(u[y+f-S]+u[y+f-w]>>1)&255}if(C==4){for(f=0;f<w;f++)h[_+f]=u[y+f]+256-D(0,u[y+f-S],0)&255;for(f=w;f<S;f++)h[_+f]=u[y+f]+256-D(u[y+f-w],u[y+f-S],u[y+f-w-S])&255}}}function j(h,u){const x=new Uint8Array(h),S=x.slice(0),w=new Uint32Array(S.buffer),C=k(S,u),y=C[0],_=C[1],f=x.length,l=new Uint8Array(f>>2);let P;if(x.length<2e7)for(var R=0;R<f;R+=4)P=E(y,L=x[R]*(1/255),q=x[R+1]*(1/255),G=x[R+2]*(1/255),V=x[R+3]*(1/255)),l[R>>2]=P.ind,w[R>>2]=P.est.rgba;else for(R=0;R<f;R+=4){var L=x[R]*.00392156862745098,q=x[R+1]*(1/255),G=x[R+2]*(1/255),V=x[R+3]*(1/255);for(P=y;P.left;)P=H(P.est,L,q,G,V)<=0?P.left:P.right;l[R>>2]=P.ind,w[R>>2]=P.est.rgba}return{abuf:S.buffer,inds:l,plte:_}}function k(h,u,x){x==null&&(x=1e-4);const S=new Uint32Array(h.buffer),w={i0:0,i1:h.length,bst:null,est:null,tdst:0,left:null,right:null};w.bst=z(h,w.i0,w.i1),w.est=A(w.bst);const C=[w];for(;C.length<u;){let _=0,f=0;for(var y=0;y<C.length;y++)C[y].est.L>_&&(_=C[y].est.L,f=y);if(_<x)break;const l=C[f],P=B(h,S,l.i0,l.i1,l.est.e,l.est.eMq255);if(l.i0>=P||l.i1<=P){l.est.L=0;continue}const R={i0:l.i0,i1:P,bst:null,est:null,tdst:0,left:null,right:null};R.bst=z(h,R.i0,R.i1),R.est=A(R.bst);const L={i0:P,i1:l.i1,bst:null,est:null,tdst:0,left:null,right:null};for(L.bst={R:[],m:[],N:l.bst.N-R.bst.N},y=0;y<16;y++)L.bst.R[y]=l.bst.R[y]-R.bst.R[y];for(y=0;y<4;y++)L.bst.m[y]=l.bst.m[y]-R.bst.m[y];L.est=A(L.bst),l.left=R,l.right=L,C[f]=R,C.push(L)}for(C.sort((_,f)=>f.bst.N-_.bst.N),y=0;y<C.length;y++)C[y].ind=y;return[w,C]}function E(h,u,x,S,w){if(h.left==null)return h.tdst=function(R,L,q,G,V){const $=L-R[0],O=q-R[1],K=G-R[2],ue=V-R[3];return $*$+O*O+K*K+ue*ue}(h.est.q,u,x,S,w),h;const C=H(h.est,u,x,S,w);let y=h.left,_=h.right;C>0&&(y=h.right,_=h.left);const f=E(y,u,x,S,w);if(f.tdst<=C*C)return f;const l=E(_,u,x,S,w);return l.tdst<f.tdst?l:f}function H(h,u,x,S,w){const{e:C}=h;return C[0]*u+C[1]*x+C[2]*S+C[3]*w-h.eMq}function B(h,u,x,S,w,C){for(S-=4;x<S;){for(;F(h,x,w)<=C;)x+=4;for(;F(h,S,w)>C;)S-=4;if(x>=S)break;const y=u[x>>2];u[x>>2]=u[S>>2],u[S>>2]=y,x+=4,S-=4}for(;F(h,x,w)>C;)x-=4;return x+4}function F(h,u,x){return h[u]*x[0]+h[u+1]*x[1]+h[u+2]*x[2]+h[u+3]*x[3]}function z(h,u,x){const S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=[0,0,0,0],C=x-u>>2;for(let y=u;y<x;y+=4){const _=h[y]*.00392156862745098,f=h[y+1]*(1/255),l=h[y+2]*(1/255),P=h[y+3]*(1/255);w[0]+=_,w[1]+=f,w[2]+=l,w[3]+=P,S[0]+=_*_,S[1]+=_*f,S[2]+=_*l,S[3]+=_*P,S[5]+=f*f,S[6]+=f*l,S[7]+=f*P,S[10]+=l*l,S[11]+=l*P,S[15]+=P*P}return S[4]=S[1],S[8]=S[2],S[9]=S[6],S[12]=S[3],S[13]=S[7],S[14]=S[11],{R:S,m:w,N:C}}function A(h){const{R:u}=h,{m:x}=h,{N:S}=h,w=x[0],C=x[1],y=x[2],_=x[3],f=S==0?0:1/S,l=[u[0]-w*w*f,u[1]-w*C*f,u[2]-w*y*f,u[3]-w*_*f,u[4]-C*w*f,u[5]-C*C*f,u[6]-C*y*f,u[7]-C*_*f,u[8]-y*w*f,u[9]-y*C*f,u[10]-y*y*f,u[11]-y*_*f,u[12]-_*w*f,u[13]-_*C*f,u[14]-_*y*f,u[15]-_*_*f],P=l,R=N;let L=[Math.random(),Math.random(),Math.random(),Math.random()],q=0,G=0;if(S!=0)for(let $=0;$<16&&(L=R.multVec(P,L),G=Math.sqrt(R.dot(L,L)),L=R.sml(1/G,L),!($!=0&&Math.abs(G-q)<1e-9));$++)q=G;const V=[w*f,C*f,y*f,_*f];return{Cov:l,q:V,e:L,L:q,eMq255:R.dot(R.sml(255,V),L),eMq:R.dot(L,V),rgba:(Math.round(255*V[3])<<24|Math.round(255*V[2])<<16|Math.round(255*V[1])<<8|Math.round(255*V[0])<<0)>>>0}}var N={multVec:(h,u)=>[h[0]*u[0]+h[1]*u[1]+h[2]*u[2]+h[3]*u[3],h[4]*u[0]+h[5]*u[1]+h[6]*u[2]+h[7]*u[3],h[8]*u[0]+h[9]*u[1]+h[10]*u[2]+h[11]*u[3],h[12]*u[0]+h[13]*u[1]+h[14]*u[2]+h[15]*u[3]],dot:(h,u)=>h[0]*u[0]+h[1]*u[1]+h[2]*u[2]+h[3]*u[3],sml:(h,u)=>[h*u[0],h*u[1],h*u[2],h*u[3]]};nt.encode=function(u,x,S,w,C,y,_){w==null&&(w=0),_==null&&(_=!1);const f=n(u,x,S,w,[!1,!1,!1,0,_,!1]);return T(f,-1),v(f,x,S,C,y)},nt.encodeLL=function(u,x,S,w,C,y,_,f){const l={ctype:0+(w==1?0:2)+(C==0?0:4),depth:y,frames:[]},P=(w+C)*y,R=P*x;for(let L=0;L<u.length;L++)l.frames.push({rect:{x:0,y:0,width:x,height:S},img:new Uint8Array(u[L]),blend:0,dispose:1,bpp:Math.ceil(P/8),bpl:Math.ceil(R/8)});return T(l,0,!0),v(l,x,S,_,f)},nt.encode.compress=n,nt.encode.dither=i,nt.quantize=j,nt.quantize.getKDtree=k,nt.quantize.getNearest=E})();const Fs={toArrayBuffer(m,b){const D=m.width,a=m.height,e=D<<2,t=m.getContext("2d").getImageData(0,0,D,a),d=new Uint32Array(t.data.buffer),i=(32*D+31)/32<<2,v=i*a,T=122+v,n=new ArrayBuffer(T),r=new DataView(n),s=1<<20;let c,p,j,k,E=s,H=0,B=0,F=0;function z(h){r.setUint16(B,h,!0),B+=2}function A(h){r.setUint32(B,h,!0),B+=4}function N(h){B+=h}z(19778),A(T),N(4),A(122),A(108),A(D),A(-a>>>0),z(1),z(32),A(3),A(v),A(2835),A(2835),N(8),A(16711680),A(65280),A(255),A(4278190080),A(1466527264),function h(){for(;H<a&&E>0;){for(k=122+H*i,c=0;c<e;)E--,p=d[F++],j=p>>>24,r.setUint32(k+c,p<<8|j),c+=4;H++}F<d.length?(E=s,setTimeout(h,Fs._dly)):b(n)}()},toBlob(m,b){this.toArrayBuffer(m,D=>{b(new Blob([D],{type:"image/bmp"}))})},_dly:9};var We={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},jr={[We.CHROME]:16384,[We.FIREFOX]:11180,[We.DESKTOP_SAFARI]:16384,[We.IE]:8192,[We.IOS]:4096,[We.ETC]:8192};const es=typeof window<"u",Os=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,pn=es&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Ir=(es||Os)&&(pn&&pn.getOriginalSymbol(window,"File")||typeof File<"u"&&File),ks=(es||Os)&&(pn&&pn.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function ts(m,b,D=Date.now()){return new Promise(a=>{const e=m.split(","),t=e[0].match(/:(.*?);/)[1],d=globalThis.atob(e[1]);let i=d.length;const v=new Uint8Array(i);for(;i--;)v[i]=d.charCodeAt(i);const T=new Blob([v],{type:t});T.name=b,T.lastModified=D,a(T)})}function Us(m){return new Promise((b,D)=>{const a=new ks;a.onload=()=>b(a.result),a.onerror=e=>D(e),a.readAsDataURL(m)})}function Ms(m){return new Promise((b,D)=>{const a=new Image;a.onload=()=>b(a),a.onerror=e=>D(e),a.src=m})}function xt(){if(xt.cachedResult!==void 0)return xt.cachedResult;let m=We.ETC;const{userAgent:b}=navigator;return/Chrom(e|ium)/i.test(b)?m=We.CHROME:/iP(ad|od|hone)/i.test(b)&&/WebKit/i.test(b)?m=We.IOS:/Safari/i.test(b)?m=We.DESKTOP_SAFARI:/Firefox/i.test(b)?m=We.FIREFOX:(/MSIE/i.test(b)||document.documentMode)&&(m=We.IE),xt.cachedResult=m,xt.cachedResult}function Ns(m,b){const D=xt(),a=jr[D];let e=m,t=b,d=e*t;const i=e>t?t/e:e/t;for(;d>a*a;){const v=(a+e)/2,T=(a+t)/2;v<T?(t=T,e=T*i):(t=v*i,e=v),d=e*t}return{width:e,height:t}}function yn(m,b){let D,a;try{if(D=new OffscreenCanvas(m,b),a=D.getContext("2d"),a===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{D=document.createElement("canvas"),a=D.getContext("2d")}return D.width=m,D.height=b,[D,a]}function Ls(m,b){const{width:D,height:a}=Ns(m.width,m.height),[e,t]=yn(D,a);return b&&/jpe?g/.test(b)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(m,0,0,e.width,e.height),e}function dn(){return dn.cachedResult!==void 0||(dn.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),dn.cachedResult}function bn(m,b={}){return new Promise(function(D,a){let e,t;var d=function(){try{return t=Ls(e,b.fileType||m.type),D([e,t])}catch(v){return a(v)}},i=function(v){try{var T=function(n){try{throw n}catch(r){return a(r)}};try{let n;return Us(m).then(function(r){try{return n=r,Ms(n).then(function(s){try{return e=s,function(){try{return d()}catch(c){return a(c)}}()}catch(c){return T(c)}},T)}catch(s){return T(s)}},T)}catch(n){T(n)}}catch(n){return a(n)}};try{if(dn()||[We.DESKTOP_SAFARI,We.MOBILE_SAFARI].includes(xt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(m).then(function(v){try{return e=v,d()}catch{return i()}},i)}catch{i()}})}function xn(m,b,D,a,e=1){return new Promise(function(t,d){let i;if(b==="image/png"){let T,n,r;return T=m.getContext("2d"),{data:n}=T.getImageData(0,0,m.width,m.height),r=nt.encode([n.buffer],m.width,m.height,4096*e),i=new Blob([r],{type:b}),i.name=D,i.lastModified=a,v.call(this)}{let T=function(){return v.call(this)};if(b==="image/bmp")return new Promise(n=>Fs.toBlob(m,n)).then((function(n){try{return i=n,i.name=D,i.lastModified=a,T.call(this)}catch(r){return d(r)}}).bind(this),d);{let n=function(){return T.call(this)};if(typeof OffscreenCanvas=="function"&&m instanceof OffscreenCanvas)return m.convertToBlob({type:b,quality:e}).then((function(r){try{return i=r,i.name=D,i.lastModified=a,n.call(this)}catch(s){return d(s)}}).bind(this),d);{let r;return r=m.toDataURL(b,e),ts(r,D,a).then((function(s){try{return i=s,n.call(this)}catch(c){return d(c)}}).bind(this),d)}}}function v(){return t(i)}})}function it(m){m.width=0,m.height=0}function jt(){return new Promise(function(m,b){let D,a,e,t;return jt.cachedResult!==void 0?m(jt.cachedResult):ts("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(d){try{return D=d,bn(D).then(function(i){try{return a=i[1],xn(a,D.type,D.name,D.lastModified).then(function(v){try{return e=v,it(a),bn(e).then(function(T){try{return t=T[0],jt.cachedResult=t.width===1&&t.height===2,m(jt.cachedResult)}catch(n){return b(n)}},b)}catch(T){return b(T)}},b)}catch(v){return b(v)}},b)}catch(i){return b(i)}},b)})}function Ps(m){return new Promise((b,D)=>{const a=new ks;a.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return b(-2);const d=t.byteLength;let i=2;for(;i<d;){if(t.getUint16(i+2,!1)<=8)return b(-1);const v=t.getUint16(i,!1);if(i+=2,v==65505){if(t.getUint32(i+=2,!1)!=1165519206)return b(-1);const T=t.getUint16(i+=6,!1)==18761;i+=t.getUint32(i+4,T);const n=t.getUint16(i,T);i+=2;for(let r=0;r<n;r++)if(t.getUint16(i+12*r,T)==274)return b(t.getUint16(i+12*r+8,T))}else{if((65280&v)!=65280)break;i+=t.getUint16(i,!1)}}return b(-1)},a.onerror=e=>D(e),a.readAsArrayBuffer(m)})}function Bs(m,b){const{width:D}=m,{height:a}=m,{maxWidthOrHeight:e}=b;let t,d=m;return isFinite(e)&&(D>e||a>e)&&([d,t]=yn(D,a),D>a?(d.width=e,d.height=a/D*e):(d.width=D/a*e,d.height=e),t.drawImage(m,0,0,d.width,d.height),it(m)),d}function Hs(m,b){const{width:D}=m,{height:a}=m,[e,t]=yn(D,a);switch(b>4&&b<9?(e.width=a,e.height=D):(e.width=D,e.height=a),b){case 2:t.transform(-1,0,0,1,D,0);break;case 3:t.transform(-1,0,0,-1,D,a);break;case 4:t.transform(1,0,0,-1,0,a);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,a,0);break;case 7:t.transform(0,-1,-1,0,a,D);break;case 8:t.transform(0,-1,1,0,0,D)}return t.drawImage(m,0,0,D,a),it(m),e}function rs(m,b,D=0){return new Promise(function(a,e){let t,d,i,v,T,n,r,s,c,p,j,k,E,H,B,F,z,A,N,h;function u(S=5){if(b.signal&&b.signal.aborted)throw b.signal.reason;t+=S,b.onProgress(Math.min(t,100))}function x(S){if(b.signal&&b.signal.aborted)throw b.signal.reason;t=Math.min(Math.max(S,t),100),b.onProgress(t)}return t=D,d=b.maxIteration||10,i=1024*b.maxSizeMB*1024,u(),bn(m,b).then((function(S){try{return[,v]=S,u(),T=Bs(v,b),u(),new Promise(function(w,C){var y;if(!(y=b.exifOrientation))return Ps(m).then((function(f){try{return y=f,_.call(this)}catch(l){return C(l)}}).bind(this),C);function _(){return w(y)}return _.call(this)}).then((function(w){try{return n=w,u(),jt().then((function(C){try{return r=C?T:Hs(T,n),u(),s=b.initialQuality||1,c=b.fileType||m.type,xn(r,c,m.name,m.lastModified,s).then((function(y){try{{let f=function(){if(d--&&(B>i||B>E)){let P,R;return P=h?.95*N.width:N.width,R=h?.95*N.height:N.height,[z,A]=yn(P,R),A.drawImage(N,0,0,P,R),s*=c==="image/png"?.85:.95,xn(z,c,m.name,m.lastModified,s).then(function(L){try{return F=L,it(N),N=z,B=F.size,x(Math.min(99,Math.floor((H-B)/(H-i)*100))),f}catch(q){return e(q)}},e)}return[1]},l=function(){return it(N),it(z),it(T),it(r),it(v),x(100),a(F)};if(p=y,u(),j=p.size>i,k=p.size>m.size,!j&&!k)return x(100),a(p);var _;return E=m.size,H=p.size,B=H,N=r,h=!b.alwaysKeepResolution&&j,(_=(function(P){for(;P;){if(P.then)return void P.then(_,e);try{if(P.pop){if(P.length)return P.pop()?l.call(this):P;P=f}else P=P.call(this)}catch(R){return e(R)}}}).bind(this))(f)}}catch(f){return e(f)}}).bind(this),e)}catch(y){return e(y)}}).bind(this),e)}catch(C){return e(C)}}).bind(this),e)}catch(w){return e(w)}}).bind(this),e)})}const Rr=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let _n;function Dr(m,b){return new Promise((D,a)=>{_n||(_n=function(d){const i=[];return i.push(d),URL.createObjectURL(new Blob(i))}(Rr));const e=new Worker(_n);e.addEventListener("message",function(d){if(b.signal&&b.signal.aborted)e.terminate();else if(d.data.progress===void 0){if(d.data.error)return a(new Error(d.data.error)),void e.terminate();D(d.data.file),e.terminate()}else b.onProgress(d.data.progress)}),e.addEventListener("error",a),b.signal&&b.signal.addEventListener("abort",()=>{a(b.signal.reason),e.terminate()}),e.postMessage({file:m,imageCompressionLibUrl:b.libURL,options:{...b,onProgress:void 0,signal:void 0}})})}function Ne(m,b){return new Promise(function(D,a){let e,t,d,i,v,T;if(e={...b},d=0,{onProgress:i}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,v=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=c=>{d=c,typeof i=="function"&&i(d)},!(m instanceof Blob||m instanceof Ir))return a(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(m.type))return a(new Error("The file given is not an image"));if(T=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!v||typeof Worker!="function"||T)return rs(m,e).then((function(c){try{return t=c,s.call(this)}catch(p){return a(p)}}).bind(this),a);var n=(function(){try{return s.call(this)}catch(c){return a(c)}}).bind(this),r=function(c){try{return rs(m,e).then(function(p){try{return t=p,n()}catch(j){return a(j)}},a)}catch(p){return a(p)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Dr(m,e).then(function(c){try{return t=c,n()}catch{return r()}},r)}catch{r()}function s(){try{t.name=m.name,t.lastModified=m.lastModified}catch{}try{e.preserveExif&&m.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===m.type)&&(t=Ds(m,t))}catch{}return D(t)}})}Ne.getDataUrlFromFile=Us,Ne.getFilefromDataUrl=ts,Ne.loadImage=Ms,Ne.drawImageInCanvas=Ls,Ne.drawFileInCanvas=bn,Ne.canvasToFile=xn,Ne.getExifOrientation=Ps,Ne.handleMaxWidthOrHeight=Bs,Ne.followExifOrientation=Hs,Ne.cleanupCanvasMemory=it,Ne.isAutoOrientationInBrowser=jt,Ne.approximateBelowMaximumCanvasSizeOfBrowser=Ns,Ne.copyExifWithoutOrientation=Ds,Ne.getBrowserName=xt,Ne.version="2.0.2";var jn,is;function zs(){if(is)return jn;is=1;function m(b){var D=typeof b;return b!=null&&(D=="object"||D=="function")}return jn=m,jn}var In,os;function Fr(){if(os)return In;os=1;var m=typeof rn=="object"&&rn&&rn.Object===Object&&rn;return In=m,In}var Rn,as;function Ws(){if(as)return Rn;as=1;var m=Fr(),b=typeof self=="object"&&self&&self.Object===Object&&self,D=m||b||Function("return this")();return Rn=D,Rn}var Dn,ls;function Or(){if(ls)return Dn;ls=1;var m=Ws(),b=function(){return m.Date.now()};return Dn=b,Dn}var Fn,cs;function kr(){if(cs)return Fn;cs=1;var m=/\s/;function b(D){for(var a=D.length;a--&&m.test(D.charAt(a)););return a}return Fn=b,Fn}var On,ds;function Ur(){if(ds)return On;ds=1;var m=kr(),b=/^\s+/;function D(a){return a&&a.slice(0,m(a)+1).replace(b,"")}return On=D,On}var kn,us;function Gs(){if(us)return kn;us=1;var m=Ws(),b=m.Symbol;return kn=b,kn}var Un,fs;function Mr(){if(fs)return Un;fs=1;var m=Gs(),b=Object.prototype,D=b.hasOwnProperty,a=b.toString,e=m?m.toStringTag:void 0;function t(d){var i=D.call(d,e),v=d[e];try{d[e]=void 0;var T=!0}catch{}var n=a.call(d);return T&&(i?d[e]=v:delete d[e]),n}return Un=t,Un}var Mn,hs;function Nr(){if(hs)return Mn;hs=1;var m=Object.prototype,b=m.toString;function D(a){return b.call(a)}return Mn=D,Mn}var Nn,ms;function Lr(){if(ms)return Nn;ms=1;var m=Gs(),b=Mr(),D=Nr(),a="[object Null]",e="[object Undefined]",t=m?m.toStringTag:void 0;function d(i){return i==null?i===void 0?e:a:t&&t in Object(i)?b(i):D(i)}return Nn=d,Nn}var Ln,gs;function Pr(){if(gs)return Ln;gs=1;function m(b){return b!=null&&typeof b=="object"}return Ln=m,Ln}var Pn,ps;function Br(){if(ps)return Pn;ps=1;var m=Lr(),b=Pr(),D="[object Symbol]";function a(e){return typeof e=="symbol"||b(e)&&m(e)==D}return Pn=a,Pn}var Bn,bs;function Hr(){if(bs)return Bn;bs=1;var m=Ur(),b=zs(),D=Br(),a=NaN,e=/^[-+]0x[0-9a-f]+$/i,t=/^0b[01]+$/i,d=/^0o[0-7]+$/i,i=parseInt;function v(T){if(typeof T=="number")return T;if(D(T))return a;if(b(T)){var n=typeof T.valueOf=="function"?T.valueOf():T;T=b(n)?n+"":n}if(typeof T!="string")return T===0?T:+T;T=m(T);var r=t.test(T);return r||d.test(T)?i(T.slice(2),r?2:8):e.test(T)?a:+T}return Bn=v,Bn}var Hn,xs;function zr(){if(xs)return Hn;xs=1;var m=zs(),b=Or(),D=Hr(),a="Expected a function",e=Math.max,t=Math.min;function d(i,v,T){var n,r,s,c,p,j,k=0,E=!1,H=!1,B=!0;if(typeof i!="function")throw new TypeError(a);v=D(v)||0,m(T)&&(E=!!T.leading,H="maxWait"in T,s=H?e(D(T.maxWait)||0,v):s,B="trailing"in T?!!T.trailing:B);function F(C){var y=n,_=r;return n=r=void 0,k=C,c=i.apply(_,y),c}function z(C){return k=C,p=setTimeout(h,v),E?F(C):c}function A(C){var y=C-j,_=C-k,f=v-y;return H?t(f,s-_):f}function N(C){var y=C-j,_=C-k;return j===void 0||y>=v||y<0||H&&_>=s}function h(){var C=b();if(N(C))return u(C);p=setTimeout(h,A(C))}function u(C){return p=void 0,B&&n?F(C):(n=r=void 0,c)}function x(){p!==void 0&&clearTimeout(p),k=0,n=j=r=p=void 0}function S(){return p===void 0?c:u(b())}function w(){var C=b(),y=N(C);if(n=arguments,r=this,j=C,y){if(p===void 0)return z(j);if(H)return clearTimeout(p),p=setTimeout(h,v),F(j)}return p===void 0&&(p=setTimeout(h,v)),c}return w.cancel=x,w.flush=S,w}return Hn=d,Hn}var Wr=zr();const Gr=dr(Wr),qr=Tt([o.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),o.jsx("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn"),$r=Tt(o.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut"),Yr=Tt(o.jsx("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen"),Vr=Tt([o.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),o.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera"),Ft=W.forwardRef(({path:m,initialImages:b=[],onImagesUpdated:D,onDelete:a,isOwnDesign:e},t)=>{const[d,i]=W.useState(b.map(l=>({...l,deleted:!1}))),[v,T]=W.useState(!1),[n,r]=W.useState(0),[s,c]=W.useState(!1),[p,j]=W.useState(null),[k,E]=W.useState(1),[H,B]=W.useState(!1),[F,z]=W.useState(!1),[A,N]=W.useState(""),[h,u]=W.useState("info"),x=W.useRef(null);W.useEffect(()=>{console.log("Initial images received:",b),i(b.map(l=>({...l,deleted:!!l.deleted})))},[b]);const S=async l=>{const P=Array.from(l.target.files||[]);T(!0);const R={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},L=P.map(async(q,G)=>{let V=q;q.size>1024*1024&&(V=await Ne(q,R),N("Your image was compressed before uploading due to file size larger than 1 MB."),u("info"),z(!0));const O=`${new Date().getTime()}-${V.name}`,K=It(),ue=Rt(K,`${m}/${O}`),ie=Is(ue,V);return new Promise((se,le)=>{ie.on("state_changed",ce=>{const fe=ce.bytesTransferred/ce.totalBytes*100;r(fe)},ce=>{console.error("Upload failed:",ce),le(ce)},()=>{Rs(ie.snapshot.ref).then(ce=>{se({url:ce,path:ue.fullPath,title:""})})})})});Promise.all(L).then(q=>{const G=[...d,...q];i(G),D&&D(G),N("Images uploaded successfully."),u("success"),z(!0),T(!1),r(0),x.current&&(x.current.value="")}).catch(q=>{console.error("Error uploading images: ",q),N("Failed to upload images."),u("error"),z(!0),T(!1),r(0)})},w=l=>{i(P=>{const R=P.map((L,q)=>q===l?{...L,deleted:!0}:L);return D(R),R}),N("Image marked for deletion. Update to permanently delete."),u("info"),z(!0)},C=async()=>{const l=d.filter(P=>P.deleted);if(console.log("Attempting to delete images:",l),l.length>0){const P=l.map(R=>{const L=It(),q=Rt(L,R.path);return cn(q)});try{await Promise.all(P),a(l),i(R=>R.filter(L=>!L.deleted)),N("Deleted images have been permanently removed."),u("success")}catch(R){console.error("Error committing deletions:",R),N("Failed to commit deletions."),u("error")}z(!0)}else console.log("No images marked for deletion.")},y=l=>{B(!H),j(l)};W.useEffect(()=>{const l=()=>{const P=!!document.fullscreenElement;B(P)};return document.addEventListener("fullscreenchange",l),()=>document.removeEventListener("fullscreenchange",l)},[]);const _=(l,P)=>{P!=="clickaway"&&z(!1)},f=W.useCallback(Gr((l,P)=>{setTimeout(()=>{i(R=>{const L=R.map((q,G)=>G===l?{...q,title:P}:q);return D&&D(L),L})},0)},30),[D]);return W.useImperativeHandle(t,()=>({commitDeletions:C})),o.jsxs("div",{children:[e&&o.jsx(fn,{title:"Upload Images",children:o.jsxs(Be,{variant:"outlined",component:"label",startIcon:o.jsx(Vr,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",o.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:S,disabled:v,ref:x,accept:"image/*"})]})}),v&&o.jsxs(o.Fragment,{children:[o.jsxs("p",{children:["Uploading... ",Math.round(n),"%"]}),o.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:o.jsx("div",{style:{height:"20px",width:`${n}%`,backgroundColor:"green"}})})]}),d.filter(l=>!l.deleted).map((l,P)=>o.jsxs("div",{children:[o.jsx("img",{src:l.url,alt:`Uploaded design ${P}`,onClick:()=>{c(!0),j(P)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&o.jsx(Xe,{onClick:()=>w(P),children:o.jsx(Vt,{})}),o.jsx("textarea",{value:l.title,onChange:R=>f(P,R.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},P)),o.jsx(yt,{open:s,onClose:()=>c(!1),fullScreen:H,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:H?"none":void 0,maxHeight:H?"none":void 0,height:H?"100%":void 0,width:H?"100%":void 0,overflowY:"auto"}},children:p!==null&&o.jsxs(vt,{children:[o.jsx("div",{style:{textAlign:"center"},children:o.jsx("img",{src:d[p].url,alt:`Zoomed Design ${p}`,style:{maxWidth:"100%",maxHeight:H?"100vh":void 0,transform:`scale(${k})`,transition:"transform 0.2s ease-out"}})}),o.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[o.jsx(Xe,{onClick:()=>E(k*1.2),children:o.jsx(qr,{})}),o.jsx(Xe,{onClick:()=>E(k/1.2),style:{marginLeft:"10px"},children:o.jsx($r,{})}),o.jsx(Xe,{onClick:()=>y(p),style:{marginLeft:"10px"},children:o.jsx(Yr,{})}),H&&o.jsx(Xe,{onClick:()=>y(p),style:{position:"absolute",top:20,right:20},children:o.jsx(ur,{})})]})]})}),o.jsx(At,{open:F,autoHideDuration:6e3,onClose:_,children:o.jsx(St,{onClose:_,severity:h,sx:{width:"100%"},children:A})})]})});/*! @license DOMPurify 3.2.3 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.3/LICENSE */const{entries:qs,setPrototypeOf:ys,isFrozen:Qr,getPrototypeOf:Xr,getOwnPropertyDescriptor:Kr}=Object;let{freeze:He,seal:Ke,create:$s}=Object,{apply:Xn,construct:Kn}=typeof Reflect<"u"&&Reflect;He||(He=function(b){return b});Ke||(Ke=function(b){return b});Xn||(Xn=function(b,D,a){return b.apply(D,a)});Kn||(Kn=function(b,D){return new b(...D)});const on=Ge(Array.prototype.forEach),vs=Ge(Array.prototype.pop),zt=Ge(Array.prototype.push),un=Ge(String.prototype.toLowerCase),zn=Ge(String.prototype.toString),Ts=Ge(String.prototype.match),Wt=Ge(String.prototype.replace),Zr=Ge(String.prototype.indexOf),Jr=Ge(String.prototype.trim),st=Ge(Object.prototype.hasOwnProperty),Pe=Ge(RegExp.prototype.test),Gt=ei(TypeError);function Ge(m){return function(b){for(var D=arguments.length,a=new Array(D>1?D-1:0),e=1;e<D;e++)a[e-1]=arguments[e];return Xn(m,b,a)}}function ei(m){return function(){for(var b=arguments.length,D=new Array(b),a=0;a<b;a++)D[a]=arguments[a];return Kn(m,D)}}function oe(m,b){let D=arguments.length>2&&arguments[2]!==void 0?arguments[2]:un;ys&&ys(m,null);let a=b.length;for(;a--;){let e=b[a];if(typeof e=="string"){const t=D(e);t!==e&&(Qr(b)||(b[a]=t),e=t)}m[e]=!0}return m}function ti(m){for(let b=0;b<m.length;b++)st(m,b)||(m[b]=null);return m}function bt(m){const b=$s(null);for(const[D,a]of qs(m))st(m,D)&&(Array.isArray(a)?b[D]=ti(a):a&&typeof a=="object"&&a.constructor===Object?b[D]=bt(a):b[D]=a);return b}function qt(m,b){for(;m!==null;){const a=Kr(m,b);if(a){if(a.get)return Ge(a.get);if(typeof a.value=="function")return Ge(a.value)}m=Xr(m)}function D(){return null}return D}const As=He(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Wn=He(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Gn=He(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ni=He(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),qn=He(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),si=He(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ss=He(["#text"]),ws=He(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),$n=He(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Cs=He(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),an=He(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),ri=Ke(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ii=Ke(/<%[\w\W]*|[\w\W]*%>/gm),oi=Ke(/\$\{[\w\W]*}/gm),ai=Ke(/^data-[\-\w.\u00B7-\uFFFF]+$/),li=Ke(/^aria-[\-\w]+$/),Ys=Ke(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ci=Ke(/^(?:\w+script|data):/i),di=Ke(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Vs=Ke(/^html$/i),ui=Ke(/^[a-z][.\w]*(-[.\w]+)+$/i);var Es=Object.freeze({__proto__:null,ARIA_ATTR:li,ATTR_WHITESPACE:di,CUSTOM_ELEMENT:ui,DATA_ATTR:ai,DOCTYPE_NAME:Vs,ERB_EXPR:ii,IS_ALLOWED_URI:Ys,IS_SCRIPT_OR_DATA:ci,MUSTACHE_EXPR:ri,TMPLIT_EXPR:oi});const $t={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},fi=function(){return typeof window>"u"?null:window},hi=function(b,D){if(typeof b!="object"||typeof b.createPolicy!="function")return null;let a=null;const e="data-tt-policy-suffix";D&&D.hasAttribute(e)&&(a=D.getAttribute(e));const t="dompurify"+(a?"#"+a:"");try{return b.createPolicy(t,{createHTML(d){return d},createScriptURL(d){return d}})}catch{return console.warn("TrustedTypes policy "+t+" could not be created."),null}},_s=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Qs(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:fi();const b=J=>Qs(J);if(b.version="3.2.3",b.removed=[],!m||!m.document||m.document.nodeType!==$t.document)return b.isSupported=!1,b;let{document:D}=m;const a=D,e=a.currentScript,{DocumentFragment:t,HTMLTemplateElement:d,Node:i,Element:v,NodeFilter:T,NamedNodeMap:n=m.NamedNodeMap||m.MozNamedAttrMap,HTMLFormElement:r,DOMParser:s,trustedTypes:c}=m,p=v.prototype,j=qt(p,"cloneNode"),k=qt(p,"remove"),E=qt(p,"nextSibling"),H=qt(p,"childNodes"),B=qt(p,"parentNode");if(typeof d=="function"){const J=D.createElement("template");J.content&&J.content.ownerDocument&&(D=J.content.ownerDocument)}let F,z="";const{implementation:A,createNodeIterator:N,createDocumentFragment:h,getElementsByTagName:u}=D,{importNode:x}=a;let S=_s();b.isSupported=typeof qs=="function"&&typeof B=="function"&&A&&A.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:w,ERB_EXPR:C,TMPLIT_EXPR:y,DATA_ATTR:_,ARIA_ATTR:f,IS_SCRIPT_OR_DATA:l,ATTR_WHITESPACE:P,CUSTOM_ELEMENT:R}=Es;let{IS_ALLOWED_URI:L}=Es,q=null;const G=oe({},[...As,...Wn,...Gn,...qn,...Ss]);let V=null;const $=oe({},[...ws,...$n,...Cs,...an]);let O=Object.seal($s(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),K=null,ue=null,ie=!0,se=!0,le=!1,ce=!0,fe=!1,Oe=!0,Te=!1,me=!1,ve=!1,de=!1,he=!1,pe=!1,Se=!0,be=!1;const je="user-content-";let xe=!0,ne=!1,we={},Ce=null;const at=oe({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ae=null;const qe=oe({},["audio","video","img","source","image","track"]);let te=null;const ke=oe({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),re="http://www.w3.org/1998/Math/MathML",Ue="http://www.w3.org/2000/svg",ee="http://www.w3.org/1999/xhtml";let _e=ee,Ie=!1,ht=null;const mt=oe({},[re,Ue,ee],zn);let lt=oe({},["mi","mo","mn","ms","mtext"]),$e=oe({},["annotation-xml"]);const Mt=oe({},["title","style","font","a","script"]);let Me=null;const Ye=["application/xhtml+xml","text/html"],Ze="text/html";let ge=null,Je=null;const et=D.createElement("form"),Ve=function(I){return I instanceof RegExp||I instanceof Function},wt=function(){let I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Je&&Je===I)){if((!I||typeof I!="object")&&(I={}),I=bt(I),Me=Ye.indexOf(I.PARSER_MEDIA_TYPE)===-1?Ze:I.PARSER_MEDIA_TYPE,ge=Me==="application/xhtml+xml"?zn:un,q=st(I,"ALLOWED_TAGS")?oe({},I.ALLOWED_TAGS,ge):G,V=st(I,"ALLOWED_ATTR")?oe({},I.ALLOWED_ATTR,ge):$,ht=st(I,"ALLOWED_NAMESPACES")?oe({},I.ALLOWED_NAMESPACES,zn):mt,te=st(I,"ADD_URI_SAFE_ATTR")?oe(bt(ke),I.ADD_URI_SAFE_ATTR,ge):ke,Ae=st(I,"ADD_DATA_URI_TAGS")?oe(bt(qe),I.ADD_DATA_URI_TAGS,ge):qe,Ce=st(I,"FORBID_CONTENTS")?oe({},I.FORBID_CONTENTS,ge):at,K=st(I,"FORBID_TAGS")?oe({},I.FORBID_TAGS,ge):{},ue=st(I,"FORBID_ATTR")?oe({},I.FORBID_ATTR,ge):{},we=st(I,"USE_PROFILES")?I.USE_PROFILES:!1,ie=I.ALLOW_ARIA_ATTR!==!1,se=I.ALLOW_DATA_ATTR!==!1,le=I.ALLOW_UNKNOWN_PROTOCOLS||!1,ce=I.ALLOW_SELF_CLOSE_IN_ATTR!==!1,fe=I.SAFE_FOR_TEMPLATES||!1,Oe=I.SAFE_FOR_XML!==!1,Te=I.WHOLE_DOCUMENT||!1,de=I.RETURN_DOM||!1,he=I.RETURN_DOM_FRAGMENT||!1,pe=I.RETURN_TRUSTED_TYPE||!1,ve=I.FORCE_BODY||!1,Se=I.SANITIZE_DOM!==!1,be=I.SANITIZE_NAMED_PROPS||!1,xe=I.KEEP_CONTENT!==!1,ne=I.IN_PLACE||!1,L=I.ALLOWED_URI_REGEXP||Ys,_e=I.NAMESPACE||ee,lt=I.MATHML_TEXT_INTEGRATION_POINTS||lt,$e=I.HTML_INTEGRATION_POINTS||$e,O=I.CUSTOM_ELEMENT_HANDLING||{},I.CUSTOM_ELEMENT_HANDLING&&Ve(I.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(O.tagNameCheck=I.CUSTOM_ELEMENT_HANDLING.tagNameCheck),I.CUSTOM_ELEMENT_HANDLING&&Ve(I.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(O.attributeNameCheck=I.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),I.CUSTOM_ELEMENT_HANDLING&&typeof I.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(O.allowCustomizedBuiltInElements=I.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),fe&&(se=!1),he&&(de=!0),we&&(q=oe({},Ss),V=[],we.html===!0&&(oe(q,As),oe(V,ws)),we.svg===!0&&(oe(q,Wn),oe(V,$n),oe(V,an)),we.svgFilters===!0&&(oe(q,Gn),oe(V,$n),oe(V,an)),we.mathMl===!0&&(oe(q,qn),oe(V,Cs),oe(V,an))),I.ADD_TAGS&&(q===G&&(q=bt(q)),oe(q,I.ADD_TAGS,ge)),I.ADD_ATTR&&(V===$&&(V=bt(V)),oe(V,I.ADD_ATTR,ge)),I.ADD_URI_SAFE_ATTR&&oe(te,I.ADD_URI_SAFE_ATTR,ge),I.FORBID_CONTENTS&&(Ce===at&&(Ce=bt(Ce)),oe(Ce,I.FORBID_CONTENTS,ge)),xe&&(q["#text"]=!0),Te&&oe(q,["html","head","body"]),q.table&&(oe(q,["tbody"]),delete K.tbody),I.TRUSTED_TYPES_POLICY){if(typeof I.TRUSTED_TYPES_POLICY.createHTML!="function")throw Gt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof I.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Gt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');F=I.TRUSTED_TYPES_POLICY,z=F.createHTML("")}else F===void 0&&(F=hi(c,e)),F!==null&&typeof z=="string"&&(z=F.createHTML(""));He&&He(I),Je=I}},Nt=oe({},[...Wn,...Gn,...ni]),Zt=oe({},[...qn,...si]),vn=function(I){let g=B(I);(!g||!g.tagName)&&(g={namespaceURI:_e,tagName:"template"});const U=un(I.tagName),M=un(g.tagName);return ht[I.namespaceURI]?I.namespaceURI===Ue?g.namespaceURI===ee?U==="svg":g.namespaceURI===re?U==="svg"&&(M==="annotation-xml"||lt[M]):!!Nt[U]:I.namespaceURI===re?g.namespaceURI===ee?U==="math":g.namespaceURI===Ue?U==="math"&&$e[M]:!!Zt[U]:I.namespaceURI===ee?g.namespaceURI===Ue&&!$e[M]||g.namespaceURI===re&&!lt[M]?!1:!Zt[U]&&(Mt[U]||!Nt[U]):!!(Me==="application/xhtml+xml"&&ht[I.namespaceURI]):!1},Qe=function(I){zt(b.removed,{element:I});try{B(I).removeChild(I)}catch{k(I)}},gt=function(I,g){try{zt(b.removed,{attribute:g.getAttributeNode(I),from:g})}catch{zt(b.removed,{attribute:null,from:g})}if(g.removeAttribute(I),I==="is")if(de||he)try{Qe(g)}catch{}else try{g.setAttribute(I,"")}catch{}},Jt=function(I){let g=null,U=null;if(ve)I="<remove></remove>"+I;else{const Y=Ts(I,/^[\r\n\t ]+/);U=Y&&Y[0]}Me==="application/xhtml+xml"&&_e===ee&&(I='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+I+"</body></html>");const M=F?F.createHTML(I):I;if(_e===ee)try{g=new s().parseFromString(M,Me)}catch{}if(!g||!g.documentElement){g=A.createDocument(_e,"template",null);try{g.documentElement.innerHTML=Ie?z:M}catch{}}const Q=g.body||g.documentElement;return I&&U&&Q.insertBefore(D.createTextNode(U),Q.childNodes[0]||null),_e===ee?u.call(g,Te?"html":"body")[0]:Te?g.documentElement:Q},en=function(I){return N.call(I.ownerDocument||I,I,T.SHOW_ELEMENT|T.SHOW_COMMENT|T.SHOW_TEXT|T.SHOW_PROCESSING_INSTRUCTION|T.SHOW_CDATA_SECTION,null)},Lt=function(I){return I instanceof r&&(typeof I.nodeName!="string"||typeof I.textContent!="string"||typeof I.removeChild!="function"||!(I.attributes instanceof n)||typeof I.removeAttribute!="function"||typeof I.setAttribute!="function"||typeof I.namespaceURI!="string"||typeof I.insertBefore!="function"||typeof I.hasChildNodes!="function")},pt=function(I){return typeof i=="function"&&I instanceof i};function tt(J,I,g){on(J,U=>{U.call(b,I,g,Je)})}const Pt=function(I){let g=null;if(tt(S.beforeSanitizeElements,I,null),Lt(I))return Qe(I),!0;const U=ge(I.nodeName);if(tt(S.uponSanitizeElement,I,{tagName:U,allowedTags:q}),I.hasChildNodes()&&!pt(I.firstElementChild)&&Pe(/<[/\w]/g,I.innerHTML)&&Pe(/<[/\w]/g,I.textContent)||I.nodeType===$t.progressingInstruction||Oe&&I.nodeType===$t.comment&&Pe(/<[/\w]/g,I.data))return Qe(I),!0;if(!q[U]||K[U]){if(!K[U]&&tn(U)&&(O.tagNameCheck instanceof RegExp&&Pe(O.tagNameCheck,U)||O.tagNameCheck instanceof Function&&O.tagNameCheck(U)))return!1;if(xe&&!Ce[U]){const M=B(I)||I.parentNode,Q=H(I)||I.childNodes;if(Q&&M){const Y=Q.length;for(let Z=Y-1;Z>=0;--Z){const X=j(Q[Z],!0);X.__removalCount=(I.__removalCount||0)+1,M.insertBefore(X,E(I))}}}return Qe(I),!0}return I instanceof v&&!vn(I)||(U==="noscript"||U==="noembed"||U==="noframes")&&Pe(/<\/no(script|embed|frames)/i,I.innerHTML)?(Qe(I),!0):(fe&&I.nodeType===$t.text&&(g=I.textContent,on([w,C,y],M=>{g=Wt(g,M," ")}),I.textContent!==g&&(zt(b.removed,{element:I.cloneNode()}),I.textContent=g)),tt(S.afterSanitizeElements,I,null),!1)},Bt=function(I,g,U){if(Se&&(g==="id"||g==="name")&&(U in D||U in et))return!1;if(!(se&&!ue[g]&&Pe(_,g))){if(!(ie&&Pe(f,g))){if(!V[g]||ue[g]){if(!(tn(I)&&(O.tagNameCheck instanceof RegExp&&Pe(O.tagNameCheck,I)||O.tagNameCheck instanceof Function&&O.tagNameCheck(I))&&(O.attributeNameCheck instanceof RegExp&&Pe(O.attributeNameCheck,g)||O.attributeNameCheck instanceof Function&&O.attributeNameCheck(g))||g==="is"&&O.allowCustomizedBuiltInElements&&(O.tagNameCheck instanceof RegExp&&Pe(O.tagNameCheck,U)||O.tagNameCheck instanceof Function&&O.tagNameCheck(U))))return!1}else if(!te[g]){if(!Pe(L,Wt(U,P,""))){if(!((g==="src"||g==="xlink:href"||g==="href")&&I!=="script"&&Zr(U,"data:")===0&&Ae[I])){if(!(le&&!Pe(l,Wt(U,P,"")))){if(U)return!1}}}}}}return!0},tn=function(I){return I!=="annotation-xml"&&Ts(I,R)},nn=function(I){tt(S.beforeSanitizeAttributes,I,null);const{attributes:g}=I;if(!g||Lt(I))return;const U={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:V,forceKeepAttr:void 0};let M=g.length;for(;M--;){const Q=g[M],{name:Y,namespaceURI:Z,value:X}=Q,De=ge(Y);let ye=Y==="value"?X:Jr(X);if(U.attrName=De,U.attrValue=ye,U.keepAttr=!0,U.forceKeepAttr=void 0,tt(S.uponSanitizeAttribute,I,U),ye=U.attrValue,be&&(De==="id"||De==="name")&&(gt(Y,I),ye=je+ye),Oe&&Pe(/((--!?|])>)|<\/(style|title)/i,ye)){gt(Y,I);continue}if(U.forceKeepAttr||(gt(Y,I),!U.keepAttr))continue;if(!ce&&Pe(/\/>/i,ye)){gt(Y,I);continue}fe&&on([w,C,y],sn=>{ye=Wt(ye,sn," ")});const Ct=ge(I.nodeName);if(Bt(Ct,De,ye)){if(F&&typeof c=="object"&&typeof c.getAttributeType=="function"&&!Z)switch(c.getAttributeType(Ct,De)){case"TrustedHTML":{ye=F.createHTML(ye);break}case"TrustedScriptURL":{ye=F.createScriptURL(ye);break}}try{Z?I.setAttributeNS(Z,Y,ye):I.setAttribute(Y,ye),Lt(I)?Qe(I):vs(b.removed)}catch{}}}tt(S.afterSanitizeAttributes,I,null)},Tn=function J(I){let g=null;const U=en(I);for(tt(S.beforeSanitizeShadowDOM,I,null);g=U.nextNode();)tt(S.uponSanitizeShadowNode,g,null),Pt(g),nn(g),g.content instanceof t&&J(g.content);tt(S.afterSanitizeShadowDOM,I,null)};return b.sanitize=function(J){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=null,U=null,M=null,Q=null;if(Ie=!J,Ie&&(J="<!-->"),typeof J!="string"&&!pt(J))if(typeof J.toString=="function"){if(J=J.toString(),typeof J!="string")throw Gt("dirty is not a string, aborting")}else throw Gt("toString is not a function");if(!b.isSupported)return J;if(me||wt(I),b.removed=[],typeof J=="string"&&(ne=!1),ne){if(J.nodeName){const X=ge(J.nodeName);if(!q[X]||K[X])throw Gt("root node is forbidden and cannot be sanitized in-place")}}else if(J instanceof i)g=Jt("<!---->"),U=g.ownerDocument.importNode(J,!0),U.nodeType===$t.element&&U.nodeName==="BODY"||U.nodeName==="HTML"?g=U:g.appendChild(U);else{if(!de&&!fe&&!Te&&J.indexOf("<")===-1)return F&&pe?F.createHTML(J):J;if(g=Jt(J),!g)return de?null:pe?z:""}g&&ve&&Qe(g.firstChild);const Y=en(ne?J:g);for(;M=Y.nextNode();)Pt(M),nn(M),M.content instanceof t&&Tn(M.content);if(ne)return J;if(de){if(he)for(Q=h.call(g.ownerDocument);g.firstChild;)Q.appendChild(g.firstChild);else Q=g;return(V.shadowroot||V.shadowrootmode)&&(Q=x.call(a,Q,!0)),Q}let Z=Te?g.outerHTML:g.innerHTML;return Te&&q["!doctype"]&&g.ownerDocument&&g.ownerDocument.doctype&&g.ownerDocument.doctype.name&&Pe(Vs,g.ownerDocument.doctype.name)&&(Z="<!DOCTYPE "+g.ownerDocument.doctype.name+`>
`+Z),fe&&on([w,C,y],X=>{Z=Wt(Z,X," ")}),F&&pe?F.createHTML(Z):Z},b.setConfig=function(){let J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};wt(J),me=!0},b.clearConfig=function(){Je=null,me=!1},b.isValidAttribute=function(J,I,g){Je||wt({});const U=ge(J),M=ge(I);return Bt(U,M,g)},b.addHook=function(J,I){typeof I=="function"&&zt(S[J],I)},b.removeHook=function(J){return vs(S[J])},b.removeHooks=function(J){S[J]=[]},b.removeAllHooks=function(){S=_s()},b}var Yn=Qs();const ot=({onChange:m,initialValue:b})=>{const[D,a]=W.useState(Yn.sanitize(b||"")),e=W.useRef(!1),t=W.useRef(null),[d,i]=W.useState("");W.useEffect(()=>{e.current?a(Yn.sanitize(b||"")):e.current=!0},[b]);const v=(c,p)=>{const j=p.getData(),k=Yn.sanitize(j);a(k),m(k)},T=c=>{if(!t.current){console.warn("Editor not initialized");return}const p=t.current;p.model.change(j=>{const k=p.model.document.selection.getFirstPosition();j.insertText(c,k)}),i("")},n=c=>{T(c.target.value)},r=["Î±","Î²","Î³","Î´","Îµ","Î¶","Î·","Î¸","Î¹","Îº","Î»","Î¼","Î½","Î¾","Î¿","Ï€","Ï","Ïƒ","Ï„","Ï…","Ï†","Ï‡","Ïˆ","Ï‰"],s=["Â°","+","-","=","~","â‰¥","â‰¤","â‰ ",">","<","*","/","%"];return o.jsxs("div",{children:[o.jsxs(ln,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%"},children:[o.jsx(fr,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),o.jsx(ss,{variant:"standard",sx:{m:1,minWidth:40},children:o.jsxs(hn,{labelId:"math-operators-label",id:"math-operators",value:d,onChange:n,displayEmpty:!0,children:[o.jsx(_t,{value:"",disabled:!0,children:"Math"}),s.map(c=>o.jsx(_t,{value:c,children:c},c))]})}),o.jsx(ss,{variant:"standard",sx:{m:1,minWidth:40},children:o.jsxs(hn,{labelId:"greek-letters-label",id:"greek-letters",value:d,onChange:n,displayEmpty:!0,children:[o.jsx(_t,{value:"",disabled:!0,children:"Greek"}),r.map(c=>o.jsx(_t,{value:c,children:c},c))]})})]}),o.jsx(hr.CKEditor,{editor:mr,data:D,onReady:c=>{t.current=c},config:{toolbar:["undo","redo","|","heading","bold","italic","|","bulletedList","numberedList","blockQuote","indent","outdent","|","link","insertTable","|"],table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]}},onChange:v})]})},mi=Tt(o.jsx("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),gi=Tt(o.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),Ot=({path:m,initialFiles:b,onFilesChange:D,isOwnDesign:a})=>{const[e,t]=W.useState(b.map(x=>({...x,deleted:!!x.deleted}))),[d,i]=W.useState(!1),[v,T]=W.useState(0),[n,r]=W.useState({}),[s,c]=W.useState(!1),[p,j]=W.useState(""),[k,E]=W.useState("info"),H=W.useRef(null);W.useEffect(()=>{console.log("Initial files received:",b),t(b.map(x=>({...x,deleted:!!x.deleted})))},[b]),W.useEffect(()=>()=>{r({})},[]);const B=x=>{console.log("Updating files with",x),D(x),t(x)},F=async x=>{if(!x.target.files)return;const w=Array.from(x.target.files).filter(y=>y.size>5242880?(j("File size should not exceed 5 MB"),E("error"),c(!0),!1):!0);i(!0);const C=w.map(y=>{const _=new Date().getTime(),f=`${_}-${y.name}`,l=It(),P=Rt(l,`${m}/${f}`),R=Is(P,y);return new Promise((L,q)=>{R.on("state_changed",G=>{const V=G.bytesTransferred/G.totalBytes*100;T(V)},G=>{console.error("Upload failed:",G),q(G)},()=>{Rs(R.snapshot.ref).then(G=>{L({id:_.toString(),url:G,name:y.name,path:P.fullPath})})})})});Promise.all(C).then(y=>{const _=[...e.filter(f=>!f.deleted),...y];B(_),j("Files uploaded successfully."),E("success"),c(!0),i(!1),T(0),H.current&&(H.current.value="")}).catch(y=>{console.error("Error uploading files: ",y),j("Failed to upload files."),E("error"),c(!0),i(!1),T(0)})},z=x=>{const S=e.map(w=>w.id===x?{...w,deleted:!0}:w);B(S),j("File marked for deletion. Update to permanently delete."),E("info"),c(!0)},A=x=>{r(S=>{var w;return{...S,[x]:((w=e.find(C=>C.id===x))==null?void 0:w.name)||""}}),console.log("editStates after handleEditClick:",n)},N=x=>{t(S=>{const w=S.map(C=>C.id===x&&n[x]!==void 0?{...C,name:n[x]}:C);return D(w),w}),r(S=>{const w={...S};return delete w[x],w}),j("File name updated successfully."),E("info"),c(!0)},h=(x,S)=>{r(w=>({...w,[x]:S}))},u=(x,S)=>{S!=="clickaway"&&c(!1)};return o.jsxs("div",{children:[a&&o.jsx(fn,{title:"Upload Files",children:o.jsxs(Be,{variant:"outlined",component:"label",startIcon:o.jsx(gi,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",o.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:F,disabled:d,ref:H})]})}),d&&o.jsx("div",{children:o.jsxs("p",{children:["Uploading... ",Math.round(v),"%"]})}),o.jsx(gr,{children:e.map(x=>o.jsxs(pr,{component:"div",disabled:x.deleted,children:[o.jsx(Ar,{children:o.jsx(mi,{})}),typeof n[x.id]=="string"?o.jsx(mn,{variant:"outlined",size:"small",value:n[x.id],onChange:S=>h(x.id,S.target.value),onKeyPress:S=>S.key==="Enter"&&N(x.id),fullWidth:!0}):o.jsx(br,{primary:x.name,secondary:o.jsx("a",{href:x.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),a&&(typeof n[x.id]=="string"?o.jsx(Xe,{onClick:()=>N(x.id),edge:"end","aria-label":"save",children:o.jsx(Qn,{})}):o.jsxs(o.Fragment,{children:[o.jsx(Xe,{onClick:()=>A(x.id),edge:"end","aria-label":"edit",children:o.jsx(js,{})}),o.jsx(Xe,{onClick:()=>z(x.id),edge:"end","aria-label":"delete",children:o.jsx(Vt,{})})]}))]},x.id))}),o.jsx(At,{open:s,autoHideDuration:6e3,onClose:u,children:o.jsx(St,{onClose:u,severity:k,sx:{width:"100%"},children:p})})]})},pi=({designs:m,setDesigns:b,setIsAdding:D,getDesigns:a,onReturnToDashboard:e})=>{const{userDetails:t}=Xt();console.log("Add Design loaded");const[d,i]=W.useState(""),[v,T]=W.useState(""),[n,r]=W.useState(""),[s,c]=W.useState([]),[p,j]=W.useState([]),k=W.useMemo(()=>s,[s]),[E,H]=W.useState(!1),[B,F]=W.useState(""),[z,A]=W.useState("info"),[N,h]=W.useState(!1),[u,x]=W.useState("");console.log("Adding New Design from user:",t);const S=W.useRef(null),w=()=>{h(!1)},C=(_,f)=>{f!=="clickaway"&&H(!1)};W.useEffect(()=>{if(t!=null&&t.classes){const _=Object.keys(t.classes)[0];T(_||"")}},[t==null?void 0:t.classes]);const y=async _=>{var R;if(_.preventDefault(),console.log("Files to be saved:",p),!t||!t.uid){console.error("User object is undefined or missing UID."),x("You must be signed in to add a design."),h(!0);return}if(!d){x("All fields are required."),h(!0);return}await((R=S.current)==null?void 0:R.commitDeletions());const f=s.filter(L=>!L.deleted),l=p.filter(L=>!L.deleted).map(L=>({id:L.id,url:L.url,name:L.name,path:L.path})),P={title:n,description:d,course:v,dateCreated:Qt(),dateModified:Qt(),images:f,files:l,userId:t.uid};try{const L=await Jn(Fe(ae,"designs"),P),q={...P,id:L.id};b([...m,q]),F(`${n} has been Added.`),A("success"),H(!0),r(""),i(""),c([]),j([]),setTimeout(()=>{D(!1),a()},1e3)}catch(L){console.log(L),x("There was an issue adding your design."),h(!0)}};return o.jsxs("div",{className:"small-container",children:[o.jsx("button",{onClick:e,className:"muted-button margin-top-20",children:"â† All Designs"}),o.jsx("div",{className:"design-record",children:o.jsxs("form",{onSubmit:y,children:[o.jsx("h1",{className:"designHeader",children:"New Design"}),o.jsx("div",{style:{display:"flex",alignItems:"center"},children:o.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[o.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),o.jsx("input",{id:"title",type:"text",name:"title",value:n,onChange:_=>r(_.target.value),style:{width:"100%"}})]})}),o.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),o.jsx(hn,{id:"course",value:v,onChange:_=>T(_.target.value),fullWidth:!0,disabled:!(t!=null&&t.classes)||Object.keys(t.classes).length===0,children:(t!=null&&t.classes?Object.entries(t.classes):[]).map(([_,f])=>o.jsx(_t,{value:_,children:`${f.number} - ${f.title}`},_))}),o.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),o.jsxs("ul",{children:[o.jsx("li",{children:"Objective: What is the goal for this design?"}),o.jsx("li",{children:"Rationale: Why is this new design being done?"}),o.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),o.jsx("li",{children:"Functional Modification: What is being done to this target?"}),o.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),o.jsx(ot,{onChange:i,initialValue:d}),o.jsx(Ft,{ref:S,path:"designs/images",initialImages:k,onImagesUpdated:c,onDelete:_=>c(s.filter(f=>!_.includes(f)))}),o.jsx(Ot,{path:"designs/files",initialFiles:p,onFilesChange:j}),o.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[o.jsx(Be,{type:"submit",variant:"contained",sx:{fontSize:"1rem",mt:2,textTransform:"none",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"Add"}),o.jsx(Be,{onClick:()=>D(!1),style:{marginLeft:"12px"},variant:"outlined",sx:{fontSize:"1rem",mt:2,textTransform:"none",color:"currentColor",borderColor:"rgba(255, 0, 0, 0.5)",boxShadow:"none","&:hover":{borderColor:"rgba(255, 0, 0, 0.7)",backgroundColor:"rgba(255, 0, 0, 0.1)",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",color:"currentColor",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out, background-color 0.3s ease-in-out"},children:"Cancel"})]})]})}),o.jsxs(yt,{open:N,onClose:w,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[o.jsx(kt,{id:"alert-dialog-title",children:"Notification"}),o.jsx(vt,{children:o.jsx(Kt,{id:"alert-dialog-description",children:u})}),o.jsx(Ut,{children:o.jsx(Be,{onClick:w,autoFocus:!0,children:"Ok"})})]}),o.jsx(At,{open:E,autoHideDuration:1e3,onClose:C,children:o.jsx(St,{onClose:C,severity:z,sx:{width:"100%"},children:B})})]})},bi=({designId:m,setIsAddingBuild:b,refreshBuilds:D})=>{const[a,e]=W.useState(""),[t,d]=W.useState(""),[i,v]=W.useState([]),[T,n]=W.useState([]),{userDetails:r}=Xt(),s=S=>{v(S)},c=S=>{n(S)};console.log("AddBuild loaded");const[p,j]=W.useState(!1),[k,E]=W.useState(""),[H,B]=W.useState(!1),[F,z]=W.useState(""),[A,N]=W.useState("info");console.log("Adding New Build by user:",r);const h=()=>{j(!1)},u=(S,w)=>{w!=="clickaway"&&B(!1)},x=async S=>{if(S.preventDefault(),!r||!r.uid){console.error("UserDetails object is undefined or missing UID."),E("You must be signed in to add a build."),j(!0);return}if(!t){E("Build description is required."),j(!0);return}const w=i.filter(y=>!y.deleted),C=T.filter(y=>!y.deleted).map(y=>({id:y.id,url:y.url,name:y.name,path:y.path}));try{const y=await Jn(Fe(ae,"builds"),{title:a,description:t,design_ID:m,dateCreated:Qt(),userId:r.uid,images:w,files:C});console.log("Build added with ID: ",y.id),console.log("Added New Build by user:",r),z("Your build has been successfully added."),N("success"),B(!0),setTimeout(()=>{e(""),d(""),v([]),n([]),b(!1),D()},1e3)}catch(y){if(console.error("Error adding build: ",y),y instanceof Error){let _=`Failed to add the build. ${y.message}`;y.message==="permission-denied"&&(_="You do not have permission to perform this operation."),z(_),N("error"),B(!0)}else z("Failed to add the build. Please try again later."),N("error"),B(!0)}};return o.jsxs("div",{className:"small-container",children:[o.jsxs("form",{onSubmit:x,children:[o.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),o.jsx("input",{id:"buildTitle",type:"text",value:a,onChange:S=>e(S.target.value),style:{width:"100%",marginBottom:"20px"}}),o.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),o.jsx(ot,{onChange:d,initialValue:t})," ",o.jsx(Ft,{path:`builds/${m}/images`,initialImages:i,onImagesUpdated:s}),o.jsx(Ot,{path:`builds/${m}/files`,initialFiles:T,onFilesChange:c}),o.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[o.jsx("input",{type:"submit",value:"Save"}),o.jsx("button",{style:{marginLeft:"12px"},onClick:()=>b(!1),className:"button muted-button",children:"Cancel"})]})]}),o.jsxs(yt,{open:p,onClose:h,children:[o.jsx(kt,{children:"Notification"}),o.jsx(vt,{children:o.jsx(Kt,{children:k})}),o.jsx(Ut,{children:o.jsx(Be,{onClick:h,children:"OK"})})]}),o.jsx(At,{open:H,autoHideDuration:6e3,onClose:u,children:o.jsx(St,{onClose:u,severity:A,sx:{width:"100%"},children:F})})]})},xi=({designId:m,buildId:b,refreshTests:D,setAddingTestIdForBuild:a})=>{const[e,t]=W.useState(""),[d,i]=W.useState(""),[v,T]=W.useState(""),[n,r]=W.useState(""),[s,c]=W.useState([]),[p,j]=W.useState([]),{userDetails:k}=Xt();console.log("AddTest loaded");const[E,H]=W.useState(!1),[B,F]=W.useState(""),[z,A]=W.useState(!1),[N,h]=W.useState(""),[u,x]=W.useState("info"),S=C=>{j(C)},w=async()=>{if(!d){F("Test description cannot be empty!"),H(!0);return}const C=s.filter(_=>!_.deleted),y=p.filter(_=>!_.deleted).map(_=>({id:_.id,url:_.url,name:_.name,path:_.path}));try{await Jn(Fe(ae,"tests"),{title:e,build_ID:b,design_ID:m,dateCreated:Qt(),description:d,results:v,conclusions:n,userId:k==null?void 0:k.uid,images:C,files:y}),setTimeout(()=>{D(b),t(""),i(""),T(""),r(""),c([]),j([]),a(!1)},1e3),h("Test added successfully"),x("success"),A(!0)}catch(_){console.error("Error adding test: ",_),h("Failed to add the test"),x("error"),A(!0)}};return o.jsxs("div",{children:[o.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),o.jsx("input",{id:"testTitle",type:"text",value:e,onChange:C=>t(C.target.value),style:{width:"100%",marginBottom:"20px"}}),o.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),o.jsx(ot,{onChange:i,initialValue:d}),o.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),o.jsx(ot,{onChange:T,initialValue:v}),o.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),o.jsx(ot,{onChange:r,initialValue:n}),o.jsx(Ft,{path:`tests/${b}/images`,initialImages:s,onImagesUpdated:C=>{c(C)}}),o.jsx(Ot,{path:`tests/${b}/files`,initialFiles:p,onFilesChange:S}),o.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[o.jsx("button",{onClick:w,children:"Save"}),o.jsx("button",{style:{marginLeft:"12px"},onClick:()=>a(!1),className:"button muted-button",children:"Cancel"})]}),o.jsxs(yt,{open:E,onClose:()=>H(!1),children:[o.jsx(kt,{children:"Notification"}),o.jsx(vt,{children:o.jsx(Kt,{children:B})}),o.jsx(Ut,{children:o.jsx(Be,{onClick:()=>H(!1),children:"OK"})})]}),o.jsx(At,{open:z,autoHideDuration:6e3,onClose:()=>A(!1),children:o.jsx(St,{onClose:()=>A(!1),severity:u,sx:{width:"100%"},children:N})})]})},Vn=Tt(o.jsx("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff"),Yt=m=>m&&m instanceof Zn?m.toDate().toLocaleString():"",yi=({selectedDesign:m,setIsEditing:b,getDesigns:D,onReturnToDashboard:a})=>{const{userDetails:e,loading:t}=Xt(),d=m.id,i=m.userId===(e==null?void 0:e.uid);console.log("Edit page loaded"),console.log("Design ID:",d),console.log("Editing Design by user:",e);const[v,T]=W.useState(""),[n,r]=W.useState(m.description),[s,c]=W.useState(m.course||""),[p,j]=W.useState(Yt(m.dateCreated)),[k,E]=W.useState(Yt(m.dateModified)),[H,B]=W.useState([]),[F,z]=W.useState([]),A=W.useRef(null),[N,h]=W.useState(!1),[u,x]=W.useState([]),[S,w]=W.useState({}),[C,y]=W.useState({}),[_,f]=W.useState({}),l=W.useRef(null),[P,R]=W.useState({}),[L,q]=W.useState({}),[G,V]=W.useState({}),[$,O]=W.useState(!1),[K,ue]=W.useState({}),[ie,se]=W.useState({}),[le,ce]=W.useState({}),[fe,Oe]=W.useState({}),[Te,me]=W.useState({}),ve=W.useRef(null),[de,he]=W.useState({}),[pe,Se]=W.useState({}),[be,je]=W.useState({}),[xe,ne]=W.useState(!1),[we,Ce]=W.useState(""),[at,Ae]=W.useState(()=>{}),[qe,te]=W.useState(!1),[ke,re]=W.useState(""),[Ue,ee]=W.useState("info"),[_e,Ie]=W.useState({design:!1,builds:!1,tests:!1}),ht=async g=>{if(g.preventDefault(),!n){Ce("All fields are required."),ne(!0);return}console.log("About to check image deletions",A.current),console.log(A.current),console.log(H.some(Y=>Y.deleted)),A.current&&H.some(Y=>Y.deleted)&&(console.log("Committing deletions"),await A.current.commitDeletions());const U=H.filter(Y=>!Y.deleted);F.some(Y=>Y.deleted)&&await $e();const M=F.filter(Y=>!Y.deleted);let Q={title:v,description:n,course:s,dateModified:Qt(),images:U.map(Y=>({url:Y.url,title:Y.title,path:Y.path})),files:M.map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path})),userId:e.uid};try{await ut(Re(ae,"designs",d),Q,{merge:!0}),re("Your design has been updated."),ee("success"),te(!0);const Y=Zn.now();E(Yt(Y))}catch(Y){console.error("Error updating design:",Y),re("There was an issue updating your design."),ee("error"),te(!0)}Ie(Y=>({...Y,design:!1}))};W.useEffect(()=>{m&&(r(m.description||""),T(m.title||""),c(m.course||""),(async()=>{const U=Re(ae,"designs",d),M=await xr(U);if(M.exists()){const Q=M.data();console.log("Fetched images:",Q.images),console.log("Fetched files:",Q.files),B(Q.images||[]),z(Q.files||[]),j(Yt(Q.dateCreated)),E(Yt(Q.dateModified))}})())},[m,d]);const mt=g=>{const U=H.filter(Q=>!g.some(Y=>Y.path===Q.path));console.log("Remaining images after deletion:",U),B(U);const M=U.map(Q=>({url:Q.url,title:Q.title,path:Q.path}));ut(Re(ae,"designs",d),{images:M},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(Q=>console.error("Failed to update Firestore:",Q))},lt=g=>{JSON.stringify(H)!==JSON.stringify(g)&&(B(g),console.log("Updated images received:",g))},$e=async()=>{const g=F.filter(U=>U.deleted);if(console.log("Files to delete:",g),g.length>0){const U=It(),M=g.map(Q=>{const Y=Rt(U,Q.path);return cn(Y)});try{await Promise.all(M),console.log("Files deleted successfully");const Q=F.filter(Y=>!Y.deleted);z(Q),await Cn(Re(ae,"designs",m.id),{files:Q.map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path}))}),re("Deleted files have been permanently removed."),ee("success"),te(!0)}catch(Q){console.error("Failed to delete files: ",Q),re("Failed to delete files."),ee("error"),te(!0)}}},Mt=async g=>{var Y,Z;try{await Zt(g)}catch(X){console.error("Error deleting files:",X),re("Failed to delete build files."),ee("error"),te(!0)}const U=((Y=C[g])==null?void 0:Y.filter(X=>!X.deleted).map(({url:X,path:De,title:ye})=>({url:X,path:De,title:ye})))||[],M=((Z=_[g])==null?void 0:Z.filter(X=>!X.deleted).map(X=>({id:X.id,url:X.url,name:X.name,path:X.path})))||[],Q={};U.length>0&&(Q.images=U),M.length>0&&(Q.files=M),S[g]!==void 0&&(Q.description=S[g]);try{const X=Re(ae,"builds",g);await ut(X,Q,{merge:!0}),re("Your build has been updated."),ee("success"),te(!0),ge(),Ie(De=>({...De,builds:!1}))}catch(X){console.error("Error updating build:",X),re("Failed to update build."),ee("error"),te(!0)}},Me=(g,U)=>{q(M=>({...M,[g]:U}))},Ye=(g,U)=>{w(M=>({...M,[g]:U})),Ie(M=>({...M,builds:!0}))},Ze=async g=>{const U=L[g];try{const M=Re(ae,"builds",g);await ut(M,{title:U},{merge:!0}),q(Q=>{const Y={...Q};return delete Y[g],Y}),ge()}catch(M){console.error("Failed to save build title:",M)}},ge=async()=>{if(!e){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",e==null?void 0:e.uid),console.log("Selected design ID for query:",m==null?void 0:m.id);let g;e.isAdmin?g=ze(Fe(ae,"builds"),Ee("design_ID","==",d),rt("dateCreated")):g=ze(Fe(ae,"builds"),Ee("design_ID","==",d),Ee("userId","==",e.uid),rt("dateCreated")),console.log("Builds query details:",JSON.stringify(g,null,2));const U=await ft(g);console.log("Builds snapshot details:",JSON.stringify(U.docs.map(Q=>Q.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",U.docs.length);const M=U.docs.map(Q=>(console.log("Build doc path: ",Q.ref.path),{id:Q.id,...Q.data()}));x(M),console.log("New builds state after refresh:",M)}catch(g){console.error("Error refreshing builds:",g),g.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",g):console.error("An unexpected error occurred when trying to refresh builds:",g)}},Je=(g,U)=>{const M=Re(ae,"builds",g),Q=C[g].filter(Z=>!U.some(X=>X.path===Z.path));y(Z=>({...Z,[g]:Q}));const Y=Q.map(Z=>({url:Z.url,title:Z.title,path:Z.path}));ut(M,{images:Y},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),re("Build Image deletions updated."),ee("success")}).catch(Z=>{console.error("Failed to update build images in Firestore:",Z),re("Failed to update build image deletions."),ee("error")}),te(!0)},et=async g=>{const U=ze(Fe(ae,"tests"),Ee("build_ID","==",g),Ee("userId","==",e.uid)),M=await ft(U);for(const Q of M.docs)await Dt(Re(ae,"tests",Q.id));await Dt(Re(ae,"builds",g)),await ge(),re("Build and its tests (if any) deleted successfully."),ee("success"),te(!0)},Ve=g=>{Ce("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),Ae(()=>()=>et(g)),ne(!0)},wt=(g,U)=>{y(M=>({...M,[g]:U}))},Nt=(g,U)=>{f(M=>({...M,[g]:U}))},Zt=async g=>{var M;const U=((M=_[g])==null?void 0:M.filter(Q=>Q.deleted))||[];if(console.log("Build files to delete:",U),U.length>0){const Q=It(),Y=U.map(Z=>{const X=Rt(Q,Z.path);return cn(X)});try{await Promise.all(Y),console.log("Build files deleted successfully");const Z=_[g].filter(X=>!X.deleted);f(X=>({...X,[g]:Z})),await Cn(Re(ae,"builds",g),{files:Z.map(X=>({id:X.id,url:X.url,name:X.name,path:X.path}))}),console.log("Firestore successfully updated to remove deleted files"),re("Deleted build files have been permanently removed."),ee("success"),te(!0)}catch(Z){console.error("Failed to delete build files: ",Z),re("Failed to delete build files."),ee("error"),te(!0)}}},vn=async(g,U)=>{var Z;try{await tn(g)}catch(X){console.error("Error deleting files:",X),re("Failed to delete build files."),ee("error"),te(!0)}const M={},Q=fe[g].filter(X=>!X.deleted).map(({url:X,path:De,title:ye})=>({url:X,path:De,title:ye})),Y=((Z=Te[g])==null?void 0:Z.filter(X=>!X.deleted).map(X=>({id:X.id,url:X.url,name:X.name,path:X.path})))||[];K[g]!==void 0&&(M.description=K[g]),ie[g]!==void 0&&(M.results=ie[g]),le[g]!==void 0&&(M.conclusions=le[g]),M.images=Q,M.files=Y;try{const X=Re(ae,"tests",g);await ut(X,M,{merge:!0}),re("Your test has been updated."),ee("success"),te(!0),pt(U)}catch(X){console.error(`Error updating test ID: ${g}:`,X),re("There was an issue updating your test."),ee("error"),te(!0)}},Qe=(g,U)=>{Se(M=>({...M,[g]:U}))},gt=async(g,U)=>{const M=pe[g],Q=Re(ae,"tests",g);await ut(Q,{title:M},{merge:!0}),Se(Y=>{const Z={...Y};return delete Z[g],Z}),pt(U)},Jt=(g,U)=>{console.log(`Updating description for test ID ${g}:`,U),ue(M=>({...M,[g]:U})),Ie(M=>({...M,tests:!0}))},en=(g,U)=>{console.log(`Updating results for test ID ${g}:`,U),se(M=>({...M,[g]:U})),Ie(M=>({...M,tests:!0}))},Lt=(g,U)=>{ce(M=>({...M,[g]:U})),Ie(M=>({...M,tests:!0}))};W.useEffect(()=>{!t&&e&&(async()=>{if(!e)return;let U;e.isAdmin?U=ze(Fe(ae,"builds"),Ee("design_ID","==",d),rt("dateCreated")):U=ze(Fe(ae,"builds"),Ee("design_ID","==",d),Ee("userId","==",e.uid),rt("dateCreated"));const M=await ft(U);let Q=[],Y={},Z={};for(const X of M.docs){const De=X.data(),ye=X.id;Q.push({id:ye,...De,images:De.images||[],files:De.files||[]}),Z[ye]=!0;let Ct;e.isAdmin?Ct=ze(Fe(ae,"tests"),Ee("build_ID","==",ye),rt("dateCreated")):Ct=ze(Fe(ae,"tests"),Ee("build_ID","==",ye),Ee("userId","==",e.uid),rt("dateCreated"));const sn=await ft(Ct);let ns=[],An={},Sn={};for(const dt of sn.docs){const ct=dt.data();ns.push({id:dt.id,...ct}),An[dt.id]=ct.images||[],Sn[dt.id]=ct.files||[]}Y[ye]=ns,Oe(dt=>{let ct={...dt};for(const Ht in An)ct[Ht]=An[Ht];return ct}),me(dt=>{let ct={...dt};for(const Ht in Sn)ct[Ht]=Sn[Ht];return ct})}x(Q),V(Y),je(Z)})()},[t,e,m.id,d]);const pt=async g=>{if(!e){console.log("User details not loaded yet");return}try{let U;e.isAdmin?U=ze(Fe(ae,"tests"),Ee("build_ID","==",g),rt("dateCreated")):U=ze(Fe(ae,"tests"),Ee("build_ID","==",g),Ee("userId","==",e.uid),rt("dateCreated"));const Q=(await ft(U)).docs.map(X=>({id:X.id,...X.data(),images:X.data().images||[],files:X.data().files||[]}));V(X=>({...X,[g]:Q}));let Y={},Z={};Q.forEach(X=>{Y[X.id]=X.images,Z[X.id]=X.files}),Oe(Y),me(Z)}catch(U){console.error("Error fetching tests:",U)}},tt=(g,U)=>{const M=Re(ae,"tests",g),Q=fe[g].filter(Z=>!U.includes(Z));Oe(Z=>({...Z,[g]:Q}));const Y=Q.map(({url:Z,path:X,title:De})=>({url:Z,path:X,title:De}));ut(M,{images:Y},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),re("Test Image deletions updated."),ee("success")}).catch(Z=>{console.error("Failed to update test images in Firestore:",Z),re("Failed to update test image deletions."),ee("error")}),te(!0)},Pt=(g,U)=>{Oe(M=>({...M,[g]:U}))},Bt=(g,U)=>{me(M=>({...M,[g]:U}))},tn=async g=>{var M;const U=((M=Te[g])==null?void 0:M.filter(Q=>Q.deleted))||[];if(U.length>0){const Q=It(),Y=U.map(Z=>{const X=Rt(Q,Z.path);return cn(X)});try{await Promise.all(Y);const Z=Te[g].filter(X=>!X.deleted);me(X=>({...X,[g]:Z})),await Cn(Re(ae,"tests",g),{files:Z.map(X=>({id:X.id,url:X.url,name:X.name,path:X.path}))}),re("Deleted test files have been permanently removed."),ee("success"),te(!0)}catch(Z){console.error("Failed to delete test files: ",Z),re("Failed to delete test files."),ee("error"),te(!0)}}},nn=async(g,U)=>{await Dt(Re(ae,"tests",g)),await pt(U),re("Test deleted successfully."),ee("success"),te(!0)},Tn=(g,U)=>{Ce("Are you sure you want to delete this test? This action cannot be undone."),Ae(()=>()=>nn(g,U)),ne(!0)},J=g=>{je(U=>({...U,[g]:!U[g]}))},I=()=>{const g=Object.entries(_e).filter(([M,Q])=>Q).map(([M])=>M).join(", ");if(!g.length){a();return}const U=`You have unsaved changes in the following sections: ${g}. Are you sure you want to leave?`;Ce(U),Ae(()=>()=>{Ie({design:!1,builds:!1,tests:!1}),a()}),ne(!0)};return W.useEffect(()=>{const g=U=>{Object.values(_e).some(Q=>Q)&&(U.preventDefault(),U.returnValue="")};return window.addEventListener("beforeunload",g),()=>window.removeEventListener("beforeunload",g)},[_e]),o.jsxs("div",{className:"small-container",children:[o.jsx("button",{onClick:()=>{Object.values(_e).some(U=>U)?I():a()},className:"muted-button margin-top-20",children:"â† All Designs"}),o.jsx("div",{className:"design-record",children:o.jsxs("form",{onSubmit:ht,children:[o.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),o.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[o.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[o.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),o.jsx("input",{id:"title",type:"text",name:"title",value:v,onChange:g=>{T(g.target.value),Ie(U=>({...U,design:!0}))},style:{width:"100%"}})]}),o.jsxs("div",{style:{flexGrow:2},children:[o.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),o.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:p||"",readOnly:!0,style:{width:"100%"}})]}),o.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[o.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),o.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:k||"",readOnly:!0,style:{width:"100%"}})]})]}),o.jsx("label",{className:"designTitles",htmlFor:"course",children:"Course"}),o.jsx(hn,{id:"course",value:s,onChange:g=>{c(g.target.value),Ie(U=>({...U,design:!0}))},fullWidth:!0,children:(e!=null&&e.classes?Object.entries(e.classes):[]).map(([g,U])=>o.jsx(_t,{value:g,children:`${U.number} - ${U.title}`},g))}),o.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),o.jsxs("ul",{children:[o.jsx("li",{children:"Objective: What is the goal for this design?"}),o.jsx("li",{children:"Rationale: Why is this new design being done?"}),o.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),o.jsx("li",{children:"Functional Modification: What is being done to this target?"}),o.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),o.jsx(ot,{initialValue:n,onChange:g=>{r(g),Ie(U=>({...U,design:!0}))}}),o.jsx(Ft,{ref:A,path:`designs/${m.id}/images`,initialImages:H,onImagesUpdated:lt,onDelete:mt,isOwnDesign:i}),o.jsx(Ot,{path:`designs/${m.id}/files`,initialFiles:F,onFilesChange:z,isOwnDesign:i}),i&&o.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[o.jsx("input",{type:"submit",value:"Update"}),o.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>b(!1),children:"Cancel"})]})]})}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex-space-between",children:[o.jsx("h2",{className:"buildsHeader",children:"Builds"}),i&&o.jsxs("button",{className:"button muted-button",onClick:()=>{h(!0),setTimeout(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[o.jsx("span",{role:"img","aria-label":"Add Build",children:"âž•"})," Build"]})]}),u.map((g,U)=>o.jsxs("div",{className:"build-record",children:[o.jsxs("div",{className:"flex-space-between align-items-center",children:[o.jsx("div",{children:L[g.id]!==void 0?o.jsx(mn,{variant:"outlined",size:"small",fullWidth:!0,value:L[g.id],onChange:M=>Me(g.id,M.target.value),onBlur:()=>Ze(g.id),autoFocus:!0,InputProps:{endAdornment:o.jsx(Xe,{onClick:()=>Ze(g.id),size:"small",children:o.jsx(Qn,{})})}}):o.jsx("div",{className:"buildTitle",onClick:()=>q(M=>({...M,[g.id]:g.title||`Build ${U+1}`})),style:{cursor:"pointer"},children:g.title||`Build ${U+1}`})}),o.jsxs("div",{children:[o.jsx("button",{onClick:()=>R(M=>({...M,[g.id]:!M[g.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:P[g.id]?o.jsx(Vn,{}):o.jsx(En,{})}),i&&o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Ve(g.id),children:o.jsx(Vt,{})}),o.jsxs("button",{className:"button muted-button",onClick:()=>{O(g.id),setTimeout(()=>{ve.current&&ve.current.scrollIntoView({behavior:"smooth"})},100)},children:[o.jsx("span",{role:"img","aria-label":"Add Test",children:"âž•"})," Test"]})]})]})]}),P[g.id]&&o.jsxs(o.Fragment,{children:[o.jsx(ot,{initialValue:S[g.id]||g.description,onChange:M=>{Ye(g.id,M)}}),o.jsx(Ft,{path:`builds/${g.id}/images`,initialImages:g.images,onImagesUpdated:M=>wt(g.id,M),onDelete:M=>Je(g.id,M),isOwnDesign:i}),o.jsx(Ot,{path:`builds/${g.id}/files`,initialFiles:g.files,onFilesChange:M=>Nt(g.id,M),isOwnDesign:i}),i&&o.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:o.jsx("button",{onClick:()=>Mt(g.id),children:"Update"})}),o.jsx("div",{children:G[g.id]&&G[g.id].length>0&&o.jsx("button",{onClick:()=>J(g.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:be[g.id]?o.jsxs(o.Fragment,{children:[o.jsx(En,{style:{marginRight:"8px"}}),"Tests"]}):o.jsxs(o.Fragment,{children:[o.jsx(Vn,{style:{marginRight:"8px"}}),"Tests"]})})}),!be[g.id]&&G[g.id]&&G[g.id].map((M,Q)=>o.jsxs("div",{className:"test-record",children:[o.jsxs("div",{className:"flex-space-between align-items-center",children:[o.jsx("div",{children:pe[M.id]!==void 0?o.jsx(mn,{variant:"outlined",size:"small",fullWidth:!0,value:pe[M.id],onChange:Y=>Qe(M.id,Y.target.value),onBlur:()=>gt(M.id,g.id),autoFocus:!0,InputProps:{endAdornment:o.jsx(Xe,{onClick:()=>gt(M.id,g.id),size:"small",children:o.jsx(Qn,{})})}}):o.jsx("div",{className:"testTitle",onClick:()=>Se(Y=>({...Y,[M.id]:M.title||`Test ${Q+1}`})),style:{cursor:"pointer"},children:M.title||`Test ${Q+1}`})}),o.jsxs("div",{children:[o.jsx("button",{onClick:()=>he(Y=>({...Y,[M.id]:!Y[M.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:de[M.id]?o.jsx(Vn,{}):o.jsx(En,{})}),i&&o.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>Tn(M.id,g.id),children:o.jsx(Vt,{})})]})]}),de[M.id]&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:[o.jsx("label",{className:"testTitles",children:"Description"}),o.jsx(ot,{initialValue:K[M.id]||M.description,onChange:Y=>{Jt(M.id,Y)}})]}),o.jsxs("div",{children:[o.jsx("label",{className:"testTitles",children:"Results"}),o.jsx(ot,{initialValue:ie[M.id]||M.results,onChange:Y=>{en(M.id,Y)}})]}),o.jsxs("div",{children:[o.jsx("label",{className:"testTitles",children:"Conclusions"}),o.jsx(ot,{initialValue:le[M.id]||M.conclusions,onChange:Y=>{Lt(M.id,Y)}})]}),o.jsxs("div",{children:[o.jsx(Ft,{path:`tests/${M.id}/images`,initialImages:fe[M.id]||[],onImagesUpdated:Y=>Pt(M.id,Y),onDelete:Y=>tt(M.id,Y),isOwnDesign:i}),o.jsx(Ot,{path:`tests/${M.id}/files`,initialFiles:Te[M.id]||[],onFilesChange:Y=>Bt(M.id,Y),isOwnDesign:i})]}),i&&o.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:o.jsx("button",{onClick:()=>vn(M.id,g.id),children:"Update"})})]})]},M.id))]}),$===g.id&&o.jsxs("div",{className:"new-test-record",ref:ve,children:[o.jsx("h3",{className:"newTestHeader",children:"New Test"}),o.jsx(xi,{designId:m.id,buildId:g.id,refreshTests:()=>pt(g.id),setAddingTestIdForBuild:O,onImagesUpdated:M=>Pt(g.id,M),onFilesChange:M=>Bt(g.id,M)})]})]},g.id)),o.jsx("div",{children:N&&o.jsxs("div",{className:"new-build-record",ref:l,children:[o.jsx("h3",{className:"newBuildHeader",children:"New Build"}),o.jsx(bi,{designId:m.id,setIsAddingBuild:h,refreshBuilds:ge,onImagesUpdated:g=>wt(build.id,g),onFilesChange:g=>Nt(build.id,g)})]})})]}),o.jsxs(yt,{open:xe,onClose:()=>ne(!1),children:[o.jsx(kt,{children:"Confirmation Required"}),o.jsx(vt,{children:o.jsx(Kt,{children:we})}),o.jsxs(Ut,{children:[o.jsx(Be,{onClick:()=>ne(!1),children:"Cancel"}),o.jsx(Be,{onClick:()=>{at(),ne(!1)},autoFocus:!0,children:"Confirm"})]})]}),o.jsx(At,{open:qe,autoHideDuration:6e3,onClose:()=>te(!1),children:o.jsx(St,{onClose:()=>te(!1),severity:Ue,sx:{width:"100%"},children:ke})})]})},vi=()=>{const{userDetails:m,loading:b}=Xt();console.log("Dashboard loaded");const[D,a]=W.useState([]),[e,t]=W.useState([]),[d,i]=W.useState([]),[v,T]=W.useState(null),[n,r]=W.useState(!1),[s,c]=W.useState(!1),[p,j]=W.useState(!1),[k,E]=W.useState(""),[H,B]=W.useState(""),[F,z]=W.useState(!1),[A,N]=W.useState(null),[h,u]=W.useState(!1),[x,S]=W.useState(""),[w,C]=W.useState("info"),y=()=>{c(!1),r(!1),T(null),_()},_=W.useCallback(async()=>{if(!m)return;let R;const L=[],q=[],G=[];if(m.isSuperAdmin)R=ze(Fe(ae,"designs"),rt("dateCreated","desc"));else if(m.isAdmin){const $=m.classes?Object.keys(m.classes):[];if($.length>0)R=ze(Fe(ae,"designs"),Ee("course","in",$),rt("dateCreated","desc"));else{t([]),i([]);return}}else R=ze(Fe(ae,"designs"),Ee("userId","==",m.uid),rt("dateCreated","desc"));(await ft(R)).forEach($=>{const O=$.data(),K={id:$.id,title:O.title,description:O.description,course:O.course,dateCreated:O.dateCreated,dateModified:O.dateModified,userId:O.userId,images:O.images||[],files:O.files||[]};m.isSuperAdmin?O.userId===m.uid?L.push(K):O.userId!==m.uid&&O.course&&O.isAdmin?q.push(K):O.userId!==m.uid&&!O.isAdmin&&G.push(K):m.isAdmin?O.userId===m.uid?q.push(K):G.push(K):O.userId===m.uid&&G.push(K)}),a(L),t(q),i(G)},[m,ae]);W.useEffect(()=>{!b&&m&&_()},[m,b,_]);const f=R=>{const L=[...D,...e,...d].find(q=>q.id===R);T(L||null),c(!0)},l=R=>{N(R),E("Are you sure you want to delete this design? This action cannot be undone."),j(!0)},P=async()=>{if(A)if(H!==(m==null?void 0:m.uid))S("User ID confirmation failed. Enter the correct User ID."),C("error"),u(!0);else try{const R=ze(Fe(ae,"builds"),Ee("design_ID","==",A),Ee("userId","==",m.uid)),L=await ft(R);for(const q of L.docs){const G=q.id,V=ze(Fe(ae,"tests"),Ee("build_ID","==",G),Ee("userId","==",m.uid)),$=await ft(V);for(const O of $.docs)await Dt(Re(ae,"tests",O.id));await Dt(Re(ae,"builds",G))}await Dt(Re(ae,"designs",A)),a(q=>q.filter(G=>G.id!==A)),t(q=>q.filter(G=>G.id!==A)),i(q=>q.filter(G=>G.id!==A)),S("Your design and its associated builds and tests have been deleted."),C("success"),u(!0)}catch(R){console.error("Error deleting design, builds, and tests: ",R),S("There was an issue deleting your design and its associated builds and tests."),C("error"),u(!0)}finally{B(""),z(!1),N(null)}};return o.jsxs("div",{className:"container",children:[!n&&!s&&o.jsxs(o.Fragment,{children:[o.jsx(Sr,{setIsAdding:r}),(m==null?void 0:m.isSuperAdmin)&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Super Admin Designs"}),o.jsx(Et,{designs:D,handleEdit:f,handleDelete:l,isAdmin:!0,userDetails:m,showUserIdColumn:!0}),o.jsx("h2",{children:"Educator Designs"}),o.jsx(Et,{designs:e,handleEdit:f,handleDelete:l,isAdmin:!0,userDetails:m,showUserIdColumn:!0}),o.jsx("h2",{children:"Student Designs"}),o.jsx(Et,{designs:d,handleEdit:f,handleDelete:l,isAdmin:!1,userDetails:m,showUserIdColumn:!0})]}),(m==null?void 0:m.isAdmin)&&!m.isSuperAdmin&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Educator Designs"}),o.jsx(Et,{designs:e,handleEdit:f,handleDelete:l,isAdmin:!0,userDetails:m,showUserIdColumn:!0}),o.jsx("h2",{children:"Student Designs"}),o.jsx(Et,{designs:d,handleEdit:f,handleDelete:l,isAdmin:!1,userDetails:m,showUserIdColumn:!0})]}),!(m!=null&&m.isAdmin)&&!(m!=null&&m.isSuperAdmin)&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Student Designs"}),o.jsx(Et,{designs:d,handleEdit:f,handleDelete:l,isAdmin:!1,userDetails:m,showUserIdColumn:!1})]})]}),n&&o.jsx(pi,{designs:D.concat(e),setDesigns:t,setIsAdding:r,getDesigns:_,onReturnToDashboard:y}),s&&o.jsx(yi,{designs:D.concat(e),selectedDesign:v,setDesigns:t,setIsEditing:c,getDesigns:_,onReturnToDashboard:y}),o.jsxs(yt,{open:p,onClose:()=>j(!1),PaperProps:{style:{minWidth:500}},children:[o.jsx(kt,{children:"Confirm Deletion"}),o.jsx(vt,{children:o.jsx(Kt,{children:k})}),o.jsxs(Ut,{children:[o.jsx(Be,{onClick:()=>j(!1),children:"No, cancel"}),o.jsx(Be,{onClick:()=>{z(!0),j(!1)},color:"primary",children:"Yes, delete it"})]})]}),o.jsxs(yt,{open:F,onClose:()=>z(!1),PaperProps:{style:{minWidth:500}},children:[o.jsx(kt,{children:"Confirm Your User ID"}),o.jsx(vt,{children:o.jsx(mn,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:H,onChange:R=>B(R.target.value)})}),o.jsxs(Ut,{children:[o.jsx(Be,{onClick:()=>z(!1),children:"No, cancel"}),o.jsx(Be,{onClick:P,color:"primary",children:"Confirm"})]})]}),o.jsx(At,{open:h,autoHideDuration:6e3,onClose:()=>u(!1),children:o.jsx(St,{onClose:()=>u(!1),severity:w,sx:{width:"100%"},children:x})})]})},Si=yr.memo(vi);export{Si as default};
