import{H as F,j as e,B as c,o as m,T as h,aw as N,Y as Q,af as Y,Z,ag as _,ah as z,an as E,au as le,ap as ne,ae as R,d as r,a4 as ae,a3 as ie,a5 as re,a6 as oe,aq as L,as as O,ar as U,ak as V,ax as ce,ay as de,G as C,q as ue,A as he,Q as w,R as xe,U as pe,ao as me}from"./index-DZtZBepu.js";import{V as be}from"./Visibility-DkDjejxJ.js";const je=()=>{const t=F(),n=()=>{t("/")};return e.jsxs(c,{children:[e.jsx(c,{className:"supplemental-header",children:e.jsx(m,{variant:"text",onClick:n,className:"supplemental-back-button",children:"â† Home Page"})}),e.jsx(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:e.jsx(h,{className:"supplemental-title",children:"Course Materials"})})]})},ge=()=>{const t=F();return e.jsx(m,{className:"add-material-button",variant:"contained",color:"primary",onClick:()=>t("/add-material"),children:"+ Add Material"})},fe=({materialId:t,open:n,onClose:l,onDelete:a})=>{const u=N(),o=async()=>{const i=E(u,"materials",t);await le(i),a(),l()};return e.jsxs(Q,{open:n,onClose:l,children:[e.jsx(Y,{children:"Delete Material"}),e.jsx(Z,{children:e.jsx(_,{children:"Are you sure you want to delete this material? This action cannot be undone."})}),e.jsxs(z,{children:[e.jsx(m,{onClick:l,color:"primary",children:"Cancel"}),e.jsx(m,{onClick:o,color:"secondary",children:"Delete"})]})]})},Ce=({materialId:t,onClick:n})=>e.jsx(m,{variant:"contained",color:"error",onClick:()=>n(t),sx:{backgroundColor:"#FFCDD2",color:"#C62828",borderRadius:"15px",fontWeight:"bold",padding:"4px 8px",ml:1,textTransform:"none"},children:"Unpublish"}),ve=({materialId:t,open:n,onClose:l,onUnpublish:a})=>{const u=N(),o=async()=>{const i=E(u,"materials",t);await ne(i,{published:!1}),a(),l()};return e.jsxs(Q,{open:n,onClose:l,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Y,{id:"alert-dialog-title",children:"Unpublish Material"}),e.jsx(Z,{children:e.jsx(_,{id:"alert-dialog-description",children:"Are you sure you want to unpublish this material? It will no longer be visible to users until it is published again."})}),e.jsxs(z,{children:[e.jsx(m,{onClick:l,color:"primary",children:"Cancel"}),e.jsx(m,{onClick:o,color:"error",autoFocus:!0,children:"Unpublish"})]})]})},ye=({selectedCourse:t,onCourseChange:n,onCoursesLoaded:l})=>{const{userDetails:a}=R(),[u,o]=r.useState([]);return r.useEffect(()=>{if(a!=null&&a.classes){const i=Object.entries(a.classes).map(([b,x])=>({id:b,number:x.number,title:x.title}));o(i),l&&i.length>0&&!t&&l(i[0].id)}else o([]),l&&l(null)},[a,l]),e.jsx(c,{sx:{width:"100%",mb:2},children:u.length>0?e.jsxs(ae,{sx:{width:"30%"},children:[e.jsx(ie,{id:"course-selector-label",children:"Select Course"}),e.jsx(re,{labelId:"course-selector-label",value:t,onChange:i=>n(i.target.value),children:u.map(i=>e.jsxs(oe,{value:i.id,children:[i.number," - ",i.title]},i.id))})]}):e.jsx(h,{variant:"body1",align:"center",children:"No Courses Available"})})},ke=()=>{const{userDetails:t}=R(),n=N(),[l,a]=r.useState([]),[u,o]=r.useState(!0),[i,b]=r.useState(!1),[x,T]=r.useState(!1),[v,J]=r.useState(!1),[d,B]=r.useState(null),[y,H]=r.useState(null),[j,P]=r.useState({open:!1,materialId:null}),[k,D]=r.useState(null),S=F(),K=async()=>{if(!d)return;const s=E(n,"courses",d),g=await me(s);if(g.exists()){const p=g.data(),f=(p==null?void 0:p.courseAdmin)||[];T(f.includes(t==null?void 0:t.uid))}else T(!1)};r.useEffect(()=>{K()},[d,t]),r.useEffect(()=>{if(!d){console.log("No course selected"),a([]),o(!1);return}if(!v){console.log("Initial load in progress, skipping fetch");return}console.log(`Fetching materials for course: ${d}`),o(!0);const s=t!=null&&t.isAdmin?L(V(n,"materials"),U("course","==",d),O("timestamp","desc")):L(V(n,"materials"),U("course","==",d),U("published","==",!0),O("timestamp","desc")),g=ce(s,p=>{const f=p.docs.map(G=>({id:G.id,...G.data()}));a(f),console.log(`Fetched ${f.length} materials for course: ${d}`),o(!1)},p=>{console.error(p),D("Failed to fetch materials"),o(!1)});return()=>g()},[n,d,t,v]);const I=s=>{H(s),b(!0)},X=()=>{b(!1),H(null)},ee=()=>{a(l.filter(s=>s.id!==y))},M=s=>{P({open:!0,materialId:s})},se=()=>{a(l.map(s=>s.id===j.materialId?{...s,published:!1}:s))},te=()=>{P({open:!1,materialId:null})};if(u)return e.jsx(de,{});const $=l.filter(s=>!s.published&&!s.scheduledTimestamp),W=l.filter(s=>s.scheduledTimestamp&&!s.published),q=l.filter(s=>s.published);return e.jsxs(c,{sx:{width:"100%"},children:[e.jsx(ye,{selectedCourse:d||"",onCourseChange:s=>{o(!0),B(s)},onCoursesLoaded:s=>{v||(console.log("Setting first course from onCoursesLoaded:",s),B(s),J(!0))}}),l.length===0&&d&&e.jsx(h,{variant:"body1",align:"center",sx:{width:"100%",mb:4},children:"No materials found for the selected course."}),x&&l.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{sx:{mb:4},children:[e.jsx(h,{variant:"h6",sx:{fontWeight:"bold",color:"#F57C00",mb:2},children:"Saved"}),e.jsx(C,{container:!0,spacing:3,children:$.length===0?e.jsx(h,{variant:"body1",align:"center",sx:{width:"100%"},children:"No saved (unpublished) materials found."}):$.map(s=>e.jsx(A,{material:s,isCourseAdmin:x,navigate:S,onDeleteClick:I,onUnpublishClick:M},s.id))})]}),e.jsxs(c,{sx:{mb:4},children:[e.jsx(h,{variant:"h6",sx:{fontWeight:"bold",color:"#0D47A1",mb:2},children:"Publish Scheduled"}),e.jsx(C,{container:!0,spacing:3,children:W.length===0?e.jsx(h,{variant:"body1",align:"center",sx:{width:"100%"},children:"No materials scheduled for publishing found."}):W.map(s=>e.jsx(A,{material:s,isCourseAdmin:x,navigate:S,onDeleteClick:I,onUnpublishClick:M},s.id))})]})]}),e.jsxs(c,{sx:{mb:4},children:[e.jsx(h,{variant:"h6",sx:{fontWeight:"bold",color:"#2E7D32",mb:2},children:"Published"}),e.jsx(C,{container:!0,spacing:3,children:q.length===0?e.jsx(h,{variant:"body1",align:"center",sx:{width:"100%"},children:"No published materials found."}):q.map(s=>e.jsx(A,{material:s,isCourseAdmin:x,navigate:S,onDeleteClick:I,onUnpublishClick:M},s.id))})]}),y&&e.jsx(fe,{materialId:y,open:i,onClose:X,onDelete:ee}),j.materialId&&e.jsx(ve,{materialId:j.materialId,open:j.open,onClose:te,onUnpublish:se}),k&&e.jsx(ue,{open:!0,autoHideDuration:6e3,onClose:()=>D(null),children:e.jsx(he,{onClose:()=>D(null),severity:"error",children:k})},k)]})},A=({material:t,isCourseAdmin:n,navigate:l,onDeleteClick:a,onUnpublishClick:u})=>e.jsx(C,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(c,{sx:{border:"1px solid #ddd",borderRadius:"8px",padding:2,position:"relative",backgroundColor:t.published?"#E8F5E9":"#FFF9C4"},children:[e.jsx(w,{onClick:()=>l(`/view-material/${t.id}`),"aria-label":"view",children:e.jsx(be,{})}),e.jsx(h,{variant:"h6",children:t.title||"Untitled"}),e.jsx(c,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1},children:n&&e.jsxs(e.Fragment,{children:[e.jsx(w,{onClick:()=>l(`/edit-material/${t.id}`),"aria-label":"edit",children:e.jsx(xe,{})}),e.jsx(w,{onClick:()=>a(t.id),"aria-label":"delete",children:e.jsx(pe,{})}),t.published&&e.jsx(Ce,{materialId:t.id,onClick:u})]})})]})}),Ie=()=>{const{userDetails:t}=R();return e.jsxs(c,{className:"supplemental-container",children:[e.jsx(je,{}),e.jsxs(c,{className:"supplemental-content",children:[(t==null?void 0:t.isAdmin)&&e.jsx(ge,{}),e.jsx(ke,{})]})]})};export{Ie as default};
