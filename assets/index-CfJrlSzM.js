import{n as ws,k as _s,o as Es,_ as ht,b as z,y as js,f as Is,Q as Pn,j as o,g as Bn,i as Ds,B as or,p as lr,x as on,R as ns,U as ss,V as cr,W as dr,X as Ot,Y as ur,F as Vt,I as Le,T as fr,Z as rs,J as Yt,$ as hr,S as mt,K as pt,a0 as mr,a1 as pr,a2 as gr,a3 as br,a4 as En,a5 as Ve,a6 as xr,a7 as Xe,a8 as Rs,a9 as qt,aa as Wn,ab as ln,ac as vr,A as gt,C as bt,ad as At,ae as Ct,af as Et,ag as jt,ah as Fs,ai as ks,aj as hn,ak as yr,al as is,am as as,an as Tr,ao as Ar,ap as Cr,aq as Sr,H as bn,ar as wr,as as Hn,at as Ft,au as Xt,av as kt,aw as Qt,ax as Gn,ay as Fe,az as oe,aA as ut,aB as Re,aC as _r,aD as jn,aE as Be,aF as Ee,aG as st,aH as ft,aI as It,aJ as Er}from"./index-Dm7jlzuU.js";import{d as In}from"./Visibility-T4bj_6Lg.js";function jr(l){return _s("MuiListItemIcon",l)}const os=ws("MuiListItemIcon",["root","alignItemsFlexStart"]),Ir=["className"],Dr=l=>{const{alignItems:g,classes:D}=l;return Ds({root:["root",g==="flex-start"&&"alignItemsFlexStart"]},jr,D)},Rr=Es("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(l,g)=>{const{ownerState:D}=l;return[g.root,D.alignItems==="flex-start"&&g.alignItemsFlexStart]}})(({theme:l,ownerState:g})=>ht({minWidth:56,color:(l.vars||l).palette.action.active,flexShrink:0,display:"inline-flex"},g.alignItems==="flex-start"&&{marginTop:8})),Fr=z.forwardRef(function(g,D){const d=js({props:g,name:"MuiListItemIcon"}),{className:e}=d,t=Is(d,Ir),f=z.useContext(Pn),a=ht({},d,{alignItems:f.alignItems}),y=Dr(a);return o.jsx(Rr,ht({className:Bn(y.root,e),ownerState:a,ref:D},t))});function kr(l){return _s("MuiMenuItem",l)}const Pt=ws("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),Or=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],Ur=(l,g)=>{const{ownerState:D}=l;return[g.root,D.dense&&g.dense,D.divider&&g.divider,!D.disableGutters&&g.gutters]},Mr=l=>{const{disabled:g,dense:D,divider:d,disableGutters:e,selected:t,classes:f}=l,y=Ds({root:["root",D&&"dense",g&&"disabled",!e&&"gutters",d&&"divider",t&&"selected"]},kr,f);return ht({},f,y)},Nr=Es(or,{shouldForwardProp:l=>lr(l)||l==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:Ur})(({theme:l,ownerState:g})=>ht({},l.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!g.disableGutters&&{paddingLeft:16,paddingRight:16},g.divider&&{borderBottom:`1px solid ${(l.vars||l).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(l.vars||l).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Pt.selected}`]:{backgroundColor:l.vars?`rgba(${l.vars.palette.primary.mainChannel} / ${l.vars.palette.action.selectedOpacity})`:on(l.palette.primary.main,l.palette.action.selectedOpacity),[`&.${Pt.focusVisible}`]:{backgroundColor:l.vars?`rgba(${l.vars.palette.primary.mainChannel} / calc(${l.vars.palette.action.selectedOpacity} + ${l.vars.palette.action.focusOpacity}))`:on(l.palette.primary.main,l.palette.action.selectedOpacity+l.palette.action.focusOpacity)}},[`&.${Pt.selected}:hover`]:{backgroundColor:l.vars?`rgba(${l.vars.palette.primary.mainChannel} / calc(${l.vars.palette.action.selectedOpacity} + ${l.vars.palette.action.hoverOpacity}))`:on(l.palette.primary.main,l.palette.action.selectedOpacity+l.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:l.vars?`rgba(${l.vars.palette.primary.mainChannel} / ${l.vars.palette.action.selectedOpacity})`:on(l.palette.primary.main,l.palette.action.selectedOpacity)}},[`&.${Pt.focusVisible}`]:{backgroundColor:(l.vars||l).palette.action.focus},[`&.${Pt.disabled}`]:{opacity:(l.vars||l).palette.action.disabledOpacity},[`& + .${ns.root}`]:{marginTop:l.spacing(1),marginBottom:l.spacing(1)},[`& + .${ns.inset}`]:{marginLeft:52},[`& .${ss.root}`]:{marginTop:0,marginBottom:0},[`& .${ss.inset}`]:{paddingLeft:36},[`& .${os.root}`]:{minWidth:36}},!g.dense&&{[l.breakpoints.up("sm")]:{minHeight:"auto"}},g.dense&&ht({minHeight:32,paddingTop:4,paddingBottom:4},l.typography.body2,{[`& .${os.root} svg`]:{fontSize:"1.25rem"}}))),cn=z.forwardRef(function(g,D){const d=js({props:g,name:"MuiMenuItem"}),{autoFocus:e=!1,component:t="li",dense:f=!1,divider:a=!1,disableGutters:y=!1,focusVisibleClassName:C,role:n="menuitem",tabIndex:r,className:s}=d,u=Is(d,Or),x=z.useContext(Pn),j=z.useMemo(()=>({dense:f||x.dense||!1,disableGutters:y}),[x.dense,f,y]),k=z.useRef(null);cr(()=>{e&&k.current&&k.current.focus()},[e]);const w=ht({},d,{dense:j.dense,divider:a,disableGutters:y}),P=Mr(d),M=dr(k,D);let O;return d.disabled||(O=r!==void 0?r:-1),o.jsx(Pn.Provider,{value:j,children:o.jsx(Nr,ht({ref:M,role:n,tabIndex:O,component:t,focusVisibleClassName:Bn(P.focusVisible,C),className:Bn(P.root,s)},u,{ownerState:w,classes:P}))})}),Lr=z.memo(({setIsAdding:l})=>{const{userDetails:g}=Ot();console.log("Header loaded");const D=ur(),[d,e]=z.useState(!1),[t,f]=z.useState(!1),a=()=>{g!=null&&g.uid?navigator.clipboard.writeText(g.uid).then(()=>{e(!0),f(!0)}).catch(n=>{console.error("Could not copy text: ",n)}):console.error("User details are null or undefined")},y=(n,r)=>{r!=="clickaway"&&e(!1)},C=()=>{D("/")};return o.jsxs(Vt,{sx:{mt:3,mb:2},children:[o.jsx(Vt,{sx:{display:"flex",alignItems:"center"},children:o.jsx(Le,{variant:"text",onClick:C,sx:{mr:2},children:"← Home Page"})}),o.jsx(fr,{variant:"h4",component:"h1",gutterBottom:!0,textAlign:"left",sx:{fontWeight:"bold"},children:"My Laboratory Notebook"}),g&&o.jsxs(Vt,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:[g.isAdmin&&o.jsx(rs,{label:"Admin",variant:"outlined",sx:{borderRadius:"15px",fontWeight:"bold",background:"#ffcdd2",color:"#c62828",mr:1}}),o.jsx(Yt,{title:t?"Copied!":"Click to Copy",enterDelay:300,leaveDelay:200,children:o.jsx(rs,{label:`User ID: ${g.uid}`,variant:"outlined",onClick:a,sx:{borderRadius:"15px",fontWeight:"bold",background:"#e0f2f1",color:"#00695c",mr:1,cursor:"pointer",transition:"background-color 0.3s"}})})]}),o.jsxs(Vt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx(Le,{variant:"contained",color:"primary",onClick:()=>l(!0),sx:{fontSize:"1.2rem",mt:2,textTransform:"none",minWidth:"150px",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"+ Create New"}),o.jsx(hr,{})]}),o.jsx(mt,{open:d,autoHideDuration:6e3,onClose:y,children:o.jsx(pt,{onClose:y,severity:"success",sx:{width:"100%"},children:"User ID copied to clipboard!"})})]})}),Dn=({designs:l,handleEdit:g,handleDelete:D,isAdmin:d,userDetails:e,showUserIdColumn:t})=>{const f=a=>a?a instanceof Wn?a.toDate().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):a instanceof Date?a.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A":"N/A";return o.jsx(mr,{component:pr,children:o.jsxs(gr,{sx:{"& .MuiTableCell-root":{fontSize:"1rem"},"& .MuiTableCell-head":{fontSize:"1.2rem",backgroundColor:"#1A76D3",color:"white"}},children:[o.jsx(br,{children:o.jsxs(En,{sx:{height:"60px"},children:[o.jsx(Ve,{sx:{fontWeight:"bold",width:t?"30%":"40%"},children:"Title"}),t&&o.jsx(Ve,{sx:{fontWeight:"bold",width:"20%"},children:"User ID"}),o.jsx(Ve,{sx:{fontWeight:"bold",width:"15%"},children:"Created"}),o.jsx(Ve,{sx:{fontWeight:"bold",width:"15%"},children:"Last Edited"}),o.jsx(Ve,{sx:{fontWeight:"bold",width:"10%"},children:"Edit"}),o.jsx(Ve,{sx:{fontWeight:"bold",width:"10%"},children:"Delete"})]})}),o.jsx(xr,{children:l&&l.length>0?l.map(a=>{const y=a.userId===(e==null?void 0:e.uid);return o.jsxs(En,{sx:{height:"80px"},children:[o.jsx(Ve,{children:o.jsx("button",{onClick:()=>g(a.id),className:"hyperlink-style",children:a.title})}),t&&o.jsx(Ve,{children:a.userId}),o.jsx(Ve,{children:f(a.dateCreated)}),o.jsx(Ve,{children:f(a.dateModified)}),o.jsx(Ve,{children:o.jsx(Yt,{title:"Edit",children:o.jsx("span",{children:o.jsx(Xe,{onClick:()=>y&&g(a.id),color:"primary",disabled:!y,children:o.jsx(Rs,{})})})})}),o.jsx(Ve,{children:o.jsx(Yt,{title:"Delete",children:o.jsx("span",{children:o.jsx(Xe,{onClick:()=>y&&D(a.id),color:"error",disabled:!y,children:o.jsx(qt,{})})})})})]},a.id)}):o.jsx(En,{children:o.jsx(Ve,{colSpan:t?6:5,children:"No Designs Found"})})})]})})};function Pr(l,g){return g.forEach(function(D){D&&typeof D!="string"&&!Array.isArray(D)&&Object.keys(D).forEach(function(d){if(d!=="default"&&!(d in l)){var e=Object.getOwnPropertyDescriptor(D,d);Object.defineProperty(l,d,e.get?e:{enumerable:!0,get:function(){return D[d]}})}})}),Object.freeze(l)}function Os(l,g){return new Promise(function(D,d){let e;return Br(l).then(function(t){try{return e=t,D(new Blob([g.slice(0,2),e,g.slice(2)],{type:"image/jpeg"}))}catch(f){return d(f)}},d)})}const Br=l=>new Promise((g,D)=>{const d=new FileReader;d.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let f=0;if(t.getUint16(f)!==65496)return D("not a valid JPEG");for(f+=2;;){const a=t.getUint16(f);if(a===65498)break;const y=t.getUint16(f+2);if(a===65505&&t.getUint32(f+4)===1165519206){const C=f+10;let n;switch(t.getUint16(C)){case 18761:n=!0;break;case 19789:n=!1;break;default:return D("TIFF header contains invalid endian")}if(t.getUint16(C+2,n)!==42)return D("TIFF header contains invalid version");const r=t.getUint32(C+4,n),s=C+r+2+12*t.getUint16(C+r,n);for(let u=C+r+2;u<s;u+=12)if(t.getUint16(u,n)==274){if(t.getUint16(u+2,n)!==3)return D("Orientation data type is invalid");if(t.getUint32(u+4,n)!==1)return D("Orientation data count is invalid");t.setUint16(u+8,1,n);break}return g(e.slice(f,f+2+y))}f+=2+y}return g(new Blob)}),d.readAsArrayBuffer(l)});var xn={},Hr={get exports(){return xn},set exports(l){xn=l}};(function(l){var g,D,d={};Hr.exports=d,d.parse=function(e,t){for(var f=d.bin.readUshort,a=d.bin.readUint,y=0,C={},n=new Uint8Array(e),r=n.length-4;a(n,r)!=101010256;)r--;y=r,y+=4;var s=f(n,y+=4);f(n,y+=2);var u=a(n,y+=2),x=a(n,y+=4);y+=4,y=x;for(var j=0;j<s;j++){a(n,y),y+=4,y+=4,y+=4,a(n,y+=4),u=a(n,y+=4);var k=a(n,y+=4),w=f(n,y+=4),P=f(n,y+2),M=f(n,y+4);y+=6;var O=a(n,y+=8);y+=4,y+=w+P+M,d._readLocal(n,O,C,u,k,t)}return C},d._readLocal=function(e,t,f,a,y,C){var n=d.bin.readUshort,r=d.bin.readUint;r(e,t),n(e,t+=4),n(e,t+=2);var s=n(e,t+=2);r(e,t+=2),r(e,t+=4),t+=4;var u=n(e,t+=8),x=n(e,t+=2);t+=2;var j=d.bin.readUTF8(e,t,u);if(t+=u,t+=x,C)f[j]={size:y,csize:a};else{var k=new Uint8Array(e.buffer,t);if(s==0)f[j]=new Uint8Array(k.buffer.slice(t,t+a));else{if(s!=8)throw"unknown compression method: "+s;var w=new Uint8Array(y);d.inflateRaw(k,w),f[j]=w}}},d.inflateRaw=function(e,t){return d.F.inflate(e,t)},d.inflate=function(e,t){return e[0],e[1],d.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},d.deflate=function(e,t){t==null&&(t={level:6});var f=0,a=new Uint8Array(50+Math.floor(1.1*e.length));a[f]=120,a[f+1]=156,f+=2,f=d.F.deflateRaw(e,a,f,t.level);var y=d.adler(e,0,e.length);return a[f+0]=y>>>24&255,a[f+1]=y>>>16&255,a[f+2]=y>>>8&255,a[f+3]=y>>>0&255,new Uint8Array(a.buffer,0,f+4)},d.deflateRaw=function(e,t){t==null&&(t={level:6});var f=new Uint8Array(50+Math.floor(1.1*e.length)),a=d.F.deflateRaw(e,f,a,t.level);return new Uint8Array(f.buffer,0,a)},d.encode=function(e,t){t==null&&(t=!1);var f=0,a=d.bin.writeUint,y=d.bin.writeUshort,C={};for(var n in e){var r=!d._noNeed(n)&&!t,s=e[n],u=d.crc.crc(s,0,s.length);C[n]={cpr:r,usize:s.length,crc:u,file:r?d.deflateRaw(s):s}}for(var n in C)f+=C[n].file.length+30+46+2*d.bin.sizeUTF8(n);f+=22;var x=new Uint8Array(f),j=0,k=[];for(var n in C){var w=C[n];k.push(j),j=d._writeHeader(x,j,n,w,0)}var P=0,M=j;for(var n in C)w=C[n],k.push(j),j=d._writeHeader(x,j,n,w,1,k[P++]);var O=j-M;return a(x,j,101010256),j+=4,y(x,j+=4,P),y(x,j+=2,P),a(x,j+=2,O),a(x,j+=4,M),j+=4,j+=2,x.buffer},d._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},d._writeHeader=function(e,t,f,a,y,C){var n=d.bin.writeUint,r=d.bin.writeUshort,s=a.file;return n(e,t,y==0?67324752:33639248),t+=4,y==1&&(t+=2),r(e,t,20),r(e,t+=2,0),r(e,t+=2,a.cpr?8:0),n(e,t+=2,0),n(e,t+=4,a.crc),n(e,t+=4,s.length),n(e,t+=4,a.usize),r(e,t+=4,d.bin.sizeUTF8(f)),r(e,t+=2,0),t+=2,y==1&&(t+=2,t+=2,n(e,t+=6,C),t+=4),t+=d.bin.writeUTF8(e,t,f),y==0&&(e.set(s,t),t+=s.length),t},d.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var f=t,a=0;a<8;a++)1&f?f=3988292384^f>>>1:f>>>=1;e[t]=f}return e}(),update:function(e,t,f,a){for(var y=0;y<a;y++)e=d.crc.table[255&(e^t[f+y])]^e>>>8;return e},crc:function(e,t,f){return 4294967295^d.crc.update(4294967295,e,t,f)}},d.adler=function(e,t,f){for(var a=1,y=0,C=t,n=t+f;C<n;){for(var r=Math.min(C+5552,n);C<r;)y+=a+=e[C++];a%=65521,y%=65521}return y<<16|a},d.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,f){e[t]=255&f,e[t+1]=f>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,f){e[t]=255&f,e[t+1]=f>>8&255,e[t+2]=f>>16&255,e[t+3]=f>>24&255},readASCII:function(e,t,f){for(var a="",y=0;y<f;y++)a+=String.fromCharCode(e[t+y]);return a},writeASCII:function(e,t,f){for(var a=0;a<f.length;a++)e[t+a]=f.charCodeAt(a)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,f){for(var a,y="",C=0;C<f;C++)y+="%"+d.bin.pad(e[t+C].toString(16));try{a=decodeURIComponent(y)}catch{return d.bin.readASCII(e,t,f)}return a},writeUTF8:function(e,t,f){for(var a=f.length,y=0,C=0;C<a;C++){var n=f.charCodeAt(C);if(!(4294967168&n))e[t+y]=n,y++;else if(!(4294965248&n))e[t+y]=192|n>>6,e[t+y+1]=128|n>>0&63,y+=2;else if(!(4294901760&n))e[t+y]=224|n>>12,e[t+y+1]=128|n>>6&63,e[t+y+2]=128|n>>0&63,y+=3;else{if(4292870144&n)throw"e";e[t+y]=240|n>>18,e[t+y+1]=128|n>>12&63,e[t+y+2]=128|n>>6&63,e[t+y+3]=128|n>>0&63,y+=4}}return y},sizeUTF8:function(e){for(var t=e.length,f=0,a=0;a<t;a++){var y=e.charCodeAt(a);if(!(4294967168&y))f++;else if(!(4294965248&y))f+=2;else if(!(4294901760&y))f+=3;else{if(4292870144&y)throw"e";f+=4}}return f}},d.F={},d.F.deflateRaw=function(e,t,f,a){var y=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],C=d.F.U,n=d.F._goodIndex;d.F._hash;var r=d.F._putsE,s=0,u=f<<3,x=0,j=e.length;if(a==0){for(;s<j;)r(t,u,s+(A=Math.min(65535,j-s))==j?1:0),u=d.F._copyExact(e,s,A,t,u+8),s+=A;return u>>>3}var k=C.lits,w=C.strt,P=C.prev,M=0,O=0,B=0,v=0,N=0,m=0;for(j>2&&(w[m=d.F._hash(e,0)]=0),s=0;s<j;s++){if(N=m,s+1<j-2){m=d.F._hash(e,s+1);var h=s+1&32767;P[h]=w[m],w[m]=h}if(x<=s){(M>14e3||O>26697)&&j-s>100&&(x<s&&(k[M]=s-x,M+=2,x=s),u=d.F._writeBlock(s==j-1||x==j?1:0,k,M,v,e,B,s-B,t,u),M=O=v=0,B=s);var b=0;s<j-2&&(b=d.F._bestMatch(e,s,P,N,Math.min(y[2],j-s),y[3]));var A=b>>>16,S=65535&b;if(b!=0){S=65535&b;var _=n(A=b>>>16,C.of0);C.lhst[257+_]++;var T=n(S,C.df0);C.dhst[T]++,v+=C.exb[_]+C.dxb[T],k[M]=A<<23|s-x,k[M+1]=S<<16|_<<8|T,M+=2,x=s+A}else C.lhst[e[s]]++;O++}}for(B==s&&e.length!=0||(x<s&&(k[M]=s-x,M+=2,x=s),u=d.F._writeBlock(1,k,M,v,e,B,s-B,t,u),M=0,O=0,M=O=v=0,B=s);7&u;)u++;return u>>>3},d.F._bestMatch=function(e,t,f,a,y,C){var n=32767&t,r=f[n],s=n-r+32768&32767;if(r==n||a!=d.F._hash(e,t-s))return 0;for(var u=0,x=0,j=Math.min(32767,t);s<=j&&--C!=0&&r!=n;){if(u==0||e[t+u]==e[t+u-s]){var k=d.F._howLong(e,t,s);if(k>u){if(x=s,(u=k)>=y)break;s+2<k&&(k=s+2);for(var w=0,P=0;P<k-2;P++){var M=t-s+P+32768&32767,O=M-f[M]+32768&32767;O>w&&(w=O,r=M)}}}s+=(n=r)-(r=f[n])+32768&32767}return u<<16|x},d.F._howLong=function(e,t,f){if(e[t]!=e[t-f]||e[t+1]!=e[t+1-f]||e[t+2]!=e[t+2-f])return 0;var a=t,y=Math.min(e.length,t+258);for(t+=3;t<y&&e[t]==e[t-f];)t++;return t-a},d.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},d.saved=0,d.F._writeBlock=function(e,t,f,a,y,C,n,r,s){var u,x,j,k,w,P,M,O,B,v=d.F.U,N=d.F._putsF,m=d.F._putsE;v.lhst[256]++,x=(u=d.F.getTrees())[0],j=u[1],k=u[2],w=u[3],P=u[4],M=u[5],O=u[6],B=u[7];var h=32+(s+3&7?8-(s+3&7):0)+(n<<3),b=a+d.F.contSize(v.fltree,v.lhst)+d.F.contSize(v.fdtree,v.dhst),A=a+d.F.contSize(v.ltree,v.lhst)+d.F.contSize(v.dtree,v.dhst);A+=14+3*M+d.F.contSize(v.itree,v.ihst)+(2*v.ihst[16]+3*v.ihst[17]+7*v.ihst[18]);for(var S=0;S<286;S++)v.lhst[S]=0;for(S=0;S<30;S++)v.dhst[S]=0;for(S=0;S<19;S++)v.ihst[S]=0;var _=h<b&&h<A?0:b<A?1:2;if(N(r,s,e),N(r,s+1,_),s+=3,_==0){for(;7&s;)s++;s=d.F._copyExact(y,C,n,r,s)}else{var T,F;if(_==1&&(T=v.fltree,F=v.fdtree),_==2){d.F.makeCodes(v.ltree,x),d.F.revCodes(v.ltree,x),d.F.makeCodes(v.dtree,j),d.F.revCodes(v.dtree,j),d.F.makeCodes(v.itree,k),d.F.revCodes(v.itree,k),T=v.ltree,F=v.dtree,m(r,s,w-257),m(r,s+=5,P-1),m(r,s+=5,M-4),s+=4;for(var p=0;p<M;p++)m(r,s+3*p,v.itree[1+(v.ordr[p]<<1)]);s+=3*M,s=d.F._codeTiny(O,v.itree,r,s),s=d.F._codeTiny(B,v.itree,r,s)}for(var c=C,U=0;U<f;U+=2){for(var I=t[U],L=I>>>23,q=c+(8388607&I);c<q;)s=d.F._writeLit(y[c++],T,r,s);if(L!=0){var $=t[U+1],Q=$>>16,W=$>>8&255,H=255&$;m(r,s=d.F._writeLit(257+W,T,r,s),L-v.of0[W]),s+=v.exb[W],N(r,s=d.F._writeLit(H,F,r,s),Q-v.df0[H]),s+=v.dxb[H],c+=L}}s=d.F._writeLit(256,T,r,s)}return s},d.F._copyExact=function(e,t,f,a,y){var C=y>>>3;return a[C]=f,a[C+1]=f>>>8,a[C+2]=255-a[C],a[C+3]=255-a[C+1],C+=4,a.set(new Uint8Array(e.buffer,t,f),C),y+(f+4<<3)},d.F.getTrees=function(){for(var e=d.F.U,t=d.F._hufTree(e.lhst,e.ltree,15),f=d.F._hufTree(e.dhst,e.dtree,15),a=[],y=d.F._lenCodes(e.ltree,a),C=[],n=d.F._lenCodes(e.dtree,C),r=0;r<a.length;r+=2)e.ihst[a[r]]++;for(r=0;r<C.length;r+=2)e.ihst[C[r]]++;for(var s=d.F._hufTree(e.ihst,e.itree,7),u=19;u>4&&e.itree[1+(e.ordr[u-1]<<1)]==0;)u--;return[t,f,s,y,n,u,a,C]},d.F.getSecond=function(e){for(var t=[],f=0;f<e.length;f+=2)t.push(e[f+1]);return t},d.F.nonZero=function(e){for(var t="",f=0;f<e.length;f+=2)e[f+1]!=0&&(t+=(f>>1)+",");return t},d.F.contSize=function(e,t){for(var f=0,a=0;a<t.length;a++)f+=t[a]*e[1+(a<<1)];return f},d.F._codeTiny=function(e,t,f,a){for(var y=0;y<e.length;y+=2){var C=e[y],n=e[y+1];a=d.F._writeLit(C,t,f,a);var r=C==16?2:C==17?3:7;C>15&&(d.F._putsE(f,a,n,r),a+=r)}return a},d.F._lenCodes=function(e,t){for(var f=e.length;f!=2&&e[f-1]==0;)f-=2;for(var a=0;a<f;a+=2){var y=e[a+1],C=a+3<f?e[a+3]:-1,n=a+5<f?e[a+5]:-1,r=a==0?-1:e[a-1];if(y==0&&C==y&&n==y){for(var s=a+5;s+2<f&&e[s+2]==y;)s+=2;(u=Math.min(s+1-a>>>1,138))<11?t.push(17,u-3):t.push(18,u-11),a+=2*u-2}else if(y==r&&C==y&&n==y){for(s=a+5;s+2<f&&e[s+2]==y;)s+=2;var u=Math.min(s+1-a>>>1,6);t.push(16,u-3),a+=2*u-2}else t.push(y,0)}return f>>>1},d.F._hufTree=function(e,t,f){var a=[],y=e.length,C=t.length,n=0;for(n=0;n<C;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<y;n++)e[n]!=0&&a.push({lit:n,f:e[n]});var r=a.length,s=a.slice(0);if(r==0)return 0;if(r==1){var u=a[0].lit;return s=u==0?1:0,t[1+(u<<1)]=1,t[1+(s<<1)]=1,1}a.sort(function(O,B){return O.f-B.f});var x=a[0],j=a[1],k=0,w=1,P=2;for(a[0]={lit:-1,f:x.f+j.f,l:x,r:j,d:0};w!=r-1;)x=k!=w&&(P==r||a[k].f<a[P].f)?a[k++]:a[P++],j=k!=w&&(P==r||a[k].f<a[P].f)?a[k++]:a[P++],a[w++]={lit:-1,f:x.f+j.f,l:x,r:j};var M=d.F.setDepth(a[w-1],0);for(M>f&&(d.F.restrictDepth(s,f,M),M=f),n=0;n<r;n++)t[1+(s[n].lit<<1)]=s[n].d;return M},d.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(d.F.setDepth(e.l,t+1),d.F.setDepth(e.r,t+1))},d.F.restrictDepth=function(e,t,f){var a=0,y=1<<f-t,C=0;for(e.sort(function(r,s){return s.d==r.d?r.f-s.f:s.d-r.d}),a=0;a<e.length&&e[a].d>t;a++){var n=e[a].d;e[a].d=t,C+=y-(1<<f-n)}for(C>>>=f-t;C>0;)(n=e[a].d)<t?(e[a].d++,C-=1<<t-n-1):a++;for(;a>=0;a--)e[a].d==t&&C<0&&(e[a].d--,C++);C!=0&&console.log("debt left")},d.F._goodIndex=function(e,t){var f=0;return t[16|f]<=e&&(f|=16),t[8|f]<=e&&(f|=8),t[4|f]<=e&&(f|=4),t[2|f]<=e&&(f|=2),t[1|f]<=e&&(f|=1),f},d.F._writeLit=function(e,t,f,a){return d.F._putsF(f,a,t[e<<1]),a+t[1+(e<<1)]},d.F.inflate=function(e,t){var f=Uint8Array;if(e[0]==3&&e[1]==0)return t||new f(0);var a=d.F,y=a._bitsF,C=a._bitsE,n=a._decodeTiny,r=a.makeCodes,s=a.codes2map,u=a._get17,x=a.U,j=t==null;j&&(t=new f(e.length>>>2<<3));for(var k,w,P=0,M=0,O=0,B=0,v=0,N=0,m=0,h=0,b=0;P==0;)if(P=y(e,b,1),M=y(e,b+1,2),b+=3,M!=0){if(j&&(t=d.F._check(t,h+(1<<17))),M==1&&(k=x.flmap,w=x.fdmap,N=511,m=31),M==2){O=C(e,b,5)+257,B=C(e,b+5,5)+1,v=C(e,b+10,4)+4,b+=14;for(var A=0;A<38;A+=2)x.itree[A]=0,x.itree[A+1]=0;var S=1;for(A=0;A<v;A++){var _=C(e,b+3*A,3);x.itree[1+(x.ordr[A]<<1)]=_,_>S&&(S=_)}b+=3*v,r(x.itree,S),s(x.itree,S,x.imap),k=x.lmap,w=x.dmap,b=n(x.imap,(1<<S)-1,O+B,e,b,x.ttree);var T=a._copyOut(x.ttree,0,O,x.ltree);N=(1<<T)-1;var F=a._copyOut(x.ttree,O,B,x.dtree);m=(1<<F)-1,r(x.ltree,T),s(x.ltree,T,k),r(x.dtree,F),s(x.dtree,F,w)}for(;;){var p=k[u(e,b)&N];b+=15&p;var c=p>>>4;if(!(c>>>8))t[h++]=c;else{if(c==256)break;var U=h+c-254;if(c>264){var I=x.ldef[c-257];U=h+(I>>>3)+C(e,b,7&I),b+=7&I}var L=w[u(e,b)&m];b+=15&L;var q=L>>>4,$=x.ddef[q],Q=($>>>4)+y(e,b,15&$);for(b+=15&$,j&&(t=d.F._check(t,h+(1<<17)));h<U;)t[h]=t[h++-Q],t[h]=t[h++-Q],t[h]=t[h++-Q],t[h]=t[h++-Q];h=U}}}else{7&b&&(b+=8-(7&b));var W=4+(b>>>3),H=e[W-4]|e[W-3]<<8;j&&(t=d.F._check(t,h+H)),t.set(new f(e.buffer,e.byteOffset+W,H),h),b=W+H<<3,h+=H}return t.length==h?t:t.slice(0,h)},d.F._check=function(e,t){var f=e.length;if(t<=f)return e;var a=new Uint8Array(Math.max(f<<1,t));return a.set(e,0),a},d.F._decodeTiny=function(e,t,f,a,y,C){for(var n=d.F._bitsE,r=d.F._get17,s=0;s<f;){var u=e[r(a,y)&t];y+=15&u;var x=u>>>4;if(x<=15)C[s]=x,s++;else{var j=0,k=0;x==16?(k=3+n(a,y,2),y+=2,j=C[s-1]):x==17?(k=3+n(a,y,3),y+=3):x==18&&(k=11+n(a,y,7),y+=7);for(var w=s+k;s<w;)C[s]=j,s++}}return y},d.F._copyOut=function(e,t,f,a){for(var y=0,C=0,n=a.length>>>1;C<f;){var r=e[C+t];a[C<<1]=0,a[1+(C<<1)]=r,r>y&&(y=r),C++}for(;C<n;)a[C<<1]=0,a[1+(C<<1)]=0,C++;return y},d.F.makeCodes=function(e,t){for(var f,a,y,C,n=d.F.U,r=e.length,s=n.bl_count,u=0;u<=t;u++)s[u]=0;for(u=1;u<r;u+=2)s[e[u]]++;var x=n.next_code;for(f=0,s[0]=0,a=1;a<=t;a++)f=f+s[a-1]<<1,x[a]=f;for(y=0;y<r;y+=2)(C=e[y+1])!=0&&(e[y]=x[C],x[C]++)},d.F.codes2map=function(e,t,f){for(var a=e.length,y=d.F.U.rev15,C=0;C<a;C+=2)if(e[C+1]!=0)for(var n=C>>1,r=e[C+1],s=n<<4|r,u=t-r,x=e[C]<<u,j=x+(1<<u);x!=j;)f[y[x]>>>15-t]=s,x++},d.F.revCodes=function(e,t){for(var f=d.F.U.rev15,a=15-t,y=0;y<e.length;y+=2){var C=e[y]<<t-e[y+1];e[y]=f[C]>>>a}},d.F._putsE=function(e,t,f){f<<=7&t;var a=t>>>3;e[a]|=f,e[a+1]|=f>>>8},d.F._putsF=function(e,t,f){f<<=7&t;var a=t>>>3;e[a]|=f,e[a+1]|=f>>>8,e[a+2]|=f>>>16},d.F._bitsE=function(e,t,f){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<f)-1},d.F._bitsF=function(e,t,f){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<f)-1},d.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},d.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},d.F.U=(g=Uint16Array,D=Uint32Array,{next_code:new g(16),bl_count:new g(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new g(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new D(32),flmap:new g(512),fltree:[],fdmap:new g(32),fdtree:[],lmap:new g(32768),ltree:[],ttree:[],dmap:new g(32768),dtree:[],imap:new g(512),itree:[],rev15:new g(32768),lhst:new D(286),dhst:new D(30),ihst:new D(19),lits:new D(15e3),strt:new g(65536),prev:new g(32768)}),function(){for(var e=d.F.U,t=0;t<32768;t++){var f=t;f=(4278255360&(f=(4042322160&(f=(3435973836&(f=(2863311530&f)>>>1|(1431655765&f)<<1))>>>2|(858993459&f)<<2))>>>4|(252645135&f)<<4))>>>8|(16711935&f)<<8,e.rev15[t]=(f>>>16|f<<16)>>>17}function a(y,C,n){for(;C--!=0;)y.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];a(e.fltree,144,8),a(e.fltree,112,9),a(e.fltree,24,7),a(e.fltree,8,8),d.F.makeCodes(e.fltree,9),d.F.codes2map(e.fltree,9,e.flmap),d.F.revCodes(e.fltree,9),a(e.fdtree,32,5),d.F.makeCodes(e.fdtree,5),d.F.codes2map(e.fdtree,5,e.fdmap),d.F.revCodes(e.fdtree,5),a(e.itree,19,0),a(e.ltree,286,0),a(e.dtree,30,0),a(e.ttree,320,0)}()})();var $r=Pr({__proto__:null,default:xn},[xn]);const tt=function(){var l={nextZero(n,r){for(;n[r]!=0;)r++;return r},readUshort:(n,r)=>n[r]<<8|n[r+1],writeUshort(n,r,s){n[r]=s>>8&255,n[r+1]=255&s},readUint:(n,r)=>16777216*n[r]+(n[r+1]<<16|n[r+2]<<8|n[r+3]),writeUint(n,r,s){n[r]=s>>24&255,n[r+1]=s>>16&255,n[r+2]=s>>8&255,n[r+3]=255&s},readASCII(n,r,s){let u="";for(let x=0;x<s;x++)u+=String.fromCharCode(n[r+x]);return u},writeASCII(n,r,s){for(let u=0;u<s.length;u++)n[r+u]=s.charCodeAt(u)},readBytes(n,r,s){const u=[];for(let x=0;x<s;x++)u.push(n[r+x]);return u},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,r,s){let u,x="";for(let j=0;j<s;j++)x+=`%${l.pad(n[r+j].toString(16))}`;try{u=decodeURIComponent(x)}catch{return l.readASCII(n,r,s)}return u}};function g(n,r,s,u){const x=r*s,j=t(u),k=Math.ceil(r*j/8),w=new Uint8Array(4*x),P=new Uint32Array(w.buffer),{ctype:M}=u,{depth:O}=u,B=l.readUshort;if(M==6){const I=x<<2;if(O==8)for(var v=0;v<I;v+=4)w[v]=n[v],w[v+1]=n[v+1],w[v+2]=n[v+2],w[v+3]=n[v+3];if(O==16)for(v=0;v<I;v++)w[v]=n[v<<1]}else if(M==2){const I=u.tabs.tRNS;if(I==null){if(O==8)for(v=0;v<x;v++){var N=3*v;P[v]=255<<24|n[N+2]<<16|n[N+1]<<8|n[N]}if(O==16)for(v=0;v<x;v++)N=6*v,P[v]=255<<24|n[N+4]<<16|n[N+2]<<8|n[N]}else{var m=I[0];const L=I[1],q=I[2];if(O==8)for(v=0;v<x;v++){var h=v<<2;N=3*v,P[v]=255<<24|n[N+2]<<16|n[N+1]<<8|n[N],n[N]==m&&n[N+1]==L&&n[N+2]==q&&(w[h+3]=0)}if(O==16)for(v=0;v<x;v++)h=v<<2,N=6*v,P[v]=255<<24|n[N+4]<<16|n[N+2]<<8|n[N],B(n,N)==m&&B(n,N+2)==L&&B(n,N+4)==q&&(w[h+3]=0)}}else if(M==3){const I=u.tabs.PLTE,L=u.tabs.tRNS,q=L?L.length:0;if(O==1)for(var b=0;b<s;b++){var A=b*k,S=b*r;for(v=0;v<r;v++){h=S+v<<2;var _=3*(T=n[A+(v>>3)]>>7-((7&v)<<0)&1);w[h]=I[_],w[h+1]=I[_+1],w[h+2]=I[_+2],w[h+3]=T<q?L[T]:255}}if(O==2)for(b=0;b<s;b++)for(A=b*k,S=b*r,v=0;v<r;v++)h=S+v<<2,_=3*(T=n[A+(v>>2)]>>6-((3&v)<<1)&3),w[h]=I[_],w[h+1]=I[_+1],w[h+2]=I[_+2],w[h+3]=T<q?L[T]:255;if(O==4)for(b=0;b<s;b++)for(A=b*k,S=b*r,v=0;v<r;v++)h=S+v<<2,_=3*(T=n[A+(v>>1)]>>4-((1&v)<<2)&15),w[h]=I[_],w[h+1]=I[_+1],w[h+2]=I[_+2],w[h+3]=T<q?L[T]:255;if(O==8)for(v=0;v<x;v++){var T;h=v<<2,_=3*(T=n[v]),w[h]=I[_],w[h+1]=I[_+1],w[h+2]=I[_+2],w[h+3]=T<q?L[T]:255}}else if(M==4){if(O==8)for(v=0;v<x;v++){h=v<<2;var F=n[p=v<<1];w[h]=F,w[h+1]=F,w[h+2]=F,w[h+3]=n[p+1]}if(O==16)for(v=0;v<x;v++){var p;h=v<<2,F=n[p=v<<2],w[h]=F,w[h+1]=F,w[h+2]=F,w[h+3]=n[p+2]}}else if(M==0)for(m=u.tabs.tRNS?u.tabs.tRNS:-1,b=0;b<s;b++){const I=b*k,L=b*r;if(O==1)for(var c=0;c<r;c++){var U=(F=255*(n[I+(c>>>3)]>>>7-(7&c)&1))==255*m?0:255;P[L+c]=U<<24|F<<16|F<<8|F}else if(O==2)for(c=0;c<r;c++)U=(F=85*(n[I+(c>>>2)]>>>6-((3&c)<<1)&3))==85*m?0:255,P[L+c]=U<<24|F<<16|F<<8|F;else if(O==4)for(c=0;c<r;c++)U=(F=17*(n[I+(c>>>1)]>>>4-((1&c)<<2)&15))==17*m?0:255,P[L+c]=U<<24|F<<16|F<<8|F;else if(O==8)for(c=0;c<r;c++)U=(F=n[I+c])==m?0:255,P[L+c]=U<<24|F<<16|F<<8|F;else if(O==16)for(c=0;c<r;c++)F=n[I+(c<<1)],U=B(n,I+(c<<1))==m?0:255,P[L+c]=U<<24|F<<16|F<<8|F}return w}function D(n,r,s,u){const x=t(n),j=Math.ceil(s*x/8),k=new Uint8Array((j+1+n.interlace)*u);return r=n.tabs.CgBI?e(r,k):d(r,k),n.interlace==0?r=f(r,n,0,s,u):n.interlace==1&&(r=function(P,M){const O=M.width,B=M.height,v=t(M),N=v>>3,m=Math.ceil(O*v/8),h=new Uint8Array(B*m);let b=0;const A=[0,0,4,0,2,0,1],S=[0,4,0,2,0,1,0],_=[8,8,8,4,4,2,2],T=[8,8,4,4,2,2,1];let F=0;for(;F<7;){const c=_[F],U=T[F];let I=0,L=0,q=A[F];for(;q<B;)q+=c,L++;let $=S[F];for(;$<O;)$+=U,I++;const Q=Math.ceil(I*v/8);f(P,M,b,I,L);let W=0,H=A[F];for(;H<B;){let K=S[F],ue=b+W*Q<<3;for(;K<O;){var p;if(v==1&&(p=(p=P[ue>>3])>>7-(7&ue)&1,h[H*m+(K>>3)]|=p<<7-((7&K)<<0)),v==2&&(p=(p=P[ue>>3])>>6-(7&ue)&3,h[H*m+(K>>2)]|=p<<6-((3&K)<<1)),v==4&&(p=(p=P[ue>>3])>>4-(7&ue)&15,h[H*m+(K>>1)]|=p<<4-((1&K)<<2)),v>=8){const ne=H*m+K*N;for(let re=0;re<N;re++)h[ne+re]=P[(ue>>3)+re]}ue+=v,K+=U}W++,H+=c}I*L!=0&&(b+=L*(1+Q)),F+=1}return h}(r,n)),r}function d(n,r){return e(new Uint8Array(n.buffer,2,n.length-6),r)}var e=function(){const n={H:{}};return n.H.N=function(r,s){const u=Uint8Array;let x,j,k=0,w=0,P=0,M=0,O=0,B=0,v=0,N=0,m=0;if(r[0]==3&&r[1]==0)return s||new u(0);const h=n.H,b=h.b,A=h.e,S=h.R,_=h.n,T=h.A,F=h.Z,p=h.m,c=s==null;for(c&&(s=new u(r.length>>>2<<5));k==0;)if(k=b(r,m,1),w=b(r,m+1,2),m+=3,w!=0){if(c&&(s=n.H.W(s,N+(1<<17))),w==1&&(x=p.J,j=p.h,B=511,v=31),w==2){P=A(r,m,5)+257,M=A(r,m+5,5)+1,O=A(r,m+10,4)+4,m+=14;let I=1;for(var U=0;U<38;U+=2)p.Q[U]=0,p.Q[U+1]=0;for(U=0;U<O;U++){const $=A(r,m+3*U,3);p.Q[1+(p.X[U]<<1)]=$,$>I&&(I=$)}m+=3*O,_(p.Q,I),T(p.Q,I,p.u),x=p.w,j=p.d,m=S(p.u,(1<<I)-1,P+M,r,m,p.v);const L=h.V(p.v,0,P,p.C);B=(1<<L)-1;const q=h.V(p.v,P,M,p.D);v=(1<<q)-1,_(p.C,L),T(p.C,L,x),_(p.D,q),T(p.D,q,j)}for(;;){const I=x[F(r,m)&B];m+=15&I;const L=I>>>4;if(!(L>>>8))s[N++]=L;else{if(L==256)break;{let q=N+L-254;if(L>264){const K=p.q[L-257];q=N+(K>>>3)+A(r,m,7&K),m+=7&K}const $=j[F(r,m)&v];m+=15&$;const Q=$>>>4,W=p.c[Q],H=(W>>>4)+b(r,m,15&W);for(m+=15&W;N<q;)s[N]=s[N++-H],s[N]=s[N++-H],s[N]=s[N++-H],s[N]=s[N++-H];N=q}}}}else{7&m&&(m+=8-(7&m));const I=4+(m>>>3),L=r[I-4]|r[I-3]<<8;c&&(s=n.H.W(s,N+L)),s.set(new u(r.buffer,r.byteOffset+I,L),N),m=I+L<<3,N+=L}return s.length==N?s:s.slice(0,N)},n.H.W=function(r,s){const u=r.length;if(s<=u)return r;const x=new Uint8Array(u<<1);return x.set(r,0),x},n.H.R=function(r,s,u,x,j,k){const w=n.H.e,P=n.H.Z;let M=0;for(;M<u;){const O=r[P(x,j)&s];j+=15&O;const B=O>>>4;if(B<=15)k[M]=B,M++;else{let v=0,N=0;B==16?(N=3+w(x,j,2),j+=2,v=k[M-1]):B==17?(N=3+w(x,j,3),j+=3):B==18&&(N=11+w(x,j,7),j+=7);const m=M+N;for(;M<m;)k[M]=v,M++}}return j},n.H.V=function(r,s,u,x){let j=0,k=0;const w=x.length>>>1;for(;k<u;){const P=r[k+s];x[k<<1]=0,x[1+(k<<1)]=P,P>j&&(j=P),k++}for(;k<w;)x[k<<1]=0,x[1+(k<<1)]=0,k++;return j},n.H.n=function(r,s){const u=n.H.m,x=r.length;let j,k,w,P;const M=u.j;for(var O=0;O<=s;O++)M[O]=0;for(O=1;O<x;O+=2)M[r[O]]++;const B=u.K;for(j=0,M[0]=0,k=1;k<=s;k++)j=j+M[k-1]<<1,B[k]=j;for(w=0;w<x;w+=2)P=r[w+1],P!=0&&(r[w]=B[P],B[P]++)},n.H.A=function(r,s,u){const x=r.length,j=n.H.m.r;for(let k=0;k<x;k+=2)if(r[k+1]!=0){const w=k>>1,P=r[k+1],M=w<<4|P,O=s-P;let B=r[k]<<O;const v=B+(1<<O);for(;B!=v;)u[j[B]>>>15-s]=M,B++}},n.H.l=function(r,s){const u=n.H.m.r,x=15-s;for(let j=0;j<r.length;j+=2){const k=r[j]<<s-r[j+1];r[j]=u[k]>>>x}},n.H.M=function(r,s,u){u<<=7&s;const x=s>>>3;r[x]|=u,r[x+1]|=u>>>8},n.H.I=function(r,s,u){u<<=7&s;const x=s>>>3;r[x]|=u,r[x+1]|=u>>>8,r[x+2]|=u>>>16},n.H.e=function(r,s,u){return(r[s>>>3]|r[1+(s>>>3)]<<8)>>>(7&s)&(1<<u)-1},n.H.b=function(r,s,u){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16)>>>(7&s)&(1<<u)-1},n.H.Z=function(r,s){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16)>>>(7&s)},n.H.i=function(r,s){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16|r[3+(s>>>3)]<<24)>>>(7&s)},n.H.m=function(){const r=Uint16Array,s=Uint32Array;return{K:new r(16),j:new r(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new r(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new s(32),J:new r(512),_:[],h:new r(32),$:[],w:new r(32768),C:[],v:[],d:new r(32768),D:[],u:new r(512),Q:[],r:new r(32768),s:new s(286),Y:new s(30),a:new s(19),t:new s(15e3),k:new r(65536),g:new r(32768)}}(),function(){const r=n.H.m;for(var s=0;s<32768;s++){let x=s;x=(2863311530&x)>>>1|(1431655765&x)<<1,x=(3435973836&x)>>>2|(858993459&x)<<2,x=(4042322160&x)>>>4|(252645135&x)<<4,x=(4278255360&x)>>>8|(16711935&x)<<8,r.r[s]=(x>>>16|x<<16)>>>17}function u(x,j,k){for(;j--!=0;)x.push(0,k)}for(s=0;s<32;s++)r.q[s]=r.S[s]<<3|r.T[s],r.c[s]=r.p[s]<<4|r.z[s];u(r._,144,8),u(r._,112,9),u(r._,24,7),u(r._,8,8),n.H.n(r._,9),n.H.A(r._,9,r.J),n.H.l(r._,9),u(r.$,32,5),n.H.n(r.$,5),n.H.A(r.$,5,r.h),n.H.l(r.$,5),u(r.Q,19,0),u(r.C,286,0),u(r.D,30,0),u(r.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function f(n,r,s,u,x){let j=t(r);const k=Math.ceil(u*j/8);let w,P;j=Math.ceil(j/8);let M=n[s],O=0;if(M>1&&(n[s]=[0,0,1][M-2]),M==3)for(O=j;O<k;O++)n[O+1]=n[O+1]+(n[O+1-j]>>>1)&255;for(let B=0;B<x;B++)if(w=s+B*k,P=w+B+1,M=n[P-1],O=0,M==0)for(;O<k;O++)n[w+O]=n[P+O];else if(M==1){for(;O<j;O++)n[w+O]=n[P+O];for(;O<k;O++)n[w+O]=n[P+O]+n[w+O-j]}else if(M==2)for(;O<k;O++)n[w+O]=n[P+O]+n[w+O-k];else if(M==3){for(;O<j;O++)n[w+O]=n[P+O]+(n[w+O-k]>>>1);for(;O<k;O++)n[w+O]=n[P+O]+(n[w+O-k]+n[w+O-j]>>>1)}else{for(;O<j;O++)n[w+O]=n[P+O]+a(0,n[w+O-k],0);for(;O<k;O++)n[w+O]=n[P+O]+a(n[w+O-j],n[w+O-k],n[w+O-j-k])}return n}function a(n,r,s){const u=n+r-s,x=u-n,j=u-r,k=u-s;return x*x<=j*j&&x*x<=k*k?n:j*j<=k*k?r:s}function y(n,r,s){s.width=l.readUint(n,r),r+=4,s.height=l.readUint(n,r),r+=4,s.depth=n[r],r++,s.ctype=n[r],r++,s.compress=n[r],r++,s.filter=n[r],r++,s.interlace=n[r],r++}function C(n,r,s,u,x,j,k,w,P){const M=Math.min(r,x),O=Math.min(s,j);let B=0,v=0;for(let F=0;F<O;F++)for(let p=0;p<M;p++)if(k>=0&&w>=0?(B=F*r+p<<2,v=(w+F)*x+k+p<<2):(B=(-w+F)*r-k+p<<2,v=F*x+p<<2),P==0)u[v]=n[B],u[v+1]=n[B+1],u[v+2]=n[B+2],u[v+3]=n[B+3];else if(P==1){var N=n[B+3]*.00392156862745098,m=n[B]*N,h=n[B+1]*N,b=n[B+2]*N,A=u[v+3]*(1/255),S=u[v]*A,_=u[v+1]*A,T=u[v+2]*A;const c=1-N,U=N+A*c,I=U==0?0:1/U;u[v+3]=255*U,u[v+0]=(m+S*c)*I,u[v+1]=(h+_*c)*I,u[v+2]=(b+T*c)*I}else if(P==2)N=n[B+3],m=n[B],h=n[B+1],b=n[B+2],A=u[v+3],S=u[v],_=u[v+1],T=u[v+2],N==A&&m==S&&h==_&&b==T?(u[v]=0,u[v+1]=0,u[v+2]=0,u[v+3]=0):(u[v]=m,u[v+1]=h,u[v+2]=b,u[v+3]=N);else if(P==3){if(N=n[B+3],m=n[B],h=n[B+1],b=n[B+2],A=u[v+3],S=u[v],_=u[v+1],T=u[v+2],N==A&&m==S&&h==_&&b==T)continue;if(N<220&&A>20)return!1}return!0}return{decode:function(r){const s=new Uint8Array(r);let u=8;const x=l,j=x.readUshort,k=x.readUint,w={tabs:{},frames:[]},P=new Uint8Array(s.length);let M,O=0,B=0;const v=[137,80,78,71,13,10,26,10];for(var N=0;N<8;N++)if(s[N]!=v[N])throw"The input is not a PNG file!";for(;u<s.length;){const F=x.readUint(s,u);u+=4;const p=x.readASCII(s,u,4);if(u+=4,p=="IHDR")y(s,u,w);else if(p=="iCCP"){for(var m=u;s[m]!=0;)m++;x.readASCII(s,u,m-u),s[m+1];const c=s.slice(m+2,u+F);let U=null;try{U=d(c)}catch{U=e(c)}w.tabs[p]=U}else if(p=="CgBI")w.tabs[p]=s.slice(u,u+4);else if(p=="IDAT"){for(N=0;N<F;N++)P[O+N]=s[u+N];O+=F}else if(p=="acTL")w.tabs[p]={num_frames:k(s,u),num_plays:k(s,u+4)},M=new Uint8Array(s.length);else if(p=="fcTL"){B!=0&&((T=w.frames[w.frames.length-1]).data=D(w,M.slice(0,B),T.rect.width,T.rect.height),B=0);const c={x:k(s,u+12),y:k(s,u+16),width:k(s,u+4),height:k(s,u+8)};let U=j(s,u+22);U=j(s,u+20)/(U==0?100:U);const I={rect:c,delay:Math.round(1e3*U),dispose:s[u+24],blend:s[u+25]};w.frames.push(I)}else if(p=="fdAT"){for(N=0;N<F-4;N++)M[B+N]=s[u+N+4];B+=F-4}else if(p=="pHYs")w.tabs[p]=[x.readUint(s,u),x.readUint(s,u+4),s[u+8]];else if(p=="cHRM")for(w.tabs[p]=[],N=0;N<8;N++)w.tabs[p].push(x.readUint(s,u+4*N));else if(p=="tEXt"||p=="zTXt"){w.tabs[p]==null&&(w.tabs[p]={});var h=x.nextZero(s,u),b=x.readASCII(s,u,h-u),A=u+F-h-1;if(p=="tEXt")_=x.readASCII(s,h+1,A);else{var S=d(s.slice(h+2,h+2+A));_=x.readUTF8(S,0,S.length)}w.tabs[p][b]=_}else if(p=="iTXt"){w.tabs[p]==null&&(w.tabs[p]={}),h=0,m=u,h=x.nextZero(s,m),b=x.readASCII(s,m,h-m);const c=s[m=h+1];var _;s[m+1],m+=2,h=x.nextZero(s,m),x.readASCII(s,m,h-m),m=h+1,h=x.nextZero(s,m),x.readUTF8(s,m,h-m),A=F-((m=h+1)-u),c==0?_=x.readUTF8(s,m,A):(S=d(s.slice(m,m+A)),_=x.readUTF8(S,0,S.length)),w.tabs[p][b]=_}else if(p=="PLTE")w.tabs[p]=x.readBytes(s,u,F);else if(p=="hIST"){const c=w.tabs.PLTE.length/3;for(w.tabs[p]=[],N=0;N<c;N++)w.tabs[p].push(j(s,u+2*N))}else if(p=="tRNS")w.ctype==3?w.tabs[p]=x.readBytes(s,u,F):w.ctype==0?w.tabs[p]=j(s,u):w.ctype==2&&(w.tabs[p]=[j(s,u),j(s,u+2),j(s,u+4)]);else if(p=="gAMA")w.tabs[p]=x.readUint(s,u)/1e5;else if(p=="sRGB")w.tabs[p]=s[u];else if(p=="bKGD")w.ctype==0||w.ctype==4?w.tabs[p]=[j(s,u)]:w.ctype==2||w.ctype==6?w.tabs[p]=[j(s,u),j(s,u+2),j(s,u+4)]:w.ctype==3&&(w.tabs[p]=s[u]);else if(p=="IEND")break;u+=F,x.readUint(s,u),u+=4}var T;return B!=0&&((T=w.frames[w.frames.length-1]).data=D(w,M.slice(0,B),T.rect.width,T.rect.height)),w.data=D(w,P,w.width,w.height),delete w.compress,delete w.interlace,delete w.filter,w},toRGBA8:function(r){const s=r.width,u=r.height;if(r.tabs.acTL==null)return[g(r.data,s,u,r).buffer];const x=[];r.frames[0].data==null&&(r.frames[0].data=r.data);const j=s*u*4,k=new Uint8Array(j),w=new Uint8Array(j),P=new Uint8Array(j);for(let O=0;O<r.frames.length;O++){const B=r.frames[O],v=B.rect.x,N=B.rect.y,m=B.rect.width,h=B.rect.height,b=g(B.data,m,h,r);if(O!=0)for(var M=0;M<j;M++)P[M]=k[M];if(B.blend==0?C(b,m,h,k,s,u,v,N,0):B.blend==1&&C(b,m,h,k,s,u,v,N,1),x.push(k.buffer.slice(0)),B.dispose!=0){if(B.dispose==1)C(w,m,h,k,s,u,v,N,0);else if(B.dispose==2)for(M=0;M<j;M++)k[M]=P[M]}}return x},_paeth:a,_copyTile:C,_bin:l}}();(function(){const{_copyTile:l}=tt,{_bin:g}=tt,D=tt._paeth;var d={table:function(){const m=new Uint32Array(256);for(let h=0;h<256;h++){let b=h;for(let A=0;A<8;A++)1&b?b=3988292384^b>>>1:b>>>=1;m[h]=b}return m}(),update(m,h,b,A){for(let S=0;S<A;S++)m=d.table[255&(m^h[b+S])]^m>>>8;return m},crc:(m,h,b)=>4294967295^d.update(4294967295,m,h,b)};function e(m,h,b,A){h[b]+=m[0]*A>>4,h[b+1]+=m[1]*A>>4,h[b+2]+=m[2]*A>>4,h[b+3]+=m[3]*A>>4}function t(m){return Math.max(0,Math.min(255,m))}function f(m,h){const b=m[0]-h[0],A=m[1]-h[1],S=m[2]-h[2],_=m[3]-h[3];return b*b+A*A+S*S+_*_}function a(m,h,b,A,S,_,T){T==null&&(T=1);const F=A.length,p=[];for(var c=0;c<F;c++){const H=A[c];p.push([H>>>0&255,H>>>8&255,H>>>16&255,H>>>24&255])}for(c=0;c<F;c++){let H=4294967295;for(var U=0,I=0;I<F;I++){var L=f(p[c],p[I]);I!=c&&L<H&&(H=L,U=I)}}const q=new Uint32Array(S.buffer),$=new Int16Array(h*b*4),Q=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(c=0;c<Q.length;c++)Q[c]=255*((Q[c]+.5)/16-.5);for(let H=0;H<b;H++)for(let K=0;K<h;K++){var W;c=4*(H*h+K),T!=2?W=[t(m[c]+$[c]),t(m[c+1]+$[c+1]),t(m[c+2]+$[c+2]),t(m[c+3]+$[c+3])]:(L=Q[4*(3&H)+(3&K)],W=[t(m[c]+L),t(m[c+1]+L),t(m[c+2]+L),t(m[c+3]+L)]),U=0;let ue=16777215;for(I=0;I<F;I++){const le=f(W,p[I]);le<ue&&(ue=le,U=I)}const ne=p[U],re=[W[0]-ne[0],W[1]-ne[1],W[2]-ne[2],W[3]-ne[3]];T==1&&(K!=h-1&&e(re,$,c+4,7),H!=b-1&&(K!=0&&e(re,$,c+4*h-4,3),e(re,$,c+4*h,5),K!=h-1&&e(re,$,c+4*h+4,1))),_[c>>2]=U,q[c>>2]=A[U]}}function y(m,h,b,A,S){S==null&&(S={});const{crc:_}=d,T=g.writeUint,F=g.writeUshort,p=g.writeASCII;let c=8;const U=m.frames.length>1;let I,L=!1,q=33+(U?20:0);if(S.sRGB!=null&&(q+=13),S.pHYs!=null&&(q+=21),S.iCCP!=null&&(I=pako.deflate(S.iCCP),q+=21+I.length+4),m.ctype==3){for(var $=m.plte.length,Q=0;Q<$;Q++)m.plte[Q]>>>24!=255&&(L=!0);q+=8+3*$+4+(L?8+1*$+4:0)}for(var W=0;W<m.frames.length;W++)U&&(q+=38),q+=(ne=m.frames[W]).cimg.length+12,W!=0&&(q+=4);q+=12;const H=new Uint8Array(q),K=[137,80,78,71,13,10,26,10];for(Q=0;Q<8;Q++)H[Q]=K[Q];if(T(H,c,13),c+=4,p(H,c,"IHDR"),c+=4,T(H,c,h),c+=4,T(H,c,b),c+=4,H[c]=m.depth,c++,H[c]=m.ctype,c++,H[c]=0,c++,H[c]=0,c++,H[c]=0,c++,T(H,c,_(H,c-17,17)),c+=4,S.sRGB!=null&&(T(H,c,1),c+=4,p(H,c,"sRGB"),c+=4,H[c]=S.sRGB,c++,T(H,c,_(H,c-5,5)),c+=4),S.iCCP!=null){const re=13+I.length;T(H,c,re),c+=4,p(H,c,"iCCP"),c+=4,p(H,c,"ICC profile"),c+=11,c+=2,H.set(I,c),c+=I.length,T(H,c,_(H,c-(re+4),re+4)),c+=4}if(S.pHYs!=null&&(T(H,c,9),c+=4,p(H,c,"pHYs"),c+=4,T(H,c,S.pHYs[0]),c+=4,T(H,c,S.pHYs[1]),c+=4,H[c]=S.pHYs[2],c++,T(H,c,_(H,c-13,13)),c+=4),U&&(T(H,c,8),c+=4,p(H,c,"acTL"),c+=4,T(H,c,m.frames.length),c+=4,T(H,c,S.loop!=null?S.loop:0),c+=4,T(H,c,_(H,c-12,12)),c+=4),m.ctype==3){for(T(H,c,3*($=m.plte.length)),c+=4,p(H,c,"PLTE"),c+=4,Q=0;Q<$;Q++){const re=3*Q,le=m.plte[Q],J=255&le,fe=le>>>8&255,we=le>>>16&255;H[c+re+0]=J,H[c+re+1]=fe,H[c+re+2]=we}if(c+=3*$,T(H,c,_(H,c-3*$-4,3*$+4)),c+=4,L){for(T(H,c,$),c+=4,p(H,c,"tRNS"),c+=4,Q=0;Q<$;Q++)H[c+Q]=m.plte[Q]>>>24&255;c+=$,T(H,c,_(H,c-$-4,$+4)),c+=4}}let ue=0;for(W=0;W<m.frames.length;W++){var ne=m.frames[W];U&&(T(H,c,26),c+=4,p(H,c,"fcTL"),c+=4,T(H,c,ue++),c+=4,T(H,c,ne.rect.width),c+=4,T(H,c,ne.rect.height),c+=4,T(H,c,ne.rect.x),c+=4,T(H,c,ne.rect.y),c+=4,F(H,c,A[W]),c+=2,F(H,c,1e3),c+=2,H[c]=ne.dispose,c++,H[c]=ne.blend,c++,T(H,c,_(H,c-30,30)),c+=4);const re=ne.cimg;T(H,c,($=re.length)+(W==0?0:4)),c+=4;const le=c;p(H,c,W==0?"IDAT":"fdAT"),c+=4,W!=0&&(T(H,c,ue++),c+=4),H.set(re,c),c+=$,T(H,c,_(H,le,c-le)),c+=4}return T(H,c,0),c+=4,p(H,c,"IEND"),c+=4,T(H,c,_(H,c-4,4)),c+=4,H.buffer}function C(m,h,b){for(let A=0;A<m.frames.length;A++){const S=m.frames[A];S.rect.width;const _=S.rect.height,T=new Uint8Array(_*S.bpl+_);S.cimg=u(S.img,_,S.bpp,S.bpl,T,h,b)}}function n(m,h,b,A,S){const _=S[0],T=S[1],F=S[2],p=S[3],c=S[4],U=S[5];let I=6,L=8,q=255;for(var $=0;$<m.length;$++){const ge=new Uint8Array(m[$]);for(var Q=ge.length,W=0;W<Q;W+=4)q&=ge[W+3]}const H=q!=255,K=function(de,ce,ye,Se,xe,be){const me=[];for(var ie=0;ie<de.length;ie++){const te=new Uint8Array(de[ie]),Ie=new Uint32Array(te.buffer);var Te;let se=0,ve=0,pe=ce,ze=ye,ot=Se?1:0;if(ie!=0){const Ut=be||Se||ie==1||me[ie-2].dispose!=0?1:2;let Ke=0,St=1e9;for(let lt=0;lt<Ut;lt++){var Oe=new Uint8Array(de[ie-1-lt]);const Ae=new Uint32Array(de[ie-1-lt]);let De=ce,Ue=ye,Je=-1,et=-1;for(let We=0;We<ye;We++)for(let qe=0;qe<ce;qe++)Ie[ee=We*ce+qe]!=Ae[ee]&&(qe<De&&(De=qe),qe>Je&&(Je=qe),We<Ue&&(Ue=We),We>et&&(et=We));Je==-1&&(De=Ue=Je=et=0),xe&&((1&De)==1&&De--,(1&Ue)==1&&Ue--);const xt=(Je-De+1)*(et-Ue+1);xt<St&&(St=xt,Ke=lt,se=De,ve=Ue,pe=Je-De+1,ze=et-Ue+1)}Oe=new Uint8Array(de[ie-1-Ke]),Ke==1&&(me[ie-1].dispose=2),Te=new Uint8Array(pe*ze*4),l(Oe,ce,ye,Te,pe,ze,-se,-ve,0),ot=l(te,ce,ye,Te,pe,ze,-se,-ve,3)?1:0,ot==1?s(te,ce,ye,Te,{x:se,y:ve,width:pe,height:ze}):l(te,ce,ye,Te,pe,ze,-se,-ve,0)}else Te=te.slice(0);me.push({rect:{x:se,y:ve,width:pe,height:ze},img:Te,blend:ot,dispose:0})}if(Se)for(ie=0;ie<me.length;ie++){if(($e=me[ie]).blend==1)continue;const te=$e.rect,Ie=me[ie-1].rect,se=Math.min(te.x,Ie.x),ve=Math.min(te.y,Ie.y),pe={x:se,y:ve,width:Math.max(te.x+te.width,Ie.x+Ie.width)-se,height:Math.max(te.y+te.height,Ie.y+Ie.height)-ve};me[ie-1].dispose=1,ie-1!=0&&r(de,ce,ye,me,ie-1,pe,xe),r(de,ce,ye,me,ie,pe,xe)}let at=0;if(de.length!=1)for(var ee=0;ee<me.length;ee++){var $e;at+=($e=me[ee]).rect.width*$e.rect.height}return me}(m,h,b,_,T,F),ue={},ne=[],re=[];if(A!=0){const ge=[];for(W=0;W<K.length;W++)ge.push(K[W].img.buffer);const de=function(xe){let be=0;for(var me=0;me<xe.length;me++)be+=xe[me].byteLength;const ie=new Uint8Array(be);let Te=0;for(me=0;me<xe.length;me++){const Oe=new Uint8Array(xe[me]),at=Oe.length;for(let ee=0;ee<at;ee+=4){let $e=Oe[ee],te=Oe[ee+1],Ie=Oe[ee+2];const se=Oe[ee+3];se==0&&($e=te=Ie=0),ie[Te+ee]=$e,ie[Te+ee+1]=te,ie[Te+ee+2]=Ie,ie[Te+ee+3]=se}Te+=at}return ie.buffer}(ge),ce=j(de,A);for(W=0;W<ce.plte.length;W++)ne.push(ce.plte[W].est.rgba);let ye=0;for(W=0;W<K.length;W++){const Se=(J=K[W]).img.length;var le=new Uint8Array(ce.inds.buffer,ye>>2,Se>>2);re.push(le);const xe=new Uint8Array(ce.abuf,ye,Se);U&&a(J.img,J.rect.width,J.rect.height,ne,xe,le),J.img.set(xe),ye+=Se}}else for($=0;$<K.length;$++){var J=K[$];const ge=new Uint32Array(J.img.buffer);var fe=J.rect.width;for(Q=ge.length,le=new Uint8Array(Q),re.push(le),W=0;W<Q;W++){const de=ge[W];if(W!=0&&de==ge[W-1])le[W]=le[W-1];else if(W>fe&&de==ge[W-fe])le[W]=le[W-fe];else{let ce=ue[de];if(ce==null&&(ue[de]=ce=ne.length,ne.push(de),ne.length>=300))break;le[W]=ce}}}const we=ne.length;for(we<=256&&c==0&&(L=we<=2?1:we<=4?2:we<=16?4:8,L=Math.max(L,p)),$=0;$<K.length;$++){(J=K[$]).rect.x,J.rect.y,fe=J.rect.width;const ge=J.rect.height;let de=J.img;new Uint32Array(de.buffer);let ce=4*fe,ye=4;if(we<=256&&c==0){ce=Math.ceil(L*fe/8);var je=new Uint8Array(ce*ge);const Se=re[$];for(let xe=0;xe<ge;xe++){W=xe*ce;const be=xe*fe;if(L==8)for(var he=0;he<fe;he++)je[W+he]=Se[be+he];else if(L==4)for(he=0;he<fe;he++)je[W+(he>>1)]|=Se[be+he]<<4-4*(1&he);else if(L==2)for(he=0;he<fe;he++)je[W+(he>>2)]|=Se[be+he]<<6-2*(3&he);else if(L==1)for(he=0;he<fe;he++)je[W+(he>>3)]|=Se[be+he]<<7-1*(7&he)}de=je,I=3,ye=1}else if(H==0&&K.length==1){je=new Uint8Array(fe*ge*3);const Se=fe*ge;for(W=0;W<Se;W++){const xe=3*W,be=4*W;je[xe]=de[be],je[xe+1]=de[be+1],je[xe+2]=de[be+2]}de=je,I=2,ye=3,ce=3*fe}J.img=de,J.bpl=ce,J.bpp=ye}return{ctype:I,depth:L,plte:ne,frames:K}}function r(m,h,b,A,S,_,T){const F=Uint8Array,p=Uint32Array,c=new F(m[S-1]),U=new p(m[S-1]),I=S+1<m.length?new F(m[S+1]):null,L=new F(m[S]),q=new p(L.buffer);let $=h,Q=b,W=-1,H=-1;for(let ue=0;ue<_.height;ue++)for(let ne=0;ne<_.width;ne++){const re=_.x+ne,le=_.y+ue,J=le*h+re,fe=q[J];fe==0||A[S-1].dispose==0&&U[J]==fe&&(I==null||I[4*J+3]!=0)||(re<$&&($=re),re>W&&(W=re),le<Q&&(Q=le),le>H&&(H=le))}W==-1&&($=Q=W=H=0),T&&((1&$)==1&&$--,(1&Q)==1&&Q--),_={x:$,y:Q,width:W-$+1,height:H-Q+1};const K=A[S];K.rect=_,K.blend=1,K.img=new Uint8Array(_.width*_.height*4),A[S-1].dispose==0?(l(c,h,b,K.img,_.width,_.height,-_.x,-_.y,0),s(L,h,b,K.img,_)):l(L,h,b,K.img,_.width,_.height,-_.x,-_.y,0)}function s(m,h,b,A,S){l(m,h,b,A,S.width,S.height,-S.x,-S.y,2)}function u(m,h,b,A,S,_,T){const F=[];let p,c=[0,1,2,3,4];_!=-1?c=[_]:(h*A>5e5||b==1)&&(c=[0]),T&&(p={level:0});const U=$r;for(var I=0;I<c.length;I++){for(let $=0;$<h;$++)x(S,m,$,A,b,c[I]);F.push(U.deflate(S,p))}let L,q=1e9;for(I=0;I<F.length;I++)F[I].length<q&&(L=I,q=F[I].length);return F[L]}function x(m,h,b,A,S,_){const T=b*A;let F=T+b;if(m[F]=_,F++,_==0)if(A<500)for(var p=0;p<A;p++)m[F+p]=h[T+p];else m.set(new Uint8Array(h.buffer,T,A),F);else if(_==1){for(p=0;p<S;p++)m[F+p]=h[T+p];for(p=S;p<A;p++)m[F+p]=h[T+p]-h[T+p-S]+256&255}else if(b==0){for(p=0;p<S;p++)m[F+p]=h[T+p];if(_==2)for(p=S;p<A;p++)m[F+p]=h[T+p];if(_==3)for(p=S;p<A;p++)m[F+p]=h[T+p]-(h[T+p-S]>>1)+256&255;if(_==4)for(p=S;p<A;p++)m[F+p]=h[T+p]-D(h[T+p-S],0,0)+256&255}else{if(_==2)for(p=0;p<A;p++)m[F+p]=h[T+p]+256-h[T+p-A]&255;if(_==3){for(p=0;p<S;p++)m[F+p]=h[T+p]+256-(h[T+p-A]>>1)&255;for(p=S;p<A;p++)m[F+p]=h[T+p]+256-(h[T+p-A]+h[T+p-S]>>1)&255}if(_==4){for(p=0;p<S;p++)m[F+p]=h[T+p]+256-D(0,h[T+p-A],0)&255;for(p=S;p<A;p++)m[F+p]=h[T+p]+256-D(h[T+p-S],h[T+p-A],h[T+p-S-A])&255}}}function j(m,h){const b=new Uint8Array(m),A=b.slice(0),S=new Uint32Array(A.buffer),_=k(A,h),T=_[0],F=_[1],p=b.length,c=new Uint8Array(p>>2);let U;if(b.length<2e7)for(var I=0;I<p;I+=4)U=w(T,L=b[I]*(1/255),q=b[I+1]*(1/255),$=b[I+2]*(1/255),Q=b[I+3]*(1/255)),c[I>>2]=U.ind,S[I>>2]=U.est.rgba;else for(I=0;I<p;I+=4){var L=b[I]*.00392156862745098,q=b[I+1]*(1/255),$=b[I+2]*(1/255),Q=b[I+3]*(1/255);for(U=T;U.left;)U=P(U.est,L,q,$,Q)<=0?U.left:U.right;c[I>>2]=U.ind,S[I>>2]=U.est.rgba}return{abuf:A.buffer,inds:c,plte:F}}function k(m,h,b){b==null&&(b=1e-4);const A=new Uint32Array(m.buffer),S={i0:0,i1:m.length,bst:null,est:null,tdst:0,left:null,right:null};S.bst=B(m,S.i0,S.i1),S.est=v(S.bst);const _=[S];for(;_.length<h;){let F=0,p=0;for(var T=0;T<_.length;T++)_[T].est.L>F&&(F=_[T].est.L,p=T);if(F<b)break;const c=_[p],U=M(m,A,c.i0,c.i1,c.est.e,c.est.eMq255);if(c.i0>=U||c.i1<=U){c.est.L=0;continue}const I={i0:c.i0,i1:U,bst:null,est:null,tdst:0,left:null,right:null};I.bst=B(m,I.i0,I.i1),I.est=v(I.bst);const L={i0:U,i1:c.i1,bst:null,est:null,tdst:0,left:null,right:null};for(L.bst={R:[],m:[],N:c.bst.N-I.bst.N},T=0;T<16;T++)L.bst.R[T]=c.bst.R[T]-I.bst.R[T];for(T=0;T<4;T++)L.bst.m[T]=c.bst.m[T]-I.bst.m[T];L.est=v(L.bst),c.left=I,c.right=L,_[p]=I,_.push(L)}for(_.sort((F,p)=>p.bst.N-F.bst.N),T=0;T<_.length;T++)_[T].ind=T;return[S,_]}function w(m,h,b,A,S){if(m.left==null)return m.tdst=function(I,L,q,$,Q){const W=L-I[0],H=q-I[1],K=$-I[2],ue=Q-I[3];return W*W+H*H+K*K+ue*ue}(m.est.q,h,b,A,S),m;const _=P(m.est,h,b,A,S);let T=m.left,F=m.right;_>0&&(T=m.right,F=m.left);const p=w(T,h,b,A,S);if(p.tdst<=_*_)return p;const c=w(F,h,b,A,S);return c.tdst<p.tdst?c:p}function P(m,h,b,A,S){const{e:_}=m;return _[0]*h+_[1]*b+_[2]*A+_[3]*S-m.eMq}function M(m,h,b,A,S,_){for(A-=4;b<A;){for(;O(m,b,S)<=_;)b+=4;for(;O(m,A,S)>_;)A-=4;if(b>=A)break;const T=h[b>>2];h[b>>2]=h[A>>2],h[A>>2]=T,b+=4,A-=4}for(;O(m,b,S)>_;)b-=4;return b+4}function O(m,h,b){return m[h]*b[0]+m[h+1]*b[1]+m[h+2]*b[2]+m[h+3]*b[3]}function B(m,h,b){const A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S=[0,0,0,0],_=b-h>>2;for(let T=h;T<b;T+=4){const F=m[T]*.00392156862745098,p=m[T+1]*(1/255),c=m[T+2]*(1/255),U=m[T+3]*(1/255);S[0]+=F,S[1]+=p,S[2]+=c,S[3]+=U,A[0]+=F*F,A[1]+=F*p,A[2]+=F*c,A[3]+=F*U,A[5]+=p*p,A[6]+=p*c,A[7]+=p*U,A[10]+=c*c,A[11]+=c*U,A[15]+=U*U}return A[4]=A[1],A[8]=A[2],A[9]=A[6],A[12]=A[3],A[13]=A[7],A[14]=A[11],{R:A,m:S,N:_}}function v(m){const{R:h}=m,{m:b}=m,{N:A}=m,S=b[0],_=b[1],T=b[2],F=b[3],p=A==0?0:1/A,c=[h[0]-S*S*p,h[1]-S*_*p,h[2]-S*T*p,h[3]-S*F*p,h[4]-_*S*p,h[5]-_*_*p,h[6]-_*T*p,h[7]-_*F*p,h[8]-T*S*p,h[9]-T*_*p,h[10]-T*T*p,h[11]-T*F*p,h[12]-F*S*p,h[13]-F*_*p,h[14]-F*T*p,h[15]-F*F*p],U=c,I=N;let L=[Math.random(),Math.random(),Math.random(),Math.random()],q=0,$=0;if(A!=0)for(let W=0;W<16&&(L=I.multVec(U,L),$=Math.sqrt(I.dot(L,L)),L=I.sml(1/$,L),!(W!=0&&Math.abs($-q)<1e-9));W++)q=$;const Q=[S*p,_*p,T*p,F*p];return{Cov:c,q:Q,e:L,L:q,eMq255:I.dot(I.sml(255,Q),L),eMq:I.dot(L,Q),rgba:(Math.round(255*Q[3])<<24|Math.round(255*Q[2])<<16|Math.round(255*Q[1])<<8|Math.round(255*Q[0])<<0)>>>0}}var N={multVec:(m,h)=>[m[0]*h[0]+m[1]*h[1]+m[2]*h[2]+m[3]*h[3],m[4]*h[0]+m[5]*h[1]+m[6]*h[2]+m[7]*h[3],m[8]*h[0]+m[9]*h[1]+m[10]*h[2]+m[11]*h[3],m[12]*h[0]+m[13]*h[1]+m[14]*h[2]+m[15]*h[3]],dot:(m,h)=>m[0]*h[0]+m[1]*h[1]+m[2]*h[2]+m[3]*h[3],sml:(m,h)=>[m*h[0],m*h[1],m*h[2],m*h[3]]};tt.encode=function(h,b,A,S,_,T,F){S==null&&(S=0),F==null&&(F=!1);const p=n(h,b,A,S,[!1,!1,!1,0,F,!1]);return C(p,-1),y(p,b,A,_,T)},tt.encodeLL=function(h,b,A,S,_,T,F,p){const c={ctype:0+(S==1?0:2)+(_==0?0:4),depth:T,frames:[]},U=(S+_)*T,I=U*b;for(let L=0;L<h.length;L++)c.frames.push({rect:{x:0,y:0,width:b,height:A},img:new Uint8Array(h[L]),blend:0,dispose:1,bpp:Math.ceil(U/8),bpl:Math.ceil(I/8)});return C(c,0,!0),y(c,b,A,F,p)},tt.encode.compress=n,tt.encode.dither=a,tt.quantize=j,tt.quantize.getKDtree=k,tt.quantize.getNearest=w})();const Us={toArrayBuffer(l,g){const D=l.width,d=l.height,e=D<<2,t=l.getContext("2d").getImageData(0,0,D,d),f=new Uint32Array(t.data.buffer),a=(32*D+31)/32<<2,y=a*d,C=122+y,n=new ArrayBuffer(C),r=new DataView(n),s=1<<20;let u,x,j,k,w=s,P=0,M=0,O=0;function B(m){r.setUint16(M,m,!0),M+=2}function v(m){r.setUint32(M,m,!0),M+=4}function N(m){M+=m}B(19778),v(C),N(4),v(122),v(108),v(D),v(-d>>>0),B(1),B(32),v(3),v(y),v(2835),v(2835),N(8),v(16711680),v(65280),v(255),v(4278190080),v(1466527264),function m(){for(;P<d&&w>0;){for(k=122+P*a,u=0;u<e;)w--,x=f[O++],j=x>>>24,r.setUint32(k+u,x<<8|j),u+=4;P++}O<f.length?(w=s,setTimeout(m,Us._dly)):g(n)}()},toBlob(l,g){this.toArrayBuffer(l,D=>{g(new Blob([D],{type:"image/bmp"}))})},_dly:9};var He={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},zr={[He.CHROME]:16384,[He.FIREFOX]:11180,[He.DESKTOP_SAFARI]:16384,[He.IE]:8192,[He.IOS]:4096,[He.ETC]:8192};const Vn=typeof window<"u",Ms=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,vn=Vn&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Wr=(Vn||Ms)&&(vn&&vn.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Ns=(Vn||Ms)&&(vn&&vn.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function Yn(l,g,D=Date.now()){return new Promise(d=>{const e=l.split(","),t=e[0].match(/:(.*?);/)[1],f=globalThis.atob(e[1]);let a=f.length;const y=new Uint8Array(a);for(;a--;)y[a]=f.charCodeAt(a);const C=new Blob([y],{type:t});C.name=g,C.lastModified=D,d(C)})}function Ls(l){return new Promise((g,D)=>{const d=new Ns;d.onload=()=>g(d.result),d.onerror=e=>D(e),d.readAsDataURL(l)})}function Ps(l){return new Promise((g,D)=>{const d=new Image;d.onload=()=>g(d),d.onerror=e=>D(e),d.src=l})}function Tt(){if(Tt.cachedResult!==void 0)return Tt.cachedResult;let l=He.ETC;const{userAgent:g}=navigator;return/Chrom(e|ium)/i.test(g)?l=He.CHROME:/iP(ad|od|hone)/i.test(g)&&/WebKit/i.test(g)?l=He.IOS:/Safari/i.test(g)?l=He.DESKTOP_SAFARI:/Firefox/i.test(g)?l=He.FIREFOX:(/MSIE/i.test(g)||document.documentMode)&&(l=He.IE),Tt.cachedResult=l,Tt.cachedResult}function Bs(l,g){const D=Tt(),d=zr[D];let e=l,t=g,f=e*t;const a=e>t?t/e:e/t;for(;f>d*d;){const y=(d+e)/2,C=(d+t)/2;y<C?(t=C,e=C*a):(t=y*a,e=y),f=e*t}return{width:e,height:t}}function An(l,g){let D,d;try{if(D=new OffscreenCanvas(l,g),d=D.getContext("2d"),d===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{D=document.createElement("canvas"),d=D.getContext("2d")}return D.width=l,D.height=g,[D,d]}function Hs(l,g){const{width:D,height:d}=Bs(l.width,l.height),[e,t]=An(D,d);return g&&/jpe?g/.test(g)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(l,0,0,e.width,e.height),e}function mn(){return mn.cachedResult!==void 0||(mn.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),mn.cachedResult}function yn(l,g={}){return new Promise(function(D,d){let e,t;var f=function(){try{return t=Hs(e,g.fileType||l.type),D([e,t])}catch(y){return d(y)}},a=function(y){try{var C=function(n){try{throw n}catch(r){return d(r)}};try{let n;return Ls(l).then(function(r){try{return n=r,Ps(n).then(function(s){try{return e=s,function(){try{return f()}catch(u){return d(u)}}()}catch(u){return C(u)}},C)}catch(s){return C(s)}},C)}catch(n){C(n)}}catch(n){return d(n)}};try{if(mn()||[He.DESKTOP_SAFARI,He.MOBILE_SAFARI].includes(Tt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(l).then(function(y){try{return e=y,f()}catch{return a()}},a)}catch{a()}})}function Tn(l,g,D,d,e=1){return new Promise(function(t,f){let a;if(g==="image/png"){let C,n,r;return C=l.getContext("2d"),{data:n}=C.getImageData(0,0,l.width,l.height),r=tt.encode([n.buffer],l.width,l.height,4096*e),a=new Blob([r],{type:g}),a.name=D,a.lastModified=d,y.call(this)}{let C=function(){return y.call(this)};if(g==="image/bmp")return new Promise(n=>Us.toBlob(l,n)).then((function(n){try{return a=n,a.name=D,a.lastModified=d,C.call(this)}catch(r){return f(r)}}).bind(this),f);{let n=function(){return C.call(this)};if(typeof OffscreenCanvas=="function"&&l instanceof OffscreenCanvas)return l.convertToBlob({type:g,quality:e}).then((function(r){try{return a=r,a.name=D,a.lastModified=d,n.call(this)}catch(s){return f(s)}}).bind(this),f);{let r;return r=l.toDataURL(g,e),Yn(r,D,d).then((function(s){try{return a=s,n.call(this)}catch(u){return f(u)}}).bind(this),f)}}}function y(){return t(a)}})}function rt(l){l.width=0,l.height=0}function _t(){return new Promise(function(l,g){let D,d,e,t;return _t.cachedResult!==void 0?l(_t.cachedResult):Yn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(f){try{return D=f,yn(D).then(function(a){try{return d=a[1],Tn(d,D.type,D.name,D.lastModified).then(function(y){try{return e=y,rt(d),yn(e).then(function(C){try{return t=C[0],_t.cachedResult=t.width===1&&t.height===2,l(_t.cachedResult)}catch(n){return g(n)}},g)}catch(C){return g(C)}},g)}catch(y){return g(y)}},g)}catch(a){return g(a)}},g)})}function $s(l){return new Promise((g,D)=>{const d=new Ns;d.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return g(-2);const f=t.byteLength;let a=2;for(;a<f;){if(t.getUint16(a+2,!1)<=8)return g(-1);const y=t.getUint16(a,!1);if(a+=2,y==65505){if(t.getUint32(a+=2,!1)!=1165519206)return g(-1);const C=t.getUint16(a+=6,!1)==18761;a+=t.getUint32(a+4,C);const n=t.getUint16(a,C);a+=2;for(let r=0;r<n;r++)if(t.getUint16(a+12*r,C)==274)return g(t.getUint16(a+12*r+8,C))}else{if((65280&y)!=65280)break;a+=t.getUint16(a,!1)}}return g(-1)},d.onerror=e=>D(e),d.readAsArrayBuffer(l)})}function zs(l,g){const{width:D}=l,{height:d}=l,{maxWidthOrHeight:e}=g;let t,f=l;return isFinite(e)&&(D>e||d>e)&&([f,t]=An(D,d),D>d?(f.width=e,f.height=d/D*e):(f.width=D/d*e,f.height=e),t.drawImage(l,0,0,f.width,f.height),rt(l)),f}function Ws(l,g){const{width:D}=l,{height:d}=l,[e,t]=An(D,d);switch(g>4&&g<9?(e.width=d,e.height=D):(e.width=D,e.height=d),g){case 2:t.transform(-1,0,0,1,D,0);break;case 3:t.transform(-1,0,0,-1,D,d);break;case 4:t.transform(1,0,0,-1,0,d);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,d,0);break;case 7:t.transform(0,-1,-1,0,d,D);break;case 8:t.transform(0,-1,1,0,0,D)}return t.drawImage(l,0,0,D,d),rt(l),e}function ls(l,g,D=0){return new Promise(function(d,e){let t,f,a,y,C,n,r,s,u,x,j,k,w,P,M,O,B,v,N,m;function h(A=5){if(g.signal&&g.signal.aborted)throw g.signal.reason;t+=A,g.onProgress(Math.min(t,100))}function b(A){if(g.signal&&g.signal.aborted)throw g.signal.reason;t=Math.min(Math.max(A,t),100),g.onProgress(t)}return t=D,f=g.maxIteration||10,a=1024*g.maxSizeMB*1024,h(),yn(l,g).then((function(A){try{return[,y]=A,h(),C=zs(y,g),h(),new Promise(function(S,_){var T;if(!(T=g.exifOrientation))return $s(l).then((function(p){try{return T=p,F.call(this)}catch(c){return _(c)}}).bind(this),_);function F(){return S(T)}return F.call(this)}).then((function(S){try{return n=S,h(),_t().then((function(_){try{return r=_?C:Ws(C,n),h(),s=g.initialQuality||1,u=g.fileType||l.type,Tn(r,u,l.name,l.lastModified,s).then((function(T){try{{let p=function(){if(f--&&(M>a||M>w)){let U,I;return U=m?.95*N.width:N.width,I=m?.95*N.height:N.height,[B,v]=An(U,I),v.drawImage(N,0,0,U,I),s*=u==="image/png"?.85:.95,Tn(B,u,l.name,l.lastModified,s).then(function(L){try{return O=L,rt(N),N=B,M=O.size,b(Math.min(99,Math.floor((P-M)/(P-a)*100))),p}catch(q){return e(q)}},e)}return[1]},c=function(){return rt(N),rt(B),rt(C),rt(r),rt(y),b(100),d(O)};if(x=T,h(),j=x.size>a,k=x.size>l.size,!j&&!k)return b(100),d(x);var F;return w=l.size,P=x.size,M=P,N=r,m=!g.alwaysKeepResolution&&j,(F=(function(U){for(;U;){if(U.then)return void U.then(F,e);try{if(U.pop){if(U.length)return U.pop()?c.call(this):U;U=p}else U=U.call(this)}catch(I){return e(I)}}}).bind(this))(p)}}catch(p){return e(p)}}).bind(this),e)}catch(T){return e(T)}}).bind(this),e)}catch(_){return e(_)}}).bind(this),e)}catch(S){return e(S)}}).bind(this),e)})}const Gr=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Rn;function Vr(l,g){return new Promise((D,d)=>{Rn||(Rn=function(f){const a=[];return a.push(f),URL.createObjectURL(new Blob(a))}(Gr));const e=new Worker(Rn);e.addEventListener("message",function(f){if(g.signal&&g.signal.aborted)e.terminate();else if(f.data.progress===void 0){if(f.data.error)return d(new Error(f.data.error)),void e.terminate();D(f.data.file),e.terminate()}else g.onProgress(f.data.progress)}),e.addEventListener("error",d),g.signal&&g.signal.addEventListener("abort",()=>{d(g.signal.reason),e.terminate()}),e.postMessage({file:l,imageCompressionLibUrl:g.libURL,options:{...g,onProgress:void 0,signal:void 0}})})}function ke(l,g){return new Promise(function(D,d){let e,t,f,a,y,C;if(e={...g},f=0,{onProgress:a}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,y=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=u=>{f=u,typeof a=="function"&&a(f)},!(l instanceof Blob||l instanceof Wr))return d(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(l.type))return d(new Error("The file given is not an image"));if(C=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!y||typeof Worker!="function"||C)return ls(l,e).then((function(u){try{return t=u,s.call(this)}catch(x){return d(x)}}).bind(this),d);var n=(function(){try{return s.call(this)}catch(u){return d(u)}}).bind(this),r=function(u){try{return ls(l,e).then(function(x){try{return t=x,n()}catch(j){return d(j)}},d)}catch(x){return d(x)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Vr(l,e).then(function(u){try{return t=u,n()}catch{return r()}},r)}catch{r()}function s(){try{t.name=l.name,t.lastModified=l.lastModified}catch{}try{e.preserveExif&&l.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===l.type)&&(t=Os(l,t))}catch{}return D(t)}})}ke.getDataUrlFromFile=Ls,ke.getFilefromDataUrl=Yn,ke.loadImage=Ps,ke.drawImageInCanvas=Hs,ke.drawFileInCanvas=yn,ke.canvasToFile=Tn,ke.getExifOrientation=$s,ke.handleMaxWidthOrHeight=zs,ke.followExifOrientation=Ws,ke.cleanupCanvasMemory=rt,ke.isAutoOrientationInBrowser=_t,ke.approximateBelowMaximumCanvasSizeOfBrowser=Bs,ke.copyExifWithoutOrientation=Os,ke.getBrowserName=Tt,ke.version="2.0.2";function Yr(l){var g=typeof l;return l!=null&&(g=="object"||g=="function")}var Gs=Yr,qr=typeof ln=="object"&&ln&&ln.Object===Object&&ln,Qr=qr,Xr=Qr,Zr=typeof self=="object"&&self&&self.Object===Object&&self,Kr=Xr||Zr||Function("return this")(),Vs=Kr,Jr=Vs,ei=function(){return Jr.Date.now()},ti=ei,ni=/\s/;function si(l){for(var g=l.length;g--&&ni.test(l.charAt(g)););return g}var ri=si,ii=ri,ai=/^\s+/;function oi(l){return l&&l.slice(0,ii(l)+1).replace(ai,"")}var li=oi,ci=Vs,di=ci.Symbol,Ys=di,cs=Ys,qs=Object.prototype,ui=qs.hasOwnProperty,fi=qs.toString,Bt=cs?cs.toStringTag:void 0;function hi(l){var g=ui.call(l,Bt),D=l[Bt];try{l[Bt]=void 0;var d=!0}catch{}var e=fi.call(l);return d&&(g?l[Bt]=D:delete l[Bt]),e}var mi=hi,pi=Object.prototype,gi=pi.toString;function bi(l){return gi.call(l)}var xi=bi,ds=Ys,vi=mi,yi=xi,Ti="[object Null]",Ai="[object Undefined]",us=ds?ds.toStringTag:void 0;function Ci(l){return l==null?l===void 0?Ai:Ti:us&&us in Object(l)?vi(l):yi(l)}var Si=Ci;function wi(l){return l!=null&&typeof l=="object"}var _i=wi,Ei=Si,ji=_i,Ii="[object Symbol]";function Di(l){return typeof l=="symbol"||ji(l)&&Ei(l)==Ii}var Ri=Di,Fi=li,fs=Gs,ki=Ri,hs=NaN,Oi=/^[-+]0x[0-9a-f]+$/i,Ui=/^0b[01]+$/i,Mi=/^0o[0-7]+$/i,Ni=parseInt;function Li(l){if(typeof l=="number")return l;if(ki(l))return hs;if(fs(l)){var g=typeof l.valueOf=="function"?l.valueOf():l;l=fs(g)?g+"":g}if(typeof l!="string")return l===0?l:+l;l=Fi(l);var D=Ui.test(l);return D||Mi.test(l)?Ni(l.slice(2),D?2:8):Oi.test(l)?hs:+l}var Pi=Li,Bi=Gs,Fn=ti,ms=Pi,Hi="Expected a function",$i=Math.max,zi=Math.min;function Wi(l,g,D){var d,e,t,f,a,y,C=0,n=!1,r=!1,s=!0;if(typeof l!="function")throw new TypeError(Hi);g=ms(g)||0,Bi(D)&&(n=!!D.leading,r="maxWait"in D,t=r?$i(ms(D.maxWait)||0,g):t,s="trailing"in D?!!D.trailing:s);function u(v){var N=d,m=e;return d=e=void 0,C=v,f=l.apply(m,N),f}function x(v){return C=v,a=setTimeout(w,g),n?u(v):f}function j(v){var N=v-y,m=v-C,h=g-N;return r?zi(h,t-m):h}function k(v){var N=v-y,m=v-C;return y===void 0||N>=g||N<0||r&&m>=t}function w(){var v=Fn();if(k(v))return P(v);a=setTimeout(w,j(v))}function P(v){return a=void 0,s&&d?u(v):(d=e=void 0,f)}function M(){a!==void 0&&clearTimeout(a),C=0,d=y=e=a=void 0}function O(){return a===void 0?f:P(Fn())}function B(){var v=Fn(),N=k(v);if(d=arguments,e=this,y=v,N){if(a===void 0)return x(y);if(r)return clearTimeout(a),a=setTimeout(w,g),u(y)}return a===void 0&&(a=setTimeout(w,g)),f}return B.cancel=M,B.flush=O,B}var Gi=Wi;const Vi=vr(Gi);var qn={},Yi=bt;Object.defineProperty(qn,"__esModule",{value:!0});var Qs=qn.default=void 0,qi=Yi(gt()),ps=o;Qs=qn.default=(0,qi.default)([(0,ps.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,ps.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn");var Qn={},Qi=bt;Object.defineProperty(Qn,"__esModule",{value:!0});var Xs=Qn.default=void 0,Xi=Qi(gt()),Zi=o;Xs=Qn.default=(0,Xi.default)((0,Zi.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut");var Xn={},Ki=bt;Object.defineProperty(Xn,"__esModule",{value:!0});var Zs=Xn.default=void 0,Ji=Ki(gt()),ea=o;Zs=Xn.default=(0,Ji.default)((0,ea.jsx)("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen");var Zn={},ta=bt;Object.defineProperty(Zn,"__esModule",{value:!0});var Ks=Zn.default=void 0,na=ta(gt()),sa=o;Ks=Zn.default=(0,na.default)((0,sa.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var Kn={},ra=bt;Object.defineProperty(Kn,"__esModule",{value:!0});var Js=Kn.default=void 0,ia=ra(gt()),gs=o;Js=Kn.default=(0,ia.default)([(0,gs.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,gs.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera");const Dt=z.forwardRef(({path:l,initialImages:g=[],onImagesUpdated:D,onDelete:d,isOwnDesign:e},t)=>{const[f,a]=z.useState(g.map(c=>({...c,deleted:!1}))),[y,C]=z.useState(!1),[n,r]=z.useState(0),[s,u]=z.useState(!1),[x,j]=z.useState(null),[k,w]=z.useState(1),[P,M]=z.useState(!1),[O,B]=z.useState(!1),[v,N]=z.useState(""),[m,h]=z.useState("info"),b=z.useRef(null);z.useEffect(()=>{console.log("Initial images received:",g),a(g.map(c=>({...c,deleted:!!c.deleted})))},[g]);const A=async c=>{const U=Array.from(c.target.files||[]);C(!0);const I={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},L=U.map(async(q,$)=>{let Q=q;q.size>1024*1024&&(Q=await ke(q,I),N("Your image was compressed before uploading due to file size larger than 1 MB."),h("info"),B(!0));const H=`${new Date().getTime()}-${Q.name}`,K=Et(),ue=jt(K,`${l}/${H}`),ne=Fs(ue,Q);return new Promise((re,le)=>{ne.on("state_changed",J=>{const fe=J.bytesTransferred/J.totalBytes*100;r(fe)},J=>{console.error("Upload failed:",J),le(J)},()=>{ks(ne.snapshot.ref).then(J=>{re({url:J,path:ue.fullPath,title:""})})})})});Promise.all(L).then(q=>{const $=[...f,...q];a($),D&&D($),N("Images uploaded successfully."),h("success"),B(!0),C(!1),r(0),b.current&&(b.current.value="")}).catch(q=>{console.error("Error uploading images: ",q),N("Failed to upload images."),h("error"),B(!0),C(!1),r(0)})},S=c=>{a(U=>{const I=U.map((L,q)=>q===c?{...L,deleted:!0}:L);return D(I),I}),N("Image marked for deletion. Update to permanently delete."),h("info"),B(!0)},_=async()=>{const c=f.filter(U=>U.deleted);if(console.log("Attempting to delete images:",c),c.length>0){const U=c.map(I=>{const L=Et(),q=jt(L,I.path);return hn(q)});try{await Promise.all(U),d(c),a(I=>I.filter(L=>!L.deleted)),N("Deleted images have been permanently removed."),h("success")}catch(I){console.error("Error committing deletions:",I),N("Failed to commit deletions."),h("error")}B(!0)}else console.log("No images marked for deletion.")},T=c=>{M(!P),j(c)};z.useEffect(()=>{const c=()=>{const U=!!document.fullscreenElement;M(U)};return document.addEventListener("fullscreenchange",c),()=>document.removeEventListener("fullscreenchange",c)},[]);const F=(c,U)=>{U!=="clickaway"&&B(!1)},p=z.useCallback(Vi((c,U)=>{setTimeout(()=>{a(I=>{const L=I.map((q,$)=>$===c?{...q,title:U}:q);return D&&D(L),L})},0)},30),[D]);return z.useImperativeHandle(t,()=>({commitDeletions:_})),o.jsxs("div",{children:[e&&o.jsx(Yt,{title:"Upload Images",children:o.jsxs(Le,{variant:"outlined",component:"label",startIcon:o.jsx(Js,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",o.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:A,disabled:y,ref:b,accept:"image/*"})]})}),y&&o.jsxs(o.Fragment,{children:[o.jsxs("p",{children:["Uploading... ",Math.round(n),"%"]}),o.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:o.jsx("div",{style:{height:"20px",width:`${n}%`,backgroundColor:"green"}})})]}),f.filter(c=>!c.deleted).map((c,U)=>o.jsxs("div",{children:[o.jsx("img",{src:c.url,alt:`Uploaded design ${U}`,onClick:()=>{u(!0),j(U)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&o.jsx(Xe,{onClick:()=>S(U),children:o.jsx(qt,{})}),o.jsx("textarea",{value:c.title,onChange:I=>p(U,I.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},U)),o.jsx(At,{open:s,onClose:()=>u(!1),fullScreen:P,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:P?"none":void 0,maxHeight:P?"none":void 0,height:P?"100%":void 0,width:P?"100%":void 0,overflowY:"auto"}},children:x!==null&&o.jsxs(Ct,{children:[o.jsx("div",{style:{textAlign:"center"},children:o.jsx("img",{src:f[x].url,alt:`Zoomed Design ${x}`,style:{maxWidth:"100%",maxHeight:P?"100vh":void 0,transform:`scale(${k})`,transition:"transform 0.2s ease-out"}})}),o.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[o.jsx(Xe,{onClick:()=>w(k*1.2),children:o.jsx(Qs,{})}),o.jsx(Xe,{onClick:()=>w(k/1.2),style:{marginLeft:"10px"},children:o.jsx(Xs,{})}),o.jsx(Xe,{onClick:()=>T(x),style:{marginLeft:"10px"},children:o.jsx(Zs,{})}),P&&o.jsx(Xe,{onClick:()=>T(x),style:{position:"absolute",top:20,right:20},children:o.jsx(Ks,{})})]})]})}),o.jsx(mt,{open:O,autoHideDuration:6e3,onClose:F,children:o.jsx(pt,{onClose:F,severity:m,sx:{width:"100%"},children:v})})]})});/*! @license DOMPurify 3.1.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.1.5/LICENSE */const{entries:er,setPrototypeOf:bs,isFrozen:aa,getPrototypeOf:oa,getOwnPropertyDescriptor:la}=Object;let{freeze:Pe,seal:Ze,create:tr}=Object,{apply:$n,construct:zn}=typeof Reflect<"u"&&Reflect;Pe||(Pe=function(g){return g});Ze||(Ze=function(g){return g});$n||($n=function(g,D,d){return g.apply(D,d)});zn||(zn=function(g,D){return new g(...D)});const dn=Ye(Array.prototype.forEach),xs=Ye(Array.prototype.pop),Ht=Ye(Array.prototype.push),pn=Ye(String.prototype.toLowerCase),kn=Ye(String.prototype.toString),vs=Ye(String.prototype.match),$t=Ye(String.prototype.replace),ca=Ye(String.prototype.indexOf),da=Ye(String.prototype.trim),nt=Ye(Object.prototype.hasOwnProperty),Ne=Ye(RegExp.prototype.test),zt=ua(TypeError);function Ye(l){return function(g){for(var D=arguments.length,d=new Array(D>1?D-1:0),e=1;e<D;e++)d[e-1]=arguments[e];return $n(l,g,d)}}function ua(l){return function(){for(var g=arguments.length,D=new Array(g),d=0;d<g;d++)D[d]=arguments[d];return zn(l,D)}}function ae(l,g){let D=arguments.length>2&&arguments[2]!==void 0?arguments[2]:pn;bs&&bs(l,null);let d=g.length;for(;d--;){let e=g[d];if(typeof e=="string"){const t=D(e);t!==e&&(aa(g)||(g[d]=t),e=t)}l[e]=!0}return l}function fa(l){for(let g=0;g<l.length;g++)nt(l,g)||(l[g]=null);return l}function yt(l){const g=tr(null);for(const[D,d]of er(l))nt(l,D)&&(Array.isArray(d)?g[D]=fa(d):d&&typeof d=="object"&&d.constructor===Object?g[D]=yt(d):g[D]=d);return g}function un(l,g){for(;l!==null;){const d=la(l,g);if(d){if(d.get)return Ye(d.get);if(typeof d.value=="function")return Ye(d.value)}l=oa(l)}function D(){return null}return D}const ys=Pe(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),On=Pe(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Un=Pe(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ha=Pe(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Mn=Pe(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),ma=Pe(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ts=Pe(["#text"]),As=Pe(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Nn=Pe(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Cs=Pe(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),fn=Pe(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),pa=Ze(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ga=Ze(/<%[\w\W]*|[\w\W]*%>/gm),ba=Ze(/\${[\w\W]*}/gm),xa=Ze(/^data-[\-\w.\u00B7-\uFFFF]/),va=Ze(/^aria-[\-\w]+$/),nr=Ze(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ya=Ze(/^(?:\w+script|data):/i),Ta=Ze(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),sr=Ze(/^html$/i),Aa=Ze(/^[a-z][.\w]*(-[.\w]+)+$/i);var Ss=Object.freeze({__proto__:null,MUSTACHE_EXPR:pa,ERB_EXPR:ga,TMPLIT_EXPR:ba,DATA_ATTR:xa,ARIA_ATTR:va,IS_ALLOWED_URI:nr,IS_SCRIPT_OR_DATA:ya,ATTR_WHITESPACE:Ta,DOCTYPE_NAME:sr,CUSTOM_ELEMENT:Aa});const Wt={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},Ca=function(){return typeof window>"u"?null:window},Sa=function(g,D){if(typeof g!="object"||typeof g.createPolicy!="function")return null;let d=null;const e="data-tt-policy-suffix";D&&D.hasAttribute(e)&&(d=D.getAttribute(e));const t="dompurify"+(d?"#"+d:"");try{return g.createPolicy(t,{createHTML(f){return f},createScriptURL(f){return f}})}catch{return console.warn("TrustedTypes policy "+t+" could not be created."),null}};function rr(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ca();const g=Z=>rr(Z);if(g.version="3.1.5",g.removed=[],!l||!l.document||l.document.nodeType!==Wt.document)return g.isSupported=!1,g;let{document:D}=l;const d=D,e=d.currentScript,{DocumentFragment:t,HTMLTemplateElement:f,Node:a,Element:y,NodeFilter:C,NamedNodeMap:n=l.NamedNodeMap||l.MozNamedAttrMap,HTMLFormElement:r,DOMParser:s,trustedTypes:u}=l,x=y.prototype,j=un(x,"cloneNode"),k=un(x,"nextSibling"),w=un(x,"childNodes"),P=un(x,"parentNode");if(typeof f=="function"){const Z=D.createElement("template");Z.content&&Z.content.ownerDocument&&(D=Z.content.ownerDocument)}let M,O="";const{implementation:B,createNodeIterator:v,createDocumentFragment:N,getElementsByTagName:m}=D,{importNode:h}=d;let b={};g.isSupported=typeof er=="function"&&typeof P=="function"&&B&&B.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:A,ERB_EXPR:S,TMPLIT_EXPR:_,DATA_ATTR:T,ARIA_ATTR:F,IS_SCRIPT_OR_DATA:p,ATTR_WHITESPACE:c,CUSTOM_ELEMENT:U}=Ss;let{IS_ALLOWED_URI:I}=Ss,L=null;const q=ae({},[...ys,...On,...Un,...Mn,...Ts]);let $=null;const Q=ae({},[...As,...Nn,...Cs,...fn]);let W=Object.seal(tr(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),H=null,K=null,ue=!0,ne=!0,re=!1,le=!0,J=!1,fe=!0,we=!1,je=!1,he=!1,ge=!1,de=!1,ce=!1,ye=!0,Se=!1;const xe="user-content-";let be=!0,me=!1,ie={},Te=null;const Oe=ae({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let at=null;const ee=ae({},["audio","video","img","source","image","track"]);let $e=null;const te=ae({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ie="http://www.w3.org/1998/Math/MathML",se="http://www.w3.org/2000/svg",ve="http://www.w3.org/1999/xhtml";let pe=ve,ze=!1,ot=null;const Ut=ae({},[Ie,se,ve],kn);let Ke=null;const St=["application/xhtml+xml","text/html"],lt="text/html";let Ae=null,De=null;const Ue=D.createElement("form"),Je=function(i){return i instanceof RegExp||i instanceof Function},et=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(De&&De===i)){if((!i||typeof i!="object")&&(i={}),i=yt(i),Ke=St.indexOf(i.PARSER_MEDIA_TYPE)===-1?lt:i.PARSER_MEDIA_TYPE,Ae=Ke==="application/xhtml+xml"?kn:pn,L=nt(i,"ALLOWED_TAGS")?ae({},i.ALLOWED_TAGS,Ae):q,$=nt(i,"ALLOWED_ATTR")?ae({},i.ALLOWED_ATTR,Ae):Q,ot=nt(i,"ALLOWED_NAMESPACES")?ae({},i.ALLOWED_NAMESPACES,kn):Ut,$e=nt(i,"ADD_URI_SAFE_ATTR")?ae(yt(te),i.ADD_URI_SAFE_ATTR,Ae):te,at=nt(i,"ADD_DATA_URI_TAGS")?ae(yt(ee),i.ADD_DATA_URI_TAGS,Ae):ee,Te=nt(i,"FORBID_CONTENTS")?ae({},i.FORBID_CONTENTS,Ae):Oe,H=nt(i,"FORBID_TAGS")?ae({},i.FORBID_TAGS,Ae):{},K=nt(i,"FORBID_ATTR")?ae({},i.FORBID_ATTR,Ae):{},ie=nt(i,"USE_PROFILES")?i.USE_PROFILES:!1,ue=i.ALLOW_ARIA_ATTR!==!1,ne=i.ALLOW_DATA_ATTR!==!1,re=i.ALLOW_UNKNOWN_PROTOCOLS||!1,le=i.ALLOW_SELF_CLOSE_IN_ATTR!==!1,J=i.SAFE_FOR_TEMPLATES||!1,fe=i.SAFE_FOR_XML!==!1,we=i.WHOLE_DOCUMENT||!1,ge=i.RETURN_DOM||!1,de=i.RETURN_DOM_FRAGMENT||!1,ce=i.RETURN_TRUSTED_TYPE||!1,he=i.FORCE_BODY||!1,ye=i.SANITIZE_DOM!==!1,Se=i.SANITIZE_NAMED_PROPS||!1,be=i.KEEP_CONTENT!==!1,me=i.IN_PLACE||!1,I=i.ALLOWED_URI_REGEXP||nr,pe=i.NAMESPACE||ve,W=i.CUSTOM_ELEMENT_HANDLING||{},i.CUSTOM_ELEMENT_HANDLING&&Je(i.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(W.tagNameCheck=i.CUSTOM_ELEMENT_HANDLING.tagNameCheck),i.CUSTOM_ELEMENT_HANDLING&&Je(i.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(W.attributeNameCheck=i.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),i.CUSTOM_ELEMENT_HANDLING&&typeof i.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(W.allowCustomizedBuiltInElements=i.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),J&&(ne=!1),de&&(ge=!0),ie&&(L=ae({},Ts),$=[],ie.html===!0&&(ae(L,ys),ae($,As)),ie.svg===!0&&(ae(L,On),ae($,Nn),ae($,fn)),ie.svgFilters===!0&&(ae(L,Un),ae($,Nn),ae($,fn)),ie.mathMl===!0&&(ae(L,Mn),ae($,Cs),ae($,fn))),i.ADD_TAGS&&(L===q&&(L=yt(L)),ae(L,i.ADD_TAGS,Ae)),i.ADD_ATTR&&($===Q&&($=yt($)),ae($,i.ADD_ATTR,Ae)),i.ADD_URI_SAFE_ATTR&&ae($e,i.ADD_URI_SAFE_ATTR,Ae),i.FORBID_CONTENTS&&(Te===Oe&&(Te=yt(Te)),ae(Te,i.FORBID_CONTENTS,Ae)),be&&(L["#text"]=!0),we&&ae(L,["html","head","body"]),L.table&&(ae(L,["tbody"]),delete H.tbody),i.TRUSTED_TYPES_POLICY){if(typeof i.TRUSTED_TYPES_POLICY.createHTML!="function")throw zt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof i.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw zt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');M=i.TRUSTED_TYPES_POLICY,O=M.createHTML("")}else M===void 0&&(M=Sa(u,e)),M!==null&&typeof O=="string"&&(O=M.createHTML(""));Pe&&Pe(i),De=i}},xt=ae({},["mi","mo","mn","ms","mtext"]),We=ae({},["foreignobject","annotation-xml"]),qe=ae({},["title","style","font","a","script"]),Zt=ae({},[...On,...Un,...ha]),Kt=ae({},[...Mn,...ma]),Cn=function(i){let R=P(i);(!R||!R.tagName)&&(R={namespaceURI:pe,tagName:"template"});const E=pn(i.tagName),G=pn(R.tagName);return ot[i.namespaceURI]?i.namespaceURI===se?R.namespaceURI===ve?E==="svg":R.namespaceURI===Ie?E==="svg"&&(G==="annotation-xml"||xt[G]):!!Zt[E]:i.namespaceURI===Ie?R.namespaceURI===ve?E==="math":R.namespaceURI===se?E==="math"&&We[G]:!!Kt[E]:i.namespaceURI===ve?R.namespaceURI===se&&!We[G]||R.namespaceURI===Ie&&!xt[G]?!1:!Kt[E]&&(qe[E]||!Zt[E]):!!(Ke==="application/xhtml+xml"&&ot[i.namespaceURI]):!1},Ge=function(i){Ht(g.removed,{element:i});try{i.parentNode.removeChild(i)}catch{i.remove()}},wt=function(i,R){try{Ht(g.removed,{attribute:R.getAttributeNode(i),from:R})}catch{Ht(g.removed,{attribute:null,from:R})}if(R.removeAttribute(i),i==="is"&&!$[i])if(ge||de)try{Ge(R)}catch{}else try{R.setAttribute(i,"")}catch{}},Jt=function(i){let R=null,E=null;if(he)i="<remove></remove>"+i;else{const X=vs(i,/^[\r\n\t ]+/);E=X&&X[0]}Ke==="application/xhtml+xml"&&pe===ve&&(i='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+i+"</body></html>");const G=M?M.createHTML(i):i;if(pe===ve)try{R=new s().parseFromString(G,Ke)}catch{}if(!R||!R.documentElement){R=B.createDocument(pe,"template",null);try{R.documentElement.innerHTML=ze?O:G}catch{}}const V=R.body||R.documentElement;return i&&E&&V.insertBefore(D.createTextNode(E),V.childNodes[0]||null),pe===ve?m.call(R,we?"html":"body")[0]:we?R.documentElement:V},en=function(i){return v.call(i.ownerDocument||i,i,C.SHOW_ELEMENT|C.SHOW_COMMENT|C.SHOW_TEXT|C.SHOW_PROCESSING_INSTRUCTION|C.SHOW_CDATA_SECTION,null)},vt=function(i){return i instanceof r&&(typeof i.nodeName!="string"||typeof i.textContent!="string"||typeof i.removeChild!="function"||!(i.attributes instanceof n)||typeof i.removeAttribute!="function"||typeof i.setAttribute!="function"||typeof i.namespaceURI!="string"||typeof i.insertBefore!="function"||typeof i.hasChildNodes!="function")},tn=function(i){return typeof a=="function"&&i instanceof a},Qe=function(i,R,E){b[i]&&dn(b[i],G=>{G.call(g,R,E,De)})},Mt=function(i){let R=null;if(Qe("beforeSanitizeElements",i,null),vt(i))return Ge(i),!0;const E=Ae(i.nodeName);if(Qe("uponSanitizeElement",i,{tagName:E,allowedTags:L}),i.hasChildNodes()&&!tn(i.firstElementChild)&&Ne(/<[/\w]/g,i.innerHTML)&&Ne(/<[/\w]/g,i.textContent)||i.nodeType===Wt.progressingInstruction||fe&&i.nodeType===Wt.comment&&Ne(/<[/\w]/g,i.data))return Ge(i),!0;if(!L[E]||H[E]){if(!H[E]&&sn(E)&&(W.tagNameCheck instanceof RegExp&&Ne(W.tagNameCheck,E)||W.tagNameCheck instanceof Function&&W.tagNameCheck(E)))return!1;if(be&&!Te[E]){const G=P(i)||i.parentNode,V=w(i)||i.childNodes;if(V&&G){const X=V.length;for(let Y=X-1;Y>=0;--Y){const Ce=j(V[Y],!0);Ce.__removalCount=(i.__removalCount||0)+1,G.insertBefore(Ce,k(i))}}}return Ge(i),!0}return i instanceof y&&!Cn(i)||(E==="noscript"||E==="noembed"||E==="noframes")&&Ne(/<\/no(script|embed|frames)/i,i.innerHTML)?(Ge(i),!0):(J&&i.nodeType===Wt.text&&(R=i.textContent,dn([A,S,_],G=>{R=$t(R,G," ")}),i.textContent!==R&&(Ht(g.removed,{element:i.cloneNode()}),i.textContent=R)),Qe("afterSanitizeElements",i,null),!1)},nn=function(i,R,E){if(ye&&(R==="id"||R==="name")&&(E in D||E in Ue))return!1;if(!(ne&&!K[R]&&Ne(T,R))){if(!(ue&&Ne(F,R))){if(!$[R]||K[R]){if(!(sn(i)&&(W.tagNameCheck instanceof RegExp&&Ne(W.tagNameCheck,i)||W.tagNameCheck instanceof Function&&W.tagNameCheck(i))&&(W.attributeNameCheck instanceof RegExp&&Ne(W.attributeNameCheck,R)||W.attributeNameCheck instanceof Function&&W.attributeNameCheck(R))||R==="is"&&W.allowCustomizedBuiltInElements&&(W.tagNameCheck instanceof RegExp&&Ne(W.tagNameCheck,E)||W.tagNameCheck instanceof Function&&W.tagNameCheck(E))))return!1}else if(!$e[R]){if(!Ne(I,$t(E,c,""))){if(!((R==="src"||R==="xlink:href"||R==="href")&&i!=="script"&&ca(E,"data:")===0&&at[i])){if(!(re&&!Ne(p,$t(E,c,"")))){if(E)return!1}}}}}}return!0},sn=function(i){return i!=="annotation-xml"&&vs(i,U)},rn=function(i){Qe("beforeSanitizeAttributes",i,null);const{attributes:R}=i;if(!R)return;const E={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:$};let G=R.length;for(;G--;){const V=R[G],{name:X,namespaceURI:Y,value:Ce}=V,Me=Ae(X);let _e=X==="value"?Ce:da(Ce);if(E.attrName=Me,E.attrValue=_e,E.keepAttr=!0,E.forceKeepAttr=void 0,Qe("uponSanitizeAttribute",i,E),_e=E.attrValue,E.forceKeepAttr||(wt(X,i),!E.keepAttr))continue;if(!le&&Ne(/\/>/i,_e)){wt(X,i);continue}if(fe&&Ne(/((--!?|])>)|<\/(style|title)/i,_e)){wt(X,i);continue}J&&dn([A,S,_],Nt=>{_e=$t(_e,Nt," ")});const an=Ae(i.nodeName);if(nn(an,Me,_e)){if(Se&&(Me==="id"||Me==="name")&&(wt(X,i),_e=xe+_e),M&&typeof u=="object"&&typeof u.getAttributeType=="function"&&!Y)switch(u.getAttributeType(an,Me)){case"TrustedHTML":{_e=M.createHTML(_e);break}case"TrustedScriptURL":{_e=M.createScriptURL(_e);break}}try{Y?i.setAttributeNS(Y,X,_e):i.setAttribute(X,_e),vt(i)?Ge(i):xs(g.removed)}catch{}}}Qe("afterSanitizeAttributes",i,null)},Sn=function Z(i){let R=null;const E=en(i);for(Qe("beforeSanitizeShadowDOM",i,null);R=E.nextNode();)Qe("uponSanitizeShadowNode",R,null),!Mt(R)&&(R.content instanceof t&&Z(R.content),rn(R));Qe("afterSanitizeShadowDOM",i,null)};return g.sanitize=function(Z){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},R=null,E=null,G=null,V=null;if(ze=!Z,ze&&(Z="<!-->"),typeof Z!="string"&&!tn(Z))if(typeof Z.toString=="function"){if(Z=Z.toString(),typeof Z!="string")throw zt("dirty is not a string, aborting")}else throw zt("toString is not a function");if(!g.isSupported)return Z;if(je||et(i),g.removed=[],typeof Z=="string"&&(me=!1),me){if(Z.nodeName){const Ce=Ae(Z.nodeName);if(!L[Ce]||H[Ce])throw zt("root node is forbidden and cannot be sanitized in-place")}}else if(Z instanceof a)R=Jt("<!---->"),E=R.ownerDocument.importNode(Z,!0),E.nodeType===Wt.element&&E.nodeName==="BODY"||E.nodeName==="HTML"?R=E:R.appendChild(E);else{if(!ge&&!J&&!we&&Z.indexOf("<")===-1)return M&&ce?M.createHTML(Z):Z;if(R=Jt(Z),!R)return ge?null:ce?O:""}R&&he&&Ge(R.firstChild);const X=en(me?Z:R);for(;G=X.nextNode();)Mt(G)||(G.content instanceof t&&Sn(G.content),rn(G));if(me)return Z;if(ge){if(de)for(V=N.call(R.ownerDocument);R.firstChild;)V.appendChild(R.firstChild);else V=R;return($.shadowroot||$.shadowrootmode)&&(V=h.call(d,V,!0)),V}let Y=we?R.outerHTML:R.innerHTML;return we&&L["!doctype"]&&R.ownerDocument&&R.ownerDocument.doctype&&R.ownerDocument.doctype.name&&Ne(sr,R.ownerDocument.doctype.name)&&(Y="<!DOCTYPE "+R.ownerDocument.doctype.name+`>
`+Y),J&&dn([A,S,_],Ce=>{Y=$t(Y,Ce," ")}),M&&ce?M.createHTML(Y):Y},g.setConfig=function(){let Z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};et(Z),je=!0},g.clearConfig=function(){De=null,je=!1},g.isValidAttribute=function(Z,i,R){De||et({});const E=Ae(Z),G=Ae(i);return nn(E,G,R)},g.addHook=function(Z,i){typeof i=="function"&&(b[Z]=b[Z]||[],Ht(b[Z],i))},g.removeHook=function(Z){if(b[Z])return xs(b[Z])},g.removeHooks=function(Z){b[Z]&&(b[Z]=[])},g.removeAllHooks=function(){b={}},g}var Ln=rr();const it=({onChange:l,initialValue:g})=>{const[D,d]=z.useState(Ln.sanitize(g||"")),e=z.useRef(!1),t=z.useRef(null),[f,a]=z.useState("");z.useEffect(()=>{e.current?d(Ln.sanitize(g||"")):e.current=!0},[g]);const y=(u,x)=>{const j=x.getData(),k=Ln.sanitize(j);d(k),l(k)},C=u=>{if(!t.current){console.warn("Editor not initialized");return}const x=t.current;x.model.change(j=>{const k=x.model.document.selection.getFirstPosition();j.insertText(u,k)}),a("")},n=u=>{C(u.target.value)},r=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],s=["°","+","-","=","~","≥","≤","≠",">","<","*","/","%"];return o.jsxs("div",{children:[o.jsxs(Vt,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%"},children:[o.jsx(yr,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),o.jsx(is,{variant:"standard",sx:{m:1,minWidth:40},children:o.jsxs(as,{labelId:"math-operators-label",id:"math-operators",value:f,onChange:n,displayEmpty:!0,children:[o.jsx(cn,{value:"",disabled:!0,children:"Math"}),s.map(u=>o.jsx(cn,{value:u,children:u},u))]})}),o.jsx(is,{variant:"standard",sx:{m:1,minWidth:40},children:o.jsxs(as,{labelId:"greek-letters-label",id:"greek-letters",value:f,onChange:n,displayEmpty:!0,children:[o.jsx(cn,{value:"",disabled:!0,children:"Greek"}),r.map(u=>o.jsx(cn,{value:u,children:u},u))]})})]}),o.jsx(Tr.CKEditor,{editor:Ar,data:D,onReady:u=>{t.current=u},config:{toolbar:["undo","redo","|","heading","bold","italic","|","bulletedList","numberedList","blockQuote","indent","outdent","|","link","insertTable","|"],table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]}},onChange:y})]})};var Jn={},wa=bt;Object.defineProperty(Jn,"__esModule",{value:!0});var ir=Jn.default=void 0,_a=wa(gt()),Ea=o;ir=Jn.default=(0,_a.default)((0,Ea.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile");var es={},ja=bt;Object.defineProperty(es,"__esModule",{value:!0});var ar=es.default=void 0,Ia=ja(gt()),Da=o;ar=es.default=(0,Ia.default)((0,Da.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload");const Rt=({path:l,initialFiles:g,onFilesChange:D,isOwnDesign:d})=>{const[e,t]=z.useState(g.map(b=>({...b,deleted:!!b.deleted}))),[f,a]=z.useState(!1),[y,C]=z.useState(0),[n,r]=z.useState({}),[s,u]=z.useState(!1),[x,j]=z.useState(""),[k,w]=z.useState("info"),P=z.useRef(null);z.useEffect(()=>{console.log("Initial files received:",g),t(g.map(b=>({...b,deleted:!!b.deleted})))},[g]),z.useEffect(()=>()=>{r({})},[]);const M=b=>{console.log("Updating files with",b),D(b),t(b)},O=async b=>{if(!b.target.files)return;const S=Array.from(b.target.files).filter(T=>T.size>5242880?(j("File size should not exceed 5 MB"),w("error"),u(!0),!1):!0);a(!0);const _=S.map(T=>{const F=new Date().getTime(),p=`${F}-${T.name}`,c=Et(),U=jt(c,`${l}/${p}`),I=Fs(U,T);return new Promise((L,q)=>{I.on("state_changed",$=>{const Q=$.bytesTransferred/$.totalBytes*100;C(Q)},$=>{console.error("Upload failed:",$),q($)},()=>{ks(I.snapshot.ref).then($=>{L({id:F.toString(),url:$,name:T.name,path:U.fullPath})})})})});Promise.all(_).then(T=>{const F=[...e.filter(p=>!p.deleted),...T];M(F),j("Files uploaded successfully."),w("success"),u(!0),a(!1),C(0),P.current&&(P.current.value="")}).catch(T=>{console.error("Error uploading files: ",T),j("Failed to upload files."),w("error"),u(!0),a(!1),C(0)})},B=b=>{const A=e.map(S=>S.id===b?{...S,deleted:!0}:S);M(A),j("File marked for deletion. Update to permanently delete."),w("info"),u(!0)},v=b=>{r(A=>{var S;return{...A,[b]:((S=e.find(_=>_.id===b))==null?void 0:S.name)||""}}),console.log("editStates after handleEditClick:",n)},N=b=>{t(A=>{const S=A.map(_=>_.id===b&&n[b]!==void 0?{..._,name:n[b]}:_);return D(S),S}),r(A=>{const S={...A};return delete S[b],S}),j("File name updated successfully."),w("info"),u(!0)},m=(b,A)=>{r(S=>({...S,[b]:A}))},h=(b,A)=>{A!=="clickaway"&&u(!1)};return o.jsxs("div",{children:[d&&o.jsx(Yt,{title:"Upload Files",children:o.jsxs(Le,{variant:"outlined",component:"label",startIcon:o.jsx(ar,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",o.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:O,disabled:f,ref:P})]})}),f&&o.jsx("div",{children:o.jsxs("p",{children:["Uploading... ",Math.round(y),"%"]})}),o.jsx(Cr,{children:e.map(b=>o.jsxs(Sr,{component:"div",disabled:b.deleted,children:[o.jsx(Fr,{children:o.jsx(ir,{})}),typeof n[b.id]=="string"?o.jsx(bn,{variant:"outlined",size:"small",value:n[b.id],onChange:A=>m(b.id,A.target.value),onKeyPress:A=>A.key==="Enter"&&N(b.id),fullWidth:!0}):o.jsx(wr,{primary:b.name,secondary:o.jsx("a",{href:b.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),d&&(typeof n[b.id]=="string"?o.jsx(Xe,{onClick:()=>N(b.id),edge:"end","aria-label":"save",children:o.jsx(Hn,{})}):o.jsxs(o.Fragment,{children:[o.jsx(Xe,{onClick:()=>v(b.id),edge:"end","aria-label":"edit",children:o.jsx(Rs,{})}),o.jsx(Xe,{onClick:()=>B(b.id),edge:"end","aria-label":"delete",children:o.jsx(qt,{})})]}))]},b.id))}),o.jsx(mt,{open:s,autoHideDuration:6e3,onClose:h,children:o.jsx(pt,{onClose:h,severity:k,sx:{width:"100%"},children:x})})]})},Ra=({designs:l,setDesigns:g,setIsAdding:D,getDesigns:d,onReturnToDashboard:e})=>{const{userDetails:t}=Ot();console.log("Add Design loaded");const[f,a]=z.useState(""),[y,C]=z.useState(""),[n,r]=z.useState([]),[s,u]=z.useState([]),x=z.useMemo(()=>n,[n]),[j,k]=z.useState(!1),[w,P]=z.useState(""),[M,O]=z.useState("info"),[B,v]=z.useState(!1),[N,m]=z.useState("");console.log("Adding New Design from user:",t);const h=z.useRef(null),b=()=>{v(!1)},A=(_,T)=>{T!=="clickaway"&&k(!1)},S=async _=>{var c;if(_.preventDefault(),console.log("Files to be saved:",s),!t||!t.uid){console.error("User object is undefined or missing UID."),m("You must be signed in to add a design."),v(!0);return}if(!f){m("All fields are required."),v(!0);return}await((c=h.current)==null?void 0:c.commitDeletions());const T=n.filter(U=>!U.deleted),F=s.filter(U=>!U.deleted).map(U=>({id:U.id,url:U.url,name:U.name,path:U.path})),p={title:y,description:f,dateCreated:Qt(),dateModified:Qt(),images:T,files:F,userId:t.uid};try{const U=await Gn(Fe(oe,"designs"),p),I={...p,id:U.id};g([...l,I]),setTimeout(()=>{D(!1),d()},1e3),P(`${y} has been Added.`),O("success"),k(!0),C(""),a(""),r([]),u([])}catch(U){console.log(U),m("There was an issue adding your design."),v(!0)}};return o.jsxs("div",{className:"small-container",children:[o.jsx("button",{onClick:e,className:"muted-button margin-top-20",children:"← All Designs"}),o.jsx("div",{className:"design-record",children:o.jsxs("form",{onSubmit:S,children:[o.jsx("h1",{className:"designHeader",children:"New Design"}),o.jsx("div",{style:{display:"flex",alignItems:"center"},children:o.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[o.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),o.jsx("input",{id:"title",type:"text",name:"title",value:y,onChange:_=>C(_.target.value),style:{width:"100%"}})]})}),o.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),o.jsxs("ul",{children:[o.jsx("li",{children:"Objective: What is the goal for this design?"}),o.jsx("li",{children:"Rationale: Why is this new design being done?"}),o.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),o.jsx("li",{children:"Functional Modification: What is being done to this target?"}),o.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),o.jsx(it,{onChange:a,initialValue:f}),o.jsx(Dt,{ref:h,path:"designs/images",initialImages:x,onImagesUpdated:r,onDelete:_=>r(n.filter(T=>!_.includes(T)))}),o.jsx(Rt,{path:"designs/files",initialFiles:s,onFilesChange:u}),o.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[o.jsx(Le,{type:"submit",variant:"contained",sx:{fontSize:"1rem",mt:2,textTransform:"none",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"Add"}),o.jsx(Le,{onClick:()=>D(!1),style:{marginLeft:"12px"},variant:"outlined",sx:{fontSize:"1rem",mt:2,textTransform:"none",color:"currentColor",borderColor:"rgba(255, 0, 0, 0.5)",boxShadow:"none","&:hover":{borderColor:"rgba(255, 0, 0, 0.7)",backgroundColor:"rgba(255, 0, 0, 0.1)",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",color:"currentColor",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out, background-color 0.3s ease-in-out"},children:"Cancel"})]})]})}),o.jsxs(At,{open:B,onClose:b,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[o.jsx(Ft,{id:"alert-dialog-title",children:"Notification"}),o.jsx(Ct,{children:o.jsx(Xt,{id:"alert-dialog-description",children:N})}),o.jsx(kt,{children:o.jsx(Le,{onClick:b,autoFocus:!0,children:"Ok"})})]}),o.jsx(mt,{open:j,autoHideDuration:1e3,onClose:A,children:o.jsx(pt,{onClose:A,severity:M,sx:{width:"100%"},children:w})})]})},Fa=({designId:l,setIsAddingBuild:g,refreshBuilds:D})=>{const[d,e]=z.useState(""),[t,f]=z.useState(""),[a,y]=z.useState([]),[C,n]=z.useState([]),{userDetails:r}=Ot(),s=A=>{y(A)},u=A=>{n(A)};console.log("AddBuild loaded");const[x,j]=z.useState(!1),[k,w]=z.useState(""),[P,M]=z.useState(!1),[O,B]=z.useState(""),[v,N]=z.useState("info");console.log("Adding New Build by user:",r);const m=()=>{j(!1)},h=(A,S)=>{S!=="clickaway"&&M(!1)},b=async A=>{if(A.preventDefault(),!r||!r.uid){console.error("UserDetails object is undefined or missing UID."),w("You must be signed in to add a build."),j(!0);return}if(!t){w("Build description is required."),j(!0);return}const S=a.filter(T=>!T.deleted),_=C.filter(T=>!T.deleted).map(T=>({id:T.id,url:T.url,name:T.name,path:T.path}));try{const T=await Gn(Fe(oe,"builds"),{title:d,description:t,design_ID:l,dateCreated:Qt(),userId:r.uid,images:S,files:_});console.log("Build added with ID: ",T.id),console.log("Added New Build by user:",r),B("Your build has been successfully added."),N("success"),M(!0),setTimeout(()=>{e(""),f(""),y([]),n([]),g(!1),D()},1e3)}catch(T){if(console.error("Error adding build: ",T),T instanceof Error){let F=`Failed to add the build. ${T.message}`;T.message==="permission-denied"&&(F="You do not have permission to perform this operation."),B(F),N("error"),M(!0)}else B("Failed to add the build. Please try again later."),N("error"),M(!0)}};return o.jsxs("div",{className:"small-container",children:[o.jsxs("form",{onSubmit:b,children:[o.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),o.jsx("input",{id:"buildTitle",type:"text",value:d,onChange:A=>e(A.target.value),style:{width:"100%",marginBottom:"20px"}}),o.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),o.jsx(it,{onChange:f,initialValue:t})," ",o.jsx(Dt,{path:`builds/${l}/images`,initialImages:a,onImagesUpdated:s}),o.jsx(Rt,{path:`builds/${l}/files`,initialFiles:C,onFilesChange:u}),o.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[o.jsx("input",{type:"submit",value:"Save"}),o.jsx("button",{style:{marginLeft:"12px"},onClick:()=>g(!1),className:"button muted-button",children:"Cancel"})]})]}),o.jsxs(At,{open:x,onClose:m,children:[o.jsx(Ft,{children:"Notification"}),o.jsx(Ct,{children:o.jsx(Xt,{children:k})}),o.jsx(kt,{children:o.jsx(Le,{onClick:m,children:"OK"})})]}),o.jsx(mt,{open:P,autoHideDuration:6e3,onClose:h,children:o.jsx(pt,{onClose:h,severity:v,sx:{width:"100%"},children:O})})]})},ka=({designId:l,buildId:g,refreshTests:D,setAddingTestIdForBuild:d})=>{const[e,t]=z.useState(""),[f,a]=z.useState(""),[y,C]=z.useState(""),[n,r]=z.useState(""),[s,u]=z.useState([]),[x,j]=z.useState([]),{userDetails:k}=Ot();console.log("AddTest loaded");const[w,P]=z.useState(!1),[M,O]=z.useState(""),[B,v]=z.useState(!1),[N,m]=z.useState(""),[h,b]=z.useState("info"),A=_=>{j(_)},S=async()=>{if(!f){O("Test description cannot be empty!"),P(!0);return}const _=s.filter(F=>!F.deleted),T=x.filter(F=>!F.deleted).map(F=>({id:F.id,url:F.url,name:F.name,path:F.path}));try{await Gn(Fe(oe,"tests"),{title:e,build_ID:g,design_ID:l,dateCreated:Qt(),description:f,results:y,conclusions:n,userId:k==null?void 0:k.uid,images:_,files:T}),setTimeout(()=>{D(g),t(""),a(""),C(""),r(""),u([]),j([]),d(!1)},1e3),m("Test added successfully"),b("success"),v(!0)}catch(F){console.error("Error adding test: ",F),m("Failed to add the test"),b("error"),v(!0)}};return o.jsxs("div",{children:[o.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),o.jsx("input",{id:"testTitle",type:"text",value:e,onChange:_=>t(_.target.value),style:{width:"100%",marginBottom:"20px"}}),o.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),o.jsx(it,{onChange:a,initialValue:f}),o.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),o.jsx(it,{onChange:C,initialValue:y}),o.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),o.jsx(it,{onChange:r,initialValue:n}),o.jsx(Dt,{path:`tests/${g}/images`,initialImages:s,onImagesUpdated:_=>{u(_)}}),o.jsx(Rt,{path:`tests/${g}/files`,initialFiles:x,onFilesChange:A}),o.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[o.jsx("button",{onClick:S,children:"Save"}),o.jsx("button",{style:{marginLeft:"12px"},onClick:()=>d(!1),className:"button muted-button",children:"Cancel"})]}),o.jsxs(At,{open:w,onClose:()=>P(!1),children:[o.jsx(Ft,{children:"Notification"}),o.jsx(Ct,{children:o.jsx(Xt,{children:M})}),o.jsx(kt,{children:o.jsx(Le,{onClick:()=>P(!1),children:"OK"})})]}),o.jsx(mt,{open:B,autoHideDuration:6e3,onClose:()=>v(!1),children:o.jsx(pt,{onClose:()=>v(!1),severity:h,sx:{width:"100%"},children:N})})]})};var ts={},Oa=bt;Object.defineProperty(ts,"__esModule",{value:!0});var gn=ts.default=void 0,Ua=Oa(gt()),Ma=o;gn=ts.default=(0,Ua.default)((0,Ma.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff");const Gt=l=>l&&l instanceof Wn?l.toDate().toLocaleString():"",Na=({selectedDesign:l,setIsEditing:g,getDesigns:D,onReturnToDashboard:d})=>{const{userDetails:e,loading:t}=Ot(),f=l.id,a=l.userId===(e==null?void 0:e.uid);console.log("Edit page loaded"),console.log("Design ID:",f),console.log("Editing Design by user:",e);const[y,C]=z.useState(""),[n,r]=z.useState(l.description),[s,u]=z.useState(Gt(l.dateCreated)),[x,j]=z.useState(Gt(l.dateModified)),[k,w]=z.useState([]),[P,M]=z.useState([]),O=z.useRef(null),[B,v]=z.useState(!1),[N,m]=z.useState([]),[h,b]=z.useState({}),[A,S]=z.useState({}),[_,T]=z.useState({}),F=z.useRef(null),[p,c]=z.useState({}),[U,I]=z.useState({}),[L,q]=z.useState({}),[$,Q]=z.useState(!1),[W,H]=z.useState({}),[K,ue]=z.useState({}),[ne,re]=z.useState({}),[le,J]=z.useState({}),[fe,we]=z.useState({}),je=z.useRef(null),[he,ge]=z.useState({}),[de,ce]=z.useState({}),[ye,Se]=z.useState({}),[xe,be]=z.useState(!1),[me,ie]=z.useState(""),[Te,Oe]=z.useState(()=>{}),[at,ee]=z.useState(!1),[$e,te]=z.useState(""),[Ie,se]=z.useState("info"),[ve,pe]=z.useState({design:!1,builds:!1,tests:!1}),ze=async i=>{if(i.preventDefault(),!n){ie("All fields are required."),be(!0);return}console.log("About to check image deletions",O.current),console.log(O.current),console.log(k.some(V=>V.deleted)),O.current&&k.some(V=>V.deleted)&&(console.log("Committing deletions"),await O.current.commitDeletions());const R=k.filter(V=>!V.deleted);P.some(V=>V.deleted)&&await Ke();const E=P.filter(V=>!V.deleted);let G={title:y,description:n,dateModified:Qt(),images:R.map(V=>({url:V.url,title:V.title,path:V.path})),files:E.map(V=>({id:V.id,url:V.url,name:V.name,path:V.path})),userId:e.uid};try{await ut(Re(oe,"designs",f),G,{merge:!0}),te("Your design has been updated."),se("success"),ee(!0);const V=Wn.now();j(Gt(V))}catch(V){console.error("Error updating design:",V),te("There was an issue updating your design."),se("error"),ee(!0)}pe(V=>({...V,design:!1}))};z.useEffect(()=>{l&&(r(l.description||""),C(l.title||""),(async()=>{const R=Re(oe,"designs",f),E=await _r(R);if(E.exists()){const G=E.data();console.log("Fetched images:",G.images),console.log("Fetched files:",G.files),w(G.images||[]),M(G.files||[]),u(Gt(G.dateCreated)),j(Gt(G.dateModified))}})())},[l,f]);const ot=i=>{const R=k.filter(G=>!i.some(V=>V.path===G.path));console.log("Remaining images after deletion:",R),w(R);const E=R.map(G=>({url:G.url,title:G.title,path:G.path}));ut(Re(oe,"designs",f),{images:E},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(G=>console.error("Failed to update Firestore:",G))},Ut=i=>{JSON.stringify(k)!==JSON.stringify(i)&&(w(i),console.log("Updated images received:",i))},Ke=async()=>{const i=P.filter(R=>R.deleted);if(console.log("Files to delete:",i),i.length>0){const R=Et(),E=i.map(G=>{const V=jt(R,G.path);return hn(V)});try{await Promise.all(E),console.log("Files deleted successfully");const G=P.filter(V=>!V.deleted);M(G),await jn(Re(oe,"designs",l.id),{files:G.map(V=>({id:V.id,url:V.url,name:V.name,path:V.path}))}),te("Deleted files have been permanently removed."),se("success"),ee(!0)}catch(G){console.error("Failed to delete files: ",G),te("Failed to delete files."),se("error"),ee(!0)}}},St=async i=>{var V,X;try{await Zt(i)}catch(Y){console.error("Error deleting files:",Y),te("Failed to delete build files."),se("error"),ee(!0)}const R=((V=A[i])==null?void 0:V.filter(Y=>!Y.deleted).map(({url:Y,path:Ce,title:Me})=>({url:Y,path:Ce,title:Me})))||[],E=((X=_[i])==null?void 0:X.filter(Y=>!Y.deleted).map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path})))||[],G={};R.length>0&&(G.images=R),E.length>0&&(G.files=E),h[i]!==void 0&&(G.description=h[i]);try{const Y=Re(oe,"builds",i);await ut(Y,G,{merge:!0}),te("Your build has been updated."),se("success"),ee(!0),Ue(),pe(Ce=>({...Ce,builds:!1}))}catch(Y){console.error("Error updating build:",Y),te("Failed to update build."),se("error"),ee(!0)}},lt=(i,R)=>{I(E=>({...E,[i]:R}))},Ae=(i,R)=>{b(E=>({...E,[i]:R})),pe(E=>({...E,builds:!0}))},De=async i=>{const R=U[i];try{const E=Re(oe,"builds",i);await ut(E,{title:R},{merge:!0}),I(G=>{const V={...G};return delete V[i],V}),Ue()}catch(E){console.error("Failed to save build title:",E)}},Ue=async()=>{if(!e){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",e==null?void 0:e.uid),console.log("Selected design ID for query:",l==null?void 0:l.id);let i;e.isAdmin?i=Be(Fe(oe,"builds"),Ee("design_ID","==",f),st("dateCreated")):i=Be(Fe(oe,"builds"),Ee("design_ID","==",f),Ee("userId","==",e.uid),st("dateCreated")),console.log("Builds query details:",JSON.stringify(i,null,2));const R=await ft(i);console.log("Builds snapshot details:",JSON.stringify(R.docs.map(G=>G.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",R.docs.length);const E=R.docs.map(G=>(console.log("Build doc path: ",G.ref.path),{id:G.id,...G.data()}));m(E),console.log("New builds state after refresh:",E)}catch(i){console.error("Error refreshing builds:",i),i.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",i):console.error("An unexpected error occurred when trying to refresh builds:",i)}},Je=(i,R)=>{const E=Re(oe,"builds",i),G=A[i].filter(X=>!R.some(Y=>Y.path===X.path));S(X=>({...X,[i]:G}));const V=G.map(X=>({url:X.url,title:X.title,path:X.path}));ut(E,{images:V},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),te("Build Image deletions updated."),se("success")}).catch(X=>{console.error("Failed to update build images in Firestore:",X),te("Failed to update build image deletions."),se("error")}),ee(!0)},et=async i=>{const R=Be(Fe(oe,"tests"),Ee("build_ID","==",i),Ee("userId","==",e.uid)),E=await ft(R);for(const G of E.docs)await It(Re(oe,"tests",G.id));await It(Re(oe,"builds",i)),await Ue(),te("Build and its tests (if any) deleted successfully."),se("success"),ee(!0)},xt=i=>{ie("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),Oe(()=>()=>et(i)),be(!0)},We=(i,R)=>{S(E=>({...E,[i]:R}))},qe=(i,R)=>{T(E=>({...E,[i]:R}))},Zt=async i=>{var E;const R=((E=_[i])==null?void 0:E.filter(G=>G.deleted))||[];if(console.log("Build files to delete:",R),R.length>0){const G=Et(),V=R.map(X=>{const Y=jt(G,X.path);return hn(Y)});try{await Promise.all(V),console.log("Build files deleted successfully");const X=_[i].filter(Y=>!Y.deleted);T(Y=>({...Y,[i]:X})),await jn(Re(oe,"builds",i),{files:X.map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path}))}),console.log("Firestore successfully updated to remove deleted files"),te("Deleted build files have been permanently removed."),se("success"),ee(!0)}catch(X){console.error("Failed to delete build files: ",X),te("Failed to delete build files."),se("error"),ee(!0)}}},Kt=async(i,R)=>{var X;try{await nn(i)}catch(Y){console.error("Error deleting files:",Y),te("Failed to delete build files."),se("error"),ee(!0)}const E={},G=le[i].filter(Y=>!Y.deleted).map(({url:Y,path:Ce,title:Me})=>({url:Y,path:Ce,title:Me})),V=((X=fe[i])==null?void 0:X.filter(Y=>!Y.deleted).map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path})))||[];W[i]!==void 0&&(E.description=W[i]),K[i]!==void 0&&(E.results=K[i]),ne[i]!==void 0&&(E.conclusions=ne[i]),E.images=G,E.files=V;try{const Y=Re(oe,"tests",i);await ut(Y,E,{merge:!0}),te("Your test has been updated."),se("success"),ee(!0),vt(R)}catch(Y){console.error(`Error updating test ID: ${i}:`,Y),te("There was an issue updating your test."),se("error"),ee(!0)}},Cn=(i,R)=>{ce(E=>({...E,[i]:R}))},Ge=async(i,R)=>{const E=de[i],G=Re(oe,"tests",i);await ut(G,{title:E},{merge:!0}),ce(V=>{const X={...V};return delete X[i],X}),vt(R)},wt=(i,R)=>{console.log(`Updating description for test ID ${i}:`,R),H(E=>({...E,[i]:R})),pe(E=>({...E,tests:!0}))},Jt=(i,R)=>{console.log(`Updating results for test ID ${i}:`,R),ue(E=>({...E,[i]:R})),pe(E=>({...E,tests:!0}))},en=(i,R)=>{re(E=>({...E,[i]:R})),pe(E=>({...E,tests:!0}))};z.useEffect(()=>{!t&&e&&(async()=>{if(!e)return;let R;e.isAdmin?R=Be(Fe(oe,"builds"),Ee("design_ID","==",f),st("dateCreated")):R=Be(Fe(oe,"builds"),Ee("design_ID","==",f),Ee("userId","==",e.uid),st("dateCreated"));const E=await ft(R);let G=[],V={},X={};for(const Y of E.docs){const Ce=Y.data(),Me=Y.id;G.push({id:Me,...Ce,images:Ce.images||[],files:Ce.files||[]}),X[Me]=!0;let _e;e.isAdmin?_e=Be(Fe(oe,"tests"),Ee("build_ID","==",Me),st("dateCreated")):_e=Be(Fe(oe,"tests"),Ee("build_ID","==",Me),Ee("userId","==",e.uid),st("dateCreated"));const an=await ft(_e);let Nt=[],wn={},_n={};for(const dt of an.docs){const ct=dt.data();Nt.push({id:dt.id,...ct}),wn[dt.id]=ct.images||[],_n[dt.id]=ct.files||[]}V[Me]=Nt,J(dt=>{let ct={...dt};for(const Lt in wn)ct[Lt]=wn[Lt];return ct}),we(dt=>{let ct={...dt};for(const Lt in _n)ct[Lt]=_n[Lt];return ct})}m(G),q(V),Se(X)})()},[t,e,l.id,f]);const vt=async i=>{if(!e){console.log("User details not loaded yet");return}try{let R;e.isAdmin?R=Be(Fe(oe,"tests"),Ee("build_ID","==",i),st("dateCreated")):R=Be(Fe(oe,"tests"),Ee("build_ID","==",i),Ee("userId","==",e.uid),st("dateCreated"));const G=(await ft(R)).docs.map(Y=>({id:Y.id,...Y.data(),images:Y.data().images||[],files:Y.data().files||[]}));q(Y=>({...Y,[i]:G}));let V={},X={};G.forEach(Y=>{V[Y.id]=Y.images,X[Y.id]=Y.files}),J(V),we(X)}catch(R){console.error("Error fetching tests:",R)}},tn=(i,R)=>{const E=Re(oe,"tests",i),G=le[i].filter(X=>!R.includes(X));J(X=>({...X,[i]:G}));const V=G.map(({url:X,path:Y,title:Ce})=>({url:X,path:Y,title:Ce}));ut(E,{images:V},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),te("Test Image deletions updated."),se("success")}).catch(X=>{console.error("Failed to update test images in Firestore:",X),te("Failed to update test image deletions."),se("error")}),ee(!0)},Qe=(i,R)=>{J(E=>({...E,[i]:R}))},Mt=(i,R)=>{we(E=>({...E,[i]:R}))},nn=async i=>{var E;const R=((E=fe[i])==null?void 0:E.filter(G=>G.deleted))||[];if(R.length>0){const G=Et(),V=R.map(X=>{const Y=jt(G,X.path);return hn(Y)});try{await Promise.all(V);const X=fe[i].filter(Y=>!Y.deleted);we(Y=>({...Y,[i]:X})),await jn(Re(oe,"tests",i),{files:X.map(Y=>({id:Y.id,url:Y.url,name:Y.name,path:Y.path}))}),te("Deleted test files have been permanently removed."),se("success"),ee(!0)}catch(X){console.error("Failed to delete test files: ",X),te("Failed to delete test files."),se("error"),ee(!0)}}},sn=async(i,R)=>{await It(Re(oe,"tests",i)),await vt(R),te("Test deleted successfully."),se("success"),ee(!0)},rn=(i,R)=>{ie("Are you sure you want to delete this test? This action cannot be undone."),Oe(()=>()=>sn(i,R)),be(!0)},Sn=i=>{Se(R=>({...R,[i]:!R[i]}))},Z=()=>{const i=Object.entries(ve).filter(([E,G])=>G).map(([E])=>E).join(", ");if(!i.length){d();return}const R=`You have unsaved changes in the following sections: ${i}. Are you sure you want to leave?`;ie(R),Oe(()=>()=>{pe({design:!1,builds:!1,tests:!1}),d()}),be(!0)};return z.useEffect(()=>{const i=R=>{Object.values(ve).some(G=>G)&&(R.preventDefault(),R.returnValue="")};return window.addEventListener("beforeunload",i),()=>window.removeEventListener("beforeunload",i)},[ve]),o.jsxs("div",{className:"small-container",children:[o.jsx("button",{onClick:()=>{Object.values(ve).some(R=>R)?Z():d()},className:"muted-button margin-top-20",children:"← All Designs"}),o.jsx("div",{className:"design-record",children:o.jsxs("form",{onSubmit:ze,children:[o.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),o.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[o.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[o.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),o.jsx("input",{id:"title",type:"text",name:"title",value:y,onChange:i=>{C(i.target.value),pe(R=>({...R,design:!0}))},style:{width:"100%"}})]}),o.jsxs("div",{style:{flexGrow:2},children:[o.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),o.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:s||"",readOnly:!0,style:{width:"100%"}})]}),o.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[o.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),o.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:x||"",readOnly:!0,style:{width:"100%"}})]})]}),o.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),o.jsxs("ul",{children:[o.jsx("li",{children:"Objective: What is the goal for this design?"}),o.jsx("li",{children:"Rationale: Why is this new design being done?"}),o.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),o.jsx("li",{children:"Functional Modification: What is being done to this target?"}),o.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),o.jsx(it,{initialValue:n,onChange:i=>{r(i),pe(R=>({...R,design:!0}))}}),o.jsx(Dt,{ref:O,path:`designs/${l.id}/images`,initialImages:k,onImagesUpdated:Ut,onDelete:ot,isOwnDesign:a}),o.jsx(Rt,{path:`designs/${l.id}/files`,initialFiles:P,onFilesChange:M,isOwnDesign:a}),a&&o.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[o.jsx("input",{type:"submit",value:"Update"}),o.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>g(!1),children:"Cancel"})]})]})}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex-space-between",children:[o.jsx("h2",{className:"buildsHeader",children:"Builds"}),a&&o.jsxs("button",{className:"button muted-button",onClick:()=>{v(!0),setTimeout(()=>{F.current&&F.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[o.jsx("span",{role:"img","aria-label":"Add Build",children:"➕"})," Build"]})]}),N.map((i,R)=>o.jsxs("div",{className:"build-record",children:[o.jsxs("div",{className:"flex-space-between align-items-center",children:[o.jsx("div",{children:U[i.id]!==void 0?o.jsx(bn,{variant:"outlined",size:"small",fullWidth:!0,value:U[i.id],onChange:E=>lt(i.id,E.target.value),onBlur:()=>De(i.id),autoFocus:!0,InputProps:{endAdornment:o.jsx(Xe,{onClick:()=>De(i.id),size:"small",children:o.jsx(Hn,{})})}}):o.jsx("div",{className:"buildTitle",onClick:()=>I(E=>({...E,[i.id]:i.title||`Build ${R+1}`})),style:{cursor:"pointer"},children:i.title||`Build ${R+1}`})}),o.jsxs("div",{children:[o.jsx("button",{onClick:()=>c(E=>({...E,[i.id]:!E[i.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:p[i.id]?o.jsx(gn,{}):o.jsx(In,{})}),a&&o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>xt(i.id),children:o.jsx(qt,{})}),o.jsxs("button",{className:"button muted-button",onClick:()=>{Q(i.id),setTimeout(()=>{je.current&&je.current.scrollIntoView({behavior:"smooth"})},100)},children:[o.jsx("span",{role:"img","aria-label":"Add Test",children:"➕"})," Test"]})]})]})]}),p[i.id]&&o.jsxs(o.Fragment,{children:[o.jsx(it,{initialValue:h[i.id]||i.description,onChange:E=>{Ae(i.id,E)}}),o.jsx(Dt,{path:`builds/${i.id}/images`,initialImages:i.images,onImagesUpdated:E=>We(i.id,E),onDelete:E=>Je(i.id,E),isOwnDesign:a}),o.jsx(Rt,{path:`builds/${i.id}/files`,initialFiles:i.files,onFilesChange:E=>qe(i.id,E),isOwnDesign:a}),a&&o.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:o.jsx("button",{onClick:()=>St(i.id),children:"Update"})}),o.jsx("div",{children:L[i.id]&&L[i.id].length>0&&o.jsx("button",{onClick:()=>Sn(i.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:ye[i.id]?o.jsxs(o.Fragment,{children:[o.jsx(In,{style:{marginRight:"8px"}}),"Tests"]}):o.jsxs(o.Fragment,{children:[o.jsx(gn,{style:{marginRight:"8px"}}),"Tests"]})})}),!ye[i.id]&&L[i.id]&&L[i.id].map((E,G)=>o.jsxs("div",{className:"test-record",children:[o.jsxs("div",{className:"flex-space-between align-items-center",children:[o.jsx("div",{children:de[E.id]!==void 0?o.jsx(bn,{variant:"outlined",size:"small",fullWidth:!0,value:de[E.id],onChange:V=>Cn(E.id,V.target.value),onBlur:()=>Ge(E.id,i.id),autoFocus:!0,InputProps:{endAdornment:o.jsx(Xe,{onClick:()=>Ge(E.id,i.id),size:"small",children:o.jsx(Hn,{})})}}):o.jsx("div",{className:"testTitle",onClick:()=>ce(V=>({...V,[E.id]:E.title||`Test ${G+1}`})),style:{cursor:"pointer"},children:E.title||`Test ${G+1}`})}),o.jsxs("div",{children:[o.jsx("button",{onClick:()=>ge(V=>({...V,[E.id]:!V[E.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:he[E.id]?o.jsx(gn,{}):o.jsx(In,{})}),a&&o.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>rn(E.id,i.id),children:o.jsx(qt,{})})]})]}),he[E.id]&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:[o.jsx("label",{className:"testTitles",children:"Description"}),o.jsx(it,{initialValue:W[E.id]||E.description,onChange:V=>{wt(E.id,V)}})]}),o.jsxs("div",{children:[o.jsx("label",{className:"testTitles",children:"Results"}),o.jsx(it,{initialValue:K[E.id]||E.results,onChange:V=>{Jt(E.id,V)}})]}),o.jsxs("div",{children:[o.jsx("label",{className:"testTitles",children:"Conclusions"}),o.jsx(it,{initialValue:ne[E.id]||E.conclusions,onChange:V=>{en(E.id,V)}})]}),o.jsxs("div",{children:[o.jsx(Dt,{path:`tests/${E.id}/images`,initialImages:le[E.id]||[],onImagesUpdated:V=>Qe(E.id,V),onDelete:V=>tn(E.id,V),isOwnDesign:a}),o.jsx(Rt,{path:`tests/${E.id}/files`,initialFiles:fe[E.id]||[],onFilesChange:V=>Mt(E.id,V),isOwnDesign:a})]}),a&&o.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:o.jsx("button",{onClick:()=>Kt(E.id,i.id),children:"Update"})})]})]},E.id))]}),$===i.id&&o.jsxs("div",{className:"new-test-record",ref:je,children:[o.jsx("h3",{className:"newTestHeader",children:"New Test"}),o.jsx(ka,{designId:l.id,buildId:i.id,refreshTests:()=>vt(i.id),setAddingTestIdForBuild:Q,onImagesUpdated:E=>Qe(i.id,E),onFilesChange:E=>Mt(i.id,E)})]})]},i.id)),o.jsx("div",{children:B&&o.jsxs("div",{className:"new-build-record",ref:F,children:[o.jsx("h3",{className:"newBuildHeader",children:"New Build"}),o.jsx(Fa,{designId:l.id,setIsAddingBuild:v,refreshBuilds:Ue,onImagesUpdated:i=>We(build.id,i),onFilesChange:i=>qe(build.id,i)})]})})]}),o.jsxs(At,{open:xe,onClose:()=>be(!1),children:[o.jsx(Ft,{children:"Confirmation Required"}),o.jsx(Ct,{children:o.jsx(Xt,{children:me})}),o.jsxs(kt,{children:[o.jsx(Le,{onClick:()=>be(!1),children:"Cancel"}),o.jsx(Le,{onClick:()=>{Te(),be(!1)},autoFocus:!0,children:"Confirm"})]})]}),o.jsx(mt,{open:at,autoHideDuration:6e3,onClose:()=>ee(!1),children:o.jsx(pt,{onClose:()=>ee(!1),severity:Ie,sx:{width:"100%"},children:$e})})]})},La=()=>{const{userDetails:l,loading:g}=Ot();console.log("Dashboard loaded");const[D,d]=z.useState([]),[e,t]=z.useState([]),[f,a]=z.useState(null),[y,C]=z.useState(!1),[n,r]=z.useState(!1),[s,u]=z.useState(!1),[x,j]=z.useState(""),[k,w]=z.useState(""),[P,M]=z.useState(!1),[O,B]=z.useState(null),[v,N]=z.useState(!1),[m,h]=z.useState(""),[b,A]=z.useState("info"),S=()=>{r(!1),C(!1),a(null),_()},_=z.useCallback(async()=>{let c;l&&l.isAdmin?c=Be(Fe(oe,"designs"),st("dateCreated","desc")):l&&(c=Be(Fe(oe,"designs"),Ee("userId","==",l.uid),st("dateCreated","desc")));const U=await ft(c||Be(Fe(oe,"designs"))),I=[],L=[];U.forEach(q=>{const $=q.data(),Q={id:q.id,title:$.title,description:$.description,dateCreated:$.dateCreated,dateModified:$.dateModified,userId:$.userId,images:$.images||[],files:$.files||[]};$.userId===(l==null?void 0:l.uid)?I.push(Q):L.push(Q)}),d(I),t(L)},[l]);z.useEffect(()=>{!g&&l&&_()},[l,g,_]);const T=c=>{const U=[...D,...e].find(I=>I.id===c);a(U||null),r(!0)},F=c=>{B(c),j("Are you sure you want to delete this design? This action cannot be undone."),u(!0)},p=async()=>{if(O)if(k!==(l==null?void 0:l.uid))h("User ID confirmation failed. Enter the correct User ID."),A("error"),N(!0);else try{const c=Be(Fe(oe,"builds"),Ee("design_ID","==",O),Ee("userId","==",l.uid)),U=await ft(c);for(const I of U.docs){const L=I.id,q=Be(Fe(oe,"tests"),Ee("build_ID","==",L),Ee("userId","==",l.uid)),$=await ft(q);for(const Q of $.docs)await It(Re(oe,"tests",Q.id));await It(Re(oe,"builds",L))}await It(Re(oe,"designs",O)),d(I=>I.filter(L=>L.id!==O)),t(I=>I.filter(L=>L.id!==O)),h("Your design and its associated builds and tests have been deleted."),A("success"),N(!0)}catch(c){console.error("Error deleting design, builds, and tests: ",c),h("There was an issue deleting your design and its associated builds and tests."),A("error"),N(!0)}finally{w(""),M(!1),B(null)}};return o.jsxs("div",{className:"container",children:[!y&&!n&&o.jsxs(o.Fragment,{children:[o.jsx(Lr,{setIsAdding:C}),(l==null?void 0:l.isAdmin)&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{children:"Admin Designs"}),o.jsx(Dn,{designs:D,handleEdit:T,handleDelete:F,isAdmin:!0,userDetails:l,showUserIdColumn:!0}),o.jsx("h2",{children:"Users' Designs"}),o.jsx(Dn,{designs:e,handleEdit:T,handleDelete:F,isAdmin:!1,userDetails:l,showUserIdColumn:!0})]}),!(l!=null&&l.isAdmin)&&o.jsx(Dn,{designs:D,handleEdit:T,handleDelete:F,isAdmin:!1,userDetails:l,showUserIdColumn:!1})]}),y&&o.jsx(Ra,{designs:D,setDesigns:d,setIsAdding:C,getDesigns:_,onReturnToDashboard:S}),n&&o.jsx(Na,{designs:D,selectedDesign:f,setDesigns:d,setIsEditing:r,getDesigns:_,onReturnToDashboard:S}),o.jsxs(At,{open:s,onClose:()=>u(!1),PaperProps:{style:{minWidth:500}},children:[o.jsx(Ft,{children:"Confirm Deletion"}),o.jsx(Ct,{children:o.jsx(Xt,{children:x})}),o.jsxs(kt,{children:[o.jsx(Le,{onClick:()=>u(!1),children:"No, cancel"}),o.jsx(Le,{onClick:()=>{M(!0),u(!1)},color:"primary",children:"Yes, delete it"})]})]}),o.jsxs(At,{open:P,onClose:()=>M(!1),PaperProps:{style:{minWidth:500}},children:[o.jsx(Ft,{children:"Confirm Your User ID"}),o.jsx(Ct,{children:o.jsx(bn,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:k,onChange:c=>w(c.target.value)})}),o.jsxs(kt,{children:[o.jsx(Le,{onClick:()=>M(!1),children:"No, cancel"}),o.jsx(Le,{onClick:p,color:"primary",children:"Confirm"})]})]}),o.jsx(mt,{open:v,autoHideDuration:6e3,onClose:()=>N(!1),children:o.jsx(pt,{onClose:()=>N(!1),severity:b,sx:{width:"100%"},children:m})})]})},Ha=Er.memo(La);export{Ha as default};
