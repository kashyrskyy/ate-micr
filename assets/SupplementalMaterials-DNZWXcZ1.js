import{H as y,j as e,B as o,o as p,ay as ae,T as u,az as U,Y as O,ag as L,Z as Q,ah as V,ai as Y,ap as N,aw as ne,ar as te,af as Z,d as c,as as H,au as W,at as M,al as q,aA as le,aB as ie,G as m,q as re,A as oe,Q as A,an as ce,R as de,U as ue,aq as he,aC as xe,aD as pe,aE as me,aF as be,aG as fe}from"./index-DSRancwa.js";const je=()=>{const s=y(),n=()=>{s("/")};return e.jsxs(o,{children:[e.jsx(o,{className:"supplemental-header",children:e.jsx(p,{variant:"text",startIcon:e.jsx(ae,{}),onClick:n,className:"supplemental-back-button",children:"Home Page"})}),e.jsx(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:e.jsx(u,{className:"supplemental-title",children:"Course Materials"})})]})},ge=({selectedCourse:s})=>{const n=y();return e.jsx(p,{className:"add-material-button",variant:"contained",color:"primary",disabled:!s,onClick:()=>s&&n(`/add-material?course=${s}`),children:"+ Add Material"})},Ce=({materialId:s,open:n,onClose:t,onDelete:l})=>{const r=U(),h=async()=>{const d=N(r,"materials",s);await ne(d),l(),t()};return e.jsxs(O,{open:n,onClose:t,children:[e.jsx(L,{children:"Delete Material"}),e.jsx(Q,{children:e.jsx(V,{children:"Are you sure you want to delete this material? This action cannot be undone."})}),e.jsxs(Y,{children:[e.jsx(p,{onClick:t,color:"primary",children:"Cancel"}),e.jsx(p,{onClick:h,color:"secondary",children:"Delete"})]})]})},ye=({materialId:s,onClick:n})=>e.jsx(p,{variant:"contained",color:"error",onClick:()=>n(s),sx:{backgroundColor:"#FFCDD2",color:"#C62828",borderRadius:"15px",fontWeight:"bold",padding:"4px 8px",ml:1,textTransform:"none"},children:"Unpublish"}),Se=({materialId:s,open:n,onClose:t,onUnpublish:l})=>{const r=U(),h=async()=>{const d=N(r,"materials",s);await te(d,{published:!1}),l(),t()};return e.jsxs(O,{open:n,onClose:t,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(L,{id:"alert-dialog-title",children:"Unpublish Material"}),e.jsx(Q,{children:e.jsx(V,{id:"alert-dialog-description",children:"Are you sure you want to unpublish this material? It will no longer be visible to users until it is published again."})}),e.jsxs(Y,{children:[e.jsx(p,{onClick:t,color:"primary",children:"Cancel"}),e.jsx(p,{onClick:h,color:"error",autoFocus:!0,children:"Unpublish"})]})]})},ke=({initialCourse:s})=>{const{userDetails:n}=Z(),t=U(),[l,r]=c.useState([]),[h,d]=c.useState(!0),[b,T]=c.useState(!1),[f,E]=c.useState(!1),[i,_]=c.useState(s??null),[S,$]=c.useState(null),[j,B]=c.useState({open:!1,materialId:null}),[k,v]=c.useState(null),w=y(),J=async()=>{if(!i)return;const a=N(t,"courses",i),g=await he(a);if(g.exists()){const x=g.data(),C=(x==null?void 0:x.courseAdmin)||[];E(C.includes(n==null?void 0:n.uid))}else E(!1)};c.useEffect(()=>{i&&J()},[i]),c.useEffect(()=>{s&&i!==s&&_(s)},[s]),c.useEffect(()=>{if(!i){console.log("No course selected"),r([]),d(!1);return}console.log(`Fetching materials for course: ${i}`),d(!0);const a=n!=null&&n.isAdmin?H(q(t,"materials"),M("course","==",i),W("timestamp","desc")):H(q(t,"materials"),M("course","==",i),M("published","==",!0),W("timestamp","desc")),g=le(a,x=>{const C=x.docs.map(G=>({id:G.id,...G.data()}));r(C),console.log(`Fetched ${C.length} materials for course: ${i}`),d(!1)},x=>{console.error(x),v("Failed to fetch materials"),d(!1)});return()=>g()},[t,i,n]);const D=a=>{$(a),T(!0)},K=()=>{T(!1),$(null)},X=()=>{r(l.filter(a=>a.id!==S))},I=a=>{B({open:!0,materialId:a})},ee=()=>{r(l.map(a=>a.id===j.materialId?{...a,published:!1}:a))},se=()=>{B({open:!1,materialId:null})};if(h)return e.jsx(ie,{});const R=l.filter(a=>!a.published&&!a.scheduledTimestamp),P=l.filter(a=>a.scheduledTimestamp&&!a.published),z=l.filter(a=>a.published);return e.jsxs(o,{sx:{width:"100%"},children:[l.length===0&&i&&e.jsx(u,{variant:"body1",align:"center",sx:{width:"100%",mb:4},children:"No materials found for the selected course."}),f&&l.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(o,{sx:{mb:4},children:[e.jsx(u,{variant:"h6",sx:{fontWeight:"bold",color:"#F57C00",mb:2},children:"Saved"}),e.jsx(m,{container:!0,spacing:3,children:R.length===0?e.jsx(u,{variant:"body1",align:"center",sx:{width:"100%"},children:"No saved (unpublished) materials found."}):R.map(a=>e.jsx(F,{material:a,isCourseAdmin:f,navigate:w,selectedCourse:i||"",onDeleteClick:D,onUnpublishClick:I},a.id))})]}),e.jsxs(o,{sx:{mb:4},children:[e.jsx(u,{variant:"h6",sx:{fontWeight:"bold",color:"#0D47A1",mb:2},children:"Publish Scheduled"}),e.jsx(m,{container:!0,spacing:3,children:P.length===0?e.jsx(u,{variant:"body1",align:"center",sx:{width:"100%"},children:"No materials scheduled for publishing found."}):P.map(a=>e.jsx(F,{material:a,isCourseAdmin:f,navigate:w,selectedCourse:i||"",onDeleteClick:D,onUnpublishClick:I},a.id))})]})]}),e.jsxs(o,{sx:{mb:4},children:[e.jsx(u,{variant:"h6",sx:{fontWeight:"bold",color:"#2E7D32",mb:2},children:"Published"}),e.jsx(m,{container:!0,spacing:3,children:z.length===0?e.jsx(u,{variant:"body1",align:"center",sx:{width:"100%"},children:"No published materials found."}):z.map(a=>e.jsx(F,{material:a,isCourseAdmin:f,navigate:w,selectedCourse:i||"",onDeleteClick:D,onUnpublishClick:I},a.id))})]}),S&&e.jsx(Ce,{materialId:S,open:b,onClose:K,onDelete:X}),j.materialId&&e.jsx(Se,{materialId:j.materialId,open:j.open,onClose:se,onUnpublish:ee}),k&&e.jsx(re,{open:!0,autoHideDuration:6e3,onClose:()=>v(null),children:e.jsx(oe,{onClose:()=>v(null),severity:"error",children:k})},k)]})},F=({material:s,isCourseAdmin:n,navigate:t,selectedCourse:l,onDeleteClick:r,onUnpublishClick:h})=>e.jsx(m,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(o,{sx:{border:"1px solid #ddd",borderRadius:"8px",padding:2,position:"relative",backgroundColor:s.published?"#E8F5E9":"#FFF9C4"},children:[e.jsx(A,{onClick:()=>t(`/view-material/${s.id}?course=${l}`),"aria-label":"view",children:e.jsx(ce,{})}),e.jsx(u,{variant:"h6",children:s.title||"Untitled"}),e.jsx(o,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1},children:n&&e.jsxs(e.Fragment,{children:[e.jsx(A,{onClick:()=>t(`/edit-material/${s.id}?course=${l}`),"aria-label":"edit",children:e.jsx(de,{})}),e.jsx(A,{onClick:()=>r(s.id),"aria-label":"delete",children:e.jsx(ue,{})}),s.published&&e.jsx(ye,{materialId:s.id,onClick:h})]})})]})}),ve=({courses:s})=>{const n=y();return e.jsxs(o,{sx:{width:"100%",padding:4},children:[e.jsx(u,{variant:"h5",align:"center",sx:{mt:3,pb:2,fontFamily:"Staatliches, sans-serif",fontSize:"2rem",color:"#00695c",textTransform:"uppercase",letterSpacing:"1px"},children:"Select a Course"}),e.jsx(m,{container:!0,spacing:4,justifyContent:"center",children:s.map(t=>e.jsx(m,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(xe,{onClick:()=>n(`/supplemental-materials?course=${t.id}`),sx:{cursor:"pointer",borderRadius:"15px",transition:"transform 0.3s, box-shadow 0.3s","&:hover":{transform:"scale(1.05)",boxShadow:"0 6px 20px rgba(0, 0, 0, 0.1)"},boxShadow:"0 3px 10px rgba(0, 0, 0, 0.1)"},children:e.jsxs(pe,{sx:{textAlign:"center",padding:3,backgroundColor:"#e0f7fa","&:hover":{backgroundColor:"#b2ebf2"}},children:[e.jsx(u,{variant:"h5",sx:{fontFamily:"Staatliches, sans-serif",fontSize:"1.5rem",color:"#006064"},children:t.number}),e.jsx(u,{variant:"body1",sx:{fontFamily:"Gabarito, sans-serif",fontSize:"1rem",color:"#004d40",marginTop:1},children:t.title})]})})},t.id))})]})},De=()=>{const{userDetails:s}=Z(),[n,t]=me(),l=n.get("course")||null,r=c.useMemo(()=>s!=null&&s.classes?Object.entries(s.classes).map(([d,b])=>({id:d,number:b.number,title:b.title})):[],[s==null?void 0:s.classes]),h=c.useMemo(()=>r.find(d=>d.id===l),[r,l]);return e.jsxs(o,{className:"supplemental-container",children:[e.jsx(je,{}),l?e.jsxs(o,{children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(be,{returnToSelection:!0}),e.jsx(fe,{label:h?`${h.number} - ${h.title}`:"Selected Course",variant:"outlined",sx:{borderRadius:"15px",fontSize:"32px",fontWeight:"bold",background:"#e0f2f1",color:"#00695c",cursor:"pointer",transition:"background-color 0.3s",fontFamily:"Staatliches, sans-serif",padding:"20px 20px","&:hover":{backgroundColor:"#b2dfdb"}}})]}),e.jsxs(o,{className:"supplemental-content",children:[(s==null?void 0:s.isAdmin)&&e.jsx(ge,{selectedCourse:l}),e.jsx(ke,{initialCourse:l})]})]}):e.jsx(e.Fragment,{children:e.jsx(ve,{courses:r})})]})};export{De as default};
