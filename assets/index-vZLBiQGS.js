import{n as ws,k as _s,o as Es,_ as ht,b as z,y as js,f as Is,Q as Pn,j as a,g as Bn,i as Ds,B as or,p as lr,x as cn,R as ns,U as ss,V as cr,W as dr,X as Ut,Y as ur,F as qt,I as Ne,T as fr,Z as rs,J as Qt,$ as hr,S as mt,K as pt,a0 as mr,a1 as pr,a2 as gr,a3 as br,a4 as En,a5 as ze,a6 as xr,a7 as qe,a8 as Rs,a9 as Xt,aa as Wn,ab as dn,ac as vr,A as gt,C as bt,ad as Ct,ae as St,af as jt,ag as It,ah as Fs,ai as ks,aj as mn,ak as yr,al as is,am as as,an as Tr,ao as Ar,ap as Cr,aq as Sr,H as xn,ar as wr,as as Hn,at as kt,au as Kt,av as Ot,aw as Zt,ax as Gn,ay as Re,az as oe,aA as ut,aB as Ie,aC as _r,aD as jn,aE as Pe,aF as je,aG as tt,aH as ft,aI as Dt,aJ as Er}from"./index-BgNDDZNI.js";import{d as In}from"./Visibility-B-kz-Xo5.js";function jr(o){return _s("MuiListItemIcon",o)}const os=ws("MuiListItemIcon",["root","alignItemsFlexStart"]),Ir=["className"],Dr=o=>{const{alignItems:g,classes:R}=o;return Ds({root:["root",g==="flex-start"&&"alignItemsFlexStart"]},jr,R)},Rr=Es("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(o,g)=>{const{ownerState:R}=o;return[g.root,R.alignItems==="flex-start"&&g.alignItemsFlexStart]}})(({theme:o,ownerState:g})=>ht({minWidth:56,color:(o.vars||o).palette.action.active,flexShrink:0,display:"inline-flex"},g.alignItems==="flex-start"&&{marginTop:8})),Fr=z.forwardRef(function(g,R){const c=js({props:g,name:"MuiListItemIcon"}),{className:e}=c,t=Is(c,Ir),u=z.useContext(Pn),i=ht({},c,{alignItems:u.alignItems}),v=Dr(i);return a.jsx(Rr,ht({className:Bn(v.root,e),ownerState:i,ref:R},t))});function kr(o){return _s("MuiMenuItem",o)}const Bt=ws("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),Or=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],Ur=(o,g)=>{const{ownerState:R}=o;return[g.root,R.dense&&g.dense,R.divider&&g.divider,!R.disableGutters&&g.gutters]},Mr=o=>{const{disabled:g,dense:R,divider:c,disableGutters:e,selected:t,classes:u}=o,v=Ds({root:["root",R&&"dense",g&&"disabled",!e&&"gutters",c&&"divider",t&&"selected"]},kr,u);return ht({},u,v)},Nr=Es(or,{shouldForwardProp:o=>lr(o)||o==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:Ur})(({theme:o,ownerState:g})=>ht({},o.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!g.disableGutters&&{paddingLeft:16,paddingRight:16},g.divider&&{borderBottom:`1px solid ${(o.vars||o).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(o.vars||o).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Bt.selected}`]:{backgroundColor:o.vars?`rgba(${o.vars.palette.primary.mainChannel} / ${o.vars.palette.action.selectedOpacity})`:cn(o.palette.primary.main,o.palette.action.selectedOpacity),[`&.${Bt.focusVisible}`]:{backgroundColor:o.vars?`rgba(${o.vars.palette.primary.mainChannel} / calc(${o.vars.palette.action.selectedOpacity} + ${o.vars.palette.action.focusOpacity}))`:cn(o.palette.primary.main,o.palette.action.selectedOpacity+o.palette.action.focusOpacity)}},[`&.${Bt.selected}:hover`]:{backgroundColor:o.vars?`rgba(${o.vars.palette.primary.mainChannel} / calc(${o.vars.palette.action.selectedOpacity} + ${o.vars.palette.action.hoverOpacity}))`:cn(o.palette.primary.main,o.palette.action.selectedOpacity+o.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:o.vars?`rgba(${o.vars.palette.primary.mainChannel} / ${o.vars.palette.action.selectedOpacity})`:cn(o.palette.primary.main,o.palette.action.selectedOpacity)}},[`&.${Bt.focusVisible}`]:{backgroundColor:(o.vars||o).palette.action.focus},[`&.${Bt.disabled}`]:{opacity:(o.vars||o).palette.action.disabledOpacity},[`& + .${ns.root}`]:{marginTop:o.spacing(1),marginBottom:o.spacing(1)},[`& + .${ns.inset}`]:{marginLeft:52},[`& .${ss.root}`]:{marginTop:0,marginBottom:0},[`& .${ss.inset}`]:{paddingLeft:36},[`& .${os.root}`]:{minWidth:36}},!g.dense&&{[o.breakpoints.up("sm")]:{minHeight:"auto"}},g.dense&&ht({minHeight:32,paddingTop:4,paddingBottom:4},o.typography.body2,{[`& .${os.root} svg`]:{fontSize:"1.25rem"}}))),un=z.forwardRef(function(g,R){const c=js({props:g,name:"MuiMenuItem"}),{autoFocus:e=!1,component:t="li",dense:u=!1,divider:i=!1,disableGutters:v=!1,focusVisibleClassName:w,role:n="menuitem",tabIndex:r,className:s}=c,d=Is(c,Or),b=z.useContext(Pn),I=z.useMemo(()=>({dense:u||b.dense||!1,disableGutters:v}),[b.dense,u,v]),O=z.useRef(null);cr(()=>{e&&O.current&&O.current.focus()},[e]);const E=ht({},c,{dense:I.dense,divider:i,disableGutters:v}),B=Mr(c),L=dr(O,R);let F;return c.disabled||(F=r!==void 0?r:-1),a.jsx(Pn.Provider,{value:I,children:a.jsx(Nr,ht({ref:L,role:n,tabIndex:F,component:t,focusVisibleClassName:Bn(B.focusVisible,w),className:Bn(B.root,s)},d,{ownerState:E,classes:B}))})}),Lr=z.memo(({setIsAdding:o})=>{const{userDetails:g}=Ut();console.log("Header loaded");const R=ur(),[c,e]=z.useState(!1),[t,u]=z.useState(!1),i=()=>{g!=null&&g.uid?navigator.clipboard.writeText(g.uid).then(()=>{e(!0),u(!0)}).catch(n=>{console.error("Could not copy text: ",n)}):console.error("User details are null or undefined")},v=(n,r)=>{r!=="clickaway"&&e(!1)},w=()=>{R("/")};return a.jsxs(qt,{sx:{mt:3,mb:2},children:[a.jsx(qt,{sx:{display:"flex",alignItems:"center"},children:a.jsx(Ne,{variant:"text",onClick:w,sx:{mr:2},children:"← Home Page"})}),a.jsx(fr,{variant:"h4",component:"h1",gutterBottom:!0,textAlign:"left",sx:{fontWeight:"bold"},children:"My Laboratory Notebook"}),g&&a.jsxs(qt,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:[g.isAdmin&&a.jsx(rs,{label:"Admin",variant:"outlined",sx:{borderRadius:"15px",fontWeight:"bold",background:"#ffcdd2",color:"#c62828",mr:1}}),a.jsx(Qt,{title:t?"Copied!":"Click to Copy",enterDelay:300,leaveDelay:200,children:a.jsx(rs,{label:`User ID: ${g.uid}`,variant:"outlined",onClick:i,sx:{borderRadius:"15px",fontWeight:"bold",background:"#e0f2f1",color:"#00695c",mr:1,cursor:"pointer",transition:"background-color 0.3s"}})})]}),a.jsxs(qt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx(Ne,{variant:"contained",color:"primary",onClick:()=>o(!0),sx:{fontSize:"1.2rem",mt:2,textTransform:"none",minWidth:"150px",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"+ Create New"}),a.jsx(hr,{})]}),a.jsx(mt,{open:c,autoHideDuration:6e3,onClose:v,children:a.jsx(pt,{onClose:v,severity:"success",sx:{width:"100%"},children:"User ID copied to clipboard!"})})]})}),Dn=({designs:o,handleEdit:g,handleDelete:R,isAdmin:c,userDetails:e,showUserIdColumn:t})=>{const u=i=>i?i instanceof Wn?i.toDate().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):i instanceof Date?i.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A":"N/A";return a.jsx(mr,{component:pr,children:a.jsxs(gr,{sx:{"& .MuiTableCell-root":{fontSize:"1rem"},"& .MuiTableCell-head":{fontSize:"1.2rem",backgroundColor:"#1A76D3",color:"white"}},children:[a.jsx(br,{children:a.jsxs(En,{sx:{height:"60px"},children:[a.jsx(ze,{sx:{fontWeight:"bold",width:t?"30%":"40%"},children:"Title"}),t&&a.jsx(ze,{sx:{fontWeight:"bold",width:"20%"},children:"User ID"}),a.jsx(ze,{sx:{fontWeight:"bold",width:"15%"},children:"Created"}),a.jsx(ze,{sx:{fontWeight:"bold",width:"15%"},children:"Last Edited"}),a.jsx(ze,{sx:{fontWeight:"bold",width:"10%"},children:"Edit"}),a.jsx(ze,{sx:{fontWeight:"bold",width:"10%"},children:"Delete"})]})}),a.jsx(xr,{children:o&&o.length>0?o.map(i=>{const v=i.userId===(e==null?void 0:e.uid);return a.jsxs(En,{sx:{height:"80px"},children:[a.jsx(ze,{children:a.jsx("button",{onClick:()=>g(i.id),className:"hyperlink-style",children:i.title})}),t&&a.jsx(ze,{children:i.userId}),a.jsx(ze,{children:u(i.dateCreated)}),a.jsx(ze,{children:u(i.dateModified)}),a.jsx(ze,{children:a.jsx(Qt,{title:"Edit",children:a.jsx("span",{children:a.jsx(qe,{onClick:()=>v&&g(i.id),color:"primary",disabled:!v,children:a.jsx(Rs,{})})})})}),a.jsx(ze,{children:a.jsx(Qt,{title:"Delete",children:a.jsx("span",{children:a.jsx(qe,{onClick:()=>v&&R(i.id),color:"error",disabled:!v,children:a.jsx(Xt,{})})})})})]},i.id)}):a.jsx(En,{children:a.jsx(ze,{colSpan:t?6:5,children:"No Designs Found"})})})]})})};function Pr(o,g){return g.forEach(function(R){R&&typeof R!="string"&&!Array.isArray(R)&&Object.keys(R).forEach(function(c){if(c!=="default"&&!(c in o)){var e=Object.getOwnPropertyDescriptor(R,c);Object.defineProperty(o,c,e.get?e:{enumerable:!0,get:function(){return R[c]}})}})}),Object.freeze(o)}function Os(o,g){return new Promise(function(R,c){let e;return Br(o).then(function(t){try{return e=t,R(new Blob([g.slice(0,2),e,g.slice(2)],{type:"image/jpeg"}))}catch(u){return c(u)}},c)})}const Br=o=>new Promise((g,R)=>{const c=new FileReader;c.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let u=0;if(t.getUint16(u)!==65496)return R("not a valid JPEG");for(u+=2;;){const i=t.getUint16(u);if(i===65498)break;const v=t.getUint16(u+2);if(i===65505&&t.getUint32(u+4)===1165519206){const w=u+10;let n;switch(t.getUint16(w)){case 18761:n=!0;break;case 19789:n=!1;break;default:return R("TIFF header contains invalid endian")}if(t.getUint16(w+2,n)!==42)return R("TIFF header contains invalid version");const r=t.getUint32(w+4,n),s=w+r+2+12*t.getUint16(w+r,n);for(let d=w+r+2;d<s;d+=12)if(t.getUint16(d,n)==274){if(t.getUint16(d+2,n)!==3)return R("Orientation data type is invalid");if(t.getUint32(d+4,n)!==1)return R("Orientation data count is invalid");t.setUint16(d+8,1,n);break}return g(e.slice(u,u+2+v))}u+=2+v}return g(new Blob)}),c.readAsArrayBuffer(o)});var vn={},Hr={get exports(){return vn},set exports(o){vn=o}};(function(o){var g,R,c={};Hr.exports=c,c.parse=function(e,t){for(var u=c.bin.readUshort,i=c.bin.readUint,v=0,w={},n=new Uint8Array(e),r=n.length-4;i(n,r)!=101010256;)r--;v=r,v+=4;var s=u(n,v+=4);u(n,v+=2);var d=i(n,v+=2),b=i(n,v+=4);v+=4,v=b;for(var I=0;I<s;I++){i(n,v),v+=4,v+=4,v+=4,i(n,v+=4),d=i(n,v+=4);var O=i(n,v+=4),E=u(n,v+=4),B=u(n,v+2),L=u(n,v+4);v+=6;var F=i(n,v+=8);v+=4,v+=E+B+L,c._readLocal(n,F,w,d,O,t)}return w},c._readLocal=function(e,t,u,i,v,w){var n=c.bin.readUshort,r=c.bin.readUint;r(e,t),n(e,t+=4),n(e,t+=2);var s=n(e,t+=2);r(e,t+=2),r(e,t+=4),t+=4;var d=n(e,t+=8),b=n(e,t+=2);t+=2;var I=c.bin.readUTF8(e,t,d);if(t+=d,t+=b,w)u[I]={size:v,csize:i};else{var O=new Uint8Array(e.buffer,t);if(s==0)u[I]=new Uint8Array(O.buffer.slice(t,t+i));else{if(s!=8)throw"unknown compression method: "+s;var E=new Uint8Array(v);c.inflateRaw(O,E),u[I]=E}}},c.inflateRaw=function(e,t){return c.F.inflate(e,t)},c.inflate=function(e,t){return e[0],e[1],c.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},c.deflate=function(e,t){t==null&&(t={level:6});var u=0,i=new Uint8Array(50+Math.floor(1.1*e.length));i[u]=120,i[u+1]=156,u+=2,u=c.F.deflateRaw(e,i,u,t.level);var v=c.adler(e,0,e.length);return i[u+0]=v>>>24&255,i[u+1]=v>>>16&255,i[u+2]=v>>>8&255,i[u+3]=v>>>0&255,new Uint8Array(i.buffer,0,u+4)},c.deflateRaw=function(e,t){t==null&&(t={level:6});var u=new Uint8Array(50+Math.floor(1.1*e.length)),i=c.F.deflateRaw(e,u,i,t.level);return new Uint8Array(u.buffer,0,i)},c.encode=function(e,t){t==null&&(t=!1);var u=0,i=c.bin.writeUint,v=c.bin.writeUshort,w={};for(var n in e){var r=!c._noNeed(n)&&!t,s=e[n],d=c.crc.crc(s,0,s.length);w[n]={cpr:r,usize:s.length,crc:d,file:r?c.deflateRaw(s):s}}for(var n in w)u+=w[n].file.length+30+46+2*c.bin.sizeUTF8(n);u+=22;var b=new Uint8Array(u),I=0,O=[];for(var n in w){var E=w[n];O.push(I),I=c._writeHeader(b,I,n,E,0)}var B=0,L=I;for(var n in w)E=w[n],O.push(I),I=c._writeHeader(b,I,n,E,1,O[B++]);var F=I-L;return i(b,I,101010256),I+=4,v(b,I+=4,B),v(b,I+=2,B),i(b,I+=2,F),i(b,I+=4,L),I+=4,I+=2,b.buffer},c._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},c._writeHeader=function(e,t,u,i,v,w){var n=c.bin.writeUint,r=c.bin.writeUshort,s=i.file;return n(e,t,v==0?67324752:33639248),t+=4,v==1&&(t+=2),r(e,t,20),r(e,t+=2,0),r(e,t+=2,i.cpr?8:0),n(e,t+=2,0),n(e,t+=4,i.crc),n(e,t+=4,s.length),n(e,t+=4,i.usize),r(e,t+=4,c.bin.sizeUTF8(u)),r(e,t+=2,0),t+=2,v==1&&(t+=2,t+=2,n(e,t+=6,w),t+=4),t+=c.bin.writeUTF8(e,t,u),v==0&&(e.set(s,t),t+=s.length),t},c.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var u=t,i=0;i<8;i++)1&u?u=3988292384^u>>>1:u>>>=1;e[t]=u}return e}(),update:function(e,t,u,i){for(var v=0;v<i;v++)e=c.crc.table[255&(e^t[u+v])]^e>>>8;return e},crc:function(e,t,u){return 4294967295^c.crc.update(4294967295,e,t,u)}},c.adler=function(e,t,u){for(var i=1,v=0,w=t,n=t+u;w<n;){for(var r=Math.min(w+5552,n);w<r;)v+=i+=e[w++];i%=65521,v%=65521}return v<<16|i},c.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,u){e[t]=255&u,e[t+1]=u>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,u){e[t]=255&u,e[t+1]=u>>8&255,e[t+2]=u>>16&255,e[t+3]=u>>24&255},readASCII:function(e,t,u){for(var i="",v=0;v<u;v++)i+=String.fromCharCode(e[t+v]);return i},writeASCII:function(e,t,u){for(var i=0;i<u.length;i++)e[t+i]=u.charCodeAt(i)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,u){for(var i,v="",w=0;w<u;w++)v+="%"+c.bin.pad(e[t+w].toString(16));try{i=decodeURIComponent(v)}catch{return c.bin.readASCII(e,t,u)}return i},writeUTF8:function(e,t,u){for(var i=u.length,v=0,w=0;w<i;w++){var n=u.charCodeAt(w);if(!(4294967168&n))e[t+v]=n,v++;else if(!(4294965248&n))e[t+v]=192|n>>6,e[t+v+1]=128|n>>0&63,v+=2;else if(!(4294901760&n))e[t+v]=224|n>>12,e[t+v+1]=128|n>>6&63,e[t+v+2]=128|n>>0&63,v+=3;else{if(4292870144&n)throw"e";e[t+v]=240|n>>18,e[t+v+1]=128|n>>12&63,e[t+v+2]=128|n>>6&63,e[t+v+3]=128|n>>0&63,v+=4}}return v},sizeUTF8:function(e){for(var t=e.length,u=0,i=0;i<t;i++){var v=e.charCodeAt(i);if(!(4294967168&v))u++;else if(!(4294965248&v))u+=2;else if(!(4294901760&v))u+=3;else{if(4292870144&v)throw"e";u+=4}}return u}},c.F={},c.F.deflateRaw=function(e,t,u,i){var v=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][i],w=c.F.U,n=c.F._goodIndex;c.F._hash;var r=c.F._putsE,s=0,d=u<<3,b=0,I=e.length;if(i==0){for(;s<I;)r(t,d,s+(C=Math.min(65535,I-s))==I?1:0),d=c.F._copyExact(e,s,C,t,d+8),s+=C;return d>>>3}var O=w.lits,E=w.strt,B=w.prev,L=0,F=0,H=0,x=0,M=0,h=0;for(I>2&&(E[h=c.F._hash(e,0)]=0),s=0;s<I;s++){if(M=h,s+1<I-2){h=c.F._hash(e,s+1);var f=s+1&32767;B[f]=E[h],E[h]=f}if(b<=s){(L>14e3||F>26697)&&I-s>100&&(b<s&&(O[L]=s-b,L+=2,b=s),d=c.F._writeBlock(s==I-1||b==I?1:0,O,L,x,e,H,s-H,t,d),L=F=x=0,H=s);var y=0;s<I-2&&(y=c.F._bestMatch(e,s,B,M,Math.min(v[2],I-s),v[3]));var C=y>>>16,_=65535&y;if(y!=0){_=65535&y;var j=n(C=y>>>16,w.of0);w.lhst[257+j]++;var T=n(_,w.df0);w.dhst[T]++,x+=w.exb[j]+w.dxb[T],O[L]=C<<23|s-b,O[L+1]=_<<16|j<<8|T,L+=2,b=s+C}else w.lhst[e[s]]++;F++}}for(H==s&&e.length!=0||(b<s&&(O[L]=s-b,L+=2,b=s),d=c.F._writeBlock(1,O,L,x,e,H,s-H,t,d),L=0,F=0,L=F=x=0,H=s);7&d;)d++;return d>>>3},c.F._bestMatch=function(e,t,u,i,v,w){var n=32767&t,r=u[n],s=n-r+32768&32767;if(r==n||i!=c.F._hash(e,t-s))return 0;for(var d=0,b=0,I=Math.min(32767,t);s<=I&&--w!=0&&r!=n;){if(d==0||e[t+d]==e[t+d-s]){var O=c.F._howLong(e,t,s);if(O>d){if(b=s,(d=O)>=v)break;s+2<O&&(O=s+2);for(var E=0,B=0;B<O-2;B++){var L=t-s+B+32768&32767,F=L-u[L]+32768&32767;F>E&&(E=F,r=L)}}}s+=(n=r)-(r=u[n])+32768&32767}return d<<16|b},c.F._howLong=function(e,t,u){if(e[t]!=e[t-u]||e[t+1]!=e[t+1-u]||e[t+2]!=e[t+2-u])return 0;var i=t,v=Math.min(e.length,t+258);for(t+=3;t<v&&e[t]==e[t-u];)t++;return t-i},c.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},c.saved=0,c.F._writeBlock=function(e,t,u,i,v,w,n,r,s){var d,b,I,O,E,B,L,F,H,x=c.F.U,M=c.F._putsF,h=c.F._putsE;x.lhst[256]++,b=(d=c.F.getTrees())[0],I=d[1],O=d[2],E=d[3],B=d[4],L=d[5],F=d[6],H=d[7];var f=32+(s+3&7?8-(s+3&7):0)+(n<<3),y=i+c.F.contSize(x.fltree,x.lhst)+c.F.contSize(x.fdtree,x.dhst),C=i+c.F.contSize(x.ltree,x.lhst)+c.F.contSize(x.dtree,x.dhst);C+=14+3*L+c.F.contSize(x.itree,x.ihst)+(2*x.ihst[16]+3*x.ihst[17]+7*x.ihst[18]);for(var _=0;_<286;_++)x.lhst[_]=0;for(_=0;_<30;_++)x.dhst[_]=0;for(_=0;_<19;_++)x.ihst[_]=0;var j=f<y&&f<C?0:y<C?1:2;if(M(r,s,e),M(r,s+1,j),s+=3,j==0){for(;7&s;)s++;s=c.F._copyExact(v,w,n,r,s)}else{var T,k;if(j==1&&(T=x.fltree,k=x.fdtree),j==2){c.F.makeCodes(x.ltree,b),c.F.revCodes(x.ltree,b),c.F.makeCodes(x.dtree,I),c.F.revCodes(x.dtree,I),c.F.makeCodes(x.itree,O),c.F.revCodes(x.itree,O),T=x.ltree,k=x.dtree,h(r,s,E-257),h(r,s+=5,B-1),h(r,s+=5,L-4),s+=4;for(var p=0;p<L;p++)h(r,s+3*p,x.itree[1+(x.ordr[p]<<1)]);s+=3*L,s=c.F._codeTiny(F,x.itree,r,s),s=c.F._codeTiny(H,x.itree,r,s)}for(var l=w,U=0;U<u;U+=2){for(var D=t[U],P=D>>>23,V=l+(8388607&D);l<V;)s=c.F._writeLit(v[l++],T,r,s);if(P!=0){var W=t[U+1],q=W>>16,Y=W>>8&255,N=255&W;h(r,s=c.F._writeLit(257+Y,T,r,s),P-x.of0[Y]),s+=x.exb[Y],M(r,s=c.F._writeLit(N,k,r,s),q-x.df0[N]),s+=x.dxb[N],l+=P}}s=c.F._writeLit(256,T,r,s)}return s},c.F._copyExact=function(e,t,u,i,v){var w=v>>>3;return i[w]=u,i[w+1]=u>>>8,i[w+2]=255-i[w],i[w+3]=255-i[w+1],w+=4,i.set(new Uint8Array(e.buffer,t,u),w),v+(u+4<<3)},c.F.getTrees=function(){for(var e=c.F.U,t=c.F._hufTree(e.lhst,e.ltree,15),u=c.F._hufTree(e.dhst,e.dtree,15),i=[],v=c.F._lenCodes(e.ltree,i),w=[],n=c.F._lenCodes(e.dtree,w),r=0;r<i.length;r+=2)e.ihst[i[r]]++;for(r=0;r<w.length;r+=2)e.ihst[w[r]]++;for(var s=c.F._hufTree(e.ihst,e.itree,7),d=19;d>4&&e.itree[1+(e.ordr[d-1]<<1)]==0;)d--;return[t,u,s,v,n,d,i,w]},c.F.getSecond=function(e){for(var t=[],u=0;u<e.length;u+=2)t.push(e[u+1]);return t},c.F.nonZero=function(e){for(var t="",u=0;u<e.length;u+=2)e[u+1]!=0&&(t+=(u>>1)+",");return t},c.F.contSize=function(e,t){for(var u=0,i=0;i<t.length;i++)u+=t[i]*e[1+(i<<1)];return u},c.F._codeTiny=function(e,t,u,i){for(var v=0;v<e.length;v+=2){var w=e[v],n=e[v+1];i=c.F._writeLit(w,t,u,i);var r=w==16?2:w==17?3:7;w>15&&(c.F._putsE(u,i,n,r),i+=r)}return i},c.F._lenCodes=function(e,t){for(var u=e.length;u!=2&&e[u-1]==0;)u-=2;for(var i=0;i<u;i+=2){var v=e[i+1],w=i+3<u?e[i+3]:-1,n=i+5<u?e[i+5]:-1,r=i==0?-1:e[i-1];if(v==0&&w==v&&n==v){for(var s=i+5;s+2<u&&e[s+2]==v;)s+=2;(d=Math.min(s+1-i>>>1,138))<11?t.push(17,d-3):t.push(18,d-11),i+=2*d-2}else if(v==r&&w==v&&n==v){for(s=i+5;s+2<u&&e[s+2]==v;)s+=2;var d=Math.min(s+1-i>>>1,6);t.push(16,d-3),i+=2*d-2}else t.push(v,0)}return u>>>1},c.F._hufTree=function(e,t,u){var i=[],v=e.length,w=t.length,n=0;for(n=0;n<w;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<v;n++)e[n]!=0&&i.push({lit:n,f:e[n]});var r=i.length,s=i.slice(0);if(r==0)return 0;if(r==1){var d=i[0].lit;return s=d==0?1:0,t[1+(d<<1)]=1,t[1+(s<<1)]=1,1}i.sort(function(F,H){return F.f-H.f});var b=i[0],I=i[1],O=0,E=1,B=2;for(i[0]={lit:-1,f:b.f+I.f,l:b,r:I,d:0};E!=r-1;)b=O!=E&&(B==r||i[O].f<i[B].f)?i[O++]:i[B++],I=O!=E&&(B==r||i[O].f<i[B].f)?i[O++]:i[B++],i[E++]={lit:-1,f:b.f+I.f,l:b,r:I};var L=c.F.setDepth(i[E-1],0);for(L>u&&(c.F.restrictDepth(s,u,L),L=u),n=0;n<r;n++)t[1+(s[n].lit<<1)]=s[n].d;return L},c.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(c.F.setDepth(e.l,t+1),c.F.setDepth(e.r,t+1))},c.F.restrictDepth=function(e,t,u){var i=0,v=1<<u-t,w=0;for(e.sort(function(r,s){return s.d==r.d?r.f-s.f:s.d-r.d}),i=0;i<e.length&&e[i].d>t;i++){var n=e[i].d;e[i].d=t,w+=v-(1<<u-n)}for(w>>>=u-t;w>0;)(n=e[i].d)<t?(e[i].d++,w-=1<<t-n-1):i++;for(;i>=0;i--)e[i].d==t&&w<0&&(e[i].d--,w++);w!=0&&console.log("debt left")},c.F._goodIndex=function(e,t){var u=0;return t[16|u]<=e&&(u|=16),t[8|u]<=e&&(u|=8),t[4|u]<=e&&(u|=4),t[2|u]<=e&&(u|=2),t[1|u]<=e&&(u|=1),u},c.F._writeLit=function(e,t,u,i){return c.F._putsF(u,i,t[e<<1]),i+t[1+(e<<1)]},c.F.inflate=function(e,t){var u=Uint8Array;if(e[0]==3&&e[1]==0)return t||new u(0);var i=c.F,v=i._bitsF,w=i._bitsE,n=i._decodeTiny,r=i.makeCodes,s=i.codes2map,d=i._get17,b=i.U,I=t==null;I&&(t=new u(e.length>>>2<<3));for(var O,E,B=0,L=0,F=0,H=0,x=0,M=0,h=0,f=0,y=0;B==0;)if(B=v(e,y,1),L=v(e,y+1,2),y+=3,L!=0){if(I&&(t=c.F._check(t,f+(1<<17))),L==1&&(O=b.flmap,E=b.fdmap,M=511,h=31),L==2){F=w(e,y,5)+257,H=w(e,y+5,5)+1,x=w(e,y+10,4)+4,y+=14;for(var C=0;C<38;C+=2)b.itree[C]=0,b.itree[C+1]=0;var _=1;for(C=0;C<x;C++){var j=w(e,y+3*C,3);b.itree[1+(b.ordr[C]<<1)]=j,j>_&&(_=j)}y+=3*x,r(b.itree,_),s(b.itree,_,b.imap),O=b.lmap,E=b.dmap,y=n(b.imap,(1<<_)-1,F+H,e,y,b.ttree);var T=i._copyOut(b.ttree,0,F,b.ltree);M=(1<<T)-1;var k=i._copyOut(b.ttree,F,H,b.dtree);h=(1<<k)-1,r(b.ltree,T),s(b.ltree,T,O),r(b.dtree,k),s(b.dtree,k,E)}for(;;){var p=O[d(e,y)&M];y+=15&p;var l=p>>>4;if(!(l>>>8))t[f++]=l;else{if(l==256)break;var U=f+l-254;if(l>264){var D=b.ldef[l-257];U=f+(D>>>3)+w(e,y,7&D),y+=7&D}var P=E[d(e,y)&h];y+=15&P;var V=P>>>4,W=b.ddef[V],q=(W>>>4)+v(e,y,15&W);for(y+=15&W,I&&(t=c.F._check(t,f+(1<<17)));f<U;)t[f]=t[f++-q],t[f]=t[f++-q],t[f]=t[f++-q],t[f]=t[f++-q];f=U}}}else{7&y&&(y+=8-(7&y));var Y=4+(y>>>3),N=e[Y-4]|e[Y-3]<<8;I&&(t=c.F._check(t,f+N)),t.set(new u(e.buffer,e.byteOffset+Y,N),f),y=Y+N<<3,f+=N}return t.length==f?t:t.slice(0,f)},c.F._check=function(e,t){var u=e.length;if(t<=u)return e;var i=new Uint8Array(Math.max(u<<1,t));return i.set(e,0),i},c.F._decodeTiny=function(e,t,u,i,v,w){for(var n=c.F._bitsE,r=c.F._get17,s=0;s<u;){var d=e[r(i,v)&t];v+=15&d;var b=d>>>4;if(b<=15)w[s]=b,s++;else{var I=0,O=0;b==16?(O=3+n(i,v,2),v+=2,I=w[s-1]):b==17?(O=3+n(i,v,3),v+=3):b==18&&(O=11+n(i,v,7),v+=7);for(var E=s+O;s<E;)w[s]=I,s++}}return v},c.F._copyOut=function(e,t,u,i){for(var v=0,w=0,n=i.length>>>1;w<u;){var r=e[w+t];i[w<<1]=0,i[1+(w<<1)]=r,r>v&&(v=r),w++}for(;w<n;)i[w<<1]=0,i[1+(w<<1)]=0,w++;return v},c.F.makeCodes=function(e,t){for(var u,i,v,w,n=c.F.U,r=e.length,s=n.bl_count,d=0;d<=t;d++)s[d]=0;for(d=1;d<r;d+=2)s[e[d]]++;var b=n.next_code;for(u=0,s[0]=0,i=1;i<=t;i++)u=u+s[i-1]<<1,b[i]=u;for(v=0;v<r;v+=2)(w=e[v+1])!=0&&(e[v]=b[w],b[w]++)},c.F.codes2map=function(e,t,u){for(var i=e.length,v=c.F.U.rev15,w=0;w<i;w+=2)if(e[w+1]!=0)for(var n=w>>1,r=e[w+1],s=n<<4|r,d=t-r,b=e[w]<<d,I=b+(1<<d);b!=I;)u[v[b]>>>15-t]=s,b++},c.F.revCodes=function(e,t){for(var u=c.F.U.rev15,i=15-t,v=0;v<e.length;v+=2){var w=e[v]<<t-e[v+1];e[v]=u[w]>>>i}},c.F._putsE=function(e,t,u){u<<=7&t;var i=t>>>3;e[i]|=u,e[i+1]|=u>>>8},c.F._putsF=function(e,t,u){u<<=7&t;var i=t>>>3;e[i]|=u,e[i+1]|=u>>>8,e[i+2]|=u>>>16},c.F._bitsE=function(e,t,u){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<u)-1},c.F._bitsF=function(e,t,u){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<u)-1},c.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},c.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},c.F.U=(g=Uint16Array,R=Uint32Array,{next_code:new g(16),bl_count:new g(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new g(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new R(32),flmap:new g(512),fltree:[],fdmap:new g(32),fdtree:[],lmap:new g(32768),ltree:[],ttree:[],dmap:new g(32768),dtree:[],imap:new g(512),itree:[],rev15:new g(32768),lhst:new R(286),dhst:new R(30),ihst:new R(19),lits:new R(15e3),strt:new g(65536),prev:new g(32768)}),function(){for(var e=c.F.U,t=0;t<32768;t++){var u=t;u=(4278255360&(u=(4042322160&(u=(3435973836&(u=(2863311530&u)>>>1|(1431655765&u)<<1))>>>2|(858993459&u)<<2))>>>4|(252645135&u)<<4))>>>8|(16711935&u)<<8,e.rev15[t]=(u>>>16|u<<16)>>>17}function i(v,w,n){for(;w--!=0;)v.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];i(e.fltree,144,8),i(e.fltree,112,9),i(e.fltree,24,7),i(e.fltree,8,8),c.F.makeCodes(e.fltree,9),c.F.codes2map(e.fltree,9,e.flmap),c.F.revCodes(e.fltree,9),i(e.fdtree,32,5),c.F.makeCodes(e.fdtree,5),c.F.codes2map(e.fdtree,5,e.fdmap),c.F.revCodes(e.fdtree,5),i(e.itree,19,0),i(e.ltree,286,0),i(e.dtree,30,0),i(e.ttree,320,0)}()})();var $r=Pr({__proto__:null,default:vn},[vn]);const Xe=function(){var o={nextZero(n,r){for(;n[r]!=0;)r++;return r},readUshort:(n,r)=>n[r]<<8|n[r+1],writeUshort(n,r,s){n[r]=s>>8&255,n[r+1]=255&s},readUint:(n,r)=>16777216*n[r]+(n[r+1]<<16|n[r+2]<<8|n[r+3]),writeUint(n,r,s){n[r]=s>>24&255,n[r+1]=s>>16&255,n[r+2]=s>>8&255,n[r+3]=255&s},readASCII(n,r,s){let d="";for(let b=0;b<s;b++)d+=String.fromCharCode(n[r+b]);return d},writeASCII(n,r,s){for(let d=0;d<s.length;d++)n[r+d]=s.charCodeAt(d)},readBytes(n,r,s){const d=[];for(let b=0;b<s;b++)d.push(n[r+b]);return d},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,r,s){let d,b="";for(let I=0;I<s;I++)b+=`%${o.pad(n[r+I].toString(16))}`;try{d=decodeURIComponent(b)}catch{return o.readASCII(n,r,s)}return d}};function g(n,r,s,d){const b=r*s,I=t(d),O=Math.ceil(r*I/8),E=new Uint8Array(4*b),B=new Uint32Array(E.buffer),{ctype:L}=d,{depth:F}=d,H=o.readUshort;if(L==6){const D=b<<2;if(F==8)for(var x=0;x<D;x+=4)E[x]=n[x],E[x+1]=n[x+1],E[x+2]=n[x+2],E[x+3]=n[x+3];if(F==16)for(x=0;x<D;x++)E[x]=n[x<<1]}else if(L==2){const D=d.tabs.tRNS;if(D==null){if(F==8)for(x=0;x<b;x++){var M=3*x;B[x]=255<<24|n[M+2]<<16|n[M+1]<<8|n[M]}if(F==16)for(x=0;x<b;x++)M=6*x,B[x]=255<<24|n[M+4]<<16|n[M+2]<<8|n[M]}else{var h=D[0];const P=D[1],V=D[2];if(F==8)for(x=0;x<b;x++){var f=x<<2;M=3*x,B[x]=255<<24|n[M+2]<<16|n[M+1]<<8|n[M],n[M]==h&&n[M+1]==P&&n[M+2]==V&&(E[f+3]=0)}if(F==16)for(x=0;x<b;x++)f=x<<2,M=6*x,B[x]=255<<24|n[M+4]<<16|n[M+2]<<8|n[M],H(n,M)==h&&H(n,M+2)==P&&H(n,M+4)==V&&(E[f+3]=0)}}else if(L==3){const D=d.tabs.PLTE,P=d.tabs.tRNS,V=P?P.length:0;if(F==1)for(var y=0;y<s;y++){var C=y*O,_=y*r;for(x=0;x<r;x++){f=_+x<<2;var j=3*(T=n[C+(x>>3)]>>7-((7&x)<<0)&1);E[f]=D[j],E[f+1]=D[j+1],E[f+2]=D[j+2],E[f+3]=T<V?P[T]:255}}if(F==2)for(y=0;y<s;y++)for(C=y*O,_=y*r,x=0;x<r;x++)f=_+x<<2,j=3*(T=n[C+(x>>2)]>>6-((3&x)<<1)&3),E[f]=D[j],E[f+1]=D[j+1],E[f+2]=D[j+2],E[f+3]=T<V?P[T]:255;if(F==4)for(y=0;y<s;y++)for(C=y*O,_=y*r,x=0;x<r;x++)f=_+x<<2,j=3*(T=n[C+(x>>1)]>>4-((1&x)<<2)&15),E[f]=D[j],E[f+1]=D[j+1],E[f+2]=D[j+2],E[f+3]=T<V?P[T]:255;if(F==8)for(x=0;x<b;x++){var T;f=x<<2,j=3*(T=n[x]),E[f]=D[j],E[f+1]=D[j+1],E[f+2]=D[j+2],E[f+3]=T<V?P[T]:255}}else if(L==4){if(F==8)for(x=0;x<b;x++){f=x<<2;var k=n[p=x<<1];E[f]=k,E[f+1]=k,E[f+2]=k,E[f+3]=n[p+1]}if(F==16)for(x=0;x<b;x++){var p;f=x<<2,k=n[p=x<<2],E[f]=k,E[f+1]=k,E[f+2]=k,E[f+3]=n[p+2]}}else if(L==0)for(h=d.tabs.tRNS?d.tabs.tRNS:-1,y=0;y<s;y++){const D=y*O,P=y*r;if(F==1)for(var l=0;l<r;l++){var U=(k=255*(n[D+(l>>>3)]>>>7-(7&l)&1))==255*h?0:255;B[P+l]=U<<24|k<<16|k<<8|k}else if(F==2)for(l=0;l<r;l++)U=(k=85*(n[D+(l>>>2)]>>>6-((3&l)<<1)&3))==85*h?0:255,B[P+l]=U<<24|k<<16|k<<8|k;else if(F==4)for(l=0;l<r;l++)U=(k=17*(n[D+(l>>>1)]>>>4-((1&l)<<2)&15))==17*h?0:255,B[P+l]=U<<24|k<<16|k<<8|k;else if(F==8)for(l=0;l<r;l++)U=(k=n[D+l])==h?0:255,B[P+l]=U<<24|k<<16|k<<8|k;else if(F==16)for(l=0;l<r;l++)k=n[D+(l<<1)],U=H(n,D+(l<<1))==h?0:255,B[P+l]=U<<24|k<<16|k<<8|k}return E}function R(n,r,s,d){const b=t(n),I=Math.ceil(s*b/8),O=new Uint8Array((I+1+n.interlace)*d);return r=n.tabs.CgBI?e(r,O):c(r,O),n.interlace==0?r=u(r,n,0,s,d):n.interlace==1&&(r=function(B,L){const F=L.width,H=L.height,x=t(L),M=x>>3,h=Math.ceil(F*x/8),f=new Uint8Array(H*h);let y=0;const C=[0,0,4,0,2,0,1],_=[0,4,0,2,0,1,0],j=[8,8,8,4,4,2,2],T=[8,8,4,4,2,2,1];let k=0;for(;k<7;){const l=j[k],U=T[k];let D=0,P=0,V=C[k];for(;V<H;)V+=l,P++;let W=_[k];for(;W<F;)W+=U,D++;const q=Math.ceil(D*x/8);u(B,L,y,D,P);let Y=0,N=C[k];for(;N<H;){let Z=_[k],de=y+Y*q<<3;for(;Z<F;){var p;if(x==1&&(p=(p=B[de>>3])>>7-(7&de)&1,f[N*h+(Z>>3)]|=p<<7-((7&Z)<<0)),x==2&&(p=(p=B[de>>3])>>6-(7&de)&3,f[N*h+(Z>>2)]|=p<<6-((3&Z)<<1)),x==4&&(p=(p=B[de>>3])>>4-(7&de)&15,f[N*h+(Z>>1)]|=p<<4-((1&Z)<<2)),x>=8){const ne=N*h+Z*M;for(let ee=0;ee<M;ee++)f[ne+ee]=B[(de>>3)+ee]}de+=x,Z+=U}Y++,N+=l}D*P!=0&&(y+=P*(1+q)),k+=1}return f}(r,n)),r}function c(n,r){return e(new Uint8Array(n.buffer,2,n.length-6),r)}var e=function(){const n={H:{}};return n.H.N=function(r,s){const d=Uint8Array;let b,I,O=0,E=0,B=0,L=0,F=0,H=0,x=0,M=0,h=0;if(r[0]==3&&r[1]==0)return s||new d(0);const f=n.H,y=f.b,C=f.e,_=f.R,j=f.n,T=f.A,k=f.Z,p=f.m,l=s==null;for(l&&(s=new d(r.length>>>2<<5));O==0;)if(O=y(r,h,1),E=y(r,h+1,2),h+=3,E!=0){if(l&&(s=n.H.W(s,M+(1<<17))),E==1&&(b=p.J,I=p.h,H=511,x=31),E==2){B=C(r,h,5)+257,L=C(r,h+5,5)+1,F=C(r,h+10,4)+4,h+=14;let D=1;for(var U=0;U<38;U+=2)p.Q[U]=0,p.Q[U+1]=0;for(U=0;U<F;U++){const W=C(r,h+3*U,3);p.Q[1+(p.X[U]<<1)]=W,W>D&&(D=W)}h+=3*F,j(p.Q,D),T(p.Q,D,p.u),b=p.w,I=p.d,h=_(p.u,(1<<D)-1,B+L,r,h,p.v);const P=f.V(p.v,0,B,p.C);H=(1<<P)-1;const V=f.V(p.v,B,L,p.D);x=(1<<V)-1,j(p.C,P),T(p.C,P,b),j(p.D,V),T(p.D,V,I)}for(;;){const D=b[k(r,h)&H];h+=15&D;const P=D>>>4;if(!(P>>>8))s[M++]=P;else{if(P==256)break;{let V=M+P-254;if(P>264){const Z=p.q[P-257];V=M+(Z>>>3)+C(r,h,7&Z),h+=7&Z}const W=I[k(r,h)&x];h+=15&W;const q=W>>>4,Y=p.c[q],N=(Y>>>4)+y(r,h,15&Y);for(h+=15&Y;M<V;)s[M]=s[M++-N],s[M]=s[M++-N],s[M]=s[M++-N],s[M]=s[M++-N];M=V}}}}else{7&h&&(h+=8-(7&h));const D=4+(h>>>3),P=r[D-4]|r[D-3]<<8;l&&(s=n.H.W(s,M+P)),s.set(new d(r.buffer,r.byteOffset+D,P),M),h=D+P<<3,M+=P}return s.length==M?s:s.slice(0,M)},n.H.W=function(r,s){const d=r.length;if(s<=d)return r;const b=new Uint8Array(d<<1);return b.set(r,0),b},n.H.R=function(r,s,d,b,I,O){const E=n.H.e,B=n.H.Z;let L=0;for(;L<d;){const F=r[B(b,I)&s];I+=15&F;const H=F>>>4;if(H<=15)O[L]=H,L++;else{let x=0,M=0;H==16?(M=3+E(b,I,2),I+=2,x=O[L-1]):H==17?(M=3+E(b,I,3),I+=3):H==18&&(M=11+E(b,I,7),I+=7);const h=L+M;for(;L<h;)O[L]=x,L++}}return I},n.H.V=function(r,s,d,b){let I=0,O=0;const E=b.length>>>1;for(;O<d;){const B=r[O+s];b[O<<1]=0,b[1+(O<<1)]=B,B>I&&(I=B),O++}for(;O<E;)b[O<<1]=0,b[1+(O<<1)]=0,O++;return I},n.H.n=function(r,s){const d=n.H.m,b=r.length;let I,O,E,B;const L=d.j;for(var F=0;F<=s;F++)L[F]=0;for(F=1;F<b;F+=2)L[r[F]]++;const H=d.K;for(I=0,L[0]=0,O=1;O<=s;O++)I=I+L[O-1]<<1,H[O]=I;for(E=0;E<b;E+=2)B=r[E+1],B!=0&&(r[E]=H[B],H[B]++)},n.H.A=function(r,s,d){const b=r.length,I=n.H.m.r;for(let O=0;O<b;O+=2)if(r[O+1]!=0){const E=O>>1,B=r[O+1],L=E<<4|B,F=s-B;let H=r[O]<<F;const x=H+(1<<F);for(;H!=x;)d[I[H]>>>15-s]=L,H++}},n.H.l=function(r,s){const d=n.H.m.r,b=15-s;for(let I=0;I<r.length;I+=2){const O=r[I]<<s-r[I+1];r[I]=d[O]>>>b}},n.H.M=function(r,s,d){d<<=7&s;const b=s>>>3;r[b]|=d,r[b+1]|=d>>>8},n.H.I=function(r,s,d){d<<=7&s;const b=s>>>3;r[b]|=d,r[b+1]|=d>>>8,r[b+2]|=d>>>16},n.H.e=function(r,s,d){return(r[s>>>3]|r[1+(s>>>3)]<<8)>>>(7&s)&(1<<d)-1},n.H.b=function(r,s,d){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16)>>>(7&s)&(1<<d)-1},n.H.Z=function(r,s){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16)>>>(7&s)},n.H.i=function(r,s){return(r[s>>>3]|r[1+(s>>>3)]<<8|r[2+(s>>>3)]<<16|r[3+(s>>>3)]<<24)>>>(7&s)},n.H.m=function(){const r=Uint16Array,s=Uint32Array;return{K:new r(16),j:new r(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new r(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new s(32),J:new r(512),_:[],h:new r(32),$:[],w:new r(32768),C:[],v:[],d:new r(32768),D:[],u:new r(512),Q:[],r:new r(32768),s:new s(286),Y:new s(30),a:new s(19),t:new s(15e3),k:new r(65536),g:new r(32768)}}(),function(){const r=n.H.m;for(var s=0;s<32768;s++){let b=s;b=(2863311530&b)>>>1|(1431655765&b)<<1,b=(3435973836&b)>>>2|(858993459&b)<<2,b=(4042322160&b)>>>4|(252645135&b)<<4,b=(4278255360&b)>>>8|(16711935&b)<<8,r.r[s]=(b>>>16|b<<16)>>>17}function d(b,I,O){for(;I--!=0;)b.push(0,O)}for(s=0;s<32;s++)r.q[s]=r.S[s]<<3|r.T[s],r.c[s]=r.p[s]<<4|r.z[s];d(r._,144,8),d(r._,112,9),d(r._,24,7),d(r._,8,8),n.H.n(r._,9),n.H.A(r._,9,r.J),n.H.l(r._,9),d(r.$,32,5),n.H.n(r.$,5),n.H.A(r.$,5,r.h),n.H.l(r.$,5),d(r.Q,19,0),d(r.C,286,0),d(r.D,30,0),d(r.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function u(n,r,s,d,b){let I=t(r);const O=Math.ceil(d*I/8);let E,B;I=Math.ceil(I/8);let L=n[s],F=0;if(L>1&&(n[s]=[0,0,1][L-2]),L==3)for(F=I;F<O;F++)n[F+1]=n[F+1]+(n[F+1-I]>>>1)&255;for(let H=0;H<b;H++)if(E=s+H*O,B=E+H+1,L=n[B-1],F=0,L==0)for(;F<O;F++)n[E+F]=n[B+F];else if(L==1){for(;F<I;F++)n[E+F]=n[B+F];for(;F<O;F++)n[E+F]=n[B+F]+n[E+F-I]}else if(L==2)for(;F<O;F++)n[E+F]=n[B+F]+n[E+F-O];else if(L==3){for(;F<I;F++)n[E+F]=n[B+F]+(n[E+F-O]>>>1);for(;F<O;F++)n[E+F]=n[B+F]+(n[E+F-O]+n[E+F-I]>>>1)}else{for(;F<I;F++)n[E+F]=n[B+F]+i(0,n[E+F-O],0);for(;F<O;F++)n[E+F]=n[B+F]+i(n[E+F-I],n[E+F-O],n[E+F-I-O])}return n}function i(n,r,s){const d=n+r-s,b=d-n,I=d-r,O=d-s;return b*b<=I*I&&b*b<=O*O?n:I*I<=O*O?r:s}function v(n,r,s){s.width=o.readUint(n,r),r+=4,s.height=o.readUint(n,r),r+=4,s.depth=n[r],r++,s.ctype=n[r],r++,s.compress=n[r],r++,s.filter=n[r],r++,s.interlace=n[r],r++}function w(n,r,s,d,b,I,O,E,B){const L=Math.min(r,b),F=Math.min(s,I);let H=0,x=0;for(let k=0;k<F;k++)for(let p=0;p<L;p++)if(O>=0&&E>=0?(H=k*r+p<<2,x=(E+k)*b+O+p<<2):(H=(-E+k)*r-O+p<<2,x=k*b+p<<2),B==0)d[x]=n[H],d[x+1]=n[H+1],d[x+2]=n[H+2],d[x+3]=n[H+3];else if(B==1){var M=n[H+3]*.00392156862745098,h=n[H]*M,f=n[H+1]*M,y=n[H+2]*M,C=d[x+3]*(1/255),_=d[x]*C,j=d[x+1]*C,T=d[x+2]*C;const l=1-M,U=M+C*l,D=U==0?0:1/U;d[x+3]=255*U,d[x+0]=(h+_*l)*D,d[x+1]=(f+j*l)*D,d[x+2]=(y+T*l)*D}else if(B==2)M=n[H+3],h=n[H],f=n[H+1],y=n[H+2],C=d[x+3],_=d[x],j=d[x+1],T=d[x+2],M==C&&h==_&&f==j&&y==T?(d[x]=0,d[x+1]=0,d[x+2]=0,d[x+3]=0):(d[x]=h,d[x+1]=f,d[x+2]=y,d[x+3]=M);else if(B==3){if(M=n[H+3],h=n[H],f=n[H+1],y=n[H+2],C=d[x+3],_=d[x],j=d[x+1],T=d[x+2],M==C&&h==_&&f==j&&y==T)continue;if(M<220&&C>20)return!1}return!0}return{decode:function(r){const s=new Uint8Array(r);let d=8;const b=o,I=b.readUshort,O=b.readUint,E={tabs:{},frames:[]},B=new Uint8Array(s.length);let L,F=0,H=0;const x=[137,80,78,71,13,10,26,10];for(var M=0;M<8;M++)if(s[M]!=x[M])throw"The input is not a PNG file!";for(;d<s.length;){const k=b.readUint(s,d);d+=4;const p=b.readASCII(s,d,4);if(d+=4,p=="IHDR")v(s,d,E);else if(p=="iCCP"){for(var h=d;s[h]!=0;)h++;b.readASCII(s,d,h-d),s[h+1];const l=s.slice(h+2,d+k);let U=null;try{U=c(l)}catch{U=e(l)}E.tabs[p]=U}else if(p=="CgBI")E.tabs[p]=s.slice(d,d+4);else if(p=="IDAT"){for(M=0;M<k;M++)B[F+M]=s[d+M];F+=k}else if(p=="acTL")E.tabs[p]={num_frames:O(s,d),num_plays:O(s,d+4)},L=new Uint8Array(s.length);else if(p=="fcTL"){H!=0&&((T=E.frames[E.frames.length-1]).data=R(E,L.slice(0,H),T.rect.width,T.rect.height),H=0);const l={x:O(s,d+12),y:O(s,d+16),width:O(s,d+4),height:O(s,d+8)};let U=I(s,d+22);U=I(s,d+20)/(U==0?100:U);const D={rect:l,delay:Math.round(1e3*U),dispose:s[d+24],blend:s[d+25]};E.frames.push(D)}else if(p=="fdAT"){for(M=0;M<k-4;M++)L[H+M]=s[d+M+4];H+=k-4}else if(p=="pHYs")E.tabs[p]=[b.readUint(s,d),b.readUint(s,d+4),s[d+8]];else if(p=="cHRM")for(E.tabs[p]=[],M=0;M<8;M++)E.tabs[p].push(b.readUint(s,d+4*M));else if(p=="tEXt"||p=="zTXt"){E.tabs[p]==null&&(E.tabs[p]={});var f=b.nextZero(s,d),y=b.readASCII(s,d,f-d),C=d+k-f-1;if(p=="tEXt")j=b.readASCII(s,f+1,C);else{var _=c(s.slice(f+2,f+2+C));j=b.readUTF8(_,0,_.length)}E.tabs[p][y]=j}else if(p=="iTXt"){E.tabs[p]==null&&(E.tabs[p]={}),f=0,h=d,f=b.nextZero(s,h),y=b.readASCII(s,h,f-h);const l=s[h=f+1];var j;s[h+1],h+=2,f=b.nextZero(s,h),b.readASCII(s,h,f-h),h=f+1,f=b.nextZero(s,h),b.readUTF8(s,h,f-h),C=k-((h=f+1)-d),l==0?j=b.readUTF8(s,h,C):(_=c(s.slice(h,h+C)),j=b.readUTF8(_,0,_.length)),E.tabs[p][y]=j}else if(p=="PLTE")E.tabs[p]=b.readBytes(s,d,k);else if(p=="hIST"){const l=E.tabs.PLTE.length/3;for(E.tabs[p]=[],M=0;M<l;M++)E.tabs[p].push(I(s,d+2*M))}else if(p=="tRNS")E.ctype==3?E.tabs[p]=b.readBytes(s,d,k):E.ctype==0?E.tabs[p]=I(s,d):E.ctype==2&&(E.tabs[p]=[I(s,d),I(s,d+2),I(s,d+4)]);else if(p=="gAMA")E.tabs[p]=b.readUint(s,d)/1e5;else if(p=="sRGB")E.tabs[p]=s[d];else if(p=="bKGD")E.ctype==0||E.ctype==4?E.tabs[p]=[I(s,d)]:E.ctype==2||E.ctype==6?E.tabs[p]=[I(s,d),I(s,d+2),I(s,d+4)]:E.ctype==3&&(E.tabs[p]=s[d]);else if(p=="IEND")break;d+=k,b.readUint(s,d),d+=4}var T;return H!=0&&((T=E.frames[E.frames.length-1]).data=R(E,L.slice(0,H),T.rect.width,T.rect.height)),E.data=R(E,B,E.width,E.height),delete E.compress,delete E.interlace,delete E.filter,E},toRGBA8:function(r){const s=r.width,d=r.height;if(r.tabs.acTL==null)return[g(r.data,s,d,r).buffer];const b=[];r.frames[0].data==null&&(r.frames[0].data=r.data);const I=s*d*4,O=new Uint8Array(I),E=new Uint8Array(I),B=new Uint8Array(I);for(let F=0;F<r.frames.length;F++){const H=r.frames[F],x=H.rect.x,M=H.rect.y,h=H.rect.width,f=H.rect.height,y=g(H.data,h,f,r);if(F!=0)for(var L=0;L<I;L++)B[L]=O[L];if(H.blend==0?w(y,h,f,O,s,d,x,M,0):H.blend==1&&w(y,h,f,O,s,d,x,M,1),b.push(O.buffer.slice(0)),H.dispose!=0){if(H.dispose==1)w(E,h,f,O,s,d,x,M,0);else if(H.dispose==2)for(L=0;L<I;L++)O[L]=B[L]}}return b},_paeth:i,_copyTile:w,_bin:o}}();(function(){const{_copyTile:o}=Xe,{_bin:g}=Xe,R=Xe._paeth;var c={table:function(){const h=new Uint32Array(256);for(let f=0;f<256;f++){let y=f;for(let C=0;C<8;C++)1&y?y=3988292384^y>>>1:y>>>=1;h[f]=y}return h}(),update(h,f,y,C){for(let _=0;_<C;_++)h=c.table[255&(h^f[y+_])]^h>>>8;return h},crc:(h,f,y)=>4294967295^c.update(4294967295,h,f,y)};function e(h,f,y,C){f[y]+=h[0]*C>>4,f[y+1]+=h[1]*C>>4,f[y+2]+=h[2]*C>>4,f[y+3]+=h[3]*C>>4}function t(h){return Math.max(0,Math.min(255,h))}function u(h,f){const y=h[0]-f[0],C=h[1]-f[1],_=h[2]-f[2],j=h[3]-f[3];return y*y+C*C+_*_+j*j}function i(h,f,y,C,_,j,T){T==null&&(T=1);const k=C.length,p=[];for(var l=0;l<k;l++){const N=C[l];p.push([N>>>0&255,N>>>8&255,N>>>16&255,N>>>24&255])}for(l=0;l<k;l++){let N=4294967295;for(var U=0,D=0;D<k;D++){var P=u(p[l],p[D]);D!=l&&P<N&&(N=P,U=D)}}const V=new Uint32Array(_.buffer),W=new Int16Array(f*y*4),q=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(l=0;l<q.length;l++)q[l]=255*((q[l]+.5)/16-.5);for(let N=0;N<y;N++)for(let Z=0;Z<f;Z++){var Y;l=4*(N*f+Z),T!=2?Y=[t(h[l]+W[l]),t(h[l+1]+W[l+1]),t(h[l+2]+W[l+2]),t(h[l+3]+W[l+3])]:(P=q[4*(3&N)+(3&Z)],Y=[t(h[l]+P),t(h[l+1]+P),t(h[l+2]+P),t(h[l+3]+P)]),U=0;let de=16777215;for(D=0;D<k;D++){const le=u(Y,p[D]);le<de&&(de=le,U=D)}const ne=p[U],ee=[Y[0]-ne[0],Y[1]-ne[1],Y[2]-ne[2],Y[3]-ne[3]];T==1&&(Z!=f-1&&e(ee,W,l+4,7),N!=y-1&&(Z!=0&&e(ee,W,l+4*f-4,3),e(ee,W,l+4*f,5),Z!=f-1&&e(ee,W,l+4*f+4,1))),j[l>>2]=U,V[l>>2]=C[U]}}function v(h,f,y,C,_){_==null&&(_={});const{crc:j}=c,T=g.writeUint,k=g.writeUshort,p=g.writeASCII;let l=8;const U=h.frames.length>1;let D,P=!1,V=33+(U?20:0);if(_.sRGB!=null&&(V+=13),_.pHYs!=null&&(V+=21),_.iCCP!=null&&(D=pako.deflate(_.iCCP),V+=21+D.length+4),h.ctype==3){for(var W=h.plte.length,q=0;q<W;q++)h.plte[q]>>>24!=255&&(P=!0);V+=8+3*W+4+(P?8+1*W+4:0)}for(var Y=0;Y<h.frames.length;Y++)U&&(V+=38),V+=(ne=h.frames[Y]).cimg.length+12,Y!=0&&(V+=4);V+=12;const N=new Uint8Array(V),Z=[137,80,78,71,13,10,26,10];for(q=0;q<8;q++)N[q]=Z[q];if(T(N,l,13),l+=4,p(N,l,"IHDR"),l+=4,T(N,l,f),l+=4,T(N,l,y),l+=4,N[l]=h.depth,l++,N[l]=h.ctype,l++,N[l]=0,l++,N[l]=0,l++,N[l]=0,l++,T(N,l,j(N,l-17,17)),l+=4,_.sRGB!=null&&(T(N,l,1),l+=4,p(N,l,"sRGB"),l+=4,N[l]=_.sRGB,l++,T(N,l,j(N,l-5,5)),l+=4),_.iCCP!=null){const ee=13+D.length;T(N,l,ee),l+=4,p(N,l,"iCCP"),l+=4,p(N,l,"ICC profile"),l+=11,l+=2,N.set(D,l),l+=D.length,T(N,l,j(N,l-(ee+4),ee+4)),l+=4}if(_.pHYs!=null&&(T(N,l,9),l+=4,p(N,l,"pHYs"),l+=4,T(N,l,_.pHYs[0]),l+=4,T(N,l,_.pHYs[1]),l+=4,N[l]=_.pHYs[2],l++,T(N,l,j(N,l-13,13)),l+=4),U&&(T(N,l,8),l+=4,p(N,l,"acTL"),l+=4,T(N,l,h.frames.length),l+=4,T(N,l,_.loop!=null?_.loop:0),l+=4,T(N,l,j(N,l-12,12)),l+=4),h.ctype==3){for(T(N,l,3*(W=h.plte.length)),l+=4,p(N,l,"PLTE"),l+=4,q=0;q<W;q++){const ee=3*q,le=h.plte[q],se=255&le,ue=le>>>8&255,Fe=le>>>16&255;N[l+ee+0]=se,N[l+ee+1]=ue,N[l+ee+2]=Fe}if(l+=3*W,T(N,l,j(N,l-3*W-4,3*W+4)),l+=4,P){for(T(N,l,W),l+=4,p(N,l,"tRNS"),l+=4,q=0;q<W;q++)N[l+q]=h.plte[q]>>>24&255;l+=W,T(N,l,j(N,l-W-4,W+4)),l+=4}}let de=0;for(Y=0;Y<h.frames.length;Y++){var ne=h.frames[Y];U&&(T(N,l,26),l+=4,p(N,l,"fcTL"),l+=4,T(N,l,de++),l+=4,T(N,l,ne.rect.width),l+=4,T(N,l,ne.rect.height),l+=4,T(N,l,ne.rect.x),l+=4,T(N,l,ne.rect.y),l+=4,k(N,l,C[Y]),l+=2,k(N,l,1e3),l+=2,N[l]=ne.dispose,l++,N[l]=ne.blend,l++,T(N,l,j(N,l-30,30)),l+=4);const ee=ne.cimg;T(N,l,(W=ee.length)+(Y==0?0:4)),l+=4;const le=l;p(N,l,Y==0?"IDAT":"fdAT"),l+=4,Y!=0&&(T(N,l,de++),l+=4),N.set(ee,l),l+=W,T(N,l,j(N,le,l-le)),l+=4}return T(N,l,0),l+=4,p(N,l,"IEND"),l+=4,T(N,l,j(N,l-4,4)),l+=4,N.buffer}function w(h,f,y){for(let C=0;C<h.frames.length;C++){const _=h.frames[C];_.rect.width;const j=_.rect.height,T=new Uint8Array(j*_.bpl+j);_.cimg=d(_.img,j,_.bpp,_.bpl,T,f,y)}}function n(h,f,y,C,_){const j=_[0],T=_[1],k=_[2],p=_[3],l=_[4],U=_[5];let D=6,P=8,V=255;for(var W=0;W<h.length;W++){const Te=new Uint8Array(h[W]);for(var q=Te.length,Y=0;Y<q;Y+=4)V&=Te[Y+3]}const N=V!=255,Z=function(ae,ce,be,Ce,xe,ve){const pe=[];for(var ie=0;ie<ae.length;ie++){const J=new Uint8Array(ae[ie]),ke=new Uint32Array(J.buffer);var Ae;let te=0,Ee=0,fe=ce,Oe=be,it=Ce?1:0;if(ie!=0){const xt=ve||Ce||ie==1||pe[ie-2].dispose!=0?1:2;let vt=0,Ke=1e9;for(let at=0;at<xt;at++){var _e=new Uint8Array(ae[ie-1-at]);const Mt=new Uint32Array(ae[ie-1-at]);let he=ce,Se=be,Je=-1,et=-1;for(let He=0;He<be;He++)for(let $e=0;$e<ce;$e++)ke[K=He*ce+$e]!=Mt[K]&&($e<he&&(he=$e),$e>Je&&(Je=$e),He<Se&&(Se=He),He>et&&(et=He));Je==-1&&(he=Se=Je=et=0),xe&&((1&he)==1&&he--,(1&Se)==1&&Se--);const ct=(Je-he+1)*(et-Se+1);ct<Ke&&(Ke=ct,vt=at,te=he,Ee=Se,fe=Je-he+1,Oe=et-Se+1)}_e=new Uint8Array(ae[ie-1-vt]),vt==1&&(pe[ie-1].dispose=2),Ae=new Uint8Array(fe*Oe*4),o(_e,ce,be,Ae,fe,Oe,-te,-Ee,0),it=o(J,ce,be,Ae,fe,Oe,-te,-Ee,3)?1:0,it==1?s(J,ce,be,Ae,{x:te,y:Ee,width:fe,height:Oe}):o(J,ce,be,Ae,fe,Oe,-te,-Ee,0)}else Ae=J.slice(0);pe.push({rect:{x:te,y:Ee,width:fe,height:Oe},img:Ae,blend:it,dispose:0})}if(Ce)for(ie=0;ie<pe.length;ie++){if((Ge=pe[ie]).blend==1)continue;const J=Ge.rect,ke=pe[ie-1].rect,te=Math.min(J.x,ke.x),Ee=Math.min(J.y,ke.y),fe={x:te,y:Ee,width:Math.max(J.x+J.width,ke.x+ke.width)-te,height:Math.max(J.y+J.height,ke.y+ke.height)-Ee};pe[ie-1].dispose=1,ie-1!=0&&r(ae,ce,be,pe,ie-1,fe,xe),r(ae,ce,be,pe,ie,fe,xe)}let rt=0;if(ae.length!=1)for(var K=0;K<pe.length;K++){var Ge;rt+=(Ge=pe[K]).rect.width*Ge.rect.height}return pe}(h,f,y,j,T,k),de={},ne=[],ee=[];if(C!=0){const Te=[];for(Y=0;Y<Z.length;Y++)Te.push(Z[Y].img.buffer);const ae=function(xe){let ve=0;for(var pe=0;pe<xe.length;pe++)ve+=xe[pe].byteLength;const ie=new Uint8Array(ve);let Ae=0;for(pe=0;pe<xe.length;pe++){const _e=new Uint8Array(xe[pe]),rt=_e.length;for(let K=0;K<rt;K+=4){let Ge=_e[K],J=_e[K+1],ke=_e[K+2];const te=_e[K+3];te==0&&(Ge=J=ke=0),ie[Ae+K]=Ge,ie[Ae+K+1]=J,ie[Ae+K+2]=ke,ie[Ae+K+3]=te}Ae+=rt}return ie.buffer}(Te),ce=I(ae,C);for(Y=0;Y<ce.plte.length;Y++)ne.push(ce.plte[Y].est.rgba);let be=0;for(Y=0;Y<Z.length;Y++){const Ce=(se=Z[Y]).img.length;var le=new Uint8Array(ce.inds.buffer,be>>2,Ce>>2);ee.push(le);const xe=new Uint8Array(ce.abuf,be,Ce);U&&i(se.img,se.rect.width,se.rect.height,ne,xe,le),se.img.set(xe),be+=Ce}}else for(W=0;W<Z.length;W++){var se=Z[W];const Te=new Uint32Array(se.img.buffer);var ue=se.rect.width;for(q=Te.length,le=new Uint8Array(q),ee.push(le),Y=0;Y<q;Y++){const ae=Te[Y];if(Y!=0&&ae==Te[Y-1])le[Y]=le[Y-1];else if(Y>ue&&ae==Te[Y-ue])le[Y]=le[Y-ue];else{let ce=de[ae];if(ce==null&&(de[ae]=ce=ne.length,ne.push(ae),ne.length>=300))break;le[Y]=ce}}}const Fe=ne.length;for(Fe<=256&&l==0&&(P=Fe<=2?1:Fe<=4?2:Fe<=16?4:8,P=Math.max(P,p)),W=0;W<Z.length;W++){(se=Z[W]).rect.x,se.rect.y,ue=se.rect.width;const Te=se.rect.height;let ae=se.img;new Uint32Array(ae.buffer);let ce=4*ue,be=4;if(Fe<=256&&l==0){ce=Math.ceil(P*ue/8);var ye=new Uint8Array(ce*Te);const Ce=ee[W];for(let xe=0;xe<Te;xe++){Y=xe*ce;const ve=xe*ue;if(P==8)for(var me=0;me<ue;me++)ye[Y+me]=Ce[ve+me];else if(P==4)for(me=0;me<ue;me++)ye[Y+(me>>1)]|=Ce[ve+me]<<4-4*(1&me);else if(P==2)for(me=0;me<ue;me++)ye[Y+(me>>2)]|=Ce[ve+me]<<6-2*(3&me);else if(P==1)for(me=0;me<ue;me++)ye[Y+(me>>3)]|=Ce[ve+me]<<7-1*(7&me)}ae=ye,D=3,be=1}else if(N==0&&Z.length==1){ye=new Uint8Array(ue*Te*3);const Ce=ue*Te;for(Y=0;Y<Ce;Y++){const xe=3*Y,ve=4*Y;ye[xe]=ae[ve],ye[xe+1]=ae[ve+1],ye[xe+2]=ae[ve+2]}ae=ye,D=2,be=3,ce=3*ue}se.img=ae,se.bpl=ce,se.bpp=be}return{ctype:D,depth:P,plte:ne,frames:Z}}function r(h,f,y,C,_,j,T){const k=Uint8Array,p=Uint32Array,l=new k(h[_-1]),U=new p(h[_-1]),D=_+1<h.length?new k(h[_+1]):null,P=new k(h[_]),V=new p(P.buffer);let W=f,q=y,Y=-1,N=-1;for(let de=0;de<j.height;de++)for(let ne=0;ne<j.width;ne++){const ee=j.x+ne,le=j.y+de,se=le*f+ee,ue=V[se];ue==0||C[_-1].dispose==0&&U[se]==ue&&(D==null||D[4*se+3]!=0)||(ee<W&&(W=ee),ee>Y&&(Y=ee),le<q&&(q=le),le>N&&(N=le))}Y==-1&&(W=q=Y=N=0),T&&((1&W)==1&&W--,(1&q)==1&&q--),j={x:W,y:q,width:Y-W+1,height:N-q+1};const Z=C[_];Z.rect=j,Z.blend=1,Z.img=new Uint8Array(j.width*j.height*4),C[_-1].dispose==0?(o(l,f,y,Z.img,j.width,j.height,-j.x,-j.y,0),s(P,f,y,Z.img,j)):o(P,f,y,Z.img,j.width,j.height,-j.x,-j.y,0)}function s(h,f,y,C,_){o(h,f,y,C,_.width,_.height,-_.x,-_.y,2)}function d(h,f,y,C,_,j,T){const k=[];let p,l=[0,1,2,3,4];j!=-1?l=[j]:(f*C>5e5||y==1)&&(l=[0]),T&&(p={level:0});const U=$r;for(var D=0;D<l.length;D++){for(let W=0;W<f;W++)b(_,h,W,C,y,l[D]);k.push(U.deflate(_,p))}let P,V=1e9;for(D=0;D<k.length;D++)k[D].length<V&&(P=D,V=k[D].length);return k[P]}function b(h,f,y,C,_,j){const T=y*C;let k=T+y;if(h[k]=j,k++,j==0)if(C<500)for(var p=0;p<C;p++)h[k+p]=f[T+p];else h.set(new Uint8Array(f.buffer,T,C),k);else if(j==1){for(p=0;p<_;p++)h[k+p]=f[T+p];for(p=_;p<C;p++)h[k+p]=f[T+p]-f[T+p-_]+256&255}else if(y==0){for(p=0;p<_;p++)h[k+p]=f[T+p];if(j==2)for(p=_;p<C;p++)h[k+p]=f[T+p];if(j==3)for(p=_;p<C;p++)h[k+p]=f[T+p]-(f[T+p-_]>>1)+256&255;if(j==4)for(p=_;p<C;p++)h[k+p]=f[T+p]-R(f[T+p-_],0,0)+256&255}else{if(j==2)for(p=0;p<C;p++)h[k+p]=f[T+p]+256-f[T+p-C]&255;if(j==3){for(p=0;p<_;p++)h[k+p]=f[T+p]+256-(f[T+p-C]>>1)&255;for(p=_;p<C;p++)h[k+p]=f[T+p]+256-(f[T+p-C]+f[T+p-_]>>1)&255}if(j==4){for(p=0;p<_;p++)h[k+p]=f[T+p]+256-R(0,f[T+p-C],0)&255;for(p=_;p<C;p++)h[k+p]=f[T+p]+256-R(f[T+p-_],f[T+p-C],f[T+p-_-C])&255}}}function I(h,f){const y=new Uint8Array(h),C=y.slice(0),_=new Uint32Array(C.buffer),j=O(C,f),T=j[0],k=j[1],p=y.length,l=new Uint8Array(p>>2);let U;if(y.length<2e7)for(var D=0;D<p;D+=4)U=E(T,P=y[D]*(1/255),V=y[D+1]*(1/255),W=y[D+2]*(1/255),q=y[D+3]*(1/255)),l[D>>2]=U.ind,_[D>>2]=U.est.rgba;else for(D=0;D<p;D+=4){var P=y[D]*.00392156862745098,V=y[D+1]*(1/255),W=y[D+2]*(1/255),q=y[D+3]*(1/255);for(U=T;U.left;)U=B(U.est,P,V,W,q)<=0?U.left:U.right;l[D>>2]=U.ind,_[D>>2]=U.est.rgba}return{abuf:C.buffer,inds:l,plte:k}}function O(h,f,y){y==null&&(y=1e-4);const C=new Uint32Array(h.buffer),_={i0:0,i1:h.length,bst:null,est:null,tdst:0,left:null,right:null};_.bst=H(h,_.i0,_.i1),_.est=x(_.bst);const j=[_];for(;j.length<f;){let k=0,p=0;for(var T=0;T<j.length;T++)j[T].est.L>k&&(k=j[T].est.L,p=T);if(k<y)break;const l=j[p],U=L(h,C,l.i0,l.i1,l.est.e,l.est.eMq255);if(l.i0>=U||l.i1<=U){l.est.L=0;continue}const D={i0:l.i0,i1:U,bst:null,est:null,tdst:0,left:null,right:null};D.bst=H(h,D.i0,D.i1),D.est=x(D.bst);const P={i0:U,i1:l.i1,bst:null,est:null,tdst:0,left:null,right:null};for(P.bst={R:[],m:[],N:l.bst.N-D.bst.N},T=0;T<16;T++)P.bst.R[T]=l.bst.R[T]-D.bst.R[T];for(T=0;T<4;T++)P.bst.m[T]=l.bst.m[T]-D.bst.m[T];P.est=x(P.bst),l.left=D,l.right=P,j[p]=D,j.push(P)}for(j.sort((k,p)=>p.bst.N-k.bst.N),T=0;T<j.length;T++)j[T].ind=T;return[_,j]}function E(h,f,y,C,_){if(h.left==null)return h.tdst=function(D,P,V,W,q){const Y=P-D[0],N=V-D[1],Z=W-D[2],de=q-D[3];return Y*Y+N*N+Z*Z+de*de}(h.est.q,f,y,C,_),h;const j=B(h.est,f,y,C,_);let T=h.left,k=h.right;j>0&&(T=h.right,k=h.left);const p=E(T,f,y,C,_);if(p.tdst<=j*j)return p;const l=E(k,f,y,C,_);return l.tdst<p.tdst?l:p}function B(h,f,y,C,_){const{e:j}=h;return j[0]*f+j[1]*y+j[2]*C+j[3]*_-h.eMq}function L(h,f,y,C,_,j){for(C-=4;y<C;){for(;F(h,y,_)<=j;)y+=4;for(;F(h,C,_)>j;)C-=4;if(y>=C)break;const T=f[y>>2];f[y>>2]=f[C>>2],f[C>>2]=T,y+=4,C-=4}for(;F(h,y,_)>j;)y-=4;return y+4}function F(h,f,y){return h[f]*y[0]+h[f+1]*y[1]+h[f+2]*y[2]+h[f+3]*y[3]}function H(h,f,y){const C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_=[0,0,0,0],j=y-f>>2;for(let T=f;T<y;T+=4){const k=h[T]*.00392156862745098,p=h[T+1]*(1/255),l=h[T+2]*(1/255),U=h[T+3]*(1/255);_[0]+=k,_[1]+=p,_[2]+=l,_[3]+=U,C[0]+=k*k,C[1]+=k*p,C[2]+=k*l,C[3]+=k*U,C[5]+=p*p,C[6]+=p*l,C[7]+=p*U,C[10]+=l*l,C[11]+=l*U,C[15]+=U*U}return C[4]=C[1],C[8]=C[2],C[9]=C[6],C[12]=C[3],C[13]=C[7],C[14]=C[11],{R:C,m:_,N:j}}function x(h){const{R:f}=h,{m:y}=h,{N:C}=h,_=y[0],j=y[1],T=y[2],k=y[3],p=C==0?0:1/C,l=[f[0]-_*_*p,f[1]-_*j*p,f[2]-_*T*p,f[3]-_*k*p,f[4]-j*_*p,f[5]-j*j*p,f[6]-j*T*p,f[7]-j*k*p,f[8]-T*_*p,f[9]-T*j*p,f[10]-T*T*p,f[11]-T*k*p,f[12]-k*_*p,f[13]-k*j*p,f[14]-k*T*p,f[15]-k*k*p],U=l,D=M;let P=[Math.random(),Math.random(),Math.random(),Math.random()],V=0,W=0;if(C!=0)for(let Y=0;Y<16&&(P=D.multVec(U,P),W=Math.sqrt(D.dot(P,P)),P=D.sml(1/W,P),!(Y!=0&&Math.abs(W-V)<1e-9));Y++)V=W;const q=[_*p,j*p,T*p,k*p];return{Cov:l,q,e:P,L:V,eMq255:D.dot(D.sml(255,q),P),eMq:D.dot(P,q),rgba:(Math.round(255*q[3])<<24|Math.round(255*q[2])<<16|Math.round(255*q[1])<<8|Math.round(255*q[0])<<0)>>>0}}var M={multVec:(h,f)=>[h[0]*f[0]+h[1]*f[1]+h[2]*f[2]+h[3]*f[3],h[4]*f[0]+h[5]*f[1]+h[6]*f[2]+h[7]*f[3],h[8]*f[0]+h[9]*f[1]+h[10]*f[2]+h[11]*f[3],h[12]*f[0]+h[13]*f[1]+h[14]*f[2]+h[15]*f[3]],dot:(h,f)=>h[0]*f[0]+h[1]*f[1]+h[2]*f[2]+h[3]*f[3],sml:(h,f)=>[h*f[0],h*f[1],h*f[2],h*f[3]]};Xe.encode=function(f,y,C,_,j,T,k){_==null&&(_=0),k==null&&(k=!1);const p=n(f,y,C,_,[!1,!1,!1,0,k,!1]);return w(p,-1),v(p,y,C,j,T)},Xe.encodeLL=function(f,y,C,_,j,T,k,p){const l={ctype:0+(_==1?0:2)+(j==0?0:4),depth:T,frames:[]},U=(_+j)*T,D=U*y;for(let P=0;P<f.length;P++)l.frames.push({rect:{x:0,y:0,width:y,height:C},img:new Uint8Array(f[P]),blend:0,dispose:1,bpp:Math.ceil(U/8),bpl:Math.ceil(D/8)});return w(l,0,!0),v(l,y,C,k,p)},Xe.encode.compress=n,Xe.encode.dither=i,Xe.quantize=I,Xe.quantize.getKDtree=O,Xe.quantize.getNearest=E})();const Us={toArrayBuffer(o,g){const R=o.width,c=o.height,e=R<<2,t=o.getContext("2d").getImageData(0,0,R,c),u=new Uint32Array(t.data.buffer),i=(32*R+31)/32<<2,v=i*c,w=122+v,n=new ArrayBuffer(w),r=new DataView(n),s=1<<20;let d,b,I,O,E=s,B=0,L=0,F=0;function H(h){r.setUint16(L,h,!0),L+=2}function x(h){r.setUint32(L,h,!0),L+=4}function M(h){L+=h}H(19778),x(w),M(4),x(122),x(108),x(R),x(-c>>>0),H(1),H(32),x(3),x(v),x(2835),x(2835),M(8),x(16711680),x(65280),x(255),x(4278190080),x(1466527264),function h(){for(;B<c&&E>0;){for(O=122+B*i,d=0;d<e;)E--,b=u[F++],I=b>>>24,r.setUint32(O+d,b<<8|I),d+=4;B++}F<u.length?(E=s,setTimeout(h,Us._dly)):g(n)}()},toBlob(o,g){this.toArrayBuffer(o,R=>{g(new Blob([R],{type:"image/bmp"}))})},_dly:9};var Be={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},zr={[Be.CHROME]:16384,[Be.FIREFOX]:11180,[Be.DESKTOP_SAFARI]:16384,[Be.IE]:8192,[Be.IOS]:4096,[Be.ETC]:8192};const Vn=typeof window<"u",Ms=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,yn=Vn&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Wr=(Vn||Ms)&&(yn&&yn.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Ns=(Vn||Ms)&&(yn&&yn.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function Yn(o,g,R=Date.now()){return new Promise(c=>{const e=o.split(","),t=e[0].match(/:(.*?);/)[1],u=globalThis.atob(e[1]);let i=u.length;const v=new Uint8Array(i);for(;i--;)v[i]=u.charCodeAt(i);const w=new Blob([v],{type:t});w.name=g,w.lastModified=R,c(w)})}function Ls(o){return new Promise((g,R)=>{const c=new Ns;c.onload=()=>g(c.result),c.onerror=e=>R(e),c.readAsDataURL(o)})}function Ps(o){return new Promise((g,R)=>{const c=new Image;c.onload=()=>g(c),c.onerror=e=>R(e),c.src=o})}function At(){if(At.cachedResult!==void 0)return At.cachedResult;let o=Be.ETC;const{userAgent:g}=navigator;return/Chrom(e|ium)/i.test(g)?o=Be.CHROME:/iP(ad|od|hone)/i.test(g)&&/WebKit/i.test(g)?o=Be.IOS:/Safari/i.test(g)?o=Be.DESKTOP_SAFARI:/Firefox/i.test(g)?o=Be.FIREFOX:(/MSIE/i.test(g)||document.documentMode)&&(o=Be.IE),At.cachedResult=o,At.cachedResult}function Bs(o,g){const R=At(),c=zr[R];let e=o,t=g,u=e*t;const i=e>t?t/e:e/t;for(;u>c*c;){const v=(c+e)/2,w=(c+t)/2;v<w?(t=w,e=w*i):(t=v*i,e=v),u=e*t}return{width:e,height:t}}function Cn(o,g){let R,c;try{if(R=new OffscreenCanvas(o,g),c=R.getContext("2d"),c===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{R=document.createElement("canvas"),c=R.getContext("2d")}return R.width=o,R.height=g,[R,c]}function Hs(o,g){const{width:R,height:c}=Bs(o.width,o.height),[e,t]=Cn(R,c);return g&&/jpe?g/.test(g)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(o,0,0,e.width,e.height),e}function pn(){return pn.cachedResult!==void 0||(pn.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),pn.cachedResult}function Tn(o,g={}){return new Promise(function(R,c){let e,t;var u=function(){try{return t=Hs(e,g.fileType||o.type),R([e,t])}catch(v){return c(v)}},i=function(v){try{var w=function(n){try{throw n}catch(r){return c(r)}};try{let n;return Ls(o).then(function(r){try{return n=r,Ps(n).then(function(s){try{return e=s,function(){try{return u()}catch(d){return c(d)}}()}catch(d){return w(d)}},w)}catch(s){return w(s)}},w)}catch(n){w(n)}}catch(n){return c(n)}};try{if(pn()||[Be.DESKTOP_SAFARI,Be.MOBILE_SAFARI].includes(At()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(o).then(function(v){try{return e=v,u()}catch{return i()}},i)}catch{i()}})}function An(o,g,R,c,e=1){return new Promise(function(t,u){let i;if(g==="image/png"){let w,n,r;return w=o.getContext("2d"),{data:n}=w.getImageData(0,0,o.width,o.height),r=Xe.encode([n.buffer],o.width,o.height,4096*e),i=new Blob([r],{type:g}),i.name=R,i.lastModified=c,v.call(this)}{let w=function(){return v.call(this)};if(g==="image/bmp")return new Promise(n=>Us.toBlob(o,n)).then((function(n){try{return i=n,i.name=R,i.lastModified=c,w.call(this)}catch(r){return u(r)}}).bind(this),u);{let n=function(){return w.call(this)};if(typeof OffscreenCanvas=="function"&&o instanceof OffscreenCanvas)return o.convertToBlob({type:g,quality:e}).then((function(r){try{return i=r,i.name=R,i.lastModified=c,n.call(this)}catch(s){return u(s)}}).bind(this),u);{let r;return r=o.toDataURL(g,e),Yn(r,R,c).then((function(s){try{return i=s,n.call(this)}catch(d){return u(d)}}).bind(this),u)}}}function v(){return t(i)}})}function nt(o){o.width=0,o.height=0}function Et(){return new Promise(function(o,g){let R,c,e,t;return Et.cachedResult!==void 0?o(Et.cachedResult):Yn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(u){try{return R=u,Tn(R).then(function(i){try{return c=i[1],An(c,R.type,R.name,R.lastModified).then(function(v){try{return e=v,nt(c),Tn(e).then(function(w){try{return t=w[0],Et.cachedResult=t.width===1&&t.height===2,o(Et.cachedResult)}catch(n){return g(n)}},g)}catch(w){return g(w)}},g)}catch(v){return g(v)}},g)}catch(i){return g(i)}},g)})}function $s(o){return new Promise((g,R)=>{const c=new Ns;c.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return g(-2);const u=t.byteLength;let i=2;for(;i<u;){if(t.getUint16(i+2,!1)<=8)return g(-1);const v=t.getUint16(i,!1);if(i+=2,v==65505){if(t.getUint32(i+=2,!1)!=1165519206)return g(-1);const w=t.getUint16(i+=6,!1)==18761;i+=t.getUint32(i+4,w);const n=t.getUint16(i,w);i+=2;for(let r=0;r<n;r++)if(t.getUint16(i+12*r,w)==274)return g(t.getUint16(i+12*r+8,w))}else{if((65280&v)!=65280)break;i+=t.getUint16(i,!1)}}return g(-1)},c.onerror=e=>R(e),c.readAsArrayBuffer(o)})}function zs(o,g){const{width:R}=o,{height:c}=o,{maxWidthOrHeight:e}=g;let t,u=o;return isFinite(e)&&(R>e||c>e)&&([u,t]=Cn(R,c),R>c?(u.width=e,u.height=c/R*e):(u.width=R/c*e,u.height=e),t.drawImage(o,0,0,u.width,u.height),nt(o)),u}function Ws(o,g){const{width:R}=o,{height:c}=o,[e,t]=Cn(R,c);switch(g>4&&g<9?(e.width=c,e.height=R):(e.width=R,e.height=c),g){case 2:t.transform(-1,0,0,1,R,0);break;case 3:t.transform(-1,0,0,-1,R,c);break;case 4:t.transform(1,0,0,-1,0,c);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,c,0);break;case 7:t.transform(0,-1,-1,0,c,R);break;case 8:t.transform(0,-1,1,0,0,R)}return t.drawImage(o,0,0,R,c),nt(o),e}function ls(o,g,R=0){return new Promise(function(c,e){let t,u,i,v,w,n,r,s,d,b,I,O,E,B,L,F,H,x,M,h;function f(C=5){if(g.signal&&g.signal.aborted)throw g.signal.reason;t+=C,g.onProgress(Math.min(t,100))}function y(C){if(g.signal&&g.signal.aborted)throw g.signal.reason;t=Math.min(Math.max(C,t),100),g.onProgress(t)}return t=R,u=g.maxIteration||10,i=1024*g.maxSizeMB*1024,f(),Tn(o,g).then((function(C){try{return[,v]=C,f(),w=zs(v,g),f(),new Promise(function(_,j){var T;if(!(T=g.exifOrientation))return $s(o).then((function(p){try{return T=p,k.call(this)}catch(l){return j(l)}}).bind(this),j);function k(){return _(T)}return k.call(this)}).then((function(_){try{return n=_,f(),Et().then((function(j){try{return r=j?w:Ws(w,n),f(),s=g.initialQuality||1,d=g.fileType||o.type,An(r,d,o.name,o.lastModified,s).then((function(T){try{{let p=function(){if(u--&&(L>i||L>E)){let U,D;return U=h?.95*M.width:M.width,D=h?.95*M.height:M.height,[H,x]=Cn(U,D),x.drawImage(M,0,0,U,D),s*=d==="image/png"?.85:.95,An(H,d,o.name,o.lastModified,s).then(function(P){try{return F=P,nt(M),M=H,L=F.size,y(Math.min(99,Math.floor((B-L)/(B-i)*100))),p}catch(V){return e(V)}},e)}return[1]},l=function(){return nt(M),nt(H),nt(w),nt(r),nt(v),y(100),c(F)};if(b=T,f(),I=b.size>i,O=b.size>o.size,!I&&!O)return y(100),c(b);var k;return E=o.size,B=b.size,L=B,M=r,h=!g.alwaysKeepResolution&&I,(k=(function(U){for(;U;){if(U.then)return void U.then(k,e);try{if(U.pop){if(U.length)return U.pop()?l.call(this):U;U=p}else U=U.call(this)}catch(D){return e(D)}}}).bind(this))(p)}}catch(p){return e(p)}}).bind(this),e)}catch(T){return e(T)}}).bind(this),e)}catch(j){return e(j)}}).bind(this),e)}catch(_){return e(_)}}).bind(this),e)})}const Gr=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Rn;function Vr(o,g){return new Promise((R,c)=>{Rn||(Rn=function(u){const i=[];return i.push(u),URL.createObjectURL(new Blob(i))}(Gr));const e=new Worker(Rn);e.addEventListener("message",function(u){if(g.signal&&g.signal.aborted)e.terminate();else if(u.data.progress===void 0){if(u.data.error)return c(new Error(u.data.error)),void e.terminate();R(u.data.file),e.terminate()}else g.onProgress(u.data.progress)}),e.addEventListener("error",c),g.signal&&g.signal.addEventListener("abort",()=>{c(g.signal.reason),e.terminate()}),e.postMessage({file:o,imageCompressionLibUrl:g.libURL,options:{...g,onProgress:void 0,signal:void 0}})})}function Ue(o,g){return new Promise(function(R,c){let e,t,u,i,v,w;if(e={...g},u=0,{onProgress:i}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,v=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=d=>{u=d,typeof i=="function"&&i(u)},!(o instanceof Blob||o instanceof Wr))return c(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(o.type))return c(new Error("The file given is not an image"));if(w=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!v||typeof Worker!="function"||w)return ls(o,e).then((function(d){try{return t=d,s.call(this)}catch(b){return c(b)}}).bind(this),c);var n=(function(){try{return s.call(this)}catch(d){return c(d)}}).bind(this),r=function(d){try{return ls(o,e).then(function(b){try{return t=b,n()}catch(I){return c(I)}},c)}catch(b){return c(b)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Vr(o,e).then(function(d){try{return t=d,n()}catch{return r()}},r)}catch{r()}function s(){try{t.name=o.name,t.lastModified=o.lastModified}catch{}try{e.preserveExif&&o.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===o.type)&&(t=Os(o,t))}catch{}return R(t)}})}Ue.getDataUrlFromFile=Ls,Ue.getFilefromDataUrl=Yn,Ue.loadImage=Ps,Ue.drawImageInCanvas=Hs,Ue.drawFileInCanvas=Tn,Ue.canvasToFile=An,Ue.getExifOrientation=$s,Ue.handleMaxWidthOrHeight=zs,Ue.followExifOrientation=Ws,Ue.cleanupCanvasMemory=nt,Ue.isAutoOrientationInBrowser=Et,Ue.approximateBelowMaximumCanvasSizeOfBrowser=Bs,Ue.copyExifWithoutOrientation=Os,Ue.getBrowserName=At,Ue.version="2.0.2";function Yr(o){var g=typeof o;return o!=null&&(g=="object"||g=="function")}var Gs=Yr,qr=typeof dn=="object"&&dn&&dn.Object===Object&&dn,Qr=qr,Xr=Qr,Zr=typeof self=="object"&&self&&self.Object===Object&&self,Kr=Xr||Zr||Function("return this")(),Vs=Kr,Jr=Vs,ei=function(){return Jr.Date.now()},ti=ei,ni=/\s/;function si(o){for(var g=o.length;g--&&ni.test(o.charAt(g)););return g}var ri=si,ii=ri,ai=/^\s+/;function oi(o){return o&&o.slice(0,ii(o)+1).replace(ai,"")}var li=oi,ci=Vs,di=ci.Symbol,Ys=di,cs=Ys,qs=Object.prototype,ui=qs.hasOwnProperty,fi=qs.toString,Ht=cs?cs.toStringTag:void 0;function hi(o){var g=ui.call(o,Ht),R=o[Ht];try{o[Ht]=void 0;var c=!0}catch{}var e=fi.call(o);return c&&(g?o[Ht]=R:delete o[Ht]),e}var mi=hi,pi=Object.prototype,gi=pi.toString;function bi(o){return gi.call(o)}var xi=bi,ds=Ys,vi=mi,yi=xi,Ti="[object Null]",Ai="[object Undefined]",us=ds?ds.toStringTag:void 0;function Ci(o){return o==null?o===void 0?Ai:Ti:us&&us in Object(o)?vi(o):yi(o)}var Si=Ci;function wi(o){return o!=null&&typeof o=="object"}var _i=wi,Ei=Si,ji=_i,Ii="[object Symbol]";function Di(o){return typeof o=="symbol"||ji(o)&&Ei(o)==Ii}var Ri=Di,Fi=li,fs=Gs,ki=Ri,hs=NaN,Oi=/^[-+]0x[0-9a-f]+$/i,Ui=/^0b[01]+$/i,Mi=/^0o[0-7]+$/i,Ni=parseInt;function Li(o){if(typeof o=="number")return o;if(ki(o))return hs;if(fs(o)){var g=typeof o.valueOf=="function"?o.valueOf():o;o=fs(g)?g+"":g}if(typeof o!="string")return o===0?o:+o;o=Fi(o);var R=Ui.test(o);return R||Mi.test(o)?Ni(o.slice(2),R?2:8):Oi.test(o)?hs:+o}var Pi=Li,Bi=Gs,Fn=ti,ms=Pi,Hi="Expected a function",$i=Math.max,zi=Math.min;function Wi(o,g,R){var c,e,t,u,i,v,w=0,n=!1,r=!1,s=!0;if(typeof o!="function")throw new TypeError(Hi);g=ms(g)||0,Bi(R)&&(n=!!R.leading,r="maxWait"in R,t=r?$i(ms(R.maxWait)||0,g):t,s="trailing"in R?!!R.trailing:s);function d(x){var M=c,h=e;return c=e=void 0,w=x,u=o.apply(h,M),u}function b(x){return w=x,i=setTimeout(E,g),n?d(x):u}function I(x){var M=x-v,h=x-w,f=g-M;return r?zi(f,t-h):f}function O(x){var M=x-v,h=x-w;return v===void 0||M>=g||M<0||r&&h>=t}function E(){var x=Fn();if(O(x))return B(x);i=setTimeout(E,I(x))}function B(x){return i=void 0,s&&c?d(x):(c=e=void 0,u)}function L(){i!==void 0&&clearTimeout(i),w=0,c=v=e=i=void 0}function F(){return i===void 0?u:B(Fn())}function H(){var x=Fn(),M=O(x);if(c=arguments,e=this,v=x,M){if(i===void 0)return b(v);if(r)return clearTimeout(i),i=setTimeout(E,g),d(v)}return i===void 0&&(i=setTimeout(E,g)),u}return H.cancel=L,H.flush=F,H}var Gi=Wi;const Vi=vr(Gi);var qn={},Yi=bt;Object.defineProperty(qn,"__esModule",{value:!0});var Qs=qn.default=void 0,qi=Yi(gt()),ps=a;Qs=qn.default=(0,qi.default)([(0,ps.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,ps.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn");var Qn={},Qi=bt;Object.defineProperty(Qn,"__esModule",{value:!0});var Xs=Qn.default=void 0,Xi=Qi(gt()),Zi=a;Xs=Qn.default=(0,Xi.default)((0,Zi.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut");var Xn={},Ki=bt;Object.defineProperty(Xn,"__esModule",{value:!0});var Zs=Xn.default=void 0,Ji=Ki(gt()),ea=a;Zs=Xn.default=(0,Ji.default)((0,ea.jsx)("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen");var Zn={},ta=bt;Object.defineProperty(Zn,"__esModule",{value:!0});var Ks=Zn.default=void 0,na=ta(gt()),sa=a;Ks=Zn.default=(0,na.default)((0,sa.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var Kn={},ra=bt;Object.defineProperty(Kn,"__esModule",{value:!0});var Js=Kn.default=void 0,ia=ra(gt()),gs=a;Js=Kn.default=(0,ia.default)([(0,gs.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,gs.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera");const Rt=z.forwardRef(({path:o,initialImages:g=[],onImagesUpdated:R,onDelete:c,isOwnDesign:e},t)=>{const[u,i]=z.useState(g.map(l=>({...l,deleted:!1}))),[v,w]=z.useState(!1),[n,r]=z.useState(0),[s,d]=z.useState(!1),[b,I]=z.useState(null),[O,E]=z.useState(1),[B,L]=z.useState(!1),[F,H]=z.useState(!1),[x,M]=z.useState(""),[h,f]=z.useState("info"),y=z.useRef(null);z.useEffect(()=>{console.log("Initial images received:",g),i(g.map(l=>({...l,deleted:!!l.deleted})))},[g]);const C=async l=>{const U=Array.from(l.target.files||[]);w(!0);const D={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},P=U.map(async(V,W)=>{let q=V;V.size>1024*1024&&(q=await Ue(V,D),M("Your image was compressed before uploading due to file size larger than 1 MB."),f("info"),H(!0));const N=`${new Date().getTime()}-${q.name}`,Z=jt(),de=It(Z,`${o}/${N}`),ne=Fs(de,q);return new Promise((ee,le)=>{ne.on("state_changed",se=>{const ue=se.bytesTransferred/se.totalBytes*100;r(ue)},se=>{console.error("Upload failed:",se),le(se)},()=>{ks(ne.snapshot.ref).then(se=>{ee({url:se,path:de.fullPath,title:""})})})})});Promise.all(P).then(V=>{const W=[...u,...V];i(W),R&&R(W),M("Images uploaded successfully."),f("success"),H(!0),w(!1),r(0),y.current&&(y.current.value="")}).catch(V=>{console.error("Error uploading images: ",V),M("Failed to upload images."),f("error"),H(!0),w(!1),r(0)})},_=l=>{i(U=>{const D=U.map((P,V)=>V===l?{...P,deleted:!0}:P);return R(D),D}),M("Image marked for deletion. Update to permanently delete."),f("info"),H(!0)},j=async()=>{const l=u.filter(U=>U.deleted);if(console.log("Attempting to delete images:",l),l.length>0){const U=l.map(D=>{const P=jt(),V=It(P,D.path);return mn(V)});try{await Promise.all(U),c(l),i(D=>D.filter(P=>!P.deleted)),M("Deleted images have been permanently removed."),f("success")}catch(D){console.error("Error committing deletions:",D),M("Failed to commit deletions."),f("error")}H(!0)}else console.log("No images marked for deletion.")},T=l=>{L(!B),I(l)};z.useEffect(()=>{const l=()=>{const U=!!document.fullscreenElement;L(U)};return document.addEventListener("fullscreenchange",l),()=>document.removeEventListener("fullscreenchange",l)},[]);const k=(l,U)=>{U!=="clickaway"&&H(!1)},p=z.useCallback(Vi((l,U)=>{setTimeout(()=>{i(D=>{const P=D.map((V,W)=>W===l?{...V,title:U}:V);return R&&R(P),P})},0)},30),[R]);return z.useImperativeHandle(t,()=>({commitDeletions:j})),a.jsxs("div",{children:[e&&a.jsx(Qt,{title:"Upload Images",children:a.jsxs(Ne,{variant:"outlined",component:"label",startIcon:a.jsx(Js,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",a.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:C,disabled:v,ref:y,accept:"image/*"})]})}),v&&a.jsxs(a.Fragment,{children:[a.jsxs("p",{children:["Uploading... ",Math.round(n),"%"]}),a.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:a.jsx("div",{style:{height:"20px",width:`${n}%`,backgroundColor:"green"}})})]}),u.filter(l=>!l.deleted).map((l,U)=>a.jsxs("div",{children:[a.jsx("img",{src:l.url,alt:`Uploaded design ${U}`,onClick:()=>{d(!0),I(U)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&a.jsx(qe,{onClick:()=>_(U),children:a.jsx(Xt,{})}),a.jsx("textarea",{value:l.title,onChange:D=>p(U,D.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},U)),a.jsx(Ct,{open:s,onClose:()=>d(!1),fullScreen:B,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:B?"none":void 0,maxHeight:B?"none":void 0,height:B?"100%":void 0,width:B?"100%":void 0,overflowY:"auto"}},children:b!==null&&a.jsxs(St,{children:[a.jsx("div",{style:{textAlign:"center"},children:a.jsx("img",{src:u[b].url,alt:`Zoomed Design ${b}`,style:{maxWidth:"100%",maxHeight:B?"100vh":void 0,transform:`scale(${O})`,transition:"transform 0.2s ease-out"}})}),a.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[a.jsx(qe,{onClick:()=>E(O*1.2),children:a.jsx(Qs,{})}),a.jsx(qe,{onClick:()=>E(O/1.2),style:{marginLeft:"10px"},children:a.jsx(Xs,{})}),a.jsx(qe,{onClick:()=>T(b),style:{marginLeft:"10px"},children:a.jsx(Zs,{})}),B&&a.jsx(qe,{onClick:()=>T(b),style:{position:"absolute",top:20,right:20},children:a.jsx(Ks,{})})]})]})}),a.jsx(mt,{open:F,autoHideDuration:6e3,onClose:k,children:a.jsx(pt,{onClose:k,severity:h,sx:{width:"100%"},children:x})})]})});/*! @license DOMPurify 3.1.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.1.6/LICENSE */const{entries:er,setPrototypeOf:bs,isFrozen:aa,getPrototypeOf:oa,getOwnPropertyDescriptor:la}=Object;let{freeze:Le,seal:Qe,create:tr}=Object,{apply:$n,construct:zn}=typeof Reflect<"u"&&Reflect;Le||(Le=function(g){return g});Qe||(Qe=function(g){return g});$n||($n=function(g,R,c){return g.apply(R,c)});zn||(zn=function(g,R){return new g(...R)});const fn=We(Array.prototype.forEach),xs=We(Array.prototype.pop),$t=We(Array.prototype.push),gn=We(String.prototype.toLowerCase),kn=We(String.prototype.toString),vs=We(String.prototype.match),zt=We(String.prototype.replace),ca=We(String.prototype.indexOf),da=We(String.prototype.trim),Ze=We(Object.prototype.hasOwnProperty),Me=We(RegExp.prototype.test),Wt=ua(TypeError);function We(o){return function(g){for(var R=arguments.length,c=new Array(R>1?R-1:0),e=1;e<R;e++)c[e-1]=arguments[e];return $n(o,g,c)}}function ua(o){return function(){for(var g=arguments.length,R=new Array(g),c=0;c<g;c++)R[c]=arguments[c];return zn(o,R)}}function re(o,g){let R=arguments.length>2&&arguments[2]!==void 0?arguments[2]:gn;bs&&bs(o,null);let c=g.length;for(;c--;){let e=g[c];if(typeof e=="string"){const t=R(e);t!==e&&(aa(g)||(g[c]=t),e=t)}o[e]=!0}return o}function fa(o){for(let g=0;g<o.length;g++)Ze(o,g)||(o[g]=null);return o}function Tt(o){const g=tr(null);for(const[R,c]of er(o))Ze(o,R)&&(Array.isArray(c)?g[R]=fa(c):c&&typeof c=="object"&&c.constructor===Object?g[R]=Tt(c):g[R]=c);return g}function Gt(o,g){for(;o!==null;){const c=la(o,g);if(c){if(c.get)return We(c.get);if(typeof c.value=="function")return We(c.value)}o=oa(o)}function R(){return null}return R}const ys=Le(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),On=Le(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Un=Le(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ha=Le(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Mn=Le(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),ma=Le(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ts=Le(["#text"]),As=Le(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Nn=Le(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Cs=Le(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),hn=Le(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),pa=Qe(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ga=Qe(/<%[\w\W]*|[\w\W]*%>/gm),ba=Qe(/\${[\w\W]*}/gm),xa=Qe(/^data-[\-\w.\u00B7-\uFFFF]/),va=Qe(/^aria-[\-\w]+$/),nr=Qe(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ya=Qe(/^(?:\w+script|data):/i),Ta=Qe(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),sr=Qe(/^html$/i),Aa=Qe(/^[a-z][.\w]*(-[.\w]+)+$/i);var Ss=Object.freeze({__proto__:null,MUSTACHE_EXPR:pa,ERB_EXPR:ga,TMPLIT_EXPR:ba,DATA_ATTR:xa,ARIA_ATTR:va,IS_ALLOWED_URI:nr,IS_SCRIPT_OR_DATA:ya,ATTR_WHITESPACE:Ta,DOCTYPE_NAME:sr,CUSTOM_ELEMENT:Aa});const Vt={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},Ca=function(){return typeof window>"u"?null:window},Sa=function(g,R){if(typeof g!="object"||typeof g.createPolicy!="function")return null;let c=null;const e="data-tt-policy-suffix";R&&R.hasAttribute(e)&&(c=R.getAttribute(e));const t="dompurify"+(c?"#"+c:"");try{return g.createPolicy(t,{createHTML(u){return u},createScriptURL(u){return u}})}catch{return console.warn("TrustedTypes policy "+t+" could not be created."),null}};function rr(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ca();const g=A=>rr(A);if(g.version="3.1.6",g.removed=[],!o||!o.document||o.document.nodeType!==Vt.document)return g.isSupported=!1,g;let{document:R}=o;const c=R,e=c.currentScript,{DocumentFragment:t,HTMLTemplateElement:u,Node:i,Element:v,NodeFilter:w,NamedNodeMap:n=o.NamedNodeMap||o.MozNamedAttrMap,HTMLFormElement:r,DOMParser:s,trustedTypes:d}=o,b=v.prototype,I=Gt(b,"cloneNode"),O=Gt(b,"remove"),E=Gt(b,"nextSibling"),B=Gt(b,"childNodes"),L=Gt(b,"parentNode");if(typeof u=="function"){const A=R.createElement("template");A.content&&A.content.ownerDocument&&(R=A.content.ownerDocument)}let F,H="";const{implementation:x,createNodeIterator:M,createDocumentFragment:h,getElementsByTagName:f}=R,{importNode:y}=c;let C={};g.isSupported=typeof er=="function"&&typeof L=="function"&&x&&x.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:_,ERB_EXPR:j,TMPLIT_EXPR:T,DATA_ATTR:k,ARIA_ATTR:p,IS_SCRIPT_OR_DATA:l,ATTR_WHITESPACE:U,CUSTOM_ELEMENT:D}=Ss;let{IS_ALLOWED_URI:P}=Ss,V=null;const W=re({},[...ys,...On,...Un,...Mn,...Ts]);let q=null;const Y=re({},[...As,...Nn,...Cs,...hn]);let N=Object.seal(tr(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Z=null,de=null,ne=!0,ee=!0,le=!1,se=!0,ue=!1,Fe=!0,ye=!1,me=!1,Te=!1,ae=!1,ce=!1,be=!1,Ce=!0,xe=!1;const ve="user-content-";let pe=!0,ie=!1,Ae={},_e=null;const rt=re({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let K=null;const Ge=re({},["audio","video","img","source","image","track"]);let J=null;const ke=re({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),te="http://www.w3.org/1998/Math/MathML",Ee="http://www.w3.org/2000/svg",fe="http://www.w3.org/1999/xhtml";let Oe=fe,it=!1,xt=null;const vt=re({},[te,Ee,fe],kn);let Ke=null;const at=["application/xhtml+xml","text/html"],Mt="text/html";let he=null,Se=null;const Je=R.createElement("form"),et=function(m){return m instanceof RegExp||m instanceof Function},ct=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Se&&Se===m)){if((!m||typeof m!="object")&&(m={}),m=Tt(m),Ke=at.indexOf(m.PARSER_MEDIA_TYPE)===-1?Mt:m.PARSER_MEDIA_TYPE,he=Ke==="application/xhtml+xml"?kn:gn,V=Ze(m,"ALLOWED_TAGS")?re({},m.ALLOWED_TAGS,he):W,q=Ze(m,"ALLOWED_ATTR")?re({},m.ALLOWED_ATTR,he):Y,xt=Ze(m,"ALLOWED_NAMESPACES")?re({},m.ALLOWED_NAMESPACES,kn):vt,J=Ze(m,"ADD_URI_SAFE_ATTR")?re(Tt(ke),m.ADD_URI_SAFE_ATTR,he):ke,K=Ze(m,"ADD_DATA_URI_TAGS")?re(Tt(Ge),m.ADD_DATA_URI_TAGS,he):Ge,_e=Ze(m,"FORBID_CONTENTS")?re({},m.FORBID_CONTENTS,he):rt,Z=Ze(m,"FORBID_TAGS")?re({},m.FORBID_TAGS,he):{},de=Ze(m,"FORBID_ATTR")?re({},m.FORBID_ATTR,he):{},Ae=Ze(m,"USE_PROFILES")?m.USE_PROFILES:!1,ne=m.ALLOW_ARIA_ATTR!==!1,ee=m.ALLOW_DATA_ATTR!==!1,le=m.ALLOW_UNKNOWN_PROTOCOLS||!1,se=m.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ue=m.SAFE_FOR_TEMPLATES||!1,Fe=m.SAFE_FOR_XML!==!1,ye=m.WHOLE_DOCUMENT||!1,ae=m.RETURN_DOM||!1,ce=m.RETURN_DOM_FRAGMENT||!1,be=m.RETURN_TRUSTED_TYPE||!1,Te=m.FORCE_BODY||!1,Ce=m.SANITIZE_DOM!==!1,xe=m.SANITIZE_NAMED_PROPS||!1,pe=m.KEEP_CONTENT!==!1,ie=m.IN_PLACE||!1,P=m.ALLOWED_URI_REGEXP||nr,Oe=m.NAMESPACE||fe,N=m.CUSTOM_ELEMENT_HANDLING||{},m.CUSTOM_ELEMENT_HANDLING&&et(m.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(N.tagNameCheck=m.CUSTOM_ELEMENT_HANDLING.tagNameCheck),m.CUSTOM_ELEMENT_HANDLING&&et(m.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(N.attributeNameCheck=m.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),m.CUSTOM_ELEMENT_HANDLING&&typeof m.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(N.allowCustomizedBuiltInElements=m.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ue&&(ee=!1),ce&&(ae=!0),Ae&&(V=re({},Ts),q=[],Ae.html===!0&&(re(V,ys),re(q,As)),Ae.svg===!0&&(re(V,On),re(q,Nn),re(q,hn)),Ae.svgFilters===!0&&(re(V,Un),re(q,Nn),re(q,hn)),Ae.mathMl===!0&&(re(V,Mn),re(q,Cs),re(q,hn))),m.ADD_TAGS&&(V===W&&(V=Tt(V)),re(V,m.ADD_TAGS,he)),m.ADD_ATTR&&(q===Y&&(q=Tt(q)),re(q,m.ADD_ATTR,he)),m.ADD_URI_SAFE_ATTR&&re(J,m.ADD_URI_SAFE_ATTR,he),m.FORBID_CONTENTS&&(_e===rt&&(_e=Tt(_e)),re(_e,m.FORBID_CONTENTS,he)),pe&&(V["#text"]=!0),ye&&re(V,["html","head","body"]),V.table&&(re(V,["tbody"]),delete Z.tbody),m.TRUSTED_TYPES_POLICY){if(typeof m.TRUSTED_TYPES_POLICY.createHTML!="function")throw Wt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof m.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Wt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');F=m.TRUSTED_TYPES_POLICY,H=F.createHTML("")}else F===void 0&&(F=Sa(d,e)),F!==null&&typeof H=="string"&&(H=F.createHTML(""));Le&&Le(m),Se=m}},He=re({},["mi","mo","mn","ms","mtext"]),$e=re({},["foreignobject","annotation-xml"]),Sn=re({},["title","style","font","a","script"]),Jt=re({},[...On,...Un,...ha]),en=re({},[...Mn,...ma]),tn=function(m){let S=L(m);(!S||!S.tagName)&&(S={namespaceURI:Oe,tagName:"template"});const $=gn(m.tagName),G=gn(S.tagName);return xt[m.namespaceURI]?m.namespaceURI===Ee?S.namespaceURI===fe?$==="svg":S.namespaceURI===te?$==="svg"&&(G==="annotation-xml"||He[G]):!!Jt[$]:m.namespaceURI===te?S.namespaceURI===fe?$==="math":S.namespaceURI===Ee?$==="math"&&$e[G]:!!en[$]:m.namespaceURI===fe?S.namespaceURI===Ee&&!$e[G]||S.namespaceURI===te&&!He[G]?!1:!en[$]&&(Sn[$]||!Jt[$]):!!(Ke==="application/xhtml+xml"&&xt[m.namespaceURI]):!1},Ve=function(m){$t(g.removed,{element:m});try{L(m).removeChild(m)}catch{O(m)}},wt=function(m,S){try{$t(g.removed,{attribute:S.getAttributeNode(m),from:S})}catch{$t(g.removed,{attribute:null,from:S})}if(S.removeAttribute(m),m==="is"&&!q[m])if(ae||ce)try{Ve(S)}catch{}else try{S.setAttribute(m,"")}catch{}},nn=function(m){let S=null,$=null;if(Te)m="<remove></remove>"+m;else{const Q=vs(m,/^[\r\n\t ]+/);$=Q&&Q[0]}Ke==="application/xhtml+xml"&&Oe===fe&&(m='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+m+"</body></html>");const G=F?F.createHTML(m):m;if(Oe===fe)try{S=new s().parseFromString(G,Ke)}catch{}if(!S||!S.documentElement){S=x.createDocument(Oe,"template",null);try{S.documentElement.innerHTML=it?H:G}catch{}}const X=S.body||S.documentElement;return m&&$&&X.insertBefore(R.createTextNode($),X.childNodes[0]||null),Oe===fe?f.call(S,ye?"html":"body")[0]:ye?S.documentElement:X},yt=function(m){return M.call(m.ownerDocument||m,m,w.SHOW_ELEMENT|w.SHOW_COMMENT|w.SHOW_TEXT|w.SHOW_PROCESSING_INSTRUCTION|w.SHOW_CDATA_SECTION,null)},sn=function(m){return m instanceof r&&(typeof m.nodeName!="string"||typeof m.textContent!="string"||typeof m.removeChild!="function"||!(m.attributes instanceof n)||typeof m.removeAttribute!="function"||typeof m.setAttribute!="function"||typeof m.namespaceURI!="string"||typeof m.insertBefore!="function"||typeof m.hasChildNodes!="function")},Nt=function(m){return typeof i=="function"&&m instanceof i},Ye=function(m,S,$){C[m]&&fn(C[m],G=>{G.call(g,S,$,Se)})},rn=function(m){let S=null;if(Ye("beforeSanitizeElements",m,null),sn(m))return Ve(m),!0;const $=he(m.nodeName);if(Ye("uponSanitizeElement",m,{tagName:$,allowedTags:V}),m.hasChildNodes()&&!Nt(m.firstElementChild)&&Me(/<[/\w]/g,m.innerHTML)&&Me(/<[/\w]/g,m.textContent)||m.nodeType===Vt.progressingInstruction||Fe&&m.nodeType===Vt.comment&&Me(/<[/\w]/g,m.data))return Ve(m),!0;if(!V[$]||Z[$]){if(!Z[$]&&on($)&&(N.tagNameCheck instanceof RegExp&&Me(N.tagNameCheck,$)||N.tagNameCheck instanceof Function&&N.tagNameCheck($)))return!1;if(pe&&!_e[$]){const G=L(m)||m.parentNode,X=B(m)||m.childNodes;if(X&&G){const Q=X.length;for(let ge=Q-1;ge>=0;--ge){const we=I(X[ge],!0);we.__removalCount=(m.__removalCount||0)+1,G.insertBefore(we,E(m))}}}return Ve(m),!0}return m instanceof v&&!tn(m)||($==="noscript"||$==="noembed"||$==="noframes")&&Me(/<\/no(script|embed|frames)/i,m.innerHTML)?(Ve(m),!0):(ue&&m.nodeType===Vt.text&&(S=m.textContent,fn([_,j,T],G=>{S=zt(S,G," ")}),m.textContent!==S&&($t(g.removed,{element:m.cloneNode()}),m.textContent=S)),Ye("afterSanitizeElements",m,null),!1)},an=function(m,S,$){if(Ce&&(S==="id"||S==="name")&&($ in R||$ in Je))return!1;if(!(ee&&!de[S]&&Me(k,S))){if(!(ne&&Me(p,S))){if(!q[S]||de[S]){if(!(on(m)&&(N.tagNameCheck instanceof RegExp&&Me(N.tagNameCheck,m)||N.tagNameCheck instanceof Function&&N.tagNameCheck(m))&&(N.attributeNameCheck instanceof RegExp&&Me(N.attributeNameCheck,S)||N.attributeNameCheck instanceof Function&&N.attributeNameCheck(S))||S==="is"&&N.allowCustomizedBuiltInElements&&(N.tagNameCheck instanceof RegExp&&Me(N.tagNameCheck,$)||N.tagNameCheck instanceof Function&&N.tagNameCheck($))))return!1}else if(!J[S]){if(!Me(P,zt($,U,""))){if(!((S==="src"||S==="xlink:href"||S==="href")&&m!=="script"&&ca($,"data:")===0&&K[m])){if(!(le&&!Me(l,zt($,U,"")))){if($)return!1}}}}}}return!0},on=function(m){return m!=="annotation-xml"&&vs(m,D)},ln=function(m){Ye("beforeSanitizeAttributes",m,null);const{attributes:S}=m;if(!S)return;const $={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:q};let G=S.length;for(;G--;){const X=S[G],{name:Q,namespaceURI:ge,value:we}=X,ot=he(Q);let De=Q==="value"?we:da(we);if($.attrName=ot,$.attrValue=De,$.keepAttr=!0,$.forceKeepAttr=void 0,Ye("uponSanitizeAttribute",m,$),De=$.attrValue,Fe&&Me(/((--!?|])>)|<\/(style|title)/i,De)){wt(Q,m);continue}if($.forceKeepAttr||(wt(Q,m),!$.keepAttr))continue;if(!se&&Me(/\/>/i,De)){wt(Q,m);continue}ue&&fn([_,j,T],_t=>{De=zt(De,_t," ")});const Lt=he(m.nodeName);if(an(Lt,ot,De)){if(xe&&(ot==="id"||ot==="name")&&(wt(Q,m),De=ve+De),F&&typeof d=="object"&&typeof d.getAttributeType=="function"&&!ge)switch(d.getAttributeType(Lt,ot)){case"TrustedHTML":{De=F.createHTML(De);break}case"TrustedScriptURL":{De=F.createScriptURL(De);break}}try{ge?m.setAttributeNS(ge,Q,De):m.setAttribute(Q,De),sn(m)?Ve(m):xs(g.removed)}catch{}}}Ye("afterSanitizeAttributes",m,null)},wn=function A(m){let S=null;const $=yt(m);for(Ye("beforeSanitizeShadowDOM",m,null);S=$.nextNode();)Ye("uponSanitizeShadowNode",S,null),!rn(S)&&(S.content instanceof t&&A(S.content),ln(S));Ye("afterSanitizeShadowDOM",m,null)};return g.sanitize=function(A){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},S=null,$=null,G=null,X=null;if(it=!A,it&&(A="<!-->"),typeof A!="string"&&!Nt(A))if(typeof A.toString=="function"){if(A=A.toString(),typeof A!="string")throw Wt("dirty is not a string, aborting")}else throw Wt("toString is not a function");if(!g.isSupported)return A;if(me||ct(m),g.removed=[],typeof A=="string"&&(ie=!1),ie){if(A.nodeName){const we=he(A.nodeName);if(!V[we]||Z[we])throw Wt("root node is forbidden and cannot be sanitized in-place")}}else if(A instanceof i)S=nn("<!---->"),$=S.ownerDocument.importNode(A,!0),$.nodeType===Vt.element&&$.nodeName==="BODY"||$.nodeName==="HTML"?S=$:S.appendChild($);else{if(!ae&&!ue&&!ye&&A.indexOf("<")===-1)return F&&be?F.createHTML(A):A;if(S=nn(A),!S)return ae?null:be?H:""}S&&Te&&Ve(S.firstChild);const Q=yt(ie?A:S);for(;G=Q.nextNode();)rn(G)||(G.content instanceof t&&wn(G.content),ln(G));if(ie)return A;if(ae){if(ce)for(X=h.call(S.ownerDocument);S.firstChild;)X.appendChild(S.firstChild);else X=S;return(q.shadowroot||q.shadowrootmode)&&(X=y.call(c,X,!0)),X}let ge=ye?S.outerHTML:S.innerHTML;return ye&&V["!doctype"]&&S.ownerDocument&&S.ownerDocument.doctype&&S.ownerDocument.doctype.name&&Me(sr,S.ownerDocument.doctype.name)&&(ge="<!DOCTYPE "+S.ownerDocument.doctype.name+`>
`+ge),ue&&fn([_,j,T],we=>{ge=zt(ge,we," ")}),F&&be?F.createHTML(ge):ge},g.setConfig=function(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ct(A),me=!0},g.clearConfig=function(){Se=null,me=!1},g.isValidAttribute=function(A,m,S){Se||ct({});const $=he(A),G=he(m);return an($,G,S)},g.addHook=function(A,m){typeof m=="function"&&(C[A]=C[A]||[],$t(C[A],m))},g.removeHook=function(A){if(C[A])return xs(C[A])},g.removeHooks=function(A){C[A]&&(C[A]=[])},g.removeAllHooks=function(){C={}},g}var Ln=rr();const st=({onChange:o,initialValue:g})=>{const[R,c]=z.useState(Ln.sanitize(g||"")),e=z.useRef(!1),t=z.useRef(null),[u,i]=z.useState("");z.useEffect(()=>{e.current?c(Ln.sanitize(g||"")):e.current=!0},[g]);const v=(d,b)=>{const I=b.getData(),O=Ln.sanitize(I);c(O),o(O)},w=d=>{if(!t.current){console.warn("Editor not initialized");return}const b=t.current;b.model.change(I=>{const O=b.model.document.selection.getFirstPosition();I.insertText(d,O)}),i("")},n=d=>{w(d.target.value)},r=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],s=["°","+","-","=","~","≥","≤","≠",">","<","*","/","%"];return a.jsxs("div",{children:[a.jsxs(qt,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%"},children:[a.jsx(yr,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),a.jsx(is,{variant:"standard",sx:{m:1,minWidth:40},children:a.jsxs(as,{labelId:"math-operators-label",id:"math-operators",value:u,onChange:n,displayEmpty:!0,children:[a.jsx(un,{value:"",disabled:!0,children:"Math"}),s.map(d=>a.jsx(un,{value:d,children:d},d))]})}),a.jsx(is,{variant:"standard",sx:{m:1,minWidth:40},children:a.jsxs(as,{labelId:"greek-letters-label",id:"greek-letters",value:u,onChange:n,displayEmpty:!0,children:[a.jsx(un,{value:"",disabled:!0,children:"Greek"}),r.map(d=>a.jsx(un,{value:d,children:d},d))]})})]}),a.jsx(Tr.CKEditor,{editor:Ar,data:R,onReady:d=>{t.current=d},config:{toolbar:["undo","redo","|","heading","bold","italic","|","bulletedList","numberedList","blockQuote","indent","outdent","|","link","insertTable","|"],table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]}},onChange:v})]})};var Jn={},wa=bt;Object.defineProperty(Jn,"__esModule",{value:!0});var ir=Jn.default=void 0,_a=wa(gt()),Ea=a;ir=Jn.default=(0,_a.default)((0,Ea.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile");var es={},ja=bt;Object.defineProperty(es,"__esModule",{value:!0});var ar=es.default=void 0,Ia=ja(gt()),Da=a;ar=es.default=(0,Ia.default)((0,Da.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload");const Ft=({path:o,initialFiles:g,onFilesChange:R,isOwnDesign:c})=>{const[e,t]=z.useState(g.map(y=>({...y,deleted:!!y.deleted}))),[u,i]=z.useState(!1),[v,w]=z.useState(0),[n,r]=z.useState({}),[s,d]=z.useState(!1),[b,I]=z.useState(""),[O,E]=z.useState("info"),B=z.useRef(null);z.useEffect(()=>{console.log("Initial files received:",g),t(g.map(y=>({...y,deleted:!!y.deleted})))},[g]),z.useEffect(()=>()=>{r({})},[]);const L=y=>{console.log("Updating files with",y),R(y),t(y)},F=async y=>{if(!y.target.files)return;const _=Array.from(y.target.files).filter(T=>T.size>5242880?(I("File size should not exceed 5 MB"),E("error"),d(!0),!1):!0);i(!0);const j=_.map(T=>{const k=new Date().getTime(),p=`${k}-${T.name}`,l=jt(),U=It(l,`${o}/${p}`),D=Fs(U,T);return new Promise((P,V)=>{D.on("state_changed",W=>{const q=W.bytesTransferred/W.totalBytes*100;w(q)},W=>{console.error("Upload failed:",W),V(W)},()=>{ks(D.snapshot.ref).then(W=>{P({id:k.toString(),url:W,name:T.name,path:U.fullPath})})})})});Promise.all(j).then(T=>{const k=[...e.filter(p=>!p.deleted),...T];L(k),I("Files uploaded successfully."),E("success"),d(!0),i(!1),w(0),B.current&&(B.current.value="")}).catch(T=>{console.error("Error uploading files: ",T),I("Failed to upload files."),E("error"),d(!0),i(!1),w(0)})},H=y=>{const C=e.map(_=>_.id===y?{..._,deleted:!0}:_);L(C),I("File marked for deletion. Update to permanently delete."),E("info"),d(!0)},x=y=>{r(C=>{var _;return{...C,[y]:((_=e.find(j=>j.id===y))==null?void 0:_.name)||""}}),console.log("editStates after handleEditClick:",n)},M=y=>{t(C=>{const _=C.map(j=>j.id===y&&n[y]!==void 0?{...j,name:n[y]}:j);return R(_),_}),r(C=>{const _={...C};return delete _[y],_}),I("File name updated successfully."),E("info"),d(!0)},h=(y,C)=>{r(_=>({..._,[y]:C}))},f=(y,C)=>{C!=="clickaway"&&d(!1)};return a.jsxs("div",{children:[c&&a.jsx(Qt,{title:"Upload Files",children:a.jsxs(Ne,{variant:"outlined",component:"label",startIcon:a.jsx(ar,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",a.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:F,disabled:u,ref:B})]})}),u&&a.jsx("div",{children:a.jsxs("p",{children:["Uploading... ",Math.round(v),"%"]})}),a.jsx(Cr,{children:e.map(y=>a.jsxs(Sr,{component:"div",disabled:y.deleted,children:[a.jsx(Fr,{children:a.jsx(ir,{})}),typeof n[y.id]=="string"?a.jsx(xn,{variant:"outlined",size:"small",value:n[y.id],onChange:C=>h(y.id,C.target.value),onKeyPress:C=>C.key==="Enter"&&M(y.id),fullWidth:!0}):a.jsx(wr,{primary:y.name,secondary:a.jsx("a",{href:y.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),c&&(typeof n[y.id]=="string"?a.jsx(qe,{onClick:()=>M(y.id),edge:"end","aria-label":"save",children:a.jsx(Hn,{})}):a.jsxs(a.Fragment,{children:[a.jsx(qe,{onClick:()=>x(y.id),edge:"end","aria-label":"edit",children:a.jsx(Rs,{})}),a.jsx(qe,{onClick:()=>H(y.id),edge:"end","aria-label":"delete",children:a.jsx(Xt,{})})]}))]},y.id))}),a.jsx(mt,{open:s,autoHideDuration:6e3,onClose:f,children:a.jsx(pt,{onClose:f,severity:O,sx:{width:"100%"},children:b})})]})},Ra=({designs:o,setDesigns:g,setIsAdding:R,getDesigns:c,onReturnToDashboard:e})=>{const{userDetails:t}=Ut();console.log("Add Design loaded");const[u,i]=z.useState(""),[v,w]=z.useState(""),[n,r]=z.useState([]),[s,d]=z.useState([]),b=z.useMemo(()=>n,[n]),[I,O]=z.useState(!1),[E,B]=z.useState(""),[L,F]=z.useState("info"),[H,x]=z.useState(!1),[M,h]=z.useState("");console.log("Adding New Design from user:",t);const f=z.useRef(null),y=()=>{x(!1)},C=(j,T)=>{T!=="clickaway"&&O(!1)},_=async j=>{var l;if(j.preventDefault(),console.log("Files to be saved:",s),!t||!t.uid){console.error("User object is undefined or missing UID."),h("You must be signed in to add a design."),x(!0);return}if(!u){h("All fields are required."),x(!0);return}await((l=f.current)==null?void 0:l.commitDeletions());const T=n.filter(U=>!U.deleted),k=s.filter(U=>!U.deleted).map(U=>({id:U.id,url:U.url,name:U.name,path:U.path})),p={title:v,description:u,dateCreated:Zt(),dateModified:Zt(),images:T,files:k,userId:t.uid};try{const U=await Gn(Re(oe,"designs"),p),D={...p,id:U.id};g([...o,D]),setTimeout(()=>{R(!1),c()},1e3),B(`${v} has been Added.`),F("success"),O(!0),w(""),i(""),r([]),d([])}catch(U){console.log(U),h("There was an issue adding your design."),x(!0)}};return a.jsxs("div",{className:"small-container",children:[a.jsx("button",{onClick:e,className:"muted-button margin-top-20",children:"← All Designs"}),a.jsx("div",{className:"design-record",children:a.jsxs("form",{onSubmit:_,children:[a.jsx("h1",{className:"designHeader",children:"New Design"}),a.jsx("div",{style:{display:"flex",alignItems:"center"},children:a.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[a.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),a.jsx("input",{id:"title",type:"text",name:"title",value:v,onChange:j=>w(j.target.value),style:{width:"100%"}})]})}),a.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),a.jsxs("ul",{children:[a.jsx("li",{children:"Objective: What is the goal for this design?"}),a.jsx("li",{children:"Rationale: Why is this new design being done?"}),a.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),a.jsx("li",{children:"Functional Modification: What is being done to this target?"}),a.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),a.jsx(st,{onChange:i,initialValue:u}),a.jsx(Rt,{ref:f,path:"designs/images",initialImages:b,onImagesUpdated:r,onDelete:j=>r(n.filter(T=>!j.includes(T)))}),a.jsx(Ft,{path:"designs/files",initialFiles:s,onFilesChange:d}),a.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[a.jsx(Ne,{type:"submit",variant:"contained",sx:{fontSize:"1rem",mt:2,textTransform:"none",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"Add"}),a.jsx(Ne,{onClick:()=>R(!1),style:{marginLeft:"12px"},variant:"outlined",sx:{fontSize:"1rem",mt:2,textTransform:"none",color:"currentColor",borderColor:"rgba(255, 0, 0, 0.5)",boxShadow:"none","&:hover":{borderColor:"rgba(255, 0, 0, 0.7)",backgroundColor:"rgba(255, 0, 0, 0.1)",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",color:"currentColor",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out, background-color 0.3s ease-in-out"},children:"Cancel"})]})]})}),a.jsxs(Ct,{open:H,onClose:y,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[a.jsx(kt,{id:"alert-dialog-title",children:"Notification"}),a.jsx(St,{children:a.jsx(Kt,{id:"alert-dialog-description",children:M})}),a.jsx(Ot,{children:a.jsx(Ne,{onClick:y,autoFocus:!0,children:"Ok"})})]}),a.jsx(mt,{open:I,autoHideDuration:1e3,onClose:C,children:a.jsx(pt,{onClose:C,severity:L,sx:{width:"100%"},children:E})})]})},Fa=({designId:o,setIsAddingBuild:g,refreshBuilds:R})=>{const[c,e]=z.useState(""),[t,u]=z.useState(""),[i,v]=z.useState([]),[w,n]=z.useState([]),{userDetails:r}=Ut(),s=C=>{v(C)},d=C=>{n(C)};console.log("AddBuild loaded");const[b,I]=z.useState(!1),[O,E]=z.useState(""),[B,L]=z.useState(!1),[F,H]=z.useState(""),[x,M]=z.useState("info");console.log("Adding New Build by user:",r);const h=()=>{I(!1)},f=(C,_)=>{_!=="clickaway"&&L(!1)},y=async C=>{if(C.preventDefault(),!r||!r.uid){console.error("UserDetails object is undefined or missing UID."),E("You must be signed in to add a build."),I(!0);return}if(!t){E("Build description is required."),I(!0);return}const _=i.filter(T=>!T.deleted),j=w.filter(T=>!T.deleted).map(T=>({id:T.id,url:T.url,name:T.name,path:T.path}));try{const T=await Gn(Re(oe,"builds"),{title:c,description:t,design_ID:o,dateCreated:Zt(),userId:r.uid,images:_,files:j});console.log("Build added with ID: ",T.id),console.log("Added New Build by user:",r),H("Your build has been successfully added."),M("success"),L(!0),setTimeout(()=>{e(""),u(""),v([]),n([]),g(!1),R()},1e3)}catch(T){if(console.error("Error adding build: ",T),T instanceof Error){let k=`Failed to add the build. ${T.message}`;T.message==="permission-denied"&&(k="You do not have permission to perform this operation."),H(k),M("error"),L(!0)}else H("Failed to add the build. Please try again later."),M("error"),L(!0)}};return a.jsxs("div",{className:"small-container",children:[a.jsxs("form",{onSubmit:y,children:[a.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),a.jsx("input",{id:"buildTitle",type:"text",value:c,onChange:C=>e(C.target.value),style:{width:"100%",marginBottom:"20px"}}),a.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),a.jsx(st,{onChange:u,initialValue:t})," ",a.jsx(Rt,{path:`builds/${o}/images`,initialImages:i,onImagesUpdated:s}),a.jsx(Ft,{path:`builds/${o}/files`,initialFiles:w,onFilesChange:d}),a.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[a.jsx("input",{type:"submit",value:"Save"}),a.jsx("button",{style:{marginLeft:"12px"},onClick:()=>g(!1),className:"button muted-button",children:"Cancel"})]})]}),a.jsxs(Ct,{open:b,onClose:h,children:[a.jsx(kt,{children:"Notification"}),a.jsx(St,{children:a.jsx(Kt,{children:O})}),a.jsx(Ot,{children:a.jsx(Ne,{onClick:h,children:"OK"})})]}),a.jsx(mt,{open:B,autoHideDuration:6e3,onClose:f,children:a.jsx(pt,{onClose:f,severity:x,sx:{width:"100%"},children:F})})]})},ka=({designId:o,buildId:g,refreshTests:R,setAddingTestIdForBuild:c})=>{const[e,t]=z.useState(""),[u,i]=z.useState(""),[v,w]=z.useState(""),[n,r]=z.useState(""),[s,d]=z.useState([]),[b,I]=z.useState([]),{userDetails:O}=Ut();console.log("AddTest loaded");const[E,B]=z.useState(!1),[L,F]=z.useState(""),[H,x]=z.useState(!1),[M,h]=z.useState(""),[f,y]=z.useState("info"),C=j=>{I(j)},_=async()=>{if(!u){F("Test description cannot be empty!"),B(!0);return}const j=s.filter(k=>!k.deleted),T=b.filter(k=>!k.deleted).map(k=>({id:k.id,url:k.url,name:k.name,path:k.path}));try{await Gn(Re(oe,"tests"),{title:e,build_ID:g,design_ID:o,dateCreated:Zt(),description:u,results:v,conclusions:n,userId:O==null?void 0:O.uid,images:j,files:T}),setTimeout(()=>{R(g),t(""),i(""),w(""),r(""),d([]),I([]),c(!1)},1e3),h("Test added successfully"),y("success"),x(!0)}catch(k){console.error("Error adding test: ",k),h("Failed to add the test"),y("error"),x(!0)}};return a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),a.jsx("input",{id:"testTitle",type:"text",value:e,onChange:j=>t(j.target.value),style:{width:"100%",marginBottom:"20px"}}),a.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),a.jsx(st,{onChange:i,initialValue:u}),a.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),a.jsx(st,{onChange:w,initialValue:v}),a.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),a.jsx(st,{onChange:r,initialValue:n}),a.jsx(Rt,{path:`tests/${g}/images`,initialImages:s,onImagesUpdated:j=>{d(j)}}),a.jsx(Ft,{path:`tests/${g}/files`,initialFiles:b,onFilesChange:C}),a.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[a.jsx("button",{onClick:_,children:"Save"}),a.jsx("button",{style:{marginLeft:"12px"},onClick:()=>c(!1),className:"button muted-button",children:"Cancel"})]}),a.jsxs(Ct,{open:E,onClose:()=>B(!1),children:[a.jsx(kt,{children:"Notification"}),a.jsx(St,{children:a.jsx(Kt,{children:L})}),a.jsx(Ot,{children:a.jsx(Ne,{onClick:()=>B(!1),children:"OK"})})]}),a.jsx(mt,{open:H,autoHideDuration:6e3,onClose:()=>x(!1),children:a.jsx(pt,{onClose:()=>x(!1),severity:f,sx:{width:"100%"},children:M})})]})};var ts={},Oa=bt;Object.defineProperty(ts,"__esModule",{value:!0});var bn=ts.default=void 0,Ua=Oa(gt()),Ma=a;bn=ts.default=(0,Ua.default)((0,Ma.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff");const Yt=o=>o&&o instanceof Wn?o.toDate().toLocaleString():"",Na=({selectedDesign:o,setIsEditing:g,getDesigns:R,onReturnToDashboard:c})=>{const{userDetails:e,loading:t}=Ut(),u=o.id,i=o.userId===(e==null?void 0:e.uid);console.log("Edit page loaded"),console.log("Design ID:",u),console.log("Editing Design by user:",e);const[v,w]=z.useState(""),[n,r]=z.useState(o.description),[s,d]=z.useState(Yt(o.dateCreated)),[b,I]=z.useState(Yt(o.dateModified)),[O,E]=z.useState([]),[B,L]=z.useState([]),F=z.useRef(null),[H,x]=z.useState(!1),[M,h]=z.useState([]),[f,y]=z.useState({}),[C,_]=z.useState({}),[j,T]=z.useState({}),k=z.useRef(null),[p,l]=z.useState({}),[U,D]=z.useState({}),[P,V]=z.useState({}),[W,q]=z.useState(!1),[Y,N]=z.useState({}),[Z,de]=z.useState({}),[ne,ee]=z.useState({}),[le,se]=z.useState({}),[ue,Fe]=z.useState({}),ye=z.useRef(null),[me,Te]=z.useState({}),[ae,ce]=z.useState({}),[be,Ce]=z.useState({}),[xe,ve]=z.useState(!1),[pe,ie]=z.useState(""),[Ae,_e]=z.useState(()=>{}),[rt,K]=z.useState(!1),[Ge,J]=z.useState(""),[ke,te]=z.useState("info"),[Ee,fe]=z.useState({design:!1,builds:!1,tests:!1}),Oe=async A=>{if(A.preventDefault(),!n){ie("All fields are required."),ve(!0);return}console.log("About to check image deletions",F.current),console.log(F.current),console.log(O.some(G=>G.deleted)),F.current&&O.some(G=>G.deleted)&&(console.log("Committing deletions"),await F.current.commitDeletions());const m=O.filter(G=>!G.deleted);B.some(G=>G.deleted)&&await vt();const S=B.filter(G=>!G.deleted);let $={title:v,description:n,dateModified:Zt(),images:m.map(G=>({url:G.url,title:G.title,path:G.path})),files:S.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path})),userId:e.uid};try{await ut(Ie(oe,"designs",u),$,{merge:!0}),J("Your design has been updated."),te("success"),K(!0);const G=Wn.now();I(Yt(G))}catch(G){console.error("Error updating design:",G),J("There was an issue updating your design."),te("error"),K(!0)}fe(G=>({...G,design:!1}))};z.useEffect(()=>{o&&(r(o.description||""),w(o.title||""),(async()=>{const m=Ie(oe,"designs",u),S=await _r(m);if(S.exists()){const $=S.data();console.log("Fetched images:",$.images),console.log("Fetched files:",$.files),E($.images||[]),L($.files||[]),d(Yt($.dateCreated)),I(Yt($.dateModified))}})())},[o,u]);const it=A=>{const m=O.filter($=>!A.some(G=>G.path===$.path));console.log("Remaining images after deletion:",m),E(m);const S=m.map($=>({url:$.url,title:$.title,path:$.path}));ut(Ie(oe,"designs",u),{images:S},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch($=>console.error("Failed to update Firestore:",$))},xt=A=>{JSON.stringify(O)!==JSON.stringify(A)&&(E(A),console.log("Updated images received:",A))},vt=async()=>{const A=B.filter(m=>m.deleted);if(console.log("Files to delete:",A),A.length>0){const m=jt(),S=A.map($=>{const G=It(m,$.path);return mn(G)});try{await Promise.all(S),console.log("Files deleted successfully");const $=B.filter(G=>!G.deleted);L($),await jn(Ie(oe,"designs",o.id),{files:$.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path}))}),J("Deleted files have been permanently removed."),te("success"),K(!0)}catch($){console.error("Failed to delete files: ",$),J("Failed to delete files."),te("error"),K(!0)}}},Ke=async A=>{var G,X;try{await Sn(A)}catch(Q){console.error("Error deleting files:",Q),J("Failed to delete build files."),te("error"),K(!0)}const m=((G=C[A])==null?void 0:G.filter(Q=>!Q.deleted).map(({url:Q,path:ge,title:we})=>({url:Q,path:ge,title:we})))||[],S=((X=j[A])==null?void 0:X.filter(Q=>!Q.deleted).map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path})))||[],$={};m.length>0&&($.images=m),S.length>0&&($.files=S),f[A]!==void 0&&($.description=f[A]);try{const Q=Ie(oe,"builds",A);await ut(Q,$,{merge:!0}),J("Your build has been updated."),te("success"),K(!0),Se(),fe(ge=>({...ge,builds:!1}))}catch(Q){console.error("Error updating build:",Q),J("Failed to update build."),te("error"),K(!0)}},at=(A,m)=>{D(S=>({...S,[A]:m}))},Mt=(A,m)=>{y(S=>({...S,[A]:m})),fe(S=>({...S,builds:!0}))},he=async A=>{const m=U[A];try{const S=Ie(oe,"builds",A);await ut(S,{title:m},{merge:!0}),D($=>{const G={...$};return delete G[A],G}),Se()}catch(S){console.error("Failed to save build title:",S)}},Se=async()=>{if(!e){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",e==null?void 0:e.uid),console.log("Selected design ID for query:",o==null?void 0:o.id);let A;e.isAdmin?A=Pe(Re(oe,"builds"),je("design_ID","==",u),tt("dateCreated")):A=Pe(Re(oe,"builds"),je("design_ID","==",u),je("userId","==",e.uid),tt("dateCreated")),console.log("Builds query details:",JSON.stringify(A,null,2));const m=await ft(A);console.log("Builds snapshot details:",JSON.stringify(m.docs.map($=>$.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",m.docs.length);const S=m.docs.map($=>(console.log("Build doc path: ",$.ref.path),{id:$.id,...$.data()}));h(S),console.log("New builds state after refresh:",S)}catch(A){console.error("Error refreshing builds:",A),A.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",A):console.error("An unexpected error occurred when trying to refresh builds:",A)}},Je=(A,m)=>{const S=Ie(oe,"builds",A),$=C[A].filter(X=>!m.some(Q=>Q.path===X.path));_(X=>({...X,[A]:$}));const G=$.map(X=>({url:X.url,title:X.title,path:X.path}));ut(S,{images:G},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),J("Build Image deletions updated."),te("success")}).catch(X=>{console.error("Failed to update build images in Firestore:",X),J("Failed to update build image deletions."),te("error")}),K(!0)},et=async A=>{const m=Pe(Re(oe,"tests"),je("build_ID","==",A),je("userId","==",e.uid)),S=await ft(m);for(const $ of S.docs)await Dt(Ie(oe,"tests",$.id));await Dt(Ie(oe,"builds",A)),await Se(),J("Build and its tests (if any) deleted successfully."),te("success"),K(!0)},ct=A=>{ie("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),_e(()=>()=>et(A)),ve(!0)},He=(A,m)=>{_(S=>({...S,[A]:m}))},$e=(A,m)=>{T(S=>({...S,[A]:m}))},Sn=async A=>{var S;const m=((S=j[A])==null?void 0:S.filter($=>$.deleted))||[];if(console.log("Build files to delete:",m),m.length>0){const $=jt(),G=m.map(X=>{const Q=It($,X.path);return mn(Q)});try{await Promise.all(G),console.log("Build files deleted successfully");const X=j[A].filter(Q=>!Q.deleted);T(Q=>({...Q,[A]:X})),await jn(Ie(oe,"builds",A),{files:X.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path}))}),console.log("Firestore successfully updated to remove deleted files"),J("Deleted build files have been permanently removed."),te("success"),K(!0)}catch(X){console.error("Failed to delete build files: ",X),J("Failed to delete build files."),te("error"),K(!0)}}},Jt=async(A,m)=>{var X;try{await rn(A)}catch(Q){console.error("Error deleting files:",Q),J("Failed to delete build files."),te("error"),K(!0)}const S={},$=le[A].filter(Q=>!Q.deleted).map(({url:Q,path:ge,title:we})=>({url:Q,path:ge,title:we})),G=((X=ue[A])==null?void 0:X.filter(Q=>!Q.deleted).map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path})))||[];Y[A]!==void 0&&(S.description=Y[A]),Z[A]!==void 0&&(S.results=Z[A]),ne[A]!==void 0&&(S.conclusions=ne[A]),S.images=$,S.files=G;try{const Q=Ie(oe,"tests",A);await ut(Q,S,{merge:!0}),J("Your test has been updated."),te("success"),K(!0),yt(m)}catch(Q){console.error(`Error updating test ID: ${A}:`,Q),J("There was an issue updating your test."),te("error"),K(!0)}},en=(A,m)=>{ce(S=>({...S,[A]:m}))},tn=async(A,m)=>{const S=ae[A],$=Ie(oe,"tests",A);await ut($,{title:S},{merge:!0}),ce(G=>{const X={...G};return delete X[A],X}),yt(m)},Ve=(A,m)=>{console.log(`Updating description for test ID ${A}:`,m),N(S=>({...S,[A]:m})),fe(S=>({...S,tests:!0}))},wt=(A,m)=>{console.log(`Updating results for test ID ${A}:`,m),de(S=>({...S,[A]:m})),fe(S=>({...S,tests:!0}))},nn=(A,m)=>{ee(S=>({...S,[A]:m})),fe(S=>({...S,tests:!0}))};z.useEffect(()=>{!t&&e&&(async()=>{if(!e)return;let m;e.isAdmin?m=Pe(Re(oe,"builds"),je("design_ID","==",u),tt("dateCreated")):m=Pe(Re(oe,"builds"),je("design_ID","==",u),je("userId","==",e.uid),tt("dateCreated"));const S=await ft(m);let $=[],G={},X={};for(const Q of S.docs){const ge=Q.data(),we=Q.id;$.push({id:we,...ge,images:ge.images||[],files:ge.files||[]}),X[we]=!0;let ot;e.isAdmin?ot=Pe(Re(oe,"tests"),je("build_ID","==",we),tt("dateCreated")):ot=Pe(Re(oe,"tests"),je("build_ID","==",we),je("userId","==",e.uid),tt("dateCreated"));const De=await ft(ot);let Lt=[],_t={},_n={};for(const dt of De.docs){const lt=dt.data();Lt.push({id:dt.id,...lt}),_t[dt.id]=lt.images||[],_n[dt.id]=lt.files||[]}G[we]=Lt,se(dt=>{let lt={...dt};for(const Pt in _t)lt[Pt]=_t[Pt];return lt}),Fe(dt=>{let lt={...dt};for(const Pt in _n)lt[Pt]=_n[Pt];return lt})}h($),V(G),Ce(X)})()},[t,e,o.id,u]);const yt=async A=>{if(!e){console.log("User details not loaded yet");return}try{let m;e.isAdmin?m=Pe(Re(oe,"tests"),je("build_ID","==",A),tt("dateCreated")):m=Pe(Re(oe,"tests"),je("build_ID","==",A),je("userId","==",e.uid),tt("dateCreated"));const $=(await ft(m)).docs.map(Q=>({id:Q.id,...Q.data(),images:Q.data().images||[],files:Q.data().files||[]}));V(Q=>({...Q,[A]:$}));let G={},X={};$.forEach(Q=>{G[Q.id]=Q.images,X[Q.id]=Q.files}),se(G),Fe(X)}catch(m){console.error("Error fetching tests:",m)}},sn=(A,m)=>{const S=Ie(oe,"tests",A),$=le[A].filter(X=>!m.includes(X));se(X=>({...X,[A]:$}));const G=$.map(({url:X,path:Q,title:ge})=>({url:X,path:Q,title:ge}));ut(S,{images:G},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),J("Test Image deletions updated."),te("success")}).catch(X=>{console.error("Failed to update test images in Firestore:",X),J("Failed to update test image deletions."),te("error")}),K(!0)},Nt=(A,m)=>{se(S=>({...S,[A]:m}))},Ye=(A,m)=>{Fe(S=>({...S,[A]:m}))},rn=async A=>{var S;const m=((S=ue[A])==null?void 0:S.filter($=>$.deleted))||[];if(m.length>0){const $=jt(),G=m.map(X=>{const Q=It($,X.path);return mn(Q)});try{await Promise.all(G);const X=ue[A].filter(Q=>!Q.deleted);Fe(Q=>({...Q,[A]:X})),await jn(Ie(oe,"tests",A),{files:X.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path}))}),J("Deleted test files have been permanently removed."),te("success"),K(!0)}catch(X){console.error("Failed to delete test files: ",X),J("Failed to delete test files."),te("error"),K(!0)}}},an=async(A,m)=>{await Dt(Ie(oe,"tests",A)),await yt(m),J("Test deleted successfully."),te("success"),K(!0)},on=(A,m)=>{ie("Are you sure you want to delete this test? This action cannot be undone."),_e(()=>()=>an(A,m)),ve(!0)},ln=A=>{Ce(m=>({...m,[A]:!m[A]}))},wn=()=>{const A=Object.entries(Ee).filter(([S,$])=>$).map(([S])=>S).join(", ");if(!A.length){c();return}const m=`You have unsaved changes in the following sections: ${A}. Are you sure you want to leave?`;ie(m),_e(()=>()=>{fe({design:!1,builds:!1,tests:!1}),c()}),ve(!0)};return z.useEffect(()=>{const A=m=>{Object.values(Ee).some($=>$)&&(m.preventDefault(),m.returnValue="")};return window.addEventListener("beforeunload",A),()=>window.removeEventListener("beforeunload",A)},[Ee]),a.jsxs("div",{className:"small-container",children:[a.jsx("button",{onClick:()=>{Object.values(Ee).some(m=>m)?wn():c()},className:"muted-button margin-top-20",children:"← All Designs"}),a.jsx("div",{className:"design-record",children:a.jsxs("form",{onSubmit:Oe,children:[a.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),a.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[a.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[a.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),a.jsx("input",{id:"title",type:"text",name:"title",value:v,onChange:A=>{w(A.target.value),fe(m=>({...m,design:!0}))},style:{width:"100%"}})]}),a.jsxs("div",{style:{flexGrow:2},children:[a.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),a.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:s||"",readOnly:!0,style:{width:"100%"}})]}),a.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[a.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),a.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:b||"",readOnly:!0,style:{width:"100%"}})]})]}),a.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),a.jsxs("ul",{children:[a.jsx("li",{children:"Objective: What is the goal for this design?"}),a.jsx("li",{children:"Rationale: Why is this new design being done?"}),a.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),a.jsx("li",{children:"Functional Modification: What is being done to this target?"}),a.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),a.jsx(st,{initialValue:n,onChange:A=>{r(A),fe(m=>({...m,design:!0}))}}),a.jsx(Rt,{ref:F,path:`designs/${o.id}/images`,initialImages:O,onImagesUpdated:xt,onDelete:it,isOwnDesign:i}),a.jsx(Ft,{path:`designs/${o.id}/files`,initialFiles:B,onFilesChange:L,isOwnDesign:i}),i&&a.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[a.jsx("input",{type:"submit",value:"Update"}),a.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>g(!1),children:"Cancel"})]})]})}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex-space-between",children:[a.jsx("h2",{className:"buildsHeader",children:"Builds"}),i&&a.jsxs("button",{className:"button muted-button",onClick:()=>{x(!0),setTimeout(()=>{k.current&&k.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[a.jsx("span",{role:"img","aria-label":"Add Build",children:"➕"})," Build"]})]}),M.map((A,m)=>a.jsxs("div",{className:"build-record",children:[a.jsxs("div",{className:"flex-space-between align-items-center",children:[a.jsx("div",{children:U[A.id]!==void 0?a.jsx(xn,{variant:"outlined",size:"small",fullWidth:!0,value:U[A.id],onChange:S=>at(A.id,S.target.value),onBlur:()=>he(A.id),autoFocus:!0,InputProps:{endAdornment:a.jsx(qe,{onClick:()=>he(A.id),size:"small",children:a.jsx(Hn,{})})}}):a.jsx("div",{className:"buildTitle",onClick:()=>D(S=>({...S,[A.id]:A.title||`Build ${m+1}`})),style:{cursor:"pointer"},children:A.title||`Build ${m+1}`})}),a.jsxs("div",{children:[a.jsx("button",{onClick:()=>l(S=>({...S,[A.id]:!S[A.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:p[A.id]?a.jsx(bn,{}):a.jsx(In,{})}),i&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>ct(A.id),children:a.jsx(Xt,{})}),a.jsxs("button",{className:"button muted-button",onClick:()=>{q(A.id),setTimeout(()=>{ye.current&&ye.current.scrollIntoView({behavior:"smooth"})},100)},children:[a.jsx("span",{role:"img","aria-label":"Add Test",children:"➕"})," Test"]})]})]})]}),p[A.id]&&a.jsxs(a.Fragment,{children:[a.jsx(st,{initialValue:f[A.id]||A.description,onChange:S=>{Mt(A.id,S)}}),a.jsx(Rt,{path:`builds/${A.id}/images`,initialImages:A.images,onImagesUpdated:S=>He(A.id,S),onDelete:S=>Je(A.id,S),isOwnDesign:i}),a.jsx(Ft,{path:`builds/${A.id}/files`,initialFiles:A.files,onFilesChange:S=>$e(A.id,S),isOwnDesign:i}),i&&a.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:a.jsx("button",{onClick:()=>Ke(A.id),children:"Update"})}),a.jsx("div",{children:P[A.id]&&P[A.id].length>0&&a.jsx("button",{onClick:()=>ln(A.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:be[A.id]?a.jsxs(a.Fragment,{children:[a.jsx(In,{style:{marginRight:"8px"}}),"Tests"]}):a.jsxs(a.Fragment,{children:[a.jsx(bn,{style:{marginRight:"8px"}}),"Tests"]})})}),!be[A.id]&&P[A.id]&&P[A.id].map((S,$)=>a.jsxs("div",{className:"test-record",children:[a.jsxs("div",{className:"flex-space-between align-items-center",children:[a.jsx("div",{children:ae[S.id]!==void 0?a.jsx(xn,{variant:"outlined",size:"small",fullWidth:!0,value:ae[S.id],onChange:G=>en(S.id,G.target.value),onBlur:()=>tn(S.id,A.id),autoFocus:!0,InputProps:{endAdornment:a.jsx(qe,{onClick:()=>tn(S.id,A.id),size:"small",children:a.jsx(Hn,{})})}}):a.jsx("div",{className:"testTitle",onClick:()=>ce(G=>({...G,[S.id]:S.title||`Test ${$+1}`})),style:{cursor:"pointer"},children:S.title||`Test ${$+1}`})}),a.jsxs("div",{children:[a.jsx("button",{onClick:()=>Te(G=>({...G,[S.id]:!G[S.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:me[S.id]?a.jsx(bn,{}):a.jsx(In,{})}),i&&a.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>on(S.id,A.id),children:a.jsx(Xt,{})})]})]}),me[S.id]&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",children:"Description"}),a.jsx(st,{initialValue:Y[S.id]||S.description,onChange:G=>{Ve(S.id,G)}})]}),a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",children:"Results"}),a.jsx(st,{initialValue:Z[S.id]||S.results,onChange:G=>{wt(S.id,G)}})]}),a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",children:"Conclusions"}),a.jsx(st,{initialValue:ne[S.id]||S.conclusions,onChange:G=>{nn(S.id,G)}})]}),a.jsxs("div",{children:[a.jsx(Rt,{path:`tests/${S.id}/images`,initialImages:le[S.id]||[],onImagesUpdated:G=>Nt(S.id,G),onDelete:G=>sn(S.id,G),isOwnDesign:i}),a.jsx(Ft,{path:`tests/${S.id}/files`,initialFiles:ue[S.id]||[],onFilesChange:G=>Ye(S.id,G),isOwnDesign:i})]}),i&&a.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:a.jsx("button",{onClick:()=>Jt(S.id,A.id),children:"Update"})})]})]},S.id))]}),W===A.id&&a.jsxs("div",{className:"new-test-record",ref:ye,children:[a.jsx("h3",{className:"newTestHeader",children:"New Test"}),a.jsx(ka,{designId:o.id,buildId:A.id,refreshTests:()=>yt(A.id),setAddingTestIdForBuild:q,onImagesUpdated:S=>Nt(A.id,S),onFilesChange:S=>Ye(A.id,S)})]})]},A.id)),a.jsx("div",{children:H&&a.jsxs("div",{className:"new-build-record",ref:k,children:[a.jsx("h3",{className:"newBuildHeader",children:"New Build"}),a.jsx(Fa,{designId:o.id,setIsAddingBuild:x,refreshBuilds:Se,onImagesUpdated:A=>He(build.id,A),onFilesChange:A=>$e(build.id,A)})]})})]}),a.jsxs(Ct,{open:xe,onClose:()=>ve(!1),children:[a.jsx(kt,{children:"Confirmation Required"}),a.jsx(St,{children:a.jsx(Kt,{children:pe})}),a.jsxs(Ot,{children:[a.jsx(Ne,{onClick:()=>ve(!1),children:"Cancel"}),a.jsx(Ne,{onClick:()=>{Ae(),ve(!1)},autoFocus:!0,children:"Confirm"})]})]}),a.jsx(mt,{open:rt,autoHideDuration:6e3,onClose:()=>K(!1),children:a.jsx(pt,{onClose:()=>K(!1),severity:ke,sx:{width:"100%"},children:Ge})})]})},La=()=>{const{userDetails:o,loading:g}=Ut();console.log("Dashboard loaded");const[R,c]=z.useState([]),[e,t]=z.useState([]),[u,i]=z.useState(null),[v,w]=z.useState(!1),[n,r]=z.useState(!1),[s,d]=z.useState(!1),[b,I]=z.useState(""),[O,E]=z.useState(""),[B,L]=z.useState(!1),[F,H]=z.useState(null),[x,M]=z.useState(!1),[h,f]=z.useState(""),[y,C]=z.useState("info"),_=()=>{r(!1),w(!1),i(null),j()},j=z.useCallback(async()=>{let l;o&&o.isAdmin?l=Pe(Re(oe,"designs"),tt("dateCreated","desc")):o&&(l=Pe(Re(oe,"designs"),je("userId","==",o.uid),tt("dateCreated","desc")));const U=await ft(l||Pe(Re(oe,"designs"))),D=[],P=[];U.forEach(V=>{const W=V.data(),q={id:V.id,title:W.title,description:W.description,dateCreated:W.dateCreated,dateModified:W.dateModified,userId:W.userId,images:W.images||[],files:W.files||[]};W.userId===(o==null?void 0:o.uid)?D.push(q):P.push(q)}),c(D),t(P)},[o]);z.useEffect(()=>{!g&&o&&j()},[o,g,j]);const T=l=>{const U=[...R,...e].find(D=>D.id===l);i(U||null),r(!0)},k=l=>{H(l),I("Are you sure you want to delete this design? This action cannot be undone."),d(!0)},p=async()=>{if(F)if(O!==(o==null?void 0:o.uid))f("User ID confirmation failed. Enter the correct User ID."),C("error"),M(!0);else try{const l=Pe(Re(oe,"builds"),je("design_ID","==",F),je("userId","==",o.uid)),U=await ft(l);for(const D of U.docs){const P=D.id,V=Pe(Re(oe,"tests"),je("build_ID","==",P),je("userId","==",o.uid)),W=await ft(V);for(const q of W.docs)await Dt(Ie(oe,"tests",q.id));await Dt(Ie(oe,"builds",P))}await Dt(Ie(oe,"designs",F)),c(D=>D.filter(P=>P.id!==F)),t(D=>D.filter(P=>P.id!==F)),f("Your design and its associated builds and tests have been deleted."),C("success"),M(!0)}catch(l){console.error("Error deleting design, builds, and tests: ",l),f("There was an issue deleting your design and its associated builds and tests."),C("error"),M(!0)}finally{E(""),L(!1),H(null)}};return a.jsxs("div",{className:"container",children:[!v&&!n&&a.jsxs(a.Fragment,{children:[a.jsx(Lr,{setIsAdding:w}),(o==null?void 0:o.isAdmin)&&a.jsxs(a.Fragment,{children:[a.jsx("h2",{children:"Admin Designs"}),a.jsx(Dn,{designs:R,handleEdit:T,handleDelete:k,isAdmin:!0,userDetails:o,showUserIdColumn:!0}),a.jsx("h2",{children:"Users' Designs"}),a.jsx(Dn,{designs:e,handleEdit:T,handleDelete:k,isAdmin:!1,userDetails:o,showUserIdColumn:!0})]}),!(o!=null&&o.isAdmin)&&a.jsx(Dn,{designs:R,handleEdit:T,handleDelete:k,isAdmin:!1,userDetails:o,showUserIdColumn:!1})]}),v&&a.jsx(Ra,{designs:R,setDesigns:c,setIsAdding:w,getDesigns:j,onReturnToDashboard:_}),n&&a.jsx(Na,{designs:R,selectedDesign:u,setDesigns:c,setIsEditing:r,getDesigns:j,onReturnToDashboard:_}),a.jsxs(Ct,{open:s,onClose:()=>d(!1),PaperProps:{style:{minWidth:500}},children:[a.jsx(kt,{children:"Confirm Deletion"}),a.jsx(St,{children:a.jsx(Kt,{children:b})}),a.jsxs(Ot,{children:[a.jsx(Ne,{onClick:()=>d(!1),children:"No, cancel"}),a.jsx(Ne,{onClick:()=>{L(!0),d(!1)},color:"primary",children:"Yes, delete it"})]})]}),a.jsxs(Ct,{open:B,onClose:()=>L(!1),PaperProps:{style:{minWidth:500}},children:[a.jsx(kt,{children:"Confirm Your User ID"}),a.jsx(St,{children:a.jsx(xn,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:O,onChange:l=>E(l.target.value)})}),a.jsxs(Ot,{children:[a.jsx(Ne,{onClick:()=>L(!1),children:"No, cancel"}),a.jsx(Ne,{onClick:p,color:"primary",children:"Confirm"})]})]}),a.jsx(mt,{open:x,autoHideDuration:6e3,onClose:()=>M(!1),children:a.jsx(pt,{onClose:()=>M(!1),severity:y,sx:{width:"100%"},children:h})})]})},Ha=Er.memo(La);export{Ha as default};
