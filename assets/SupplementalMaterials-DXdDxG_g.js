import{H as D,j as e,B as l,p as h,T as n,ax as E,Y as _,ag as q,Z as O,ah as z,ai as Q,ao as Y,av as se,aq as le,af as M,e as d,ar as $,at as H,as as k,al as L,ay as ne,az as te,G as b,aA as S,Q as c,R as F,U as A,t as ae,A as re}from"./index-B3FOySSA.js";import{d as w}from"./Visibility-CuQtHMN8.js";const de=()=>{const s=D(),r=()=>{s("/")};return e.jsxs(l,{children:[e.jsx(l,{className:"supplemental-header",children:e.jsx(h,{variant:"text",onClick:r,className:"supplemental-back-button",children:"â† Home Page"})}),e.jsx(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:e.jsx(n,{className:"supplemental-title",children:"Course Materials"})})]})},oe=()=>{const s=D();return e.jsx(h,{className:"add-material-button",variant:"contained",color:"primary",onClick:()=>s("/add-material"),children:"+ Add Material"})},ce=({materialId:s,open:r,onClose:t,onDelete:o})=>{const x=E(),a=async()=>{const u=Y(x,"materials",s);await se(u),o(),t()};return e.jsxs(_,{open:r,onClose:t,children:[e.jsx(q,{children:"Delete Material"}),e.jsx(O,{children:e.jsx(z,{children:"Are you sure you want to delete this material? This action cannot be undone."})}),e.jsxs(Q,{children:[e.jsx(h,{onClick:t,color:"primary",children:"Cancel"}),e.jsx(h,{onClick:a,color:"secondary",children:"Delete"})]})]})},G=({materialId:s,onClick:r})=>e.jsx(h,{variant:"contained",color:"error",onClick:()=>r(s),sx:{backgroundColor:"#FFCDD2",color:"#C62828",borderRadius:"15px",fontWeight:"bold",padding:"4px 8px",ml:1,textTransform:"none"},children:"Unpublish"}),xe=({materialId:s,open:r,onClose:t,onUnpublish:o})=>{const x=E(),a=async()=>{const u=Y(x,"materials",s);await le(u,{published:!1}),o(),t()};return e.jsxs(_,{open:r,onClose:t,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(q,{id:"alert-dialog-title",children:"Unpublish Material"}),e.jsx(O,{children:e.jsx(z,{id:"alert-dialog-description",children:"Are you sure you want to unpublish this material? It will no longer be visible to users until it is published again."})}),e.jsxs(Q,{children:[e.jsx(h,{onClick:t,color:"primary",children:"Cancel"}),e.jsx(h,{onClick:a,color:"error",autoFocus:!0,children:"Unpublish"})]})]})},he=({selectedCourse:s,onCourseChange:r})=>{const{userDetails:t}=M(),[o,x]=d.useState([{id:"public",number:"Public",title:"Public"}]);return d.useEffect(()=>{if(t!=null&&t.classes){const a=Object.entries(t.classes).map(([u,j])=>({id:u,number:j.number,title:j.title}));x([{id:"public",number:"Public",title:"Public"},...a])}else x([{id:"public",number:"Public",title:"Public"}])},[t]),e.jsx(l,{sx:{display:"flex",gap:2,mb:2},children:o.map(a=>e.jsxs(h,{variant:s===a.id?"contained":"outlined",onClick:()=>r(a.id),children:[a.number," - ",a.title]},a.id))})},ue=()=>{const{userDetails:s}=M(),r=E(),[t,o]=d.useState([]),[x,a]=d.useState(!0),[u,j]=d.useState(!1),[m,Z]=d.useState("Public"),[f,R]=d.useState(null),[g,U]=d.useState({open:!1,materialId:null}),[I,C]=d.useState(null),p=D();d.useEffect(()=>{if(!s)return;a(!0);const i=s.isAdmin?$(L(r,"materials"),k("course","==",m),H("timestamp","desc")):$(L(r,"materials"),k("course","==",m),k("published","==",!0),H("timestamp","desc")),ee=ne(i,v=>{const ie=v.docs.map(B=>({id:B.id,...B.data()}));o(ie),a(!1)},v=>{console.error(v),C("Failed to fetch materials"),a(!1)});return()=>ee()},[r,s,m]);const y=i=>{R(i),j(!0)},J=()=>{j(!1),R(null)},K=()=>{o(t.filter(i=>i.id!==f))},P=i=>{U({open:!0,materialId:i})},V=()=>{o(t.map(i=>i.id===g.materialId?{...i,published:!1}:i))},X=()=>{U({open:!1,materialId:null})};if(x)return e.jsx(te,{});const N=t.filter(i=>!i.published&&!i.scheduledTimestamp),W=t.filter(i=>i.scheduledTimestamp&&!i.published),T=t.filter(i=>i.published);return e.jsxs(l,{sx:{width:"100%"},children:[e.jsx(he,{selectedCourse:m,onCourseChange:i=>{a(!0),Z(i)}}),(s==null?void 0:s.isAdmin)&&e.jsxs(e.Fragment,{children:[e.jsx(l,{sx:{backgroundColor:"#FFF9C4",borderRadius:"8px",padding:"4px 8px",display:"inline-block",mb:2},children:e.jsx(n,{variant:"h6",sx:{fontWeight:"bold",color:"#F57C00"},children:"Saved"})}),e.jsx(b,{container:!0,spacing:3,children:N.length===0?e.jsx(n,{variant:"body1",align:"center",sx:{width:"100%"},children:"No saved (unpublished) materials found."}):N.map(i=>e.jsx(b,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(l,{sx:{border:"1px solid #ddd",borderRadius:"8px",padding:2,position:"relative",backgroundColor:"#FFF9C4"},children:[e.jsx(l,{children:i.author===(s==null?void 0:s.uid)&&e.jsx(S,{label:"My Material",variant:"outlined",sx:{borderRadius:"15px",fontWeight:"bold",background:"#C5E1A5",color:"#2E7D32",ml:1}})}),e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(c,{onClick:()=>p(`/view-material/${i.id}`),"aria-label":"view",children:e.jsx(w,{})}),e.jsx(n,{variant:"h6",children:i.title||"Untitled"})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(n,{variant:"body2",color:"textSecondary",children:["Created Date: ",i.timestamp.toDate().toLocaleString()]}),e.jsx(n,{variant:"body2",color:"textSecondary",children:"Status: Saved"})]}),e.jsx(l,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1},children:(s==null?void 0:s.isAdmin)&&e.jsxs(e.Fragment,{children:[e.jsx(c,{onClick:()=>p(`/edit-material/${i.id}`),"aria-label":"edit",children:e.jsx(F,{})}),e.jsx(c,{onClick:()=>y(i.id),"aria-label":"delete",children:e.jsx(A,{})})]})}),e.jsx(l,{sx:{backgroundColor:"#E0F7FA",borderRadius:"8px",padding:"4px 8px",display:"inline-block",mt:2},children:e.jsx(n,{variant:"body2",sx:{color:"#00796B",fontWeight:"bold"},children:i.course||"N/A"})})]})},i.id))}),e.jsx(l,{sx:{backgroundColor:"#E3F2FD",borderRadius:"8px",padding:"4px 8px",display:"inline-block",mt:4,mb:2},children:e.jsx(n,{variant:"h6",sx:{fontWeight:"bold",color:"#0D47A1"},children:"Publish Scheduled"})}),e.jsx(b,{container:!0,spacing:3,children:W.length===0?e.jsx(n,{variant:"body1",align:"center",sx:{width:"100%"},children:"No materials scheduled for publishing found."}):W.map(i=>e.jsx(b,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(l,{sx:{border:"1px solid #ddd",borderRadius:"8px",padding:2,position:"relative",backgroundColor:"#E3F2FD"},children:[e.jsx(l,{children:i.author===(s==null?void 0:s.uid)&&e.jsx(S,{label:"My Material",variant:"outlined",sx:{borderRadius:"15px",fontWeight:"bold",background:"#C5E1A5",color:"#2E7D32",ml:1}})}),e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(c,{onClick:()=>p(`/view-material/${i.id}`),"aria-label":"view",children:e.jsx(w,{})}),e.jsx(n,{variant:"h6",children:i.title||"Untitled"})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(n,{variant:"body2",color:"textSecondary",children:["Created Date: ",i.timestamp.toDate().toLocaleString()]}),e.jsx(n,{variant:"body2",color:"textSecondary",children:"Status: Scheduled for Publishing"})]}),i.scheduledTimestamp&&e.jsx(l,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(l,{sx:{backgroundColor:"#E3F2FD",border:"1px solid #90CAF9",borderRadius:"16px",padding:"4px 8px"},children:e.jsxs(n,{variant:"body2",sx:{color:"#0D47A1",fontWeight:"bold"},children:["Publish Date: ",i.scheduledTimestamp.toDate().toLocaleString()]})})}),e.jsx(l,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1},children:(s==null?void 0:s.isAdmin)&&e.jsxs(e.Fragment,{children:[e.jsx(c,{onClick:()=>p(`/edit-material/${i.id}`),"aria-label":"edit",children:e.jsx(F,{})}),e.jsx(c,{onClick:()=>y(i.id),"aria-label":"delete",children:e.jsx(A,{})}),e.jsx(G,{materialId:i.id,onClick:P})]})}),e.jsx(l,{sx:{backgroundColor:"#E0F7FA",borderRadius:"8px",padding:"4px 8px",display:"inline-block",mt:2},children:e.jsx(n,{variant:"body2",sx:{color:"#00796B",fontWeight:"bold"},children:i.course||"N/A"})})]})},i.id))})]}),e.jsx(l,{sx:{backgroundColor:"#E8F5E9",borderRadius:"8px",padding:"4px 8px",display:"inline-block",mt:4,mb:2},children:e.jsx(n,{variant:"h6",sx:{fontWeight:"bold",color:"#2E7D32"},children:"Published"})}),e.jsx(b,{container:!0,spacing:3,children:T.length===0?e.jsx(n,{variant:"body1",align:"center",sx:{width:"100%"},children:"No published materials found."}):T.map(i=>e.jsx(b,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(l,{sx:{border:"1px solid #ddd",borderRadius:"8px",padding:2,position:"relative",backgroundColor:"#E8F5E9"},children:[e.jsx(l,{children:i.author===(s==null?void 0:s.uid)&&e.jsx(S,{label:"My Material",variant:"outlined",sx:{borderRadius:"15px",fontWeight:"bold",background:"#C5E1A5",color:"#2E7D32",ml:1}})}),e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(c,{onClick:()=>p(`/view-material/${i.id}`),"aria-label":"view",children:e.jsx(w,{})}),e.jsx(n,{variant:"h6",sx:{flexGrow:1,maxWidth:"50%",wordWrap:"break-word"},children:i.title||"Untitled"})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(n,{variant:"body2",color:"textSecondary",children:["Date: ",i.timestamp.toDate().toLocaleString()]}),e.jsx(n,{variant:"body2",color:"textSecondary",children:"Status: Published"})]}),e.jsx(l,{sx:{position:"absolute",top:8,right:8,display:"flex",gap:1},children:(s==null?void 0:s.isAdmin)&&e.jsxs(e.Fragment,{children:[e.jsx(c,{onClick:()=>p(`/edit-material/${i.id}`),"aria-label":"edit",children:e.jsx(F,{})}),e.jsx(c,{onClick:()=>y(i.id),"aria-label":"delete",children:e.jsx(A,{})}),e.jsx(G,{materialId:i.id,onClick:P})]})}),e.jsx(l,{sx:{backgroundColor:"#E0F7FA",borderRadius:"8px",padding:"4px 8px",display:"inline-block",mt:2},children:e.jsx(n,{variant:"body2",sx:{color:"#00796B",fontWeight:"bold"},children:i.course||"N/A"})})]})},i.id))}),f&&e.jsx(ce,{materialId:f,open:u,onClose:J,onDelete:K}),g.materialId&&e.jsx(xe,{materialId:g.materialId,open:g.open,onClose:X,onUnpublish:V}),I&&e.jsx(ae,{open:!0,autoHideDuration:6e3,onClose:()=>C(null),children:e.jsx(re,{onClose:()=>C(null),severity:"error",children:I})})]})},je=()=>{const{userDetails:s}=M();return e.jsxs(l,{className:"supplemental-container",children:[e.jsx(de,{}),e.jsxs(l,{className:"supplemental-content",children:[(s==null?void 0:s.isAdmin)&&e.jsx(oe,{}),e.jsx(ue,{})]})]})};export{je as default};
