import{o as Vr,_ as Mn,b as $,y as Qr,f as Xr,Q as Zr,j as a,g as Kr,i as Jr,R as es,U as Ut,V as ts,F as Yt,I as Ne,T as ns,W as Kn,J as qt,X as rs,S as ht,K as mt,Y as ss,Z as is,$ as as,a0 as os,a1 as Cn,a2 as $e,a3 as ls,a4 as Ve,a5 as xr,a6 as Vt,a7 as Bn,a8 as on,a9 as cs,A as gt,C as pt,aa as At,ab as St,ac as Et,ad as jt,ae as vr,af as yr,ag as un,ah as ds,ai as Jn,aj as er,ak as ln,al as us,am as fs,an as hs,ao as ms,H as gn,ap as gs,aq as Nn,ar as Ft,as as Xt,at as kt,au as Qt,av as Hn,aw as Re,ax as oe,ay as ut,az as Ie,aA as ps,aB as wn,aC as Pe,aD as je,aE as tt,aF as ft,aG as It,aH as bs}from"./index-TFSSbGtC.js";import{d as _n}from"./Visibility-BZgNNStS.js";const xs=["className"],vs=h=>{const{alignItems:x,classes:k}=h;return Jr({root:["root",x==="flex-start"&&"alignItemsFlexStart"]},es,k)},ys=Vr("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(h,x)=>{const{ownerState:k}=h;return[x.root,k.alignItems==="flex-start"&&x.alignItemsFlexStart]}})(({theme:h,ownerState:x})=>Mn({minWidth:56,color:(h.vars||h).palette.action.active,flexShrink:0,display:"inline-flex"},x.alignItems==="flex-start"&&{marginTop:8})),Ts=$.forwardRef(function(x,k){const l=Qr({props:x,name:"MuiListItemIcon"}),{className:e}=l,t=Xr(l,xs),d=$.useContext(Zr),i=Mn({},l,{alignItems:d.alignItems}),y=vs(i);return a.jsx(ys,Mn({className:Kr(y.root,e),ownerState:i,ref:k},t))}),As=$.memo(({setIsAdding:h})=>{const{userDetails:x}=Ut();console.log("Header loaded");const k=ts(),[l,e]=$.useState(!1),[t,d]=$.useState(!1),i=()=>{x!=null&&x.uid?navigator.clipboard.writeText(x.uid).then(()=>{e(!0),d(!0)}).catch(n=>{console.error("Could not copy text: ",n)}):console.error("User details are null or undefined")},y=(n,s)=>{s!=="clickaway"&&e(!1)},w=()=>{k("/")};return a.jsxs(Yt,{sx:{mt:3,mb:2},children:[a.jsx(Yt,{sx:{display:"flex",alignItems:"center"},children:a.jsx(Ne,{variant:"text",onClick:w,sx:{mr:2},children:"â† Home Page"})}),a.jsx(ns,{variant:"h4",component:"h1",gutterBottom:!0,textAlign:"left",sx:{fontWeight:"bold"},children:"My Laboratory Notebook"}),x&&a.jsxs(Yt,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:[x.isAdmin&&a.jsx(Kn,{label:"Admin",variant:"outlined",sx:{borderRadius:"15px",fontWeight:"bold",background:"#ffcdd2",color:"#c62828",mr:1}}),a.jsx(qt,{title:t?"Copied!":"Click to Copy",enterDelay:300,leaveDelay:200,children:a.jsx(Kn,{label:`User ID: ${x.uid}`,variant:"outlined",onClick:i,sx:{borderRadius:"15px",fontWeight:"bold",background:"#e0f2f1",color:"#00695c",mr:1,cursor:"pointer",transition:"background-color 0.3s"}})})]}),a.jsxs(Yt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx(Ne,{variant:"contained",color:"primary",onClick:()=>h(!0),sx:{fontSize:"1.2rem",mt:2,textTransform:"none",minWidth:"150px",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"+ Create New"}),a.jsx(rs,{})]}),a.jsx(ht,{open:l,autoHideDuration:6e3,onClose:y,children:a.jsx(mt,{onClose:y,severity:"success",sx:{width:"100%"},children:"User ID copied to clipboard!"})})]})}),En=({designs:h,handleEdit:x,handleDelete:k,isAdmin:l,userDetails:e,showUserIdColumn:t})=>{const d=i=>i?i instanceof Bn?i.toDate().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):i instanceof Date?i.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"N/A":"N/A";return a.jsx(ss,{component:is,children:a.jsxs(as,{sx:{"& .MuiTableCell-root":{fontSize:"1rem"},"& .MuiTableCell-head":{fontSize:"1.2rem",backgroundColor:"#1A76D3",color:"white"}},children:[a.jsx(os,{children:a.jsxs(Cn,{sx:{height:"60px"},children:[a.jsx($e,{sx:{fontWeight:"bold",width:t?"30%":"40%"},children:"Title"}),t&&a.jsx($e,{sx:{fontWeight:"bold",width:"20%"},children:"User ID"}),a.jsx($e,{sx:{fontWeight:"bold",width:"15%"},children:"Created"}),a.jsx($e,{sx:{fontWeight:"bold",width:"15%"},children:"Last Edited"}),a.jsx($e,{sx:{fontWeight:"bold",width:"10%"},children:"Edit"}),a.jsx($e,{sx:{fontWeight:"bold",width:"10%"},children:"Delete"})]})}),a.jsx(ls,{children:h&&h.length>0?h.map(i=>{const y=i.userId===(e==null?void 0:e.uid);return a.jsxs(Cn,{sx:{height:"80px"},children:[a.jsx($e,{children:a.jsx("button",{onClick:()=>x(i.id),className:"hyperlink-style",children:i.title})}),t&&a.jsx($e,{children:i.userId}),a.jsx($e,{children:d(i.dateCreated)}),a.jsx($e,{children:d(i.dateModified)}),a.jsx($e,{children:a.jsx(qt,{title:"Edit",children:a.jsx("span",{children:a.jsx(Ve,{onClick:()=>y&&x(i.id),color:"primary",disabled:!y,children:a.jsx(xr,{})})})})}),a.jsx($e,{children:a.jsx(qt,{title:"Delete",children:a.jsx("span",{children:a.jsx(Ve,{onClick:()=>y&&k(i.id),color:"error",disabled:!y,children:a.jsx(Vt,{})})})})})]},i.id)}):a.jsx(Cn,{children:a.jsx($e,{colSpan:t?6:5,children:"No Designs Found"})})})]})})};function Ss(h,x){return x.forEach(function(k){k&&typeof k!="string"&&!Array.isArray(k)&&Object.keys(k).forEach(function(l){if(l!=="default"&&!(l in h)){var e=Object.getOwnPropertyDescriptor(k,l);Object.defineProperty(h,l,e.get?e:{enumerable:!0,get:function(){return k[l]}})}})}),Object.freeze(h)}function Tr(h,x){return new Promise(function(k,l){let e;return Cs(h).then(function(t){try{return e=t,k(new Blob([x.slice(0,2),e,x.slice(2)],{type:"image/jpeg"}))}catch(d){return l(d)}},l)})}const Cs=h=>new Promise((x,k)=>{const l=new FileReader;l.addEventListener("load",({target:{result:e}})=>{const t=new DataView(e);let d=0;if(t.getUint16(d)!==65496)return k("not a valid JPEG");for(d+=2;;){const i=t.getUint16(d);if(i===65498)break;const y=t.getUint16(d+2);if(i===65505&&t.getUint32(d+4)===1165519206){const w=d+10;let n;switch(t.getUint16(w)){case 18761:n=!0;break;case 19789:n=!1;break;default:return k("TIFF header contains invalid endian")}if(t.getUint16(w+2,n)!==42)return k("TIFF header contains invalid version");const s=t.getUint32(w+4,n),r=w+s+2+12*t.getUint16(w+s,n);for(let c=w+s+2;c<r;c+=12)if(t.getUint16(c,n)==274){if(t.getUint16(c+2,n)!==3)return k("Orientation data type is invalid");if(t.getUint32(c+4,n)!==1)return k("Orientation data count is invalid");t.setUint16(c+8,1,n);break}return x(e.slice(d,d+2+y))}d+=2+y}return x(new Blob)}),l.readAsArrayBuffer(h)});var pn={},ws={get exports(){return pn},set exports(h){pn=h}};(function(h){var x,k,l={};ws.exports=l,l.parse=function(e,t){for(var d=l.bin.readUshort,i=l.bin.readUint,y=0,w={},n=new Uint8Array(e),s=n.length-4;i(n,s)!=101010256;)s--;y=s,y+=4;var r=d(n,y+=4);d(n,y+=2);var c=i(n,y+=2),p=i(n,y+=4);y+=4,y=p;for(var I=0;I<r;I++){i(n,y),y+=4,y+=4,y+=4,i(n,y+=4),c=i(n,y+=4);var U=i(n,y+=4),E=d(n,y+=4),z=d(n,y+2),L=d(n,y+4);y+=6;var F=i(n,y+=8);y+=4,y+=E+z+L,l._readLocal(n,F,w,c,U,t)}return w},l._readLocal=function(e,t,d,i,y,w){var n=l.bin.readUshort,s=l.bin.readUint;s(e,t),n(e,t+=4),n(e,t+=2);var r=n(e,t+=2);s(e,t+=2),s(e,t+=4),t+=4;var c=n(e,t+=8),p=n(e,t+=2);t+=2;var I=l.bin.readUTF8(e,t,c);if(t+=c,t+=p,w)d[I]={size:y,csize:i};else{var U=new Uint8Array(e.buffer,t);if(r==0)d[I]=new Uint8Array(U.buffer.slice(t,t+i));else{if(r!=8)throw"unknown compression method: "+r;var E=new Uint8Array(y);l.inflateRaw(U,E),d[I]=E}}},l.inflateRaw=function(e,t){return l.F.inflate(e,t)},l.inflate=function(e,t){return e[0],e[1],l.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},l.deflate=function(e,t){t==null&&(t={level:6});var d=0,i=new Uint8Array(50+Math.floor(1.1*e.length));i[d]=120,i[d+1]=156,d+=2,d=l.F.deflateRaw(e,i,d,t.level);var y=l.adler(e,0,e.length);return i[d+0]=y>>>24&255,i[d+1]=y>>>16&255,i[d+2]=y>>>8&255,i[d+3]=y>>>0&255,new Uint8Array(i.buffer,0,d+4)},l.deflateRaw=function(e,t){t==null&&(t={level:6});var d=new Uint8Array(50+Math.floor(1.1*e.length)),i=l.F.deflateRaw(e,d,i,t.level);return new Uint8Array(d.buffer,0,i)},l.encode=function(e,t){t==null&&(t=!1);var d=0,i=l.bin.writeUint,y=l.bin.writeUshort,w={};for(var n in e){var s=!l._noNeed(n)&&!t,r=e[n],c=l.crc.crc(r,0,r.length);w[n]={cpr:s,usize:r.length,crc:c,file:s?l.deflateRaw(r):r}}for(var n in w)d+=w[n].file.length+30+46+2*l.bin.sizeUTF8(n);d+=22;var p=new Uint8Array(d),I=0,U=[];for(var n in w){var E=w[n];U.push(I),I=l._writeHeader(p,I,n,E,0)}var z=0,L=I;for(var n in w)E=w[n],U.push(I),I=l._writeHeader(p,I,n,E,1,U[z++]);var F=I-L;return i(p,I,101010256),I+=4,y(p,I+=4,z),y(p,I+=2,z),i(p,I+=2,F),i(p,I+=4,L),I+=4,I+=2,p.buffer},l._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},l._writeHeader=function(e,t,d,i,y,w){var n=l.bin.writeUint,s=l.bin.writeUshort,r=i.file;return n(e,t,y==0?67324752:33639248),t+=4,y==1&&(t+=2),s(e,t,20),s(e,t+=2,0),s(e,t+=2,i.cpr?8:0),n(e,t+=2,0),n(e,t+=4,i.crc),n(e,t+=4,r.length),n(e,t+=4,i.usize),s(e,t+=4,l.bin.sizeUTF8(d)),s(e,t+=2,0),t+=2,y==1&&(t+=2,t+=2,n(e,t+=6,w),t+=4),t+=l.bin.writeUTF8(e,t,d),y==0&&(e.set(r,t),t+=r.length),t},l.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var d=t,i=0;i<8;i++)1&d?d=3988292384^d>>>1:d>>>=1;e[t]=d}return e}(),update:function(e,t,d,i){for(var y=0;y<i;y++)e=l.crc.table[255&(e^t[d+y])]^e>>>8;return e},crc:function(e,t,d){return 4294967295^l.crc.update(4294967295,e,t,d)}},l.adler=function(e,t,d){for(var i=1,y=0,w=t,n=t+d;w<n;){for(var s=Math.min(w+5552,n);w<s;)y+=i+=e[w++];i%=65521,y%=65521}return y<<16|i},l.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255,e[t+2]=d>>16&255,e[t+3]=d>>24&255},readASCII:function(e,t,d){for(var i="",y=0;y<d;y++)i+=String.fromCharCode(e[t+y]);return i},writeASCII:function(e,t,d){for(var i=0;i<d.length;i++)e[t+i]=d.charCodeAt(i)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,d){for(var i,y="",w=0;w<d;w++)y+="%"+l.bin.pad(e[t+w].toString(16));try{i=decodeURIComponent(y)}catch{return l.bin.readASCII(e,t,d)}return i},writeUTF8:function(e,t,d){for(var i=d.length,y=0,w=0;w<i;w++){var n=d.charCodeAt(w);if(!(4294967168&n))e[t+y]=n,y++;else if(!(4294965248&n))e[t+y]=192|n>>6,e[t+y+1]=128|n>>0&63,y+=2;else if(!(4294901760&n))e[t+y]=224|n>>12,e[t+y+1]=128|n>>6&63,e[t+y+2]=128|n>>0&63,y+=3;else{if(4292870144&n)throw"e";e[t+y]=240|n>>18,e[t+y+1]=128|n>>12&63,e[t+y+2]=128|n>>6&63,e[t+y+3]=128|n>>0&63,y+=4}}return y},sizeUTF8:function(e){for(var t=e.length,d=0,i=0;i<t;i++){var y=e.charCodeAt(i);if(!(4294967168&y))d++;else if(!(4294965248&y))d+=2;else if(!(4294901760&y))d+=3;else{if(4292870144&y)throw"e";d+=4}}return d}},l.F={},l.F.deflateRaw=function(e,t,d,i){var y=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][i],w=l.F.U,n=l.F._goodIndex;l.F._hash;var s=l.F._putsE,r=0,c=d<<3,p=0,I=e.length;if(i==0){for(;r<I;)s(t,c,r+(S=Math.min(65535,I-r))==I?1:0),c=l.F._copyExact(e,r,S,t,c+8),r+=S;return c>>>3}var U=w.lits,E=w.strt,z=w.prev,L=0,F=0,B=0,b=0,M=0,f=0;for(I>2&&(E[f=l.F._hash(e,0)]=0),r=0;r<I;r++){if(M=f,r+1<I-2){f=l.F._hash(e,r+1);var u=r+1&32767;z[u]=E[f],E[f]=u}if(p<=r){(L>14e3||F>26697)&&I-r>100&&(p<r&&(U[L]=r-p,L+=2,p=r),c=l.F._writeBlock(r==I-1||p==I?1:0,U,L,b,e,B,r-B,t,c),L=F=b=0,B=r);var v=0;r<I-2&&(v=l.F._bestMatch(e,r,z,M,Math.min(y[2],I-r),y[3]));var S=v>>>16,_=65535&v;if(v!=0){_=65535&v;var j=n(S=v>>>16,w.of0);w.lhst[257+j]++;var T=n(_,w.df0);w.dhst[T]++,b+=w.exb[j]+w.dxb[T],U[L]=S<<23|r-p,U[L+1]=_<<16|j<<8|T,L+=2,p=r+S}else w.lhst[e[r]]++;F++}}for(B==r&&e.length!=0||(p<r&&(U[L]=r-p,L+=2,p=r),c=l.F._writeBlock(1,U,L,b,e,B,r-B,t,c),L=0,F=0,L=F=b=0,B=r);7&c;)c++;return c>>>3},l.F._bestMatch=function(e,t,d,i,y,w){var n=32767&t,s=d[n],r=n-s+32768&32767;if(s==n||i!=l.F._hash(e,t-r))return 0;for(var c=0,p=0,I=Math.min(32767,t);r<=I&&--w!=0&&s!=n;){if(c==0||e[t+c]==e[t+c-r]){var U=l.F._howLong(e,t,r);if(U>c){if(p=r,(c=U)>=y)break;r+2<U&&(U=r+2);for(var E=0,z=0;z<U-2;z++){var L=t-r+z+32768&32767,F=L-d[L]+32768&32767;F>E&&(E=F,s=L)}}}r+=(n=s)-(s=d[n])+32768&32767}return c<<16|p},l.F._howLong=function(e,t,d){if(e[t]!=e[t-d]||e[t+1]!=e[t+1-d]||e[t+2]!=e[t+2-d])return 0;var i=t,y=Math.min(e.length,t+258);for(t+=3;t<y&&e[t]==e[t-d];)t++;return t-i},l.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},l.saved=0,l.F._writeBlock=function(e,t,d,i,y,w,n,s,r){var c,p,I,U,E,z,L,F,B,b=l.F.U,M=l.F._putsF,f=l.F._putsE;b.lhst[256]++,p=(c=l.F.getTrees())[0],I=c[1],U=c[2],E=c[3],z=c[4],L=c[5],F=c[6],B=c[7];var u=32+(r+3&7?8-(r+3&7):0)+(n<<3),v=i+l.F.contSize(b.fltree,b.lhst)+l.F.contSize(b.fdtree,b.dhst),S=i+l.F.contSize(b.ltree,b.lhst)+l.F.contSize(b.dtree,b.dhst);S+=14+3*L+l.F.contSize(b.itree,b.ihst)+(2*b.ihst[16]+3*b.ihst[17]+7*b.ihst[18]);for(var _=0;_<286;_++)b.lhst[_]=0;for(_=0;_<30;_++)b.dhst[_]=0;for(_=0;_<19;_++)b.ihst[_]=0;var j=u<v&&u<S?0:v<S?1:2;if(M(s,r,e),M(s,r+1,j),r+=3,j==0){for(;7&r;)r++;r=l.F._copyExact(y,w,n,s,r)}else{var T,R;if(j==1&&(T=b.fltree,R=b.fdtree),j==2){l.F.makeCodes(b.ltree,p),l.F.revCodes(b.ltree,p),l.F.makeCodes(b.dtree,I),l.F.revCodes(b.dtree,I),l.F.makeCodes(b.itree,U),l.F.revCodes(b.itree,U),T=b.ltree,R=b.dtree,f(s,r,E-257),f(s,r+=5,z-1),f(s,r+=5,L-4),r+=4;for(var g=0;g<L;g++)f(s,r+3*g,b.itree[1+(b.ordr[g]<<1)]);r+=3*L,r=l.F._codeTiny(F,b.itree,s,r),r=l.F._codeTiny(B,b.itree,s,r)}for(var o=w,O=0;O<d;O+=2){for(var D=t[O],P=D>>>23,Y=o+(8388607&D);o<Y;)r=l.F._writeLit(y[o++],T,s,r);if(P!=0){var W=t[O+1],V=W>>16,q=W>>8&255,N=255&W;f(s,r=l.F._writeLit(257+q,T,s,r),P-b.of0[q]),r+=b.exb[q],M(s,r=l.F._writeLit(N,R,s,r),V-b.df0[N]),r+=b.dxb[N],o+=P}}r=l.F._writeLit(256,T,s,r)}return r},l.F._copyExact=function(e,t,d,i,y){var w=y>>>3;return i[w]=d,i[w+1]=d>>>8,i[w+2]=255-i[w],i[w+3]=255-i[w+1],w+=4,i.set(new Uint8Array(e.buffer,t,d),w),y+(d+4<<3)},l.F.getTrees=function(){for(var e=l.F.U,t=l.F._hufTree(e.lhst,e.ltree,15),d=l.F._hufTree(e.dhst,e.dtree,15),i=[],y=l.F._lenCodes(e.ltree,i),w=[],n=l.F._lenCodes(e.dtree,w),s=0;s<i.length;s+=2)e.ihst[i[s]]++;for(s=0;s<w.length;s+=2)e.ihst[w[s]]++;for(var r=l.F._hufTree(e.ihst,e.itree,7),c=19;c>4&&e.itree[1+(e.ordr[c-1]<<1)]==0;)c--;return[t,d,r,y,n,c,i,w]},l.F.getSecond=function(e){for(var t=[],d=0;d<e.length;d+=2)t.push(e[d+1]);return t},l.F.nonZero=function(e){for(var t="",d=0;d<e.length;d+=2)e[d+1]!=0&&(t+=(d>>1)+",");return t},l.F.contSize=function(e,t){for(var d=0,i=0;i<t.length;i++)d+=t[i]*e[1+(i<<1)];return d},l.F._codeTiny=function(e,t,d,i){for(var y=0;y<e.length;y+=2){var w=e[y],n=e[y+1];i=l.F._writeLit(w,t,d,i);var s=w==16?2:w==17?3:7;w>15&&(l.F._putsE(d,i,n,s),i+=s)}return i},l.F._lenCodes=function(e,t){for(var d=e.length;d!=2&&e[d-1]==0;)d-=2;for(var i=0;i<d;i+=2){var y=e[i+1],w=i+3<d?e[i+3]:-1,n=i+5<d?e[i+5]:-1,s=i==0?-1:e[i-1];if(y==0&&w==y&&n==y){for(var r=i+5;r+2<d&&e[r+2]==y;)r+=2;(c=Math.min(r+1-i>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),i+=2*c-2}else if(y==s&&w==y&&n==y){for(r=i+5;r+2<d&&e[r+2]==y;)r+=2;var c=Math.min(r+1-i>>>1,6);t.push(16,c-3),i+=2*c-2}else t.push(y,0)}return d>>>1},l.F._hufTree=function(e,t,d){var i=[],y=e.length,w=t.length,n=0;for(n=0;n<w;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<y;n++)e[n]!=0&&i.push({lit:n,f:e[n]});var s=i.length,r=i.slice(0);if(s==0)return 0;if(s==1){var c=i[0].lit;return r=c==0?1:0,t[1+(c<<1)]=1,t[1+(r<<1)]=1,1}i.sort(function(F,B){return F.f-B.f});var p=i[0],I=i[1],U=0,E=1,z=2;for(i[0]={lit:-1,f:p.f+I.f,l:p,r:I,d:0};E!=s-1;)p=U!=E&&(z==s||i[U].f<i[z].f)?i[U++]:i[z++],I=U!=E&&(z==s||i[U].f<i[z].f)?i[U++]:i[z++],i[E++]={lit:-1,f:p.f+I.f,l:p,r:I};var L=l.F.setDepth(i[E-1],0);for(L>d&&(l.F.restrictDepth(r,d,L),L=d),n=0;n<s;n++)t[1+(r[n].lit<<1)]=r[n].d;return L},l.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(l.F.setDepth(e.l,t+1),l.F.setDepth(e.r,t+1))},l.F.restrictDepth=function(e,t,d){var i=0,y=1<<d-t,w=0;for(e.sort(function(s,r){return r.d==s.d?s.f-r.f:r.d-s.d}),i=0;i<e.length&&e[i].d>t;i++){var n=e[i].d;e[i].d=t,w+=y-(1<<d-n)}for(w>>>=d-t;w>0;)(n=e[i].d)<t?(e[i].d++,w-=1<<t-n-1):i++;for(;i>=0;i--)e[i].d==t&&w<0&&(e[i].d--,w++);w!=0&&console.log("debt left")},l.F._goodIndex=function(e,t){var d=0;return t[16|d]<=e&&(d|=16),t[8|d]<=e&&(d|=8),t[4|d]<=e&&(d|=4),t[2|d]<=e&&(d|=2),t[1|d]<=e&&(d|=1),d},l.F._writeLit=function(e,t,d,i){return l.F._putsF(d,i,t[e<<1]),i+t[1+(e<<1)]},l.F.inflate=function(e,t){var d=Uint8Array;if(e[0]==3&&e[1]==0)return t||new d(0);var i=l.F,y=i._bitsF,w=i._bitsE,n=i._decodeTiny,s=i.makeCodes,r=i.codes2map,c=i._get17,p=i.U,I=t==null;I&&(t=new d(e.length>>>2<<3));for(var U,E,z=0,L=0,F=0,B=0,b=0,M=0,f=0,u=0,v=0;z==0;)if(z=y(e,v,1),L=y(e,v+1,2),v+=3,L!=0){if(I&&(t=l.F._check(t,u+(1<<17))),L==1&&(U=p.flmap,E=p.fdmap,M=511,f=31),L==2){F=w(e,v,5)+257,B=w(e,v+5,5)+1,b=w(e,v+10,4)+4,v+=14;for(var S=0;S<38;S+=2)p.itree[S]=0,p.itree[S+1]=0;var _=1;for(S=0;S<b;S++){var j=w(e,v+3*S,3);p.itree[1+(p.ordr[S]<<1)]=j,j>_&&(_=j)}v+=3*b,s(p.itree,_),r(p.itree,_,p.imap),U=p.lmap,E=p.dmap,v=n(p.imap,(1<<_)-1,F+B,e,v,p.ttree);var T=i._copyOut(p.ttree,0,F,p.ltree);M=(1<<T)-1;var R=i._copyOut(p.ttree,F,B,p.dtree);f=(1<<R)-1,s(p.ltree,T),r(p.ltree,T,U),s(p.dtree,R),r(p.dtree,R,E)}for(;;){var g=U[c(e,v)&M];v+=15&g;var o=g>>>4;if(!(o>>>8))t[u++]=o;else{if(o==256)break;var O=u+o-254;if(o>264){var D=p.ldef[o-257];O=u+(D>>>3)+w(e,v,7&D),v+=7&D}var P=E[c(e,v)&f];v+=15&P;var Y=P>>>4,W=p.ddef[Y],V=(W>>>4)+y(e,v,15&W);for(v+=15&W,I&&(t=l.F._check(t,u+(1<<17)));u<O;)t[u]=t[u++-V],t[u]=t[u++-V],t[u]=t[u++-V],t[u]=t[u++-V];u=O}}}else{7&v&&(v+=8-(7&v));var q=4+(v>>>3),N=e[q-4]|e[q-3]<<8;I&&(t=l.F._check(t,u+N)),t.set(new d(e.buffer,e.byteOffset+q,N),u),v=q+N<<3,u+=N}return t.length==u?t:t.slice(0,u)},l.F._check=function(e,t){var d=e.length;if(t<=d)return e;var i=new Uint8Array(Math.max(d<<1,t));return i.set(e,0),i},l.F._decodeTiny=function(e,t,d,i,y,w){for(var n=l.F._bitsE,s=l.F._get17,r=0;r<d;){var c=e[s(i,y)&t];y+=15&c;var p=c>>>4;if(p<=15)w[r]=p,r++;else{var I=0,U=0;p==16?(U=3+n(i,y,2),y+=2,I=w[r-1]):p==17?(U=3+n(i,y,3),y+=3):p==18&&(U=11+n(i,y,7),y+=7);for(var E=r+U;r<E;)w[r]=I,r++}}return y},l.F._copyOut=function(e,t,d,i){for(var y=0,w=0,n=i.length>>>1;w<d;){var s=e[w+t];i[w<<1]=0,i[1+(w<<1)]=s,s>y&&(y=s),w++}for(;w<n;)i[w<<1]=0,i[1+(w<<1)]=0,w++;return y},l.F.makeCodes=function(e,t){for(var d,i,y,w,n=l.F.U,s=e.length,r=n.bl_count,c=0;c<=t;c++)r[c]=0;for(c=1;c<s;c+=2)r[e[c]]++;var p=n.next_code;for(d=0,r[0]=0,i=1;i<=t;i++)d=d+r[i-1]<<1,p[i]=d;for(y=0;y<s;y+=2)(w=e[y+1])!=0&&(e[y]=p[w],p[w]++)},l.F.codes2map=function(e,t,d){for(var i=e.length,y=l.F.U.rev15,w=0;w<i;w+=2)if(e[w+1]!=0)for(var n=w>>1,s=e[w+1],r=n<<4|s,c=t-s,p=e[w]<<c,I=p+(1<<c);p!=I;)d[y[p]>>>15-t]=r,p++},l.F.revCodes=function(e,t){for(var d=l.F.U.rev15,i=15-t,y=0;y<e.length;y+=2){var w=e[y]<<t-e[y+1];e[y]=d[w]>>>i}},l.F._putsE=function(e,t,d){d<<=7&t;var i=t>>>3;e[i]|=d,e[i+1]|=d>>>8},l.F._putsF=function(e,t,d){d<<=7&t;var i=t>>>3;e[i]|=d,e[i+1]|=d>>>8,e[i+2]|=d>>>16},l.F._bitsE=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<d)-1},l.F._bitsF=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<d)-1},l.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},l.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},l.F.U=(x=Uint16Array,k=Uint32Array,{next_code:new x(16),bl_count:new x(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new x(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new k(32),flmap:new x(512),fltree:[],fdmap:new x(32),fdtree:[],lmap:new x(32768),ltree:[],ttree:[],dmap:new x(32768),dtree:[],imap:new x(512),itree:[],rev15:new x(32768),lhst:new k(286),dhst:new k(30),ihst:new k(19),lits:new k(15e3),strt:new x(65536),prev:new x(32768)}),function(){for(var e=l.F.U,t=0;t<32768;t++){var d=t;d=(4278255360&(d=(4042322160&(d=(3435973836&(d=(2863311530&d)>>>1|(1431655765&d)<<1))>>>2|(858993459&d)<<2))>>>4|(252645135&d)<<4))>>>8|(16711935&d)<<8,e.rev15[t]=(d>>>16|d<<16)>>>17}function i(y,w,n){for(;w--!=0;)y.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];i(e.fltree,144,8),i(e.fltree,112,9),i(e.fltree,24,7),i(e.fltree,8,8),l.F.makeCodes(e.fltree,9),l.F.codes2map(e.fltree,9,e.flmap),l.F.revCodes(e.fltree,9),i(e.fdtree,32,5),l.F.makeCodes(e.fdtree,5),l.F.codes2map(e.fdtree,5,e.fdmap),l.F.revCodes(e.fdtree,5),i(e.itree,19,0),i(e.ltree,286,0),i(e.dtree,30,0),i(e.ttree,320,0)}()})();var _s=Ss({__proto__:null,default:pn},[pn]);const Xe=function(){var h={nextZero(n,s){for(;n[s]!=0;)s++;return s},readUshort:(n,s)=>n[s]<<8|n[s+1],writeUshort(n,s,r){n[s]=r>>8&255,n[s+1]=255&r},readUint:(n,s)=>16777216*n[s]+(n[s+1]<<16|n[s+2]<<8|n[s+3]),writeUint(n,s,r){n[s]=r>>24&255,n[s+1]=r>>16&255,n[s+2]=r>>8&255,n[s+3]=255&r},readASCII(n,s,r){let c="";for(let p=0;p<r;p++)c+=String.fromCharCode(n[s+p]);return c},writeASCII(n,s,r){for(let c=0;c<r.length;c++)n[s+c]=r.charCodeAt(c)},readBytes(n,s,r){const c=[];for(let p=0;p<r;p++)c.push(n[s+p]);return c},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,s,r){let c,p="";for(let I=0;I<r;I++)p+=`%${h.pad(n[s+I].toString(16))}`;try{c=decodeURIComponent(p)}catch{return h.readASCII(n,s,r)}return c}};function x(n,s,r,c){const p=s*r,I=t(c),U=Math.ceil(s*I/8),E=new Uint8Array(4*p),z=new Uint32Array(E.buffer),{ctype:L}=c,{depth:F}=c,B=h.readUshort;if(L==6){const D=p<<2;if(F==8)for(var b=0;b<D;b+=4)E[b]=n[b],E[b+1]=n[b+1],E[b+2]=n[b+2],E[b+3]=n[b+3];if(F==16)for(b=0;b<D;b++)E[b]=n[b<<1]}else if(L==2){const D=c.tabs.tRNS;if(D==null){if(F==8)for(b=0;b<p;b++){var M=3*b;z[b]=255<<24|n[M+2]<<16|n[M+1]<<8|n[M]}if(F==16)for(b=0;b<p;b++)M=6*b,z[b]=255<<24|n[M+4]<<16|n[M+2]<<8|n[M]}else{var f=D[0];const P=D[1],Y=D[2];if(F==8)for(b=0;b<p;b++){var u=b<<2;M=3*b,z[b]=255<<24|n[M+2]<<16|n[M+1]<<8|n[M],n[M]==f&&n[M+1]==P&&n[M+2]==Y&&(E[u+3]=0)}if(F==16)for(b=0;b<p;b++)u=b<<2,M=6*b,z[b]=255<<24|n[M+4]<<16|n[M+2]<<8|n[M],B(n,M)==f&&B(n,M+2)==P&&B(n,M+4)==Y&&(E[u+3]=0)}}else if(L==3){const D=c.tabs.PLTE,P=c.tabs.tRNS,Y=P?P.length:0;if(F==1)for(var v=0;v<r;v++){var S=v*U,_=v*s;for(b=0;b<s;b++){u=_+b<<2;var j=3*(T=n[S+(b>>3)]>>7-((7&b)<<0)&1);E[u]=D[j],E[u+1]=D[j+1],E[u+2]=D[j+2],E[u+3]=T<Y?P[T]:255}}if(F==2)for(v=0;v<r;v++)for(S=v*U,_=v*s,b=0;b<s;b++)u=_+b<<2,j=3*(T=n[S+(b>>2)]>>6-((3&b)<<1)&3),E[u]=D[j],E[u+1]=D[j+1],E[u+2]=D[j+2],E[u+3]=T<Y?P[T]:255;if(F==4)for(v=0;v<r;v++)for(S=v*U,_=v*s,b=0;b<s;b++)u=_+b<<2,j=3*(T=n[S+(b>>1)]>>4-((1&b)<<2)&15),E[u]=D[j],E[u+1]=D[j+1],E[u+2]=D[j+2],E[u+3]=T<Y?P[T]:255;if(F==8)for(b=0;b<p;b++){var T;u=b<<2,j=3*(T=n[b]),E[u]=D[j],E[u+1]=D[j+1],E[u+2]=D[j+2],E[u+3]=T<Y?P[T]:255}}else if(L==4){if(F==8)for(b=0;b<p;b++){u=b<<2;var R=n[g=b<<1];E[u]=R,E[u+1]=R,E[u+2]=R,E[u+3]=n[g+1]}if(F==16)for(b=0;b<p;b++){var g;u=b<<2,R=n[g=b<<2],E[u]=R,E[u+1]=R,E[u+2]=R,E[u+3]=n[g+2]}}else if(L==0)for(f=c.tabs.tRNS?c.tabs.tRNS:-1,v=0;v<r;v++){const D=v*U,P=v*s;if(F==1)for(var o=0;o<s;o++){var O=(R=255*(n[D+(o>>>3)]>>>7-(7&o)&1))==255*f?0:255;z[P+o]=O<<24|R<<16|R<<8|R}else if(F==2)for(o=0;o<s;o++)O=(R=85*(n[D+(o>>>2)]>>>6-((3&o)<<1)&3))==85*f?0:255,z[P+o]=O<<24|R<<16|R<<8|R;else if(F==4)for(o=0;o<s;o++)O=(R=17*(n[D+(o>>>1)]>>>4-((1&o)<<2)&15))==17*f?0:255,z[P+o]=O<<24|R<<16|R<<8|R;else if(F==8)for(o=0;o<s;o++)O=(R=n[D+o])==f?0:255,z[P+o]=O<<24|R<<16|R<<8|R;else if(F==16)for(o=0;o<s;o++)R=n[D+(o<<1)],O=B(n,D+(o<<1))==f?0:255,z[P+o]=O<<24|R<<16|R<<8|R}return E}function k(n,s,r,c){const p=t(n),I=Math.ceil(r*p/8),U=new Uint8Array((I+1+n.interlace)*c);return s=n.tabs.CgBI?e(s,U):l(s,U),n.interlace==0?s=d(s,n,0,r,c):n.interlace==1&&(s=function(z,L){const F=L.width,B=L.height,b=t(L),M=b>>3,f=Math.ceil(F*b/8),u=new Uint8Array(B*f);let v=0;const S=[0,0,4,0,2,0,1],_=[0,4,0,2,0,1,0],j=[8,8,8,4,4,2,2],T=[8,8,4,4,2,2,1];let R=0;for(;R<7;){const o=j[R],O=T[R];let D=0,P=0,Y=S[R];for(;Y<B;)Y+=o,P++;let W=_[R];for(;W<F;)W+=O,D++;const V=Math.ceil(D*b/8);d(z,L,v,D,P);let q=0,N=S[R];for(;N<B;){let Z=_[R],de=v+q*V<<3;for(;Z<F;){var g;if(b==1&&(g=(g=z[de>>3])>>7-(7&de)&1,u[N*f+(Z>>3)]|=g<<7-((7&Z)<<0)),b==2&&(g=(g=z[de>>3])>>6-(7&de)&3,u[N*f+(Z>>2)]|=g<<6-((3&Z)<<1)),b==4&&(g=(g=z[de>>3])>>4-(7&de)&15,u[N*f+(Z>>1)]|=g<<4-((1&Z)<<2)),b>=8){const ne=N*f+Z*M;for(let ee=0;ee<M;ee++)u[ne+ee]=z[(de>>3)+ee]}de+=b,Z+=O}q++,N+=o}D*P!=0&&(v+=P*(1+V)),R+=1}return u}(s,n)),s}function l(n,s){return e(new Uint8Array(n.buffer,2,n.length-6),s)}var e=function(){const n={H:{}};return n.H.N=function(s,r){const c=Uint8Array;let p,I,U=0,E=0,z=0,L=0,F=0,B=0,b=0,M=0,f=0;if(s[0]==3&&s[1]==0)return r||new c(0);const u=n.H,v=u.b,S=u.e,_=u.R,j=u.n,T=u.A,R=u.Z,g=u.m,o=r==null;for(o&&(r=new c(s.length>>>2<<5));U==0;)if(U=v(s,f,1),E=v(s,f+1,2),f+=3,E!=0){if(o&&(r=n.H.W(r,M+(1<<17))),E==1&&(p=g.J,I=g.h,B=511,b=31),E==2){z=S(s,f,5)+257,L=S(s,f+5,5)+1,F=S(s,f+10,4)+4,f+=14;let D=1;for(var O=0;O<38;O+=2)g.Q[O]=0,g.Q[O+1]=0;for(O=0;O<F;O++){const W=S(s,f+3*O,3);g.Q[1+(g.X[O]<<1)]=W,W>D&&(D=W)}f+=3*F,j(g.Q,D),T(g.Q,D,g.u),p=g.w,I=g.d,f=_(g.u,(1<<D)-1,z+L,s,f,g.v);const P=u.V(g.v,0,z,g.C);B=(1<<P)-1;const Y=u.V(g.v,z,L,g.D);b=(1<<Y)-1,j(g.C,P),T(g.C,P,p),j(g.D,Y),T(g.D,Y,I)}for(;;){const D=p[R(s,f)&B];f+=15&D;const P=D>>>4;if(!(P>>>8))r[M++]=P;else{if(P==256)break;{let Y=M+P-254;if(P>264){const Z=g.q[P-257];Y=M+(Z>>>3)+S(s,f,7&Z),f+=7&Z}const W=I[R(s,f)&b];f+=15&W;const V=W>>>4,q=g.c[V],N=(q>>>4)+v(s,f,15&q);for(f+=15&q;M<Y;)r[M]=r[M++-N],r[M]=r[M++-N],r[M]=r[M++-N],r[M]=r[M++-N];M=Y}}}}else{7&f&&(f+=8-(7&f));const D=4+(f>>>3),P=s[D-4]|s[D-3]<<8;o&&(r=n.H.W(r,M+P)),r.set(new c(s.buffer,s.byteOffset+D,P),M),f=D+P<<3,M+=P}return r.length==M?r:r.slice(0,M)},n.H.W=function(s,r){const c=s.length;if(r<=c)return s;const p=new Uint8Array(c<<1);return p.set(s,0),p},n.H.R=function(s,r,c,p,I,U){const E=n.H.e,z=n.H.Z;let L=0;for(;L<c;){const F=s[z(p,I)&r];I+=15&F;const B=F>>>4;if(B<=15)U[L]=B,L++;else{let b=0,M=0;B==16?(M=3+E(p,I,2),I+=2,b=U[L-1]):B==17?(M=3+E(p,I,3),I+=3):B==18&&(M=11+E(p,I,7),I+=7);const f=L+M;for(;L<f;)U[L]=b,L++}}return I},n.H.V=function(s,r,c,p){let I=0,U=0;const E=p.length>>>1;for(;U<c;){const z=s[U+r];p[U<<1]=0,p[1+(U<<1)]=z,z>I&&(I=z),U++}for(;U<E;)p[U<<1]=0,p[1+(U<<1)]=0,U++;return I},n.H.n=function(s,r){const c=n.H.m,p=s.length;let I,U,E,z;const L=c.j;for(var F=0;F<=r;F++)L[F]=0;for(F=1;F<p;F+=2)L[s[F]]++;const B=c.K;for(I=0,L[0]=0,U=1;U<=r;U++)I=I+L[U-1]<<1,B[U]=I;for(E=0;E<p;E+=2)z=s[E+1],z!=0&&(s[E]=B[z],B[z]++)},n.H.A=function(s,r,c){const p=s.length,I=n.H.m.r;for(let U=0;U<p;U+=2)if(s[U+1]!=0){const E=U>>1,z=s[U+1],L=E<<4|z,F=r-z;let B=s[U]<<F;const b=B+(1<<F);for(;B!=b;)c[I[B]>>>15-r]=L,B++}},n.H.l=function(s,r){const c=n.H.m.r,p=15-r;for(let I=0;I<s.length;I+=2){const U=s[I]<<r-s[I+1];s[I]=c[U]>>>p}},n.H.M=function(s,r,c){c<<=7&r;const p=r>>>3;s[p]|=c,s[p+1]|=c>>>8},n.H.I=function(s,r,c){c<<=7&r;const p=r>>>3;s[p]|=c,s[p+1]|=c>>>8,s[p+2]|=c>>>16},n.H.e=function(s,r,c){return(s[r>>>3]|s[1+(r>>>3)]<<8)>>>(7&r)&(1<<c)-1},n.H.b=function(s,r,c){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)&(1<<c)-1},n.H.Z=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16)>>>(7&r)},n.H.i=function(s,r){return(s[r>>>3]|s[1+(r>>>3)]<<8|s[2+(r>>>3)]<<16|s[3+(r>>>3)]<<24)>>>(7&r)},n.H.m=function(){const s=Uint16Array,r=Uint32Array;return{K:new s(16),j:new s(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new s(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new r(32),J:new s(512),_:[],h:new s(32),$:[],w:new s(32768),C:[],v:[],d:new s(32768),D:[],u:new s(512),Q:[],r:new s(32768),s:new r(286),Y:new r(30),a:new r(19),t:new r(15e3),k:new s(65536),g:new s(32768)}}(),function(){const s=n.H.m;for(var r=0;r<32768;r++){let p=r;p=(2863311530&p)>>>1|(1431655765&p)<<1,p=(3435973836&p)>>>2|(858993459&p)<<2,p=(4042322160&p)>>>4|(252645135&p)<<4,p=(4278255360&p)>>>8|(16711935&p)<<8,s.r[r]=(p>>>16|p<<16)>>>17}function c(p,I,U){for(;I--!=0;)p.push(0,U)}for(r=0;r<32;r++)s.q[r]=s.S[r]<<3|s.T[r],s.c[r]=s.p[r]<<4|s.z[r];c(s._,144,8),c(s._,112,9),c(s._,24,7),c(s._,8,8),n.H.n(s._,9),n.H.A(s._,9,s.J),n.H.l(s._,9),c(s.$,32,5),n.H.n(s.$,5),n.H.A(s.$,5,s.h),n.H.l(s.$,5),c(s.Q,19,0),c(s.C,286,0),c(s.D,30,0),c(s.v,320,0)}(),n.H.N}();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function d(n,s,r,c,p){let I=t(s);const U=Math.ceil(c*I/8);let E,z;I=Math.ceil(I/8);let L=n[r],F=0;if(L>1&&(n[r]=[0,0,1][L-2]),L==3)for(F=I;F<U;F++)n[F+1]=n[F+1]+(n[F+1-I]>>>1)&255;for(let B=0;B<p;B++)if(E=r+B*U,z=E+B+1,L=n[z-1],F=0,L==0)for(;F<U;F++)n[E+F]=n[z+F];else if(L==1){for(;F<I;F++)n[E+F]=n[z+F];for(;F<U;F++)n[E+F]=n[z+F]+n[E+F-I]}else if(L==2)for(;F<U;F++)n[E+F]=n[z+F]+n[E+F-U];else if(L==3){for(;F<I;F++)n[E+F]=n[z+F]+(n[E+F-U]>>>1);for(;F<U;F++)n[E+F]=n[z+F]+(n[E+F-U]+n[E+F-I]>>>1)}else{for(;F<I;F++)n[E+F]=n[z+F]+i(0,n[E+F-U],0);for(;F<U;F++)n[E+F]=n[z+F]+i(n[E+F-I],n[E+F-U],n[E+F-I-U])}return n}function i(n,s,r){const c=n+s-r,p=c-n,I=c-s,U=c-r;return p*p<=I*I&&p*p<=U*U?n:I*I<=U*U?s:r}function y(n,s,r){r.width=h.readUint(n,s),s+=4,r.height=h.readUint(n,s),s+=4,r.depth=n[s],s++,r.ctype=n[s],s++,r.compress=n[s],s++,r.filter=n[s],s++,r.interlace=n[s],s++}function w(n,s,r,c,p,I,U,E,z){const L=Math.min(s,p),F=Math.min(r,I);let B=0,b=0;for(let R=0;R<F;R++)for(let g=0;g<L;g++)if(U>=0&&E>=0?(B=R*s+g<<2,b=(E+R)*p+U+g<<2):(B=(-E+R)*s-U+g<<2,b=R*p+g<<2),z==0)c[b]=n[B],c[b+1]=n[B+1],c[b+2]=n[B+2],c[b+3]=n[B+3];else if(z==1){var M=n[B+3]*.00392156862745098,f=n[B]*M,u=n[B+1]*M,v=n[B+2]*M,S=c[b+3]*(1/255),_=c[b]*S,j=c[b+1]*S,T=c[b+2]*S;const o=1-M,O=M+S*o,D=O==0?0:1/O;c[b+3]=255*O,c[b+0]=(f+_*o)*D,c[b+1]=(u+j*o)*D,c[b+2]=(v+T*o)*D}else if(z==2)M=n[B+3],f=n[B],u=n[B+1],v=n[B+2],S=c[b+3],_=c[b],j=c[b+1],T=c[b+2],M==S&&f==_&&u==j&&v==T?(c[b]=0,c[b+1]=0,c[b+2]=0,c[b+3]=0):(c[b]=f,c[b+1]=u,c[b+2]=v,c[b+3]=M);else if(z==3){if(M=n[B+3],f=n[B],u=n[B+1],v=n[B+2],S=c[b+3],_=c[b],j=c[b+1],T=c[b+2],M==S&&f==_&&u==j&&v==T)continue;if(M<220&&S>20)return!1}return!0}return{decode:function(s){const r=new Uint8Array(s);let c=8;const p=h,I=p.readUshort,U=p.readUint,E={tabs:{},frames:[]},z=new Uint8Array(r.length);let L,F=0,B=0;const b=[137,80,78,71,13,10,26,10];for(var M=0;M<8;M++)if(r[M]!=b[M])throw"The input is not a PNG file!";for(;c<r.length;){const R=p.readUint(r,c);c+=4;const g=p.readASCII(r,c,4);if(c+=4,g=="IHDR")y(r,c,E);else if(g=="iCCP"){for(var f=c;r[f]!=0;)f++;p.readASCII(r,c,f-c),r[f+1];const o=r.slice(f+2,c+R);let O=null;try{O=l(o)}catch{O=e(o)}E.tabs[g]=O}else if(g=="CgBI")E.tabs[g]=r.slice(c,c+4);else if(g=="IDAT"){for(M=0;M<R;M++)z[F+M]=r[c+M];F+=R}else if(g=="acTL")E.tabs[g]={num_frames:U(r,c),num_plays:U(r,c+4)},L=new Uint8Array(r.length);else if(g=="fcTL"){B!=0&&((T=E.frames[E.frames.length-1]).data=k(E,L.slice(0,B),T.rect.width,T.rect.height),B=0);const o={x:U(r,c+12),y:U(r,c+16),width:U(r,c+4),height:U(r,c+8)};let O=I(r,c+22);O=I(r,c+20)/(O==0?100:O);const D={rect:o,delay:Math.round(1e3*O),dispose:r[c+24],blend:r[c+25]};E.frames.push(D)}else if(g=="fdAT"){for(M=0;M<R-4;M++)L[B+M]=r[c+M+4];B+=R-4}else if(g=="pHYs")E.tabs[g]=[p.readUint(r,c),p.readUint(r,c+4),r[c+8]];else if(g=="cHRM")for(E.tabs[g]=[],M=0;M<8;M++)E.tabs[g].push(p.readUint(r,c+4*M));else if(g=="tEXt"||g=="zTXt"){E.tabs[g]==null&&(E.tabs[g]={});var u=p.nextZero(r,c),v=p.readASCII(r,c,u-c),S=c+R-u-1;if(g=="tEXt")j=p.readASCII(r,u+1,S);else{var _=l(r.slice(u+2,u+2+S));j=p.readUTF8(_,0,_.length)}E.tabs[g][v]=j}else if(g=="iTXt"){E.tabs[g]==null&&(E.tabs[g]={}),u=0,f=c,u=p.nextZero(r,f),v=p.readASCII(r,f,u-f);const o=r[f=u+1];var j;r[f+1],f+=2,u=p.nextZero(r,f),p.readASCII(r,f,u-f),f=u+1,u=p.nextZero(r,f),p.readUTF8(r,f,u-f),S=R-((f=u+1)-c),o==0?j=p.readUTF8(r,f,S):(_=l(r.slice(f,f+S)),j=p.readUTF8(_,0,_.length)),E.tabs[g][v]=j}else if(g=="PLTE")E.tabs[g]=p.readBytes(r,c,R);else if(g=="hIST"){const o=E.tabs.PLTE.length/3;for(E.tabs[g]=[],M=0;M<o;M++)E.tabs[g].push(I(r,c+2*M))}else if(g=="tRNS")E.ctype==3?E.tabs[g]=p.readBytes(r,c,R):E.ctype==0?E.tabs[g]=I(r,c):E.ctype==2&&(E.tabs[g]=[I(r,c),I(r,c+2),I(r,c+4)]);else if(g=="gAMA")E.tabs[g]=p.readUint(r,c)/1e5;else if(g=="sRGB")E.tabs[g]=r[c];else if(g=="bKGD")E.ctype==0||E.ctype==4?E.tabs[g]=[I(r,c)]:E.ctype==2||E.ctype==6?E.tabs[g]=[I(r,c),I(r,c+2),I(r,c+4)]:E.ctype==3&&(E.tabs[g]=r[c]);else if(g=="IEND")break;c+=R,p.readUint(r,c),c+=4}var T;return B!=0&&((T=E.frames[E.frames.length-1]).data=k(E,L.slice(0,B),T.rect.width,T.rect.height)),E.data=k(E,z,E.width,E.height),delete E.compress,delete E.interlace,delete E.filter,E},toRGBA8:function(s){const r=s.width,c=s.height;if(s.tabs.acTL==null)return[x(s.data,r,c,s).buffer];const p=[];s.frames[0].data==null&&(s.frames[0].data=s.data);const I=r*c*4,U=new Uint8Array(I),E=new Uint8Array(I),z=new Uint8Array(I);for(let F=0;F<s.frames.length;F++){const B=s.frames[F],b=B.rect.x,M=B.rect.y,f=B.rect.width,u=B.rect.height,v=x(B.data,f,u,s);if(F!=0)for(var L=0;L<I;L++)z[L]=U[L];if(B.blend==0?w(v,f,u,U,r,c,b,M,0):B.blend==1&&w(v,f,u,U,r,c,b,M,1),p.push(U.buffer.slice(0)),B.dispose!=0){if(B.dispose==1)w(E,f,u,U,r,c,b,M,0);else if(B.dispose==2)for(L=0;L<I;L++)U[L]=z[L]}}return p},_paeth:i,_copyTile:w,_bin:h}}();(function(){const{_copyTile:h}=Xe,{_bin:x}=Xe,k=Xe._paeth;var l={table:function(){const f=new Uint32Array(256);for(let u=0;u<256;u++){let v=u;for(let S=0;S<8;S++)1&v?v=3988292384^v>>>1:v>>>=1;f[u]=v}return f}(),update(f,u,v,S){for(let _=0;_<S;_++)f=l.table[255&(f^u[v+_])]^f>>>8;return f},crc:(f,u,v)=>4294967295^l.update(4294967295,f,u,v)};function e(f,u,v,S){u[v]+=f[0]*S>>4,u[v+1]+=f[1]*S>>4,u[v+2]+=f[2]*S>>4,u[v+3]+=f[3]*S>>4}function t(f){return Math.max(0,Math.min(255,f))}function d(f,u){const v=f[0]-u[0],S=f[1]-u[1],_=f[2]-u[2],j=f[3]-u[3];return v*v+S*S+_*_+j*j}function i(f,u,v,S,_,j,T){T==null&&(T=1);const R=S.length,g=[];for(var o=0;o<R;o++){const N=S[o];g.push([N>>>0&255,N>>>8&255,N>>>16&255,N>>>24&255])}for(o=0;o<R;o++){let N=4294967295;for(var O=0,D=0;D<R;D++){var P=d(g[o],g[D]);D!=o&&P<N&&(N=P,O=D)}}const Y=new Uint32Array(_.buffer),W=new Int16Array(u*v*4),V=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(o=0;o<V.length;o++)V[o]=255*((V[o]+.5)/16-.5);for(let N=0;N<v;N++)for(let Z=0;Z<u;Z++){var q;o=4*(N*u+Z),T!=2?q=[t(f[o]+W[o]),t(f[o+1]+W[o+1]),t(f[o+2]+W[o+2]),t(f[o+3]+W[o+3])]:(P=V[4*(3&N)+(3&Z)],q=[t(f[o]+P),t(f[o+1]+P),t(f[o+2]+P),t(f[o+3]+P)]),O=0;let de=16777215;for(D=0;D<R;D++){const le=d(q,g[D]);le<de&&(de=le,O=D)}const ne=g[O],ee=[q[0]-ne[0],q[1]-ne[1],q[2]-ne[2],q[3]-ne[3]];T==1&&(Z!=u-1&&e(ee,W,o+4,7),N!=v-1&&(Z!=0&&e(ee,W,o+4*u-4,3),e(ee,W,o+4*u,5),Z!=u-1&&e(ee,W,o+4*u+4,1))),j[o>>2]=O,Y[o>>2]=S[O]}}function y(f,u,v,S,_){_==null&&(_={});const{crc:j}=l,T=x.writeUint,R=x.writeUshort,g=x.writeASCII;let o=8;const O=f.frames.length>1;let D,P=!1,Y=33+(O?20:0);if(_.sRGB!=null&&(Y+=13),_.pHYs!=null&&(Y+=21),_.iCCP!=null&&(D=pako.deflate(_.iCCP),Y+=21+D.length+4),f.ctype==3){for(var W=f.plte.length,V=0;V<W;V++)f.plte[V]>>>24!=255&&(P=!0);Y+=8+3*W+4+(P?8+1*W+4:0)}for(var q=0;q<f.frames.length;q++)O&&(Y+=38),Y+=(ne=f.frames[q]).cimg.length+12,q!=0&&(Y+=4);Y+=12;const N=new Uint8Array(Y),Z=[137,80,78,71,13,10,26,10];for(V=0;V<8;V++)N[V]=Z[V];if(T(N,o,13),o+=4,g(N,o,"IHDR"),o+=4,T(N,o,u),o+=4,T(N,o,v),o+=4,N[o]=f.depth,o++,N[o]=f.ctype,o++,N[o]=0,o++,N[o]=0,o++,N[o]=0,o++,T(N,o,j(N,o-17,17)),o+=4,_.sRGB!=null&&(T(N,o,1),o+=4,g(N,o,"sRGB"),o+=4,N[o]=_.sRGB,o++,T(N,o,j(N,o-5,5)),o+=4),_.iCCP!=null){const ee=13+D.length;T(N,o,ee),o+=4,g(N,o,"iCCP"),o+=4,g(N,o,"ICC profile"),o+=11,o+=2,N.set(D,o),o+=D.length,T(N,o,j(N,o-(ee+4),ee+4)),o+=4}if(_.pHYs!=null&&(T(N,o,9),o+=4,g(N,o,"pHYs"),o+=4,T(N,o,_.pHYs[0]),o+=4,T(N,o,_.pHYs[1]),o+=4,N[o]=_.pHYs[2],o++,T(N,o,j(N,o-13,13)),o+=4),O&&(T(N,o,8),o+=4,g(N,o,"acTL"),o+=4,T(N,o,f.frames.length),o+=4,T(N,o,_.loop!=null?_.loop:0),o+=4,T(N,o,j(N,o-12,12)),o+=4),f.ctype==3){for(T(N,o,3*(W=f.plte.length)),o+=4,g(N,o,"PLTE"),o+=4,V=0;V<W;V++){const ee=3*V,le=f.plte[V],re=255&le,ue=le>>>8&255,Fe=le>>>16&255;N[o+ee+0]=re,N[o+ee+1]=ue,N[o+ee+2]=Fe}if(o+=3*W,T(N,o,j(N,o-3*W-4,3*W+4)),o+=4,P){for(T(N,o,W),o+=4,g(N,o,"tRNS"),o+=4,V=0;V<W;V++)N[o+V]=f.plte[V]>>>24&255;o+=W,T(N,o,j(N,o-W-4,W+4)),o+=4}}let de=0;for(q=0;q<f.frames.length;q++){var ne=f.frames[q];O&&(T(N,o,26),o+=4,g(N,o,"fcTL"),o+=4,T(N,o,de++),o+=4,T(N,o,ne.rect.width),o+=4,T(N,o,ne.rect.height),o+=4,T(N,o,ne.rect.x),o+=4,T(N,o,ne.rect.y),o+=4,R(N,o,S[q]),o+=2,R(N,o,1e3),o+=2,N[o]=ne.dispose,o++,N[o]=ne.blend,o++,T(N,o,j(N,o-30,30)),o+=4);const ee=ne.cimg;T(N,o,(W=ee.length)+(q==0?0:4)),o+=4;const le=o;g(N,o,q==0?"IDAT":"fdAT"),o+=4,q!=0&&(T(N,o,de++),o+=4),N.set(ee,o),o+=W,T(N,o,j(N,le,o-le)),o+=4}return T(N,o,0),o+=4,g(N,o,"IEND"),o+=4,T(N,o,j(N,o-4,4)),o+=4,N.buffer}function w(f,u,v){for(let S=0;S<f.frames.length;S++){const _=f.frames[S];_.rect.width;const j=_.rect.height,T=new Uint8Array(j*_.bpl+j);_.cimg=c(_.img,j,_.bpp,_.bpl,T,u,v)}}function n(f,u,v,S,_){const j=_[0],T=_[1],R=_[2],g=_[3],o=_[4],O=_[5];let D=6,P=8,Y=255;for(var W=0;W<f.length;W++){const Te=new Uint8Array(f[W]);for(var V=Te.length,q=0;q<V;q+=4)Y&=Te[q+3]}const N=Y!=255,Z=function(ae,ce,be,Se,xe,ve){const ge=[];for(var ie=0;ie<ae.length;ie++){const J=new Uint8Array(ae[ie]),ke=new Uint32Array(J.buffer);var Ae;let te=0,Ee=0,fe=ce,Ue=be,it=Se?1:0;if(ie!=0){const bt=ve||Se||ie==1||ge[ie-2].dispose!=0?1:2;let xt=0,Ke=1e9;for(let at=0;at<bt;at++){var _e=new Uint8Array(ae[ie-1-at]);const Ot=new Uint32Array(ae[ie-1-at]);let he=ce,Ce=be,Je=-1,et=-1;for(let He=0;He<be;He++)for(let ze=0;ze<ce;ze++)ke[K=He*ce+ze]!=Ot[K]&&(ze<he&&(he=ze),ze>Je&&(Je=ze),He<Ce&&(Ce=He),He>et&&(et=He));Je==-1&&(he=Ce=Je=et=0),xe&&((1&he)==1&&he--,(1&Ce)==1&&Ce--);const ct=(Je-he+1)*(et-Ce+1);ct<Ke&&(Ke=ct,xt=at,te=he,Ee=Ce,fe=Je-he+1,Ue=et-Ce+1)}_e=new Uint8Array(ae[ie-1-xt]),xt==1&&(ge[ie-1].dispose=2),Ae=new Uint8Array(fe*Ue*4),h(_e,ce,be,Ae,fe,Ue,-te,-Ee,0),it=h(J,ce,be,Ae,fe,Ue,-te,-Ee,3)?1:0,it==1?r(J,ce,be,Ae,{x:te,y:Ee,width:fe,height:Ue}):h(J,ce,be,Ae,fe,Ue,-te,-Ee,0)}else Ae=J.slice(0);ge.push({rect:{x:te,y:Ee,width:fe,height:Ue},img:Ae,blend:it,dispose:0})}if(Se)for(ie=0;ie<ge.length;ie++){if((Ge=ge[ie]).blend==1)continue;const J=Ge.rect,ke=ge[ie-1].rect,te=Math.min(J.x,ke.x),Ee=Math.min(J.y,ke.y),fe={x:te,y:Ee,width:Math.max(J.x+J.width,ke.x+ke.width)-te,height:Math.max(J.y+J.height,ke.y+ke.height)-Ee};ge[ie-1].dispose=1,ie-1!=0&&s(ae,ce,be,ge,ie-1,fe,xe),s(ae,ce,be,ge,ie,fe,xe)}let st=0;if(ae.length!=1)for(var K=0;K<ge.length;K++){var Ge;st+=(Ge=ge[K]).rect.width*Ge.rect.height}return ge}(f,u,v,j,T,R),de={},ne=[],ee=[];if(S!=0){const Te=[];for(q=0;q<Z.length;q++)Te.push(Z[q].img.buffer);const ae=function(xe){let ve=0;for(var ge=0;ge<xe.length;ge++)ve+=xe[ge].byteLength;const ie=new Uint8Array(ve);let Ae=0;for(ge=0;ge<xe.length;ge++){const _e=new Uint8Array(xe[ge]),st=_e.length;for(let K=0;K<st;K+=4){let Ge=_e[K],J=_e[K+1],ke=_e[K+2];const te=_e[K+3];te==0&&(Ge=J=ke=0),ie[Ae+K]=Ge,ie[Ae+K+1]=J,ie[Ae+K+2]=ke,ie[Ae+K+3]=te}Ae+=st}return ie.buffer}(Te),ce=I(ae,S);for(q=0;q<ce.plte.length;q++)ne.push(ce.plte[q].est.rgba);let be=0;for(q=0;q<Z.length;q++){const Se=(re=Z[q]).img.length;var le=new Uint8Array(ce.inds.buffer,be>>2,Se>>2);ee.push(le);const xe=new Uint8Array(ce.abuf,be,Se);O&&i(re.img,re.rect.width,re.rect.height,ne,xe,le),re.img.set(xe),be+=Se}}else for(W=0;W<Z.length;W++){var re=Z[W];const Te=new Uint32Array(re.img.buffer);var ue=re.rect.width;for(V=Te.length,le=new Uint8Array(V),ee.push(le),q=0;q<V;q++){const ae=Te[q];if(q!=0&&ae==Te[q-1])le[q]=le[q-1];else if(q>ue&&ae==Te[q-ue])le[q]=le[q-ue];else{let ce=de[ae];if(ce==null&&(de[ae]=ce=ne.length,ne.push(ae),ne.length>=300))break;le[q]=ce}}}const Fe=ne.length;for(Fe<=256&&o==0&&(P=Fe<=2?1:Fe<=4?2:Fe<=16?4:8,P=Math.max(P,g)),W=0;W<Z.length;W++){(re=Z[W]).rect.x,re.rect.y,ue=re.rect.width;const Te=re.rect.height;let ae=re.img;new Uint32Array(ae.buffer);let ce=4*ue,be=4;if(Fe<=256&&o==0){ce=Math.ceil(P*ue/8);var ye=new Uint8Array(ce*Te);const Se=ee[W];for(let xe=0;xe<Te;xe++){q=xe*ce;const ve=xe*ue;if(P==8)for(var me=0;me<ue;me++)ye[q+me]=Se[ve+me];else if(P==4)for(me=0;me<ue;me++)ye[q+(me>>1)]|=Se[ve+me]<<4-4*(1&me);else if(P==2)for(me=0;me<ue;me++)ye[q+(me>>2)]|=Se[ve+me]<<6-2*(3&me);else if(P==1)for(me=0;me<ue;me++)ye[q+(me>>3)]|=Se[ve+me]<<7-1*(7&me)}ae=ye,D=3,be=1}else if(N==0&&Z.length==1){ye=new Uint8Array(ue*Te*3);const Se=ue*Te;for(q=0;q<Se;q++){const xe=3*q,ve=4*q;ye[xe]=ae[ve],ye[xe+1]=ae[ve+1],ye[xe+2]=ae[ve+2]}ae=ye,D=2,be=3,ce=3*ue}re.img=ae,re.bpl=ce,re.bpp=be}return{ctype:D,depth:P,plte:ne,frames:Z}}function s(f,u,v,S,_,j,T){const R=Uint8Array,g=Uint32Array,o=new R(f[_-1]),O=new g(f[_-1]),D=_+1<f.length?new R(f[_+1]):null,P=new R(f[_]),Y=new g(P.buffer);let W=u,V=v,q=-1,N=-1;for(let de=0;de<j.height;de++)for(let ne=0;ne<j.width;ne++){const ee=j.x+ne,le=j.y+de,re=le*u+ee,ue=Y[re];ue==0||S[_-1].dispose==0&&O[re]==ue&&(D==null||D[4*re+3]!=0)||(ee<W&&(W=ee),ee>q&&(q=ee),le<V&&(V=le),le>N&&(N=le))}q==-1&&(W=V=q=N=0),T&&((1&W)==1&&W--,(1&V)==1&&V--),j={x:W,y:V,width:q-W+1,height:N-V+1};const Z=S[_];Z.rect=j,Z.blend=1,Z.img=new Uint8Array(j.width*j.height*4),S[_-1].dispose==0?(h(o,u,v,Z.img,j.width,j.height,-j.x,-j.y,0),r(P,u,v,Z.img,j)):h(P,u,v,Z.img,j.width,j.height,-j.x,-j.y,0)}function r(f,u,v,S,_){h(f,u,v,S,_.width,_.height,-_.x,-_.y,2)}function c(f,u,v,S,_,j,T){const R=[];let g,o=[0,1,2,3,4];j!=-1?o=[j]:(u*S>5e5||v==1)&&(o=[0]),T&&(g={level:0});const O=_s;for(var D=0;D<o.length;D++){for(let W=0;W<u;W++)p(_,f,W,S,v,o[D]);R.push(O.deflate(_,g))}let P,Y=1e9;for(D=0;D<R.length;D++)R[D].length<Y&&(P=D,Y=R[D].length);return R[P]}function p(f,u,v,S,_,j){const T=v*S;let R=T+v;if(f[R]=j,R++,j==0)if(S<500)for(var g=0;g<S;g++)f[R+g]=u[T+g];else f.set(new Uint8Array(u.buffer,T,S),R);else if(j==1){for(g=0;g<_;g++)f[R+g]=u[T+g];for(g=_;g<S;g++)f[R+g]=u[T+g]-u[T+g-_]+256&255}else if(v==0){for(g=0;g<_;g++)f[R+g]=u[T+g];if(j==2)for(g=_;g<S;g++)f[R+g]=u[T+g];if(j==3)for(g=_;g<S;g++)f[R+g]=u[T+g]-(u[T+g-_]>>1)+256&255;if(j==4)for(g=_;g<S;g++)f[R+g]=u[T+g]-k(u[T+g-_],0,0)+256&255}else{if(j==2)for(g=0;g<S;g++)f[R+g]=u[T+g]+256-u[T+g-S]&255;if(j==3){for(g=0;g<_;g++)f[R+g]=u[T+g]+256-(u[T+g-S]>>1)&255;for(g=_;g<S;g++)f[R+g]=u[T+g]+256-(u[T+g-S]+u[T+g-_]>>1)&255}if(j==4){for(g=0;g<_;g++)f[R+g]=u[T+g]+256-k(0,u[T+g-S],0)&255;for(g=_;g<S;g++)f[R+g]=u[T+g]+256-k(u[T+g-_],u[T+g-S],u[T+g-_-S])&255}}}function I(f,u){const v=new Uint8Array(f),S=v.slice(0),_=new Uint32Array(S.buffer),j=U(S,u),T=j[0],R=j[1],g=v.length,o=new Uint8Array(g>>2);let O;if(v.length<2e7)for(var D=0;D<g;D+=4)O=E(T,P=v[D]*(1/255),Y=v[D+1]*(1/255),W=v[D+2]*(1/255),V=v[D+3]*(1/255)),o[D>>2]=O.ind,_[D>>2]=O.est.rgba;else for(D=0;D<g;D+=4){var P=v[D]*.00392156862745098,Y=v[D+1]*(1/255),W=v[D+2]*(1/255),V=v[D+3]*(1/255);for(O=T;O.left;)O=z(O.est,P,Y,W,V)<=0?O.left:O.right;o[D>>2]=O.ind,_[D>>2]=O.est.rgba}return{abuf:S.buffer,inds:o,plte:R}}function U(f,u,v){v==null&&(v=1e-4);const S=new Uint32Array(f.buffer),_={i0:0,i1:f.length,bst:null,est:null,tdst:0,left:null,right:null};_.bst=B(f,_.i0,_.i1),_.est=b(_.bst);const j=[_];for(;j.length<u;){let R=0,g=0;for(var T=0;T<j.length;T++)j[T].est.L>R&&(R=j[T].est.L,g=T);if(R<v)break;const o=j[g],O=L(f,S,o.i0,o.i1,o.est.e,o.est.eMq255);if(o.i0>=O||o.i1<=O){o.est.L=0;continue}const D={i0:o.i0,i1:O,bst:null,est:null,tdst:0,left:null,right:null};D.bst=B(f,D.i0,D.i1),D.est=b(D.bst);const P={i0:O,i1:o.i1,bst:null,est:null,tdst:0,left:null,right:null};for(P.bst={R:[],m:[],N:o.bst.N-D.bst.N},T=0;T<16;T++)P.bst.R[T]=o.bst.R[T]-D.bst.R[T];for(T=0;T<4;T++)P.bst.m[T]=o.bst.m[T]-D.bst.m[T];P.est=b(P.bst),o.left=D,o.right=P,j[g]=D,j.push(P)}for(j.sort((R,g)=>g.bst.N-R.bst.N),T=0;T<j.length;T++)j[T].ind=T;return[_,j]}function E(f,u,v,S,_){if(f.left==null)return f.tdst=function(D,P,Y,W,V){const q=P-D[0],N=Y-D[1],Z=W-D[2],de=V-D[3];return q*q+N*N+Z*Z+de*de}(f.est.q,u,v,S,_),f;const j=z(f.est,u,v,S,_);let T=f.left,R=f.right;j>0&&(T=f.right,R=f.left);const g=E(T,u,v,S,_);if(g.tdst<=j*j)return g;const o=E(R,u,v,S,_);return o.tdst<g.tdst?o:g}function z(f,u,v,S,_){const{e:j}=f;return j[0]*u+j[1]*v+j[2]*S+j[3]*_-f.eMq}function L(f,u,v,S,_,j){for(S-=4;v<S;){for(;F(f,v,_)<=j;)v+=4;for(;F(f,S,_)>j;)S-=4;if(v>=S)break;const T=u[v>>2];u[v>>2]=u[S>>2],u[S>>2]=T,v+=4,S-=4}for(;F(f,v,_)>j;)v-=4;return v+4}function F(f,u,v){return f[u]*v[0]+f[u+1]*v[1]+f[u+2]*v[2]+f[u+3]*v[3]}function B(f,u,v){const S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_=[0,0,0,0],j=v-u>>2;for(let T=u;T<v;T+=4){const R=f[T]*.00392156862745098,g=f[T+1]*(1/255),o=f[T+2]*(1/255),O=f[T+3]*(1/255);_[0]+=R,_[1]+=g,_[2]+=o,_[3]+=O,S[0]+=R*R,S[1]+=R*g,S[2]+=R*o,S[3]+=R*O,S[5]+=g*g,S[6]+=g*o,S[7]+=g*O,S[10]+=o*o,S[11]+=o*O,S[15]+=O*O}return S[4]=S[1],S[8]=S[2],S[9]=S[6],S[12]=S[3],S[13]=S[7],S[14]=S[11],{R:S,m:_,N:j}}function b(f){const{R:u}=f,{m:v}=f,{N:S}=f,_=v[0],j=v[1],T=v[2],R=v[3],g=S==0?0:1/S,o=[u[0]-_*_*g,u[1]-_*j*g,u[2]-_*T*g,u[3]-_*R*g,u[4]-j*_*g,u[5]-j*j*g,u[6]-j*T*g,u[7]-j*R*g,u[8]-T*_*g,u[9]-T*j*g,u[10]-T*T*g,u[11]-T*R*g,u[12]-R*_*g,u[13]-R*j*g,u[14]-R*T*g,u[15]-R*R*g],O=o,D=M;let P=[Math.random(),Math.random(),Math.random(),Math.random()],Y=0,W=0;if(S!=0)for(let q=0;q<16&&(P=D.multVec(O,P),W=Math.sqrt(D.dot(P,P)),P=D.sml(1/W,P),!(q!=0&&Math.abs(W-Y)<1e-9));q++)Y=W;const V=[_*g,j*g,T*g,R*g];return{Cov:o,q:V,e:P,L:Y,eMq255:D.dot(D.sml(255,V),P),eMq:D.dot(P,V),rgba:(Math.round(255*V[3])<<24|Math.round(255*V[2])<<16|Math.round(255*V[1])<<8|Math.round(255*V[0])<<0)>>>0}}var M={multVec:(f,u)=>[f[0]*u[0]+f[1]*u[1]+f[2]*u[2]+f[3]*u[3],f[4]*u[0]+f[5]*u[1]+f[6]*u[2]+f[7]*u[3],f[8]*u[0]+f[9]*u[1]+f[10]*u[2]+f[11]*u[3],f[12]*u[0]+f[13]*u[1]+f[14]*u[2]+f[15]*u[3]],dot:(f,u)=>f[0]*u[0]+f[1]*u[1]+f[2]*u[2]+f[3]*u[3],sml:(f,u)=>[f*u[0],f*u[1],f*u[2],f*u[3]]};Xe.encode=function(u,v,S,_,j,T,R){_==null&&(_=0),R==null&&(R=!1);const g=n(u,v,S,_,[!1,!1,!1,0,R,!1]);return w(g,-1),y(g,v,S,j,T)},Xe.encodeLL=function(u,v,S,_,j,T,R,g){const o={ctype:0+(_==1?0:2)+(j==0?0:4),depth:T,frames:[]},O=(_+j)*T,D=O*v;for(let P=0;P<u.length;P++)o.frames.push({rect:{x:0,y:0,width:v,height:S},img:new Uint8Array(u[P]),blend:0,dispose:1,bpp:Math.ceil(O/8),bpl:Math.ceil(D/8)});return w(o,0,!0),y(o,v,S,R,g)},Xe.encode.compress=n,Xe.encode.dither=i,Xe.quantize=I,Xe.quantize.getKDtree=U,Xe.quantize.getNearest=E})();const Ar={toArrayBuffer(h,x){const k=h.width,l=h.height,e=k<<2,t=h.getContext("2d").getImageData(0,0,k,l),d=new Uint32Array(t.data.buffer),i=(32*k+31)/32<<2,y=i*l,w=122+y,n=new ArrayBuffer(w),s=new DataView(n),r=1<<20;let c,p,I,U,E=r,z=0,L=0,F=0;function B(f){s.setUint16(L,f,!0),L+=2}function b(f){s.setUint32(L,f,!0),L+=4}function M(f){L+=f}B(19778),b(w),M(4),b(122),b(108),b(k),b(-l>>>0),B(1),B(32),b(3),b(y),b(2835),b(2835),M(8),b(16711680),b(65280),b(255),b(4278190080),b(1466527264),function f(){for(;z<l&&E>0;){for(U=122+z*i,c=0;c<e;)E--,p=d[F++],I=p>>>24,s.setUint32(U+c,p<<8|I),c+=4;z++}F<d.length?(E=r,setTimeout(f,Ar._dly)):x(n)}()},toBlob(h,x){this.toArrayBuffer(h,k=>{x(new Blob([k],{type:"image/bmp"}))})},_dly:9};var Be={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Es={[Be.CHROME]:16384,[Be.FIREFOX]:11180,[Be.DESKTOP_SAFARI]:16384,[Be.IE]:8192,[Be.IOS]:4096,[Be.ETC]:8192};const zn=typeof window<"u",Sr=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,bn=zn&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),js=(zn||Sr)&&(bn&&bn.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Cr=(zn||Sr)&&(bn&&bn.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function $n(h,x,k=Date.now()){return new Promise(l=>{const e=h.split(","),t=e[0].match(/:(.*?);/)[1],d=globalThis.atob(e[1]);let i=d.length;const y=new Uint8Array(i);for(;i--;)y[i]=d.charCodeAt(i);const w=new Blob([y],{type:t});w.name=x,w.lastModified=k,l(w)})}function wr(h){return new Promise((x,k)=>{const l=new Cr;l.onload=()=>x(l.result),l.onerror=e=>k(e),l.readAsDataURL(h)})}function _r(h){return new Promise((x,k)=>{const l=new Image;l.onload=()=>x(l),l.onerror=e=>k(e),l.src=h})}function Tt(){if(Tt.cachedResult!==void 0)return Tt.cachedResult;let h=Be.ETC;const{userAgent:x}=navigator;return/Chrom(e|ium)/i.test(x)?h=Be.CHROME:/iP(ad|od|hone)/i.test(x)&&/WebKit/i.test(x)?h=Be.IOS:/Safari/i.test(x)?h=Be.DESKTOP_SAFARI:/Firefox/i.test(x)?h=Be.FIREFOX:(/MSIE/i.test(x)||document.documentMode)&&(h=Be.IE),Tt.cachedResult=h,Tt.cachedResult}function Er(h,x){const k=Tt(),l=Es[k];let e=h,t=x,d=e*t;const i=e>t?t/e:e/t;for(;d>l*l;){const y=(l+e)/2,w=(l+t)/2;y<w?(t=w,e=w*i):(t=y*i,e=y),d=e*t}return{width:e,height:t}}function yn(h,x){let k,l;try{if(k=new OffscreenCanvas(h,x),l=k.getContext("2d"),l===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{k=document.createElement("canvas"),l=k.getContext("2d")}return k.width=h,k.height=x,[k,l]}function jr(h,x){const{width:k,height:l}=Er(h.width,h.height),[e,t]=yn(k,l);return x&&/jpe?g/.test(x)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(h,0,0,e.width,e.height),e}function fn(){return fn.cachedResult!==void 0||(fn.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),fn.cachedResult}function xn(h,x={}){return new Promise(function(k,l){let e,t;var d=function(){try{return t=jr(e,x.fileType||h.type),k([e,t])}catch(y){return l(y)}},i=function(y){try{var w=function(n){try{throw n}catch(s){return l(s)}};try{let n;return wr(h).then(function(s){try{return n=s,_r(n).then(function(r){try{return e=r,function(){try{return d()}catch(c){return l(c)}}()}catch(c){return w(c)}},w)}catch(r){return w(r)}},w)}catch(n){w(n)}}catch(n){return l(n)}};try{if(fn()||[Be.DESKTOP_SAFARI,Be.MOBILE_SAFARI].includes(Tt()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(h).then(function(y){try{return e=y,d()}catch{return i()}},i)}catch{i()}})}function vn(h,x,k,l,e=1){return new Promise(function(t,d){let i;if(x==="image/png"){let w,n,s;return w=h.getContext("2d"),{data:n}=w.getImageData(0,0,h.width,h.height),s=Xe.encode([n.buffer],h.width,h.height,4096*e),i=new Blob([s],{type:x}),i.name=k,i.lastModified=l,y.call(this)}{let w=function(){return y.call(this)};if(x==="image/bmp")return new Promise(n=>Ar.toBlob(h,n)).then((function(n){try{return i=n,i.name=k,i.lastModified=l,w.call(this)}catch(s){return d(s)}}).bind(this),d);{let n=function(){return w.call(this)};if(typeof OffscreenCanvas=="function"&&h instanceof OffscreenCanvas)return h.convertToBlob({type:x,quality:e}).then((function(s){try{return i=s,i.name=k,i.lastModified=l,n.call(this)}catch(r){return d(r)}}).bind(this),d);{let s;return s=h.toDataURL(x,e),$n(s,k,l).then((function(r){try{return i=r,n.call(this)}catch(c){return d(c)}}).bind(this),d)}}}function y(){return t(i)}})}function nt(h){h.width=0,h.height=0}function _t(){return new Promise(function(h,x){let k,l,e,t;return _t.cachedResult!==void 0?h(_t.cachedResult):$n("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(d){try{return k=d,xn(k).then(function(i){try{return l=i[1],vn(l,k.type,k.name,k.lastModified).then(function(y){try{return e=y,nt(l),xn(e).then(function(w){try{return t=w[0],_t.cachedResult=t.width===1&&t.height===2,h(_t.cachedResult)}catch(n){return x(n)}},x)}catch(w){return x(w)}},x)}catch(y){return x(y)}},x)}catch(i){return x(i)}},x)})}function Ir(h){return new Promise((x,k)=>{const l=new Cr;l.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return x(-2);const d=t.byteLength;let i=2;for(;i<d;){if(t.getUint16(i+2,!1)<=8)return x(-1);const y=t.getUint16(i,!1);if(i+=2,y==65505){if(t.getUint32(i+=2,!1)!=1165519206)return x(-1);const w=t.getUint16(i+=6,!1)==18761;i+=t.getUint32(i+4,w);const n=t.getUint16(i,w);i+=2;for(let s=0;s<n;s++)if(t.getUint16(i+12*s,w)==274)return x(t.getUint16(i+12*s+8,w))}else{if((65280&y)!=65280)break;i+=t.getUint16(i,!1)}}return x(-1)},l.onerror=e=>k(e),l.readAsArrayBuffer(h)})}function Dr(h,x){const{width:k}=h,{height:l}=h,{maxWidthOrHeight:e}=x;let t,d=h;return isFinite(e)&&(k>e||l>e)&&([d,t]=yn(k,l),k>l?(d.width=e,d.height=l/k*e):(d.width=k/l*e,d.height=e),t.drawImage(h,0,0,d.width,d.height),nt(h)),d}function Rr(h,x){const{width:k}=h,{height:l}=h,[e,t]=yn(k,l);switch(x>4&&x<9?(e.width=l,e.height=k):(e.width=k,e.height=l),x){case 2:t.transform(-1,0,0,1,k,0);break;case 3:t.transform(-1,0,0,-1,k,l);break;case 4:t.transform(1,0,0,-1,0,l);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,l,0);break;case 7:t.transform(0,-1,-1,0,l,k);break;case 8:t.transform(0,-1,1,0,0,k)}return t.drawImage(h,0,0,k,l),nt(h),e}function tr(h,x,k=0){return new Promise(function(l,e){let t,d,i,y,w,n,s,r,c,p,I,U,E,z,L,F,B,b,M,f;function u(S=5){if(x.signal&&x.signal.aborted)throw x.signal.reason;t+=S,x.onProgress(Math.min(t,100))}function v(S){if(x.signal&&x.signal.aborted)throw x.signal.reason;t=Math.min(Math.max(S,t),100),x.onProgress(t)}return t=k,d=x.maxIteration||10,i=1024*x.maxSizeMB*1024,u(),xn(h,x).then((function(S){try{return[,y]=S,u(),w=Dr(y,x),u(),new Promise(function(_,j){var T;if(!(T=x.exifOrientation))return Ir(h).then((function(g){try{return T=g,R.call(this)}catch(o){return j(o)}}).bind(this),j);function R(){return _(T)}return R.call(this)}).then((function(_){try{return n=_,u(),_t().then((function(j){try{return s=j?w:Rr(w,n),u(),r=x.initialQuality||1,c=x.fileType||h.type,vn(s,c,h.name,h.lastModified,r).then((function(T){try{{let g=function(){if(d--&&(L>i||L>E)){let O,D;return O=f?.95*M.width:M.width,D=f?.95*M.height:M.height,[B,b]=yn(O,D),b.drawImage(M,0,0,O,D),r*=c==="image/png"?.85:.95,vn(B,c,h.name,h.lastModified,r).then(function(P){try{return F=P,nt(M),M=B,L=F.size,v(Math.min(99,Math.floor((z-L)/(z-i)*100))),g}catch(Y){return e(Y)}},e)}return[1]},o=function(){return nt(M),nt(B),nt(w),nt(s),nt(y),v(100),l(F)};if(p=T,u(),I=p.size>i,U=p.size>h.size,!I&&!U)return v(100),l(p);var R;return E=h.size,z=p.size,L=z,M=s,f=!x.alwaysKeepResolution&&I,(R=(function(O){for(;O;){if(O.then)return void O.then(R,e);try{if(O.pop){if(O.length)return O.pop()?o.call(this):O;O=g}else O=O.call(this)}catch(D){return e(D)}}}).bind(this))(g)}}catch(g){return e(g)}}).bind(this),e)}catch(T){return e(T)}}).bind(this),e)}catch(j){return e(j)}}).bind(this),e)}catch(_){return e(_)}}).bind(this),e)})}const Is=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let jn;function Ds(h,x){return new Promise((k,l)=>{jn||(jn=function(d){const i=[];return i.push(d),URL.createObjectURL(new Blob(i))}(Is));const e=new Worker(jn);e.addEventListener("message",function(d){if(x.signal&&x.signal.aborted)e.terminate();else if(d.data.progress===void 0){if(d.data.error)return l(new Error(d.data.error)),void e.terminate();k(d.data.file),e.terminate()}else x.onProgress(d.data.progress)}),e.addEventListener("error",l),x.signal&&x.signal.addEventListener("abort",()=>{l(x.signal.reason),e.terminate()}),e.postMessage({file:h,imageCompressionLibUrl:x.libURL,options:{...x,onProgress:void 0,signal:void 0}})})}function Oe(h,x){return new Promise(function(k,l){let e,t,d,i,y,w;if(e={...x},d=0,{onProgress:i}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,y=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=c=>{d=c,typeof i=="function"&&i(d)},!(h instanceof Blob||h instanceof js))return l(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(h.type))return l(new Error("The file given is not an image"));if(w=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!y||typeof Worker!="function"||w)return tr(h,e).then((function(c){try{return t=c,r.call(this)}catch(p){return l(p)}}).bind(this),l);var n=(function(){try{return r.call(this)}catch(c){return l(c)}}).bind(this),s=function(c){try{return tr(h,e).then(function(p){try{return t=p,n()}catch(I){return l(I)}},l)}catch(p){return l(p)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Ds(h,e).then(function(c){try{return t=c,n()}catch{return s()}},s)}catch{s()}function r(){try{t.name=h.name,t.lastModified=h.lastModified}catch{}try{e.preserveExif&&h.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===h.type)&&(t=Tr(h,t))}catch{}return k(t)}})}Oe.getDataUrlFromFile=wr,Oe.getFilefromDataUrl=$n,Oe.loadImage=_r,Oe.drawImageInCanvas=jr,Oe.drawFileInCanvas=xn,Oe.canvasToFile=vn,Oe.getExifOrientation=Ir,Oe.handleMaxWidthOrHeight=Dr,Oe.followExifOrientation=Rr,Oe.cleanupCanvasMemory=nt,Oe.isAutoOrientationInBrowser=_t,Oe.approximateBelowMaximumCanvasSizeOfBrowser=Er,Oe.copyExifWithoutOrientation=Tr,Oe.getBrowserName=Tt,Oe.version="2.0.2";function Rs(h){var x=typeof h;return h!=null&&(x=="object"||x=="function")}var Fr=Rs,Fs=typeof on=="object"&&on&&on.Object===Object&&on,ks=Fs,Us=ks,Os=typeof self=="object"&&self&&self.Object===Object&&self,Ms=Us||Os||Function("return this")(),kr=Ms,Ns=kr,Ls=function(){return Ns.Date.now()},Ps=Ls,Bs=/\s/;function Hs(h){for(var x=h.length;x--&&Bs.test(h.charAt(x)););return x}var zs=Hs,$s=zs,Ws=/^\s+/;function Gs(h){return h&&h.slice(0,$s(h)+1).replace(Ws,"")}var Ys=Gs,qs=kr,Vs=qs.Symbol,Ur=Vs,nr=Ur,Or=Object.prototype,Qs=Or.hasOwnProperty,Xs=Or.toString,Pt=nr?nr.toStringTag:void 0;function Zs(h){var x=Qs.call(h,Pt),k=h[Pt];try{h[Pt]=void 0;var l=!0}catch{}var e=Xs.call(h);return l&&(x?h[Pt]=k:delete h[Pt]),e}var Ks=Zs,Js=Object.prototype,ei=Js.toString;function ti(h){return ei.call(h)}var ni=ti,rr=Ur,ri=Ks,si=ni,ii="[object Null]",ai="[object Undefined]",sr=rr?rr.toStringTag:void 0;function oi(h){return h==null?h===void 0?ai:ii:sr&&sr in Object(h)?ri(h):si(h)}var li=oi;function ci(h){return h!=null&&typeof h=="object"}var di=ci,ui=li,fi=di,hi="[object Symbol]";function mi(h){return typeof h=="symbol"||fi(h)&&ui(h)==hi}var gi=mi,pi=Ys,ir=Fr,bi=gi,ar=NaN,xi=/^[-+]0x[0-9a-f]+$/i,vi=/^0b[01]+$/i,yi=/^0o[0-7]+$/i,Ti=parseInt;function Ai(h){if(typeof h=="number")return h;if(bi(h))return ar;if(ir(h)){var x=typeof h.valueOf=="function"?h.valueOf():h;h=ir(x)?x+"":x}if(typeof h!="string")return h===0?h:+h;h=pi(h);var k=vi.test(h);return k||yi.test(h)?Ti(h.slice(2),k?2:8):xi.test(h)?ar:+h}var Si=Ai,Ci=Fr,In=Ps,or=Si,wi="Expected a function",_i=Math.max,Ei=Math.min;function ji(h,x,k){var l,e,t,d,i,y,w=0,n=!1,s=!1,r=!0;if(typeof h!="function")throw new TypeError(wi);x=or(x)||0,Ci(k)&&(n=!!k.leading,s="maxWait"in k,t=s?_i(or(k.maxWait)||0,x):t,r="trailing"in k?!!k.trailing:r);function c(b){var M=l,f=e;return l=e=void 0,w=b,d=h.apply(f,M),d}function p(b){return w=b,i=setTimeout(E,x),n?c(b):d}function I(b){var M=b-y,f=b-w,u=x-M;return s?Ei(u,t-f):u}function U(b){var M=b-y,f=b-w;return y===void 0||M>=x||M<0||s&&f>=t}function E(){var b=In();if(U(b))return z(b);i=setTimeout(E,I(b))}function z(b){return i=void 0,r&&l?c(b):(l=e=void 0,d)}function L(){i!==void 0&&clearTimeout(i),w=0,l=y=e=i=void 0}function F(){return i===void 0?d:z(In())}function B(){var b=In(),M=U(b);if(l=arguments,e=this,y=b,M){if(i===void 0)return p(y);if(s)return clearTimeout(i),i=setTimeout(E,x),c(y)}return i===void 0&&(i=setTimeout(E,x)),d}return B.cancel=L,B.flush=F,B}var Ii=ji;const Di=cs(Ii);var Wn={},Ri=pt;Object.defineProperty(Wn,"__esModule",{value:!0});var Mr=Wn.default=void 0,Fi=Ri(gt()),lr=a;Mr=Wn.default=(0,Fi.default)([(0,lr.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),(0,lr.jsx)("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn");var Gn={},ki=pt;Object.defineProperty(Gn,"__esModule",{value:!0});var Nr=Gn.default=void 0,Ui=ki(gt()),Oi=a;Nr=Gn.default=(0,Ui.default)((0,Oi.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14M7 9h5v1H7z"}),"ZoomOut");var Yn={},Mi=pt;Object.defineProperty(Yn,"__esModule",{value:!0});var Lr=Yn.default=void 0,Ni=Mi(gt()),Li=a;Lr=Yn.default=(0,Ni.default)((0,Li.jsx)("path",{d:"M7 14H5v5h5v-2H7zm-2-4h2V7h3V5H5zm12 7h-3v2h5v-5h-2zM14 5v2h3v3h2V5z"}),"Fullscreen");var qn={},Pi=pt;Object.defineProperty(qn,"__esModule",{value:!0});var Pr=qn.default=void 0,Bi=Pi(gt()),Hi=a;Pr=qn.default=(0,Bi.default)((0,Hi.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var Vn={},zi=pt;Object.defineProperty(Vn,"__esModule",{value:!0});var Br=Vn.default=void 0,$i=zi(gt()),cr=a;Br=Vn.default=(0,$i.default)([(0,cr.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,cr.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"PhotoCamera");const Dt=$.forwardRef(({path:h,initialImages:x=[],onImagesUpdated:k,onDelete:l,isOwnDesign:e},t)=>{const[d,i]=$.useState(x.map(o=>({...o,deleted:!1}))),[y,w]=$.useState(!1),[n,s]=$.useState(0),[r,c]=$.useState(!1),[p,I]=$.useState(null),[U,E]=$.useState(1),[z,L]=$.useState(!1),[F,B]=$.useState(!1),[b,M]=$.useState(""),[f,u]=$.useState("info"),v=$.useRef(null);$.useEffect(()=>{console.log("Initial images received:",x),i(x.map(o=>({...o,deleted:!!o.deleted})))},[x]);const S=async o=>{const O=Array.from(o.target.files||[]);w(!0);const D={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},P=O.map(async(Y,W)=>{let V=Y;Y.size>1024*1024&&(V=await Oe(Y,D),M("Your image was compressed before uploading due to file size larger than 1 MB."),u("info"),B(!0));const N=`${new Date().getTime()}-${V.name}`,Z=Et(),de=jt(Z,`${h}/${N}`),ne=vr(de,V);return new Promise((ee,le)=>{ne.on("state_changed",re=>{const ue=re.bytesTransferred/re.totalBytes*100;s(ue)},re=>{console.error("Upload failed:",re),le(re)},()=>{yr(ne.snapshot.ref).then(re=>{ee({url:re,path:de.fullPath,title:""})})})})});Promise.all(P).then(Y=>{const W=[...d,...Y];i(W),k&&k(W),M("Images uploaded successfully."),u("success"),B(!0),w(!1),s(0),v.current&&(v.current.value="")}).catch(Y=>{console.error("Error uploading images: ",Y),M("Failed to upload images."),u("error"),B(!0),w(!1),s(0)})},_=o=>{i(O=>{const D=O.map((P,Y)=>Y===o?{...P,deleted:!0}:P);return k(D),D}),M("Image marked for deletion. Update to permanently delete."),u("info"),B(!0)},j=async()=>{const o=d.filter(O=>O.deleted);if(console.log("Attempting to delete images:",o),o.length>0){const O=o.map(D=>{const P=Et(),Y=jt(P,D.path);return un(Y)});try{await Promise.all(O),l(o),i(D=>D.filter(P=>!P.deleted)),M("Deleted images have been permanently removed."),u("success")}catch(D){console.error("Error committing deletions:",D),M("Failed to commit deletions."),u("error")}B(!0)}else console.log("No images marked for deletion.")},T=o=>{L(!z),I(o)};$.useEffect(()=>{const o=()=>{const O=!!document.fullscreenElement;L(O)};return document.addEventListener("fullscreenchange",o),()=>document.removeEventListener("fullscreenchange",o)},[]);const R=(o,O)=>{O!=="clickaway"&&B(!1)},g=$.useCallback(Di((o,O)=>{setTimeout(()=>{i(D=>{const P=D.map((Y,W)=>W===o?{...Y,title:O}:Y);return k&&k(P),P})},0)},30),[k]);return $.useImperativeHandle(t,()=>({commitDeletions:j})),a.jsxs("div",{children:[e&&a.jsx(qt,{title:"Upload Images",children:a.jsxs(Ne,{variant:"outlined",component:"label",startIcon:a.jsx(Br,{}),sx:{m:1,pl:2,pr:2},children:["Upload Image(s)",a.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:S,disabled:y,ref:v,accept:"image/*"})]})}),y&&a.jsxs(a.Fragment,{children:[a.jsxs("p",{children:["Uploading... ",Math.round(n),"%"]}),a.jsx("div",{style:{width:"100%",backgroundColor:"#ddd"},children:a.jsx("div",{style:{height:"20px",width:`${n}%`,backgroundColor:"green"}})})]}),d.filter(o=>!o.deleted).map((o,O)=>a.jsxs("div",{children:[a.jsx("img",{src:o.url,alt:`Uploaded design ${O}`,onClick:()=>{c(!0),I(O)},style:{width:"100%",maxHeight:"300px",objectFit:"contain",cursor:"pointer"}}),e&&a.jsx(Ve,{onClick:()=>_(O),children:a.jsx(Vt,{})}),a.jsx("textarea",{value:o.title,onChange:D=>g(O,D.target.value),placeholder:"Enter image title",rows:2,style:{width:"100%"}})]},O)),a.jsx(At,{open:r,onClose:()=>c(!1),fullScreen:z,PaperProps:{style:{backgroundColor:"white",boxShadow:"none",maxWidth:z?"none":void 0,maxHeight:z?"none":void 0,height:z?"100%":void 0,width:z?"100%":void 0,overflowY:"auto"}},children:p!==null&&a.jsxs(St,{children:[a.jsx("div",{style:{textAlign:"center"},children:a.jsx("img",{src:d[p].url,alt:`Zoomed Design ${p}`,style:{maxWidth:"100%",maxHeight:z?"100vh":void 0,transform:`scale(${U})`,transition:"transform 0.2s ease-out"}})}),a.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[a.jsx(Ve,{onClick:()=>E(U*1.2),children:a.jsx(Mr,{})}),a.jsx(Ve,{onClick:()=>E(U/1.2),style:{marginLeft:"10px"},children:a.jsx(Nr,{})}),a.jsx(Ve,{onClick:()=>T(p),style:{marginLeft:"10px"},children:a.jsx(Lr,{})}),z&&a.jsx(Ve,{onClick:()=>T(p),style:{position:"absolute",top:20,right:20},children:a.jsx(Pr,{})})]})]})}),a.jsx(ht,{open:F,autoHideDuration:6e3,onClose:R,children:a.jsx(mt,{onClose:R,severity:f,sx:{width:"100%"},children:b})})]})});/*! @license DOMPurify 3.1.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.1.6/LICENSE */const{entries:Hr,setPrototypeOf:dr,isFrozen:Wi,getPrototypeOf:Gi,getOwnPropertyDescriptor:Yi}=Object;let{freeze:Le,seal:Qe,create:zr}=Object,{apply:Ln,construct:Pn}=typeof Reflect<"u"&&Reflect;Le||(Le=function(x){return x});Qe||(Qe=function(x){return x});Ln||(Ln=function(x,k,l){return x.apply(k,l)});Pn||(Pn=function(x,k){return new x(...k)});const cn=We(Array.prototype.forEach),ur=We(Array.prototype.pop),Bt=We(Array.prototype.push),hn=We(String.prototype.toLowerCase),Dn=We(String.prototype.toString),fr=We(String.prototype.match),Ht=We(String.prototype.replace),qi=We(String.prototype.indexOf),Vi=We(String.prototype.trim),Ze=We(Object.prototype.hasOwnProperty),Me=We(RegExp.prototype.test),zt=Qi(TypeError);function We(h){return function(x){for(var k=arguments.length,l=new Array(k>1?k-1:0),e=1;e<k;e++)l[e-1]=arguments[e];return Ln(h,x,l)}}function Qi(h){return function(){for(var x=arguments.length,k=new Array(x),l=0;l<x;l++)k[l]=arguments[l];return Pn(h,k)}}function se(h,x){let k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:hn;dr&&dr(h,null);let l=x.length;for(;l--;){let e=x[l];if(typeof e=="string"){const t=k(e);t!==e&&(Wi(x)||(x[l]=t),e=t)}h[e]=!0}return h}function Xi(h){for(let x=0;x<h.length;x++)Ze(h,x)||(h[x]=null);return h}function yt(h){const x=zr(null);for(const[k,l]of Hr(h))Ze(h,k)&&(Array.isArray(l)?x[k]=Xi(l):l&&typeof l=="object"&&l.constructor===Object?x[k]=yt(l):x[k]=l);return x}function $t(h,x){for(;h!==null;){const l=Yi(h,x);if(l){if(l.get)return We(l.get);if(typeof l.value=="function")return We(l.value)}h=Gi(h)}function k(){return null}return k}const hr=Le(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Rn=Le(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Fn=Le(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Zi=Le(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),kn=Le(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Ki=Le(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),mr=Le(["#text"]),gr=Le(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Un=Le(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),pr=Le(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),dn=Le(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Ji=Qe(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ea=Qe(/<%[\w\W]*|[\w\W]*%>/gm),ta=Qe(/\${[\w\W]*}/gm),na=Qe(/^data-[\-\w.\u00B7-\uFFFF]/),ra=Qe(/^aria-[\-\w]+$/),$r=Qe(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),sa=Qe(/^(?:\w+script|data):/i),ia=Qe(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Wr=Qe(/^html$/i),aa=Qe(/^[a-z][.\w]*(-[.\w]+)+$/i);var br=Object.freeze({__proto__:null,MUSTACHE_EXPR:Ji,ERB_EXPR:ea,TMPLIT_EXPR:ta,DATA_ATTR:na,ARIA_ATTR:ra,IS_ALLOWED_URI:$r,IS_SCRIPT_OR_DATA:sa,ATTR_WHITESPACE:ia,DOCTYPE_NAME:Wr,CUSTOM_ELEMENT:aa});const Wt={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},oa=function(){return typeof window>"u"?null:window},la=function(x,k){if(typeof x!="object"||typeof x.createPolicy!="function")return null;let l=null;const e="data-tt-policy-suffix";k&&k.hasAttribute(e)&&(l=k.getAttribute(e));const t="dompurify"+(l?"#"+l:"");try{return x.createPolicy(t,{createHTML(d){return d},createScriptURL(d){return d}})}catch{return console.warn("TrustedTypes policy "+t+" could not be created."),null}};function Gr(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oa();const x=A=>Gr(A);if(x.version="3.1.6",x.removed=[],!h||!h.document||h.document.nodeType!==Wt.document)return x.isSupported=!1,x;let{document:k}=h;const l=k,e=l.currentScript,{DocumentFragment:t,HTMLTemplateElement:d,Node:i,Element:y,NodeFilter:w,NamedNodeMap:n=h.NamedNodeMap||h.MozNamedAttrMap,HTMLFormElement:s,DOMParser:r,trustedTypes:c}=h,p=y.prototype,I=$t(p,"cloneNode"),U=$t(p,"remove"),E=$t(p,"nextSibling"),z=$t(p,"childNodes"),L=$t(p,"parentNode");if(typeof d=="function"){const A=k.createElement("template");A.content&&A.content.ownerDocument&&(k=A.content.ownerDocument)}let F,B="";const{implementation:b,createNodeIterator:M,createDocumentFragment:f,getElementsByTagName:u}=k,{importNode:v}=l;let S={};x.isSupported=typeof Hr=="function"&&typeof L=="function"&&b&&b.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:_,ERB_EXPR:j,TMPLIT_EXPR:T,DATA_ATTR:R,ARIA_ATTR:g,IS_SCRIPT_OR_DATA:o,ATTR_WHITESPACE:O,CUSTOM_ELEMENT:D}=br;let{IS_ALLOWED_URI:P}=br,Y=null;const W=se({},[...hr,...Rn,...Fn,...kn,...mr]);let V=null;const q=se({},[...gr,...Un,...pr,...dn]);let N=Object.seal(zr(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Z=null,de=null,ne=!0,ee=!0,le=!1,re=!0,ue=!1,Fe=!0,ye=!1,me=!1,Te=!1,ae=!1,ce=!1,be=!1,Se=!0,xe=!1;const ve="user-content-";let ge=!0,ie=!1,Ae={},_e=null;const st=se({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let K=null;const Ge=se({},["audio","video","img","source","image","track"]);let J=null;const ke=se({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),te="http://www.w3.org/1998/Math/MathML",Ee="http://www.w3.org/2000/svg",fe="http://www.w3.org/1999/xhtml";let Ue=fe,it=!1,bt=null;const xt=se({},[te,Ee,fe],Dn);let Ke=null;const at=["application/xhtml+xml","text/html"],Ot="text/html";let he=null,Ce=null;const Je=k.createElement("form"),et=function(m){return m instanceof RegExp||m instanceof Function},ct=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Ce&&Ce===m)){if((!m||typeof m!="object")&&(m={}),m=yt(m),Ke=at.indexOf(m.PARSER_MEDIA_TYPE)===-1?Ot:m.PARSER_MEDIA_TYPE,he=Ke==="application/xhtml+xml"?Dn:hn,Y=Ze(m,"ALLOWED_TAGS")?se({},m.ALLOWED_TAGS,he):W,V=Ze(m,"ALLOWED_ATTR")?se({},m.ALLOWED_ATTR,he):q,bt=Ze(m,"ALLOWED_NAMESPACES")?se({},m.ALLOWED_NAMESPACES,Dn):xt,J=Ze(m,"ADD_URI_SAFE_ATTR")?se(yt(ke),m.ADD_URI_SAFE_ATTR,he):ke,K=Ze(m,"ADD_DATA_URI_TAGS")?se(yt(Ge),m.ADD_DATA_URI_TAGS,he):Ge,_e=Ze(m,"FORBID_CONTENTS")?se({},m.FORBID_CONTENTS,he):st,Z=Ze(m,"FORBID_TAGS")?se({},m.FORBID_TAGS,he):{},de=Ze(m,"FORBID_ATTR")?se({},m.FORBID_ATTR,he):{},Ae=Ze(m,"USE_PROFILES")?m.USE_PROFILES:!1,ne=m.ALLOW_ARIA_ATTR!==!1,ee=m.ALLOW_DATA_ATTR!==!1,le=m.ALLOW_UNKNOWN_PROTOCOLS||!1,re=m.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ue=m.SAFE_FOR_TEMPLATES||!1,Fe=m.SAFE_FOR_XML!==!1,ye=m.WHOLE_DOCUMENT||!1,ae=m.RETURN_DOM||!1,ce=m.RETURN_DOM_FRAGMENT||!1,be=m.RETURN_TRUSTED_TYPE||!1,Te=m.FORCE_BODY||!1,Se=m.SANITIZE_DOM!==!1,xe=m.SANITIZE_NAMED_PROPS||!1,ge=m.KEEP_CONTENT!==!1,ie=m.IN_PLACE||!1,P=m.ALLOWED_URI_REGEXP||$r,Ue=m.NAMESPACE||fe,N=m.CUSTOM_ELEMENT_HANDLING||{},m.CUSTOM_ELEMENT_HANDLING&&et(m.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(N.tagNameCheck=m.CUSTOM_ELEMENT_HANDLING.tagNameCheck),m.CUSTOM_ELEMENT_HANDLING&&et(m.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(N.attributeNameCheck=m.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),m.CUSTOM_ELEMENT_HANDLING&&typeof m.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(N.allowCustomizedBuiltInElements=m.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ue&&(ee=!1),ce&&(ae=!0),Ae&&(Y=se({},mr),V=[],Ae.html===!0&&(se(Y,hr),se(V,gr)),Ae.svg===!0&&(se(Y,Rn),se(V,Un),se(V,dn)),Ae.svgFilters===!0&&(se(Y,Fn),se(V,Un),se(V,dn)),Ae.mathMl===!0&&(se(Y,kn),se(V,pr),se(V,dn))),m.ADD_TAGS&&(Y===W&&(Y=yt(Y)),se(Y,m.ADD_TAGS,he)),m.ADD_ATTR&&(V===q&&(V=yt(V)),se(V,m.ADD_ATTR,he)),m.ADD_URI_SAFE_ATTR&&se(J,m.ADD_URI_SAFE_ATTR,he),m.FORBID_CONTENTS&&(_e===st&&(_e=yt(_e)),se(_e,m.FORBID_CONTENTS,he)),ge&&(Y["#text"]=!0),ye&&se(Y,["html","head","body"]),Y.table&&(se(Y,["tbody"]),delete Z.tbody),m.TRUSTED_TYPES_POLICY){if(typeof m.TRUSTED_TYPES_POLICY.createHTML!="function")throw zt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof m.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw zt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');F=m.TRUSTED_TYPES_POLICY,B=F.createHTML("")}else F===void 0&&(F=la(c,e)),F!==null&&typeof B=="string"&&(B=F.createHTML(""));Le&&Le(m),Ce=m}},He=se({},["mi","mo","mn","ms","mtext"]),ze=se({},["foreignobject","annotation-xml"]),Tn=se({},["title","style","font","a","script"]),Zt=se({},[...Rn,...Fn,...Zi]),Kt=se({},[...kn,...Ki]),Jt=function(m){let C=L(m);(!C||!C.tagName)&&(C={namespaceURI:Ue,tagName:"template"});const H=hn(m.tagName),G=hn(C.tagName);return bt[m.namespaceURI]?m.namespaceURI===Ee?C.namespaceURI===fe?H==="svg":C.namespaceURI===te?H==="svg"&&(G==="annotation-xml"||He[G]):!!Zt[H]:m.namespaceURI===te?C.namespaceURI===fe?H==="math":C.namespaceURI===Ee?H==="math"&&ze[G]:!!Kt[H]:m.namespaceURI===fe?C.namespaceURI===Ee&&!ze[G]||C.namespaceURI===te&&!He[G]?!1:!Kt[H]&&(Tn[H]||!Zt[H]):!!(Ke==="application/xhtml+xml"&&bt[m.namespaceURI]):!1},Ye=function(m){Bt(x.removed,{element:m});try{L(m).removeChild(m)}catch{U(m)}},Ct=function(m,C){try{Bt(x.removed,{attribute:C.getAttributeNode(m),from:C})}catch{Bt(x.removed,{attribute:null,from:C})}if(C.removeAttribute(m),m==="is"&&!V[m])if(ae||ce)try{Ye(C)}catch{}else try{C.setAttribute(m,"")}catch{}},en=function(m){let C=null,H=null;if(Te)m="<remove></remove>"+m;else{const Q=fr(m,/^[\r\n\t ]+/);H=Q&&Q[0]}Ke==="application/xhtml+xml"&&Ue===fe&&(m='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+m+"</body></html>");const G=F?F.createHTML(m):m;if(Ue===fe)try{C=new r().parseFromString(G,Ke)}catch{}if(!C||!C.documentElement){C=b.createDocument(Ue,"template",null);try{C.documentElement.innerHTML=it?B:G}catch{}}const X=C.body||C.documentElement;return m&&H&&X.insertBefore(k.createTextNode(H),X.childNodes[0]||null),Ue===fe?u.call(C,ye?"html":"body")[0]:ye?C.documentElement:X},vt=function(m){return M.call(m.ownerDocument||m,m,w.SHOW_ELEMENT|w.SHOW_COMMENT|w.SHOW_TEXT|w.SHOW_PROCESSING_INSTRUCTION|w.SHOW_CDATA_SECTION,null)},tn=function(m){return m instanceof s&&(typeof m.nodeName!="string"||typeof m.textContent!="string"||typeof m.removeChild!="function"||!(m.attributes instanceof n)||typeof m.removeAttribute!="function"||typeof m.setAttribute!="function"||typeof m.namespaceURI!="string"||typeof m.insertBefore!="function"||typeof m.hasChildNodes!="function")},Mt=function(m){return typeof i=="function"&&m instanceof i},qe=function(m,C,H){S[m]&&cn(S[m],G=>{G.call(x,C,H,Ce)})},nn=function(m){let C=null;if(qe("beforeSanitizeElements",m,null),tn(m))return Ye(m),!0;const H=he(m.nodeName);if(qe("uponSanitizeElement",m,{tagName:H,allowedTags:Y}),m.hasChildNodes()&&!Mt(m.firstElementChild)&&Me(/<[/\w]/g,m.innerHTML)&&Me(/<[/\w]/g,m.textContent)||m.nodeType===Wt.progressingInstruction||Fe&&m.nodeType===Wt.comment&&Me(/<[/\w]/g,m.data))return Ye(m),!0;if(!Y[H]||Z[H]){if(!Z[H]&&sn(H)&&(N.tagNameCheck instanceof RegExp&&Me(N.tagNameCheck,H)||N.tagNameCheck instanceof Function&&N.tagNameCheck(H)))return!1;if(ge&&!_e[H]){const G=L(m)||m.parentNode,X=z(m)||m.childNodes;if(X&&G){const Q=X.length;for(let pe=Q-1;pe>=0;--pe){const we=I(X[pe],!0);we.__removalCount=(m.__removalCount||0)+1,G.insertBefore(we,E(m))}}}return Ye(m),!0}return m instanceof y&&!Jt(m)||(H==="noscript"||H==="noembed"||H==="noframes")&&Me(/<\/no(script|embed|frames)/i,m.innerHTML)?(Ye(m),!0):(ue&&m.nodeType===Wt.text&&(C=m.textContent,cn([_,j,T],G=>{C=Ht(C,G," ")}),m.textContent!==C&&(Bt(x.removed,{element:m.cloneNode()}),m.textContent=C)),qe("afterSanitizeElements",m,null),!1)},rn=function(m,C,H){if(Se&&(C==="id"||C==="name")&&(H in k||H in Je))return!1;if(!(ee&&!de[C]&&Me(R,C))){if(!(ne&&Me(g,C))){if(!V[C]||de[C]){if(!(sn(m)&&(N.tagNameCheck instanceof RegExp&&Me(N.tagNameCheck,m)||N.tagNameCheck instanceof Function&&N.tagNameCheck(m))&&(N.attributeNameCheck instanceof RegExp&&Me(N.attributeNameCheck,C)||N.attributeNameCheck instanceof Function&&N.attributeNameCheck(C))||C==="is"&&N.allowCustomizedBuiltInElements&&(N.tagNameCheck instanceof RegExp&&Me(N.tagNameCheck,H)||N.tagNameCheck instanceof Function&&N.tagNameCheck(H))))return!1}else if(!J[C]){if(!Me(P,Ht(H,O,""))){if(!((C==="src"||C==="xlink:href"||C==="href")&&m!=="script"&&qi(H,"data:")===0&&K[m])){if(!(le&&!Me(o,Ht(H,O,"")))){if(H)return!1}}}}}}return!0},sn=function(m){return m!=="annotation-xml"&&fr(m,D)},an=function(m){qe("beforeSanitizeAttributes",m,null);const{attributes:C}=m;if(!C)return;const H={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:V};let G=C.length;for(;G--;){const X=C[G],{name:Q,namespaceURI:pe,value:we}=X,ot=he(Q);let De=Q==="value"?we:Vi(we);if(H.attrName=ot,H.attrValue=De,H.keepAttr=!0,H.forceKeepAttr=void 0,qe("uponSanitizeAttribute",m,H),De=H.attrValue,Fe&&Me(/((--!?|])>)|<\/(style|title)/i,De)){Ct(Q,m);continue}if(H.forceKeepAttr||(Ct(Q,m),!H.keepAttr))continue;if(!re&&Me(/\/>/i,De)){Ct(Q,m);continue}ue&&cn([_,j,T],wt=>{De=Ht(De,wt," ")});const Nt=he(m.nodeName);if(rn(Nt,ot,De)){if(xe&&(ot==="id"||ot==="name")&&(Ct(Q,m),De=ve+De),F&&typeof c=="object"&&typeof c.getAttributeType=="function"&&!pe)switch(c.getAttributeType(Nt,ot)){case"TrustedHTML":{De=F.createHTML(De);break}case"TrustedScriptURL":{De=F.createScriptURL(De);break}}try{pe?m.setAttributeNS(pe,Q,De):m.setAttribute(Q,De),tn(m)?Ye(m):ur(x.removed)}catch{}}}qe("afterSanitizeAttributes",m,null)},An=function A(m){let C=null;const H=vt(m);for(qe("beforeSanitizeShadowDOM",m,null);C=H.nextNode();)qe("uponSanitizeShadowNode",C,null),!nn(C)&&(C.content instanceof t&&A(C.content),an(C));qe("afterSanitizeShadowDOM",m,null)};return x.sanitize=function(A){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},C=null,H=null,G=null,X=null;if(it=!A,it&&(A="<!-->"),typeof A!="string"&&!Mt(A))if(typeof A.toString=="function"){if(A=A.toString(),typeof A!="string")throw zt("dirty is not a string, aborting")}else throw zt("toString is not a function");if(!x.isSupported)return A;if(me||ct(m),x.removed=[],typeof A=="string"&&(ie=!1),ie){if(A.nodeName){const we=he(A.nodeName);if(!Y[we]||Z[we])throw zt("root node is forbidden and cannot be sanitized in-place")}}else if(A instanceof i)C=en("<!---->"),H=C.ownerDocument.importNode(A,!0),H.nodeType===Wt.element&&H.nodeName==="BODY"||H.nodeName==="HTML"?C=H:C.appendChild(H);else{if(!ae&&!ue&&!ye&&A.indexOf("<")===-1)return F&&be?F.createHTML(A):A;if(C=en(A),!C)return ae?null:be?B:""}C&&Te&&Ye(C.firstChild);const Q=vt(ie?A:C);for(;G=Q.nextNode();)nn(G)||(G.content instanceof t&&An(G.content),an(G));if(ie)return A;if(ae){if(ce)for(X=f.call(C.ownerDocument);C.firstChild;)X.appendChild(C.firstChild);else X=C;return(V.shadowroot||V.shadowrootmode)&&(X=v.call(l,X,!0)),X}let pe=ye?C.outerHTML:C.innerHTML;return ye&&Y["!doctype"]&&C.ownerDocument&&C.ownerDocument.doctype&&C.ownerDocument.doctype.name&&Me(Wr,C.ownerDocument.doctype.name)&&(pe="<!DOCTYPE "+C.ownerDocument.doctype.name+`>
`+pe),ue&&cn([_,j,T],we=>{pe=Ht(pe,we," ")}),F&&be?F.createHTML(pe):pe},x.setConfig=function(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ct(A),me=!0},x.clearConfig=function(){Ce=null,me=!1},x.isValidAttribute=function(A,m,C){Ce||ct({});const H=he(A),G=he(m);return rn(H,G,C)},x.addHook=function(A,m){typeof m=="function"&&(S[A]=S[A]||[],Bt(S[A],m))},x.removeHook=function(A){if(S[A])return ur(S[A])},x.removeHooks=function(A){S[A]&&(S[A]=[])},x.removeAllHooks=function(){S={}},x}var On=Gr();const rt=({onChange:h,initialValue:x})=>{const[k,l]=$.useState(On.sanitize(x||"")),e=$.useRef(!1),t=$.useRef(null),[d,i]=$.useState("");$.useEffect(()=>{e.current?l(On.sanitize(x||"")):e.current=!0},[x]);const y=(c,p)=>{const I=p.getData(),U=On.sanitize(I);l(U),h(U)},w=c=>{if(!t.current){console.warn("Editor not initialized");return}const p=t.current;p.model.change(I=>{const U=p.model.document.selection.getFirstPosition();I.insertText(c,U)}),i("")},n=c=>{w(c.target.value)},s=["Î±","Î²","Î³","Î´","Îµ","Î¶","Î·","Î¸","Î¹","Îº","Î»","Î¼","Î½","Î¾","Î¿","Ï€","Ï","Ïƒ","Ï„","Ï…","Ï†","Ï‡","Ïˆ","Ï‰"],r=["Â°","+","-","=","~","â‰¥","â‰¤","â‰ ",">","<","*","/","%"];return a.jsxs("div",{children:[a.jsxs(Yt,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%"},children:[a.jsx(ds,{id:"insert-symbols-label",sx:{fontSize:"0.8rem"},children:"Insert Symbols: "}),a.jsx(Jn,{variant:"standard",sx:{m:1,minWidth:40},children:a.jsxs(er,{labelId:"math-operators-label",id:"math-operators",value:d,onChange:n,displayEmpty:!0,children:[a.jsx(ln,{value:"",disabled:!0,children:"Math"}),r.map(c=>a.jsx(ln,{value:c,children:c},c))]})}),a.jsx(Jn,{variant:"standard",sx:{m:1,minWidth:40},children:a.jsxs(er,{labelId:"greek-letters-label",id:"greek-letters",value:d,onChange:n,displayEmpty:!0,children:[a.jsx(ln,{value:"",disabled:!0,children:"Greek"}),s.map(c=>a.jsx(ln,{value:c,children:c},c))]})})]}),a.jsx(us.CKEditor,{editor:fs,data:k,onReady:c=>{t.current=c},config:{toolbar:["undo","redo","|","heading","bold","italic","|","bulletedList","numberedList","blockQuote","indent","outdent","|","link","insertTable","|"],table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]}},onChange:y})]})};var Qn={},ca=pt;Object.defineProperty(Qn,"__esModule",{value:!0});var Yr=Qn.default=void 0,da=ca(gt()),ua=a;Yr=Qn.default=(0,da.default)((0,ua.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile");var Xn={},fa=pt;Object.defineProperty(Xn,"__esModule",{value:!0});var qr=Xn.default=void 0,ha=fa(gt()),ma=a;qr=Xn.default=(0,ha.default)((0,ma.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload");const Rt=({path:h,initialFiles:x,onFilesChange:k,isOwnDesign:l})=>{const[e,t]=$.useState(x.map(v=>({...v,deleted:!!v.deleted}))),[d,i]=$.useState(!1),[y,w]=$.useState(0),[n,s]=$.useState({}),[r,c]=$.useState(!1),[p,I]=$.useState(""),[U,E]=$.useState("info"),z=$.useRef(null);$.useEffect(()=>{console.log("Initial files received:",x),t(x.map(v=>({...v,deleted:!!v.deleted})))},[x]),$.useEffect(()=>()=>{s({})},[]);const L=v=>{console.log("Updating files with",v),k(v),t(v)},F=async v=>{if(!v.target.files)return;const _=Array.from(v.target.files).filter(T=>T.size>5242880?(I("File size should not exceed 5 MB"),E("error"),c(!0),!1):!0);i(!0);const j=_.map(T=>{const R=new Date().getTime(),g=`${R}-${T.name}`,o=Et(),O=jt(o,`${h}/${g}`),D=vr(O,T);return new Promise((P,Y)=>{D.on("state_changed",W=>{const V=W.bytesTransferred/W.totalBytes*100;w(V)},W=>{console.error("Upload failed:",W),Y(W)},()=>{yr(D.snapshot.ref).then(W=>{P({id:R.toString(),url:W,name:T.name,path:O.fullPath})})})})});Promise.all(j).then(T=>{const R=[...e.filter(g=>!g.deleted),...T];L(R),I("Files uploaded successfully."),E("success"),c(!0),i(!1),w(0),z.current&&(z.current.value="")}).catch(T=>{console.error("Error uploading files: ",T),I("Failed to upload files."),E("error"),c(!0),i(!1),w(0)})},B=v=>{const S=e.map(_=>_.id===v?{..._,deleted:!0}:_);L(S),I("File marked for deletion. Update to permanently delete."),E("info"),c(!0)},b=v=>{s(S=>{var _;return{...S,[v]:((_=e.find(j=>j.id===v))==null?void 0:_.name)||""}}),console.log("editStates after handleEditClick:",n)},M=v=>{t(S=>{const _=S.map(j=>j.id===v&&n[v]!==void 0?{...j,name:n[v]}:j);return k(_),_}),s(S=>{const _={...S};return delete _[v],_}),I("File name updated successfully."),E("info"),c(!0)},f=(v,S)=>{s(_=>({..._,[v]:S}))},u=(v,S)=>{S!=="clickaway"&&c(!1)};return a.jsxs("div",{children:[l&&a.jsx(qt,{title:"Upload Files",children:a.jsxs(Ne,{variant:"outlined",component:"label",startIcon:a.jsx(qr,{}),sx:{m:1,pl:2,pr:2},children:["Upload File(s)",a.jsx("input",{type:"file",hidden:!0,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx",onChange:F,disabled:d,ref:z})]})}),d&&a.jsx("div",{children:a.jsxs("p",{children:["Uploading... ",Math.round(y),"%"]})}),a.jsx(hs,{children:e.map(v=>a.jsxs(ms,{component:"div",disabled:v.deleted,children:[a.jsx(Ts,{children:a.jsx(Yr,{})}),typeof n[v.id]=="string"?a.jsx(gn,{variant:"outlined",size:"small",value:n[v.id],onChange:S=>f(v.id,S.target.value),onKeyPress:S=>S.key==="Enter"&&M(v.id),fullWidth:!0}):a.jsx(gs,{primary:v.name,secondary:a.jsx("a",{href:v.url,target:"_blank",rel:"noopener noreferrer",children:"Download"})}),l&&(typeof n[v.id]=="string"?a.jsx(Ve,{onClick:()=>M(v.id),edge:"end","aria-label":"save",children:a.jsx(Nn,{})}):a.jsxs(a.Fragment,{children:[a.jsx(Ve,{onClick:()=>b(v.id),edge:"end","aria-label":"edit",children:a.jsx(xr,{})}),a.jsx(Ve,{onClick:()=>B(v.id),edge:"end","aria-label":"delete",children:a.jsx(Vt,{})})]}))]},v.id))}),a.jsx(ht,{open:r,autoHideDuration:6e3,onClose:u,children:a.jsx(mt,{onClose:u,severity:U,sx:{width:"100%"},children:p})})]})},ga=({designs:h,setDesigns:x,setIsAdding:k,getDesigns:l,onReturnToDashboard:e})=>{const{userDetails:t}=Ut();console.log("Add Design loaded");const[d,i]=$.useState(""),[y,w]=$.useState(""),[n,s]=$.useState([]),[r,c]=$.useState([]),p=$.useMemo(()=>n,[n]),[I,U]=$.useState(!1),[E,z]=$.useState(""),[L,F]=$.useState("info"),[B,b]=$.useState(!1),[M,f]=$.useState("");console.log("Adding New Design from user:",t);const u=$.useRef(null),v=()=>{b(!1)},S=(j,T)=>{T!=="clickaway"&&U(!1)},_=async j=>{var o;if(j.preventDefault(),console.log("Files to be saved:",r),!t||!t.uid){console.error("User object is undefined or missing UID."),f("You must be signed in to add a design."),b(!0);return}if(!d){f("All fields are required."),b(!0);return}await((o=u.current)==null?void 0:o.commitDeletions());const T=n.filter(O=>!O.deleted),R=r.filter(O=>!O.deleted).map(O=>({id:O.id,url:O.url,name:O.name,path:O.path})),g={title:y,description:d,dateCreated:Qt(),dateModified:Qt(),images:T,files:R,userId:t.uid};try{const O=await Hn(Re(oe,"designs"),g),D={...g,id:O.id};x([...h,D]),setTimeout(()=>{k(!1),l()},1e3),z(`${y} has been Added.`),F("success"),U(!0),w(""),i(""),s([]),c([])}catch(O){console.log(O),f("There was an issue adding your design."),b(!0)}};return a.jsxs("div",{className:"small-container",children:[a.jsx("button",{onClick:e,className:"muted-button margin-top-20",children:"â† All Designs"}),a.jsx("div",{className:"design-record",children:a.jsxs("form",{onSubmit:_,children:[a.jsx("h1",{className:"designHeader",children:"New Design"}),a.jsx("div",{style:{display:"flex",alignItems:"center"},children:a.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[a.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),a.jsx("input",{id:"title",type:"text",name:"title",value:y,onChange:j=>w(j.target.value),style:{width:"100%"}})]})}),a.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),a.jsxs("ul",{children:[a.jsx("li",{children:"Objective: What is the goal for this design?"}),a.jsx("li",{children:"Rationale: Why is this new design being done?"}),a.jsx("li",{children:"Selected Target Identified: What is the target for the design being made?"}),a.jsx("li",{children:"Functional Modification: What is being done to this target?"}),a.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),a.jsx(rt,{onChange:i,initialValue:d}),a.jsx(Dt,{ref:u,path:"designs/images",initialImages:p,onImagesUpdated:s,onDelete:j=>s(n.filter(T=>!j.includes(T)))}),a.jsx(Rt,{path:"designs/files",initialFiles:r,onFilesChange:c}),a.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[a.jsx(Ne,{type:"submit",variant:"contained",sx:{fontSize:"1rem",mt:2,textTransform:"none",boxShadow:"none","&:hover":{boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out",border:"1px solid transparent"},children:"Add"}),a.jsx(Ne,{onClick:()=>k(!1),style:{marginLeft:"12px"},variant:"outlined",sx:{fontSize:"1rem",mt:2,textTransform:"none",color:"currentColor",borderColor:"rgba(255, 0, 0, 0.5)",boxShadow:"none","&:hover":{borderColor:"rgba(255, 0, 0, 0.7)",backgroundColor:"rgba(255, 0, 0, 0.1)",boxShadow:"0px 0px 10px rgba(0, 0, 0, 0.2)",color:"currentColor",transform:"scale(1.05)"},transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, border-color 0.3s ease-in-out, background-color 0.3s ease-in-out"},children:"Cancel"})]})]})}),a.jsxs(At,{open:B,onClose:v,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[a.jsx(Ft,{id:"alert-dialog-title",children:"Notification"}),a.jsx(St,{children:a.jsx(Xt,{id:"alert-dialog-description",children:M})}),a.jsx(kt,{children:a.jsx(Ne,{onClick:v,autoFocus:!0,children:"Ok"})})]}),a.jsx(ht,{open:I,autoHideDuration:1e3,onClose:S,children:a.jsx(mt,{onClose:S,severity:L,sx:{width:"100%"},children:E})})]})},pa=({designId:h,setIsAddingBuild:x,refreshBuilds:k})=>{const[l,e]=$.useState(""),[t,d]=$.useState(""),[i,y]=$.useState([]),[w,n]=$.useState([]),{userDetails:s}=Ut(),r=S=>{y(S)},c=S=>{n(S)};console.log("AddBuild loaded");const[p,I]=$.useState(!1),[U,E]=$.useState(""),[z,L]=$.useState(!1),[F,B]=$.useState(""),[b,M]=$.useState("info");console.log("Adding New Build by user:",s);const f=()=>{I(!1)},u=(S,_)=>{_!=="clickaway"&&L(!1)},v=async S=>{if(S.preventDefault(),!s||!s.uid){console.error("UserDetails object is undefined or missing UID."),E("You must be signed in to add a build."),I(!0);return}if(!t){E("Build description is required."),I(!0);return}const _=i.filter(T=>!T.deleted),j=w.filter(T=>!T.deleted).map(T=>({id:T.id,url:T.url,name:T.name,path:T.path}));try{const T=await Hn(Re(oe,"builds"),{title:l,description:t,design_ID:h,dateCreated:Qt(),userId:s.uid,images:_,files:j});console.log("Build added with ID: ",T.id),console.log("Added New Build by user:",s),B("Your build has been successfully added."),M("success"),L(!0),setTimeout(()=>{e(""),d(""),y([]),n([]),x(!1),k()},1e3)}catch(T){if(console.error("Error adding build: ",T),T instanceof Error){let R=`Failed to add the build. ${T.message}`;T.message==="permission-denied"&&(R="You do not have permission to perform this operation."),B(R),M("error"),L(!0)}else B("Failed to add the build. Please try again later."),M("error"),L(!0)}};return a.jsxs("div",{className:"small-container",children:[a.jsxs("form",{onSubmit:v,children:[a.jsx("label",{className:"buildTitles",htmlFor:"buildTitle",children:"Title"}),a.jsx("input",{id:"buildTitle",type:"text",value:l,onChange:S=>e(S.target.value),style:{width:"100%",marginBottom:"20px"}}),a.jsx("label",{className:"buildTitles",htmlFor:"buildDescription",children:"Description"}),a.jsx(rt,{onChange:d,initialValue:t})," ",a.jsx(Dt,{path:`builds/${h}/images`,initialImages:i,onImagesUpdated:r}),a.jsx(Rt,{path:`builds/${h}/files`,initialFiles:w,onFilesChange:c}),a.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[a.jsx("input",{type:"submit",value:"Save"}),a.jsx("button",{style:{marginLeft:"12px"},onClick:()=>x(!1),className:"button muted-button",children:"Cancel"})]})]}),a.jsxs(At,{open:p,onClose:f,children:[a.jsx(Ft,{children:"Notification"}),a.jsx(St,{children:a.jsx(Xt,{children:U})}),a.jsx(kt,{children:a.jsx(Ne,{onClick:f,children:"OK"})})]}),a.jsx(ht,{open:z,autoHideDuration:6e3,onClose:u,children:a.jsx(mt,{onClose:u,severity:b,sx:{width:"100%"},children:F})})]})},ba=({designId:h,buildId:x,refreshTests:k,setAddingTestIdForBuild:l})=>{const[e,t]=$.useState(""),[d,i]=$.useState(""),[y,w]=$.useState(""),[n,s]=$.useState(""),[r,c]=$.useState([]),[p,I]=$.useState([]),{userDetails:U}=Ut();console.log("AddTest loaded");const[E,z]=$.useState(!1),[L,F]=$.useState(""),[B,b]=$.useState(!1),[M,f]=$.useState(""),[u,v]=$.useState("info"),S=j=>{I(j)},_=async()=>{if(!d){F("Test description cannot be empty!"),z(!0);return}const j=r.filter(R=>!R.deleted),T=p.filter(R=>!R.deleted).map(R=>({id:R.id,url:R.url,name:R.name,path:R.path}));try{await Hn(Re(oe,"tests"),{title:e,build_ID:x,design_ID:h,dateCreated:Qt(),description:d,results:y,conclusions:n,userId:U==null?void 0:U.uid,images:j,files:T}),setTimeout(()=>{k(x),t(""),i(""),w(""),s(""),c([]),I([]),l(!1)},1e3),f("Test added successfully"),v("success"),b(!0)}catch(R){console.error("Error adding test: ",R),f("Failed to add the test"),v("error"),b(!0)}};return a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",htmlFor:"testTitle",children:"Title"}),a.jsx("input",{id:"testTitle",type:"text",value:e,onChange:j=>t(j.target.value),style:{width:"100%",marginBottom:"20px"}}),a.jsx("label",{className:"testTitles",htmlFor:"testDescription",children:"Description"}),a.jsx(rt,{onChange:i,initialValue:d}),a.jsx("label",{className:"testTitles",htmlFor:"testResults",children:"Results"}),a.jsx(rt,{onChange:w,initialValue:y}),a.jsx("label",{className:"testTitles",htmlFor:"testConclusions",children:"Conclusions"}),a.jsx(rt,{onChange:s,initialValue:n}),a.jsx(Dt,{path:`tests/${x}/images`,initialImages:r,onImagesUpdated:j=>{c(j)}}),a.jsx(Rt,{path:`tests/${x}/files`,initialFiles:p,onFilesChange:S}),a.jsxs("div",{style:{display:"flex",justifyContent:"flex-end"},children:[a.jsx("button",{onClick:_,children:"Save"}),a.jsx("button",{style:{marginLeft:"12px"},onClick:()=>l(!1),className:"button muted-button",children:"Cancel"})]}),a.jsxs(At,{open:E,onClose:()=>z(!1),children:[a.jsx(Ft,{children:"Notification"}),a.jsx(St,{children:a.jsx(Xt,{children:L})}),a.jsx(kt,{children:a.jsx(Ne,{onClick:()=>z(!1),children:"OK"})})]}),a.jsx(ht,{open:B,autoHideDuration:6e3,onClose:()=>b(!1),children:a.jsx(mt,{onClose:()=>b(!1),severity:u,sx:{width:"100%"},children:M})})]})};var Zn={},xa=pt;Object.defineProperty(Zn,"__esModule",{value:!0});var mn=Zn.default=void 0,va=xa(gt()),ya=a;mn=Zn.default=(0,va.default)((0,ya.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff");const Gt=h=>h&&h instanceof Bn?h.toDate().toLocaleString():"",Ta=({selectedDesign:h,setIsEditing:x,getDesigns:k,onReturnToDashboard:l})=>{const{userDetails:e,loading:t}=Ut(),d=h.id,i=h.userId===(e==null?void 0:e.uid);console.log("Edit page loaded"),console.log("Design ID:",d),console.log("Editing Design by user:",e);const[y,w]=$.useState(""),[n,s]=$.useState(h.description),[r,c]=$.useState(Gt(h.dateCreated)),[p,I]=$.useState(Gt(h.dateModified)),[U,E]=$.useState([]),[z,L]=$.useState([]),F=$.useRef(null),[B,b]=$.useState(!1),[M,f]=$.useState([]),[u,v]=$.useState({}),[S,_]=$.useState({}),[j,T]=$.useState({}),R=$.useRef(null),[g,o]=$.useState({}),[O,D]=$.useState({}),[P,Y]=$.useState({}),[W,V]=$.useState(!1),[q,N]=$.useState({}),[Z,de]=$.useState({}),[ne,ee]=$.useState({}),[le,re]=$.useState({}),[ue,Fe]=$.useState({}),ye=$.useRef(null),[me,Te]=$.useState({}),[ae,ce]=$.useState({}),[be,Se]=$.useState({}),[xe,ve]=$.useState(!1),[ge,ie]=$.useState(""),[Ae,_e]=$.useState(()=>{}),[st,K]=$.useState(!1),[Ge,J]=$.useState(""),[ke,te]=$.useState("info"),[Ee,fe]=$.useState({design:!1,builds:!1,tests:!1}),Ue=async A=>{if(A.preventDefault(),!n){ie("All fields are required."),ve(!0);return}console.log("About to check image deletions",F.current),console.log(F.current),console.log(U.some(G=>G.deleted)),F.current&&U.some(G=>G.deleted)&&(console.log("Committing deletions"),await F.current.commitDeletions());const m=U.filter(G=>!G.deleted);z.some(G=>G.deleted)&&await xt();const C=z.filter(G=>!G.deleted);let H={title:y,description:n,dateModified:Qt(),images:m.map(G=>({url:G.url,title:G.title,path:G.path})),files:C.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path})),userId:e.uid};try{await ut(Ie(oe,"designs",d),H,{merge:!0}),J("Your design has been updated."),te("success"),K(!0);const G=Bn.now();I(Gt(G))}catch(G){console.error("Error updating design:",G),J("There was an issue updating your design."),te("error"),K(!0)}fe(G=>({...G,design:!1}))};$.useEffect(()=>{h&&(s(h.description||""),w(h.title||""),(async()=>{const m=Ie(oe,"designs",d),C=await ps(m);if(C.exists()){const H=C.data();console.log("Fetched images:",H.images),console.log("Fetched files:",H.files),E(H.images||[]),L(H.files||[]),c(Gt(H.dateCreated)),I(Gt(H.dateModified))}})())},[h,d]);const it=A=>{const m=U.filter(H=>!A.some(G=>G.path===H.path));console.log("Remaining images after deletion:",m),E(m);const C=m.map(H=>({url:H.url,title:H.title,path:H.path}));ut(Ie(oe,"designs",d),{images:C},{merge:!0}).then(()=>console.log("Firestore successfully updated")).catch(H=>console.error("Failed to update Firestore:",H))},bt=A=>{JSON.stringify(U)!==JSON.stringify(A)&&(E(A),console.log("Updated images received:",A))},xt=async()=>{const A=z.filter(m=>m.deleted);if(console.log("Files to delete:",A),A.length>0){const m=Et(),C=A.map(H=>{const G=jt(m,H.path);return un(G)});try{await Promise.all(C),console.log("Files deleted successfully");const H=z.filter(G=>!G.deleted);L(H),await wn(Ie(oe,"designs",h.id),{files:H.map(G=>({id:G.id,url:G.url,name:G.name,path:G.path}))}),J("Deleted files have been permanently removed."),te("success"),K(!0)}catch(H){console.error("Failed to delete files: ",H),J("Failed to delete files."),te("error"),K(!0)}}},Ke=async A=>{var G,X;try{await Tn(A)}catch(Q){console.error("Error deleting files:",Q),J("Failed to delete build files."),te("error"),K(!0)}const m=((G=S[A])==null?void 0:G.filter(Q=>!Q.deleted).map(({url:Q,path:pe,title:we})=>({url:Q,path:pe,title:we})))||[],C=((X=j[A])==null?void 0:X.filter(Q=>!Q.deleted).map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path})))||[],H={};m.length>0&&(H.images=m),C.length>0&&(H.files=C),u[A]!==void 0&&(H.description=u[A]);try{const Q=Ie(oe,"builds",A);await ut(Q,H,{merge:!0}),J("Your build has been updated."),te("success"),K(!0),Ce(),fe(pe=>({...pe,builds:!1}))}catch(Q){console.error("Error updating build:",Q),J("Failed to update build."),te("error"),K(!0)}},at=(A,m)=>{D(C=>({...C,[A]:m}))},Ot=(A,m)=>{v(C=>({...C,[A]:m})),fe(C=>({...C,builds:!0}))},he=async A=>{const m=O[A];try{const C=Ie(oe,"builds",A);await ut(C,{title:m},{merge:!0}),D(H=>{const G={...H};return delete G[A],G}),Ce()}catch(C){console.error("Failed to save build title:",C)}},Ce=async()=>{if(!e){console.log("User details not loaded yet");return}try{console.log("Refreshing builds for user UID:",e==null?void 0:e.uid),console.log("Selected design ID for query:",h==null?void 0:h.id);let A;e.isAdmin?A=Pe(Re(oe,"builds"),je("design_ID","==",d),tt("dateCreated")):A=Pe(Re(oe,"builds"),je("design_ID","==",d),je("userId","==",e.uid),tt("dateCreated")),console.log("Builds query details:",JSON.stringify(A,null,2));const m=await ft(A);console.log("Builds snapshot details:",JSON.stringify(m.docs.map(H=>H.data()),null,2)),console.log("Builds query successful, number of builds fetched: ",m.docs.length);const C=m.docs.map(H=>(console.log("Build doc path: ",H.ref.path),{id:H.id,...H.data()}));f(C),console.log("New builds state after refresh:",C)}catch(A){console.error("Error refreshing builds:",A),A.code==="permission-denied"?console.error("Permission denied when trying to refresh builds:",A):console.error("An unexpected error occurred when trying to refresh builds:",A)}},Je=(A,m)=>{const C=Ie(oe,"builds",A),H=S[A].filter(X=>!m.some(Q=>Q.path===X.path));_(X=>({...X,[A]:H}));const G=H.map(X=>({url:X.url,title:X.title,path:X.path}));ut(C,{images:G},{merge:!0}).then(()=>{console.log("Firestore successfully updated for build images"),J("Build Image deletions updated."),te("success")}).catch(X=>{console.error("Failed to update build images in Firestore:",X),J("Failed to update build image deletions."),te("error")}),K(!0)},et=async A=>{const m=Pe(Re(oe,"tests"),je("build_ID","==",A),je("userId","==",e.uid)),C=await ft(m);for(const H of C.docs)await It(Ie(oe,"tests",H.id));await It(Ie(oe,"builds",A)),await Ce(),J("Build and its tests (if any) deleted successfully."),te("success"),K(!0)},ct=A=>{ie("Are you sure you want to delete this build and all associated tests? This action cannot be undone."),_e(()=>()=>et(A)),ve(!0)},He=(A,m)=>{_(C=>({...C,[A]:m}))},ze=(A,m)=>{T(C=>({...C,[A]:m}))},Tn=async A=>{var C;const m=((C=j[A])==null?void 0:C.filter(H=>H.deleted))||[];if(console.log("Build files to delete:",m),m.length>0){const H=Et(),G=m.map(X=>{const Q=jt(H,X.path);return un(Q)});try{await Promise.all(G),console.log("Build files deleted successfully");const X=j[A].filter(Q=>!Q.deleted);T(Q=>({...Q,[A]:X})),await wn(Ie(oe,"builds",A),{files:X.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path}))}),console.log("Firestore successfully updated to remove deleted files"),J("Deleted build files have been permanently removed."),te("success"),K(!0)}catch(X){console.error("Failed to delete build files: ",X),J("Failed to delete build files."),te("error"),K(!0)}}},Zt=async(A,m)=>{var X;try{await nn(A)}catch(Q){console.error("Error deleting files:",Q),J("Failed to delete build files."),te("error"),K(!0)}const C={},H=le[A].filter(Q=>!Q.deleted).map(({url:Q,path:pe,title:we})=>({url:Q,path:pe,title:we})),G=((X=ue[A])==null?void 0:X.filter(Q=>!Q.deleted).map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path})))||[];q[A]!==void 0&&(C.description=q[A]),Z[A]!==void 0&&(C.results=Z[A]),ne[A]!==void 0&&(C.conclusions=ne[A]),C.images=H,C.files=G;try{const Q=Ie(oe,"tests",A);await ut(Q,C,{merge:!0}),J("Your test has been updated."),te("success"),K(!0),vt(m)}catch(Q){console.error(`Error updating test ID: ${A}:`,Q),J("There was an issue updating your test."),te("error"),K(!0)}},Kt=(A,m)=>{ce(C=>({...C,[A]:m}))},Jt=async(A,m)=>{const C=ae[A],H=Ie(oe,"tests",A);await ut(H,{title:C},{merge:!0}),ce(G=>{const X={...G};return delete X[A],X}),vt(m)},Ye=(A,m)=>{console.log(`Updating description for test ID ${A}:`,m),N(C=>({...C,[A]:m})),fe(C=>({...C,tests:!0}))},Ct=(A,m)=>{console.log(`Updating results for test ID ${A}:`,m),de(C=>({...C,[A]:m})),fe(C=>({...C,tests:!0}))},en=(A,m)=>{ee(C=>({...C,[A]:m})),fe(C=>({...C,tests:!0}))};$.useEffect(()=>{!t&&e&&(async()=>{if(!e)return;let m;e.isAdmin?m=Pe(Re(oe,"builds"),je("design_ID","==",d),tt("dateCreated")):m=Pe(Re(oe,"builds"),je("design_ID","==",d),je("userId","==",e.uid),tt("dateCreated"));const C=await ft(m);let H=[],G={},X={};for(const Q of C.docs){const pe=Q.data(),we=Q.id;H.push({id:we,...pe,images:pe.images||[],files:pe.files||[]}),X[we]=!0;let ot;e.isAdmin?ot=Pe(Re(oe,"tests"),je("build_ID","==",we),tt("dateCreated")):ot=Pe(Re(oe,"tests"),je("build_ID","==",we),je("userId","==",e.uid),tt("dateCreated"));const De=await ft(ot);let Nt=[],wt={},Sn={};for(const dt of De.docs){const lt=dt.data();Nt.push({id:dt.id,...lt}),wt[dt.id]=lt.images||[],Sn[dt.id]=lt.files||[]}G[we]=Nt,re(dt=>{let lt={...dt};for(const Lt in wt)lt[Lt]=wt[Lt];return lt}),Fe(dt=>{let lt={...dt};for(const Lt in Sn)lt[Lt]=Sn[Lt];return lt})}f(H),Y(G),Se(X)})()},[t,e,h.id,d]);const vt=async A=>{if(!e){console.log("User details not loaded yet");return}try{let m;e.isAdmin?m=Pe(Re(oe,"tests"),je("build_ID","==",A),tt("dateCreated")):m=Pe(Re(oe,"tests"),je("build_ID","==",A),je("userId","==",e.uid),tt("dateCreated"));const H=(await ft(m)).docs.map(Q=>({id:Q.id,...Q.data(),images:Q.data().images||[],files:Q.data().files||[]}));Y(Q=>({...Q,[A]:H}));let G={},X={};H.forEach(Q=>{G[Q.id]=Q.images,X[Q.id]=Q.files}),re(G),Fe(X)}catch(m){console.error("Error fetching tests:",m)}},tn=(A,m)=>{const C=Ie(oe,"tests",A),H=le[A].filter(X=>!m.includes(X));re(X=>({...X,[A]:H}));const G=H.map(({url:X,path:Q,title:pe})=>({url:X,path:Q,title:pe}));ut(C,{images:G},{merge:!0}).then(()=>{console.log("Firestore successfully updated for test images"),J("Test Image deletions updated."),te("success")}).catch(X=>{console.error("Failed to update test images in Firestore:",X),J("Failed to update test image deletions."),te("error")}),K(!0)},Mt=(A,m)=>{re(C=>({...C,[A]:m}))},qe=(A,m)=>{Fe(C=>({...C,[A]:m}))},nn=async A=>{var C;const m=((C=ue[A])==null?void 0:C.filter(H=>H.deleted))||[];if(m.length>0){const H=Et(),G=m.map(X=>{const Q=jt(H,X.path);return un(Q)});try{await Promise.all(G);const X=ue[A].filter(Q=>!Q.deleted);Fe(Q=>({...Q,[A]:X})),await wn(Ie(oe,"tests",A),{files:X.map(Q=>({id:Q.id,url:Q.url,name:Q.name,path:Q.path}))}),J("Deleted test files have been permanently removed."),te("success"),K(!0)}catch(X){console.error("Failed to delete test files: ",X),J("Failed to delete test files."),te("error"),K(!0)}}},rn=async(A,m)=>{await It(Ie(oe,"tests",A)),await vt(m),J("Test deleted successfully."),te("success"),K(!0)},sn=(A,m)=>{ie("Are you sure you want to delete this test? This action cannot be undone."),_e(()=>()=>rn(A,m)),ve(!0)},an=A=>{Se(m=>({...m,[A]:!m[A]}))},An=()=>{const A=Object.entries(Ee).filter(([C,H])=>H).map(([C])=>C).join(", ");if(!A.length){l();return}const m=`You have unsaved changes in the following sections: ${A}. Are you sure you want to leave?`;ie(m),_e(()=>()=>{fe({design:!1,builds:!1,tests:!1}),l()}),ve(!0)};return $.useEffect(()=>{const A=m=>{Object.values(Ee).some(H=>H)&&(m.preventDefault(),m.returnValue="")};return window.addEventListener("beforeunload",A),()=>window.removeEventListener("beforeunload",A)},[Ee]),a.jsxs("div",{className:"small-container",children:[a.jsx("button",{onClick:()=>{Object.values(Ee).some(m=>m)?An():l()},className:"muted-button margin-top-20",children:"â† All Designs"}),a.jsx("div",{className:"design-record",children:a.jsxs("form",{onSubmit:Ue,children:[a.jsx("h1",{className:"designHeader",style:{marginBottom:"20px"},children:"Design Document"}),a.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[a.jsxs("div",{style:{flexGrow:8,marginRight:"12px"},children:[a.jsx("label",{className:"designTitles",htmlFor:"title",children:"Title"}),a.jsx("input",{id:"title",type:"text",name:"title",value:y,onChange:A=>{w(A.target.value),fe(m=>({...m,design:!0}))},style:{width:"100%"}})]}),a.jsxs("div",{style:{flexGrow:2},children:[a.jsx("label",{className:"designTitles",htmlFor:"dateCreated",children:"Created"}),a.jsx("input",{id:"dateCreated",type:"text",name:"dateCreated",value:r||"",readOnly:!0,style:{width:"100%"}})]}),a.jsxs("div",{style:{flexGrow:2,marginLeft:"12px"},children:[a.jsx("label",{className:"designTitles",htmlFor:"dateModified",children:"Last Edited"}),a.jsx("input",{id:"dateModified",type:"text",name:"dateModified",value:p||"",readOnly:!0,style:{width:"100%"}})]})]}),a.jsx("label",{className:"designTitles",htmlFor:"description",children:"Description"}),a.jsxs("ul",{children:[a.jsx("li",{children:"Objective: What is the goal for this design?"}),a.jsx("li",{children:"Rationale: Why is this new design being done?"}),a.jsx("li",{children:"Selected Target: What is the target for the design being made?"}),a.jsx("li",{children:"Functional Modification: What is being done to this target?"}),a.jsx("li",{children:"Overview/Plan for making the modification: What are the steps to be carried out to meet the objective?"})]}),a.jsx(rt,{initialValue:n,onChange:A=>{s(A),fe(m=>({...m,design:!0}))}}),a.jsx(Dt,{ref:F,path:`designs/${h.id}/images`,initialImages:U,onImagesUpdated:bt,onDelete:it,isOwnDesign:i}),a.jsx(Rt,{path:`designs/${h.id}/files`,initialFiles:z,onFilesChange:L,isOwnDesign:i}),i&&a.jsxs("div",{style:{marginTop:"30px",display:"flex",justifyContent:"flex-end"},children:[a.jsx("input",{type:"submit",value:"Update"}),a.jsx("button",{style:{marginLeft:"12px"},className:"muted-button",type:"button",onClick:()=>x(!1),children:"Cancel"})]})]})}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex-space-between",children:[a.jsx("h2",{className:"buildsHeader",children:"Builds"}),i&&a.jsxs("button",{className:"button muted-button",onClick:()=>{b(!0),setTimeout(()=>{R.current&&R.current.scrollIntoView({behavior:"smooth"})},100)},style:{marginTop:"20px"},children:[a.jsx("span",{role:"img","aria-label":"Add Build",children:"âž•"})," Build"]})]}),M.map((A,m)=>a.jsxs("div",{className:"build-record",children:[a.jsxs("div",{className:"flex-space-between align-items-center",children:[a.jsx("div",{children:O[A.id]!==void 0?a.jsx(gn,{variant:"outlined",size:"small",fullWidth:!0,value:O[A.id],onChange:C=>at(A.id,C.target.value),onBlur:()=>he(A.id),autoFocus:!0,InputProps:{endAdornment:a.jsx(Ve,{onClick:()=>he(A.id),size:"small",children:a.jsx(Nn,{})})}}):a.jsx("div",{className:"buildTitle",onClick:()=>D(C=>({...C,[A.id]:A.title||`Build ${m+1}`})),style:{cursor:"pointer"},children:A.title||`Build ${m+1}`})}),a.jsxs("div",{children:[a.jsx("button",{onClick:()=>o(C=>({...C,[A.id]:!C[A.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:g[A.id]?a.jsx(mn,{}):a.jsx(_n,{})}),i&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>ct(A.id),children:a.jsx(Vt,{})}),a.jsxs("button",{className:"button muted-button",onClick:()=>{V(A.id),setTimeout(()=>{ye.current&&ye.current.scrollIntoView({behavior:"smooth"})},100)},children:[a.jsx("span",{role:"img","aria-label":"Add Test",children:"âž•"})," Test"]})]})]})]}),g[A.id]&&a.jsxs(a.Fragment,{children:[a.jsx(rt,{initialValue:u[A.id]||A.description,onChange:C=>{Ot(A.id,C)}}),a.jsx(Dt,{path:`builds/${A.id}/images`,initialImages:A.images,onImagesUpdated:C=>He(A.id,C),onDelete:C=>Je(A.id,C),isOwnDesign:i}),a.jsx(Rt,{path:`builds/${A.id}/files`,initialFiles:A.files,onFilesChange:C=>ze(A.id,C),isOwnDesign:i}),i&&a.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:a.jsx("button",{onClick:()=>Ke(A.id),children:"Update"})}),a.jsx("div",{children:P[A.id]&&P[A.id].length>0&&a.jsx("button",{onClick:()=>an(A.id),className:"button muted-button",style:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"12px",marginBottom:"12px"},children:be[A.id]?a.jsxs(a.Fragment,{children:[a.jsx(_n,{style:{marginRight:"8px"}}),"Tests"]}):a.jsxs(a.Fragment,{children:[a.jsx(mn,{style:{marginRight:"8px"}}),"Tests"]})})}),!be[A.id]&&P[A.id]&&P[A.id].map((C,H)=>a.jsxs("div",{className:"test-record",children:[a.jsxs("div",{className:"flex-space-between align-items-center",children:[a.jsx("div",{children:ae[C.id]!==void 0?a.jsx(gn,{variant:"outlined",size:"small",fullWidth:!0,value:ae[C.id],onChange:G=>Kt(C.id,G.target.value),onBlur:()=>Jt(C.id,A.id),autoFocus:!0,InputProps:{endAdornment:a.jsx(Ve,{onClick:()=>Jt(C.id,A.id),size:"small",children:a.jsx(Nn,{})})}}):a.jsx("div",{className:"testTitle",onClick:()=>ce(G=>({...G,[C.id]:C.title||`Test ${H+1}`})),style:{cursor:"pointer"},children:C.title||`Test ${H+1}`})}),a.jsxs("div",{children:[a.jsx("button",{onClick:()=>Te(G=>({...G,[C.id]:!G[C.id]})),className:"button muted-button",style:{border:"none",background:"none"},children:me[C.id]?a.jsx(mn,{}):a.jsx(_n,{})}),i&&a.jsx("button",{className:"button muted-button",style:{border:"none",background:"none"},onClick:()=>sn(C.id,A.id),children:a.jsx(Vt,{})})]})]}),me[C.id]&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",children:"Description"}),a.jsx(rt,{initialValue:q[C.id]||C.description,onChange:G=>{Ye(C.id,G)}})]}),a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",children:"Results"}),a.jsx(rt,{initialValue:Z[C.id]||C.results,onChange:G=>{Ct(C.id,G)}})]}),a.jsxs("div",{children:[a.jsx("label",{className:"testTitles",children:"Conclusions"}),a.jsx(rt,{initialValue:ne[C.id]||C.conclusions,onChange:G=>{en(C.id,G)}})]}),a.jsxs("div",{children:[a.jsx(Dt,{path:`tests/${C.id}/images`,initialImages:le[C.id]||[],onImagesUpdated:G=>Mt(C.id,G),onDelete:G=>tn(C.id,G),isOwnDesign:i}),a.jsx(Rt,{path:`tests/${C.id}/files`,initialFiles:ue[C.id]||[],onFilesChange:G=>qe(C.id,G),isOwnDesign:i})]}),i&&a.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:a.jsx("button",{onClick:()=>Zt(C.id,A.id),children:"Update"})})]})]},C.id))]}),W===A.id&&a.jsxs("div",{className:"new-test-record",ref:ye,children:[a.jsx("h3",{className:"newTestHeader",children:"New Test"}),a.jsx(ba,{designId:h.id,buildId:A.id,refreshTests:()=>vt(A.id),setAddingTestIdForBuild:V,onImagesUpdated:C=>Mt(A.id,C),onFilesChange:C=>qe(A.id,C)})]})]},A.id)),a.jsx("div",{children:B&&a.jsxs("div",{className:"new-build-record",ref:R,children:[a.jsx("h3",{className:"newBuildHeader",children:"New Build"}),a.jsx(pa,{designId:h.id,setIsAddingBuild:b,refreshBuilds:Ce,onImagesUpdated:A=>He(build.id,A),onFilesChange:A=>ze(build.id,A)})]})})]}),a.jsxs(At,{open:xe,onClose:()=>ve(!1),children:[a.jsx(Ft,{children:"Confirmation Required"}),a.jsx(St,{children:a.jsx(Xt,{children:ge})}),a.jsxs(kt,{children:[a.jsx(Ne,{onClick:()=>ve(!1),children:"Cancel"}),a.jsx(Ne,{onClick:()=>{Ae(),ve(!1)},autoFocus:!0,children:"Confirm"})]})]}),a.jsx(ht,{open:st,autoHideDuration:6e3,onClose:()=>K(!1),children:a.jsx(mt,{onClose:()=>K(!1),severity:ke,sx:{width:"100%"},children:Ge})})]})},Aa=()=>{const{userDetails:h,loading:x}=Ut();console.log("Dashboard loaded");const[k,l]=$.useState([]),[e,t]=$.useState([]),[d,i]=$.useState(null),[y,w]=$.useState(!1),[n,s]=$.useState(!1),[r,c]=$.useState(!1),[p,I]=$.useState(""),[U,E]=$.useState(""),[z,L]=$.useState(!1),[F,B]=$.useState(null),[b,M]=$.useState(!1),[f,u]=$.useState(""),[v,S]=$.useState("info"),_=()=>{s(!1),w(!1),i(null),j()},j=$.useCallback(async()=>{let o;h&&h.isAdmin?o=Pe(Re(oe,"designs"),tt("dateCreated","desc")):h&&(o=Pe(Re(oe,"designs"),je("userId","==",h.uid),tt("dateCreated","desc")));const O=await ft(o||Pe(Re(oe,"designs"))),D=[],P=[];O.forEach(Y=>{const W=Y.data(),V={id:Y.id,title:W.title,description:W.description,dateCreated:W.dateCreated,dateModified:W.dateModified,userId:W.userId,images:W.images||[],files:W.files||[]};W.userId===(h==null?void 0:h.uid)?D.push(V):P.push(V)}),l(D),t(P)},[h]);$.useEffect(()=>{!x&&h&&j()},[h,x,j]);const T=o=>{const O=[...k,...e].find(D=>D.id===o);i(O||null),s(!0)},R=o=>{B(o),I("Are you sure you want to delete this design? This action cannot be undone."),c(!0)},g=async()=>{if(F)if(U!==(h==null?void 0:h.uid))u("User ID confirmation failed. Enter the correct User ID."),S("error"),M(!0);else try{const o=Pe(Re(oe,"builds"),je("design_ID","==",F),je("userId","==",h.uid)),O=await ft(o);for(const D of O.docs){const P=D.id,Y=Pe(Re(oe,"tests"),je("build_ID","==",P),je("userId","==",h.uid)),W=await ft(Y);for(const V of W.docs)await It(Ie(oe,"tests",V.id));await It(Ie(oe,"builds",P))}await It(Ie(oe,"designs",F)),l(D=>D.filter(P=>P.id!==F)),t(D=>D.filter(P=>P.id!==F)),u("Your design and its associated builds and tests have been deleted."),S("success"),M(!0)}catch(o){console.error("Error deleting design, builds, and tests: ",o),u("There was an issue deleting your design and its associated builds and tests."),S("error"),M(!0)}finally{E(""),L(!1),B(null)}};return a.jsxs("div",{className:"container",children:[!y&&!n&&a.jsxs(a.Fragment,{children:[a.jsx(As,{setIsAdding:w}),(h==null?void 0:h.isAdmin)&&a.jsxs(a.Fragment,{children:[a.jsx("h2",{children:"Admin Designs"}),a.jsx(En,{designs:k,handleEdit:T,handleDelete:R,isAdmin:!0,userDetails:h,showUserIdColumn:!0}),a.jsx("h2",{children:"Users' Designs"}),a.jsx(En,{designs:e,handleEdit:T,handleDelete:R,isAdmin:!1,userDetails:h,showUserIdColumn:!0})]}),!(h!=null&&h.isAdmin)&&a.jsx(En,{designs:k,handleEdit:T,handleDelete:R,isAdmin:!1,userDetails:h,showUserIdColumn:!1})]}),y&&a.jsx(ga,{designs:k,setDesigns:l,setIsAdding:w,getDesigns:j,onReturnToDashboard:_}),n&&a.jsx(Ta,{designs:k,selectedDesign:d,setDesigns:l,setIsEditing:s,getDesigns:j,onReturnToDashboard:_}),a.jsxs(At,{open:r,onClose:()=>c(!1),PaperProps:{style:{minWidth:500}},children:[a.jsx(Ft,{children:"Confirm Deletion"}),a.jsx(St,{children:a.jsx(Xt,{children:p})}),a.jsxs(kt,{children:[a.jsx(Ne,{onClick:()=>c(!1),children:"No, cancel"}),a.jsx(Ne,{onClick:()=>{L(!0),c(!1)},color:"primary",children:"Yes, delete it"})]})]}),a.jsxs(At,{open:z,onClose:()=>L(!1),PaperProps:{style:{minWidth:500}},children:[a.jsx(Ft,{children:"Confirm Your User ID"}),a.jsx(St,{children:a.jsx(gn,{autoFocus:!0,margin:"dense",id:"userId-confirm",label:"User ID",type:"text",fullWidth:!0,variant:"outlined",value:U,onChange:o=>E(o.target.value)})}),a.jsxs(kt,{children:[a.jsx(Ne,{onClick:()=>L(!1),children:"No, cancel"}),a.jsx(Ne,{onClick:g,color:"primary",children:"Confirm"})]})]}),a.jsx(ht,{open:b,autoHideDuration:6e3,onClose:()=>M(!1),children:a.jsx(mt,{onClose:()=>M(!1),severity:v,sx:{width:"100%"},children:f})})]})},wa=bs.memo(Aa);export{wa as default};
